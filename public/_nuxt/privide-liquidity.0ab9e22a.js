import{a as ut,b as Kt,n as gt,d as Te,u as yt,e as je,c as qe,i as Jt,s as pt,T as St,p as Nt,f as ze,g as At}from"./pool.33aab128.js";import{a as rt,r as G,m as L,y as qt,D as Me,e as nt,o as h,f as I,c as Ze,x,h as a,t as _t,G as Mt,H as bt,v as le,u as Pe,F as it,J as Ct,p as $t,k as Rt,z as Je,s as ht,j as Pt,l as Ot,E as Tt,C as Bt,q as Qt,i as Ee,b as Yt,w as xt,I as Vt,B as eo}from"./entry.a8601451.js";/* empty css              */import{s as lt,m as to,l as oo,b as io,a as ro,_ as no}from"./transform.d533a7bc.js";import{D as c}from"./decimal.0e8aa3f1.js";import{u as ct,a as ao}from"./sha256.6b1ed61e.js";import"./decimal.633e31ee.js";import{g as lo}from"./common-fun.471b0caa.js";import{c as Ft,_ as Ut,b as jt,a as zt}from"./new-liquidity-title.75e0fbbb.js";import{i as wt}from"./import-icon.de3e6c66.js";import{positionError as ot,tickList as tt,direction as $e,minPrice as Z,maxPrice as z,fromCoin as y,toCoin as _,currentPrice as st,currentPriceReverse as kt,currentPriceTab as oe,defaultMinPrice as vt,defaultMaxPrice as ft,toggle as Dt,isInputTotalAmount as We,priceConfigObj as Qe,fromCoinAmount as S,toCoinAmount as N,fixedFromCoin as Ce,resetTickList as Lt,resetData as so}from"./data.9dd61b78.js";import{_ as uo}from"./coin-select.698e1175.js";import{_ as co}from"./viewDetail.a6d41f6f.js";import{_ as mo}from"./token-warning-modal.8e709a33.js";import{b as vo}from"./new-add-or-create.e885f4b7.js";/* empty css              */import{u as fo}from"./notifi.09f40938.js";import{_ as go,a as po}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.a2707f96.js";import"./precision.a7a6c57b.js";/* empty css              */import"./tick.505fdad3.js";import"./token-warning.a1bbf628.js";/* empty css              */import"./refresh-icon.858fb5ce.js";/* empty css              */import"./swap-setting.7b75dd5b.js";/* empty css              */import"./img-no-Positions_2x.0466a283.js";import"./status-block.f3fe33fe.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./icon-selected_3x.09e9a6f0.js";import"./useWhale.18edd5a9.js";import"./index.aeaaa210.js";function It(e,u,ve){const D=new c(10).pow(u-ve);return new c(1.0001).pow(e).mul(D)}const bo=rt({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,u){const ve=G(""),D=G(""),F=L(()=>{var i,p,n,A,U,te;return console.log(e.poolInfo,"===>props.poolInfo"),(i=e.poolInfo)!=null&&i.current_sqrt_price&&((p=e.poolInfo)!=null&&p.coinA.decimals)&&((n=e.poolInfo)!=null&&n.coinB.decimals)?s.sqrtPriceX64ToPrice((A=e.poolInfo)==null?void 0:A.current_sqrt_price,(U=e.poolInfo)==null?void 0:U.coinA.decimals,(te=e.poolInfo)==null?void 0:te.coinB.decimals).toString():"0"}),pe=L(()=>{let i=0;return e.direction?i=(Number(e.minPrice)/Number(F.value)-1)*100:i=(Number(e.minPrice)/Number(1/Number(F.value))-1)*100,i=i>0&&i<.1?.1:i,i=i<0&&i>-.1?-.1:i,i}),H=L(()=>{let i=0;return e.direction?i=(Number(e.maxPrice)/Number(F.value)-1)*100:i=(Number(e.maxPrice)/Number(1/Number(F.value))-1)*100,i=i>0&&i<.1?.1:i,i=i<0&&i>-.1?-.1:i,i}),q=ct(),w=L(()=>q),V=L(()=>w.value.chainName?ut(w.value.chainName):{}),{TickMath:s,getNearestTickByTick:r}=V.value,W=(i=[])=>{let p=6;const n=Math.abs(Number(i[0])-Number(i[i.length-1]));return n>=6?p=0:n>=1?p=1:n>=.1?p=2:n>=.01?p=3:n>=.001?p=4:n>=1e-4?p=5:n>=1e-5?p=6:n>=1e-6?p=7:n>=1e-7&&(p=8),p},ee=(i,p=1)=>{if(i&&i.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const n=Number(e.poolInfo.current_tick_index);console.log("0117###dataProcessing###currentTick###",n),console.log("0117###dataProcessing###props.poolInfo###",e.poolInfo),console.log("0117###dataProcessing###minPrice###",e.minPrice),console.log("0117###dataProcessing###maxPrice###",e.maxPrice),console.log("0117###dataProcessing###poolInfo###",e.poolInfo);let A=n+100*p,U=n-100*p,te,ae;if(e.maxPrice==="∞")ae=V.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ae=s.priceToTickIndex(new c(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ae=s.priceToTickIndex(new c(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ae=443636}if(e.minPrice==="0")te=V.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?te=s.priceToTickIndex(new c(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):te=s.priceToTickIndex(new c(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{te=-443636}let ce=0;if(e.currentPriceTab!=="full range"){if(n>=te&&n<=ae){const T=n-te,re=ae-n;ce=Math.max(Math.abs(T),Math.abs(re))}else n<te?ce=Math.abs(ae-n):ce=Math.abs(n-te);A=n+ce+100*p,U=n-ce-100*p}else{const T=(Math.abs(n)>5e3,2e4);A=n+T*p,U=n-T*p}U<-443636&&(U=-443636),A>443636&&(A=443636);const v=new c(i.liquidity).div(Math.pow(10,8)).toString(),M=e.tickList;console.log("0117####drawChart####tick_info_array####",M);const O=[],C=[];let P={};for(let T=0;T<M.length;T++){if(P=M[T],P.index<=n&&P.index>=U){if(O.length<1&&T!==0){const re=M[T-1];O.unshift({...re,index:U})}O.unshift(P)}else if(P.index>n&&P.index<=A&&(C.push(P),O.length<1&&T!==0)){const re=M[T-1];O.push({...re,index:U})}if(P.index>A){const re=M[T];if(C.push({...re,index:A}),O.length<1&&T!==0){const Ye=M[T-1];O.push({...Ye,index:U})}break}}let E="0";for(let T=O.length-1;T>=0;T--)E=new c(E).plus(new c(O[T].liquidityNet.toString()).div(Math.pow(10,8))).toString(),O[T].liquityAmount=E;let $=v;for(let T=0;T<C.length;T++)$=new c($).plus(new c(C[T].liquidityNet.toString()).div(Math.pow(10,8))).toString(),C[T].liquityAmount=$;let X=[];const R=M&&M.length>0?{index:n,liquityAmount:Number(v)}:{index:n,liquityAmount:0};(O.length>0||C.length>0)&&(X=[...O.reverse(),R,...C],e.direction||(X=X.reverse()));const Ae=[];M.forEach(T=>{Ae.push({...T,liquidityGross:T.liquidityGross.toString(),liquidityNet:T.liquidityNet.toString()})}),console.log("0117####drawChart####testTickInfoArray####",Ae),console.log("0117####drawChart####currentLiquity####",v),l(X,U,A,te,ae,n)}};let K=G(!1);qt(()=>{document.body.clientWidth<750?K.value=!1:K.value=!0,window.onresize=()=>{document.body.clientWidth<750?K.value=!1:K.value=!0,ee(e.poolInfo,e.zoom)}});const l=(i,p,n,A,U,te)=>{console.log("0117####drawChart####chartData####",i),console.log("0117####drawChart####tickMin####",p),console.log("0117####drawChart####tickMax####",n),console.log("0117####drawChart####minPriceTick####",A),console.log("0117####drawChart####maxPriceTick####",U),console.log("0117####drawChart####currentTick####",te),console.log("0117####drawChart####props.direction####",e.direction),console.log("0518###newd3###props.before7dContractPriceLowest###",e.before7dContractPriceLowest),console.log("0518###newd3###props.before7dContractPriceHighest###",e.before7dContractPriceHighest);let ae,ce;e.direction?(ae=e.before7dContractPriceLowest?s.priceToTickIndex(new c(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ce=e.before7dContractPriceHighest?s.priceToTickIndex(new c(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ae=e.before7dContractPriceLowest?s.priceToTickIndex(new c(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ce=e.before7dContractPriceHighest?s.priceToTickIndex(new c(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const v={top:30,right:35,bottom:20,left:55};let M,O;K.value?(M=460-v.left-v.right,O=205-v.top-v.bottom):(M=340-v.left-v.right,O=205-v.top-v.bottom);const C=n-p,P=parseInt(String(C/4));let E=[p+P/4,p+P,p+2*P,n-P,n-P/4];const $=p,X=n,R=M/(X-$);e.currentPriceTab==="full range"&&(E=[p,p+2*P,n]),console.log("0117####drawChart####xArr####",E),console.log("0117####drawChart####utickMin####",$),console.log("0117####drawChart####utickMax####",X),console.log("0117####drawChart####unit####",R);const Ae=E.map(d=>e.direction?It(d,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new c(1).div(It(d,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),T=W(Ae);lt("#chart").selectAll("*").remove();const re=lt("#chart").attr("width",M+v.left+v.right).attr("height",O+v.top+v.bottom).append("g").attr("transform",`translate(${v.left},${v.right})`),Ye=to(i,function(d){return Number(Math.abs(d.liquityAmount))})||0,t=oo().range([0,O]).domain([Ye,0]);io().rangeRound([0,M]).padding(.1);const B=re.append("g").attr("id","barsBox").selectAll("rect").data(i).enter().append("rect");w.value.theme=="default"?B.attr("x",function(d,m){return m===0?0:e.direction?Math.abs(d.index-$)*R:Math.abs(X-d.index)*R}).attr("y",function(d,m){return e.direction?m===i.length-1?0:t(d.liquityAmount):m===i.length-1?0:t(i[m+1].liquityAmount)}).attr("width",function(d,m){return m===0&&i.length===1&&d.liquityAmount>0?M:(e.direction,m!==i.length-1?Math.abs(i[m+1].index-d.index)*R:0)}).attr("height",function(d,m){return m===0&&i.length===1&&d.liquityAmount>0?O:e.direction?m===i.length-1?0:O-t(d.liquityAmount):m===i.length-1?0:O-t(i[m+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):B.attr("x",function(d,m){return m===0?0:e.direction?Math.abs(d.index-$)*R:Math.abs(X-d.index)*R}).attr("y",function(d,m){return e.direction?m===i.length-1?0:t(Math.abs(d.liquityAmount)):m===i.length-1?0:t(Math.abs(i[m+1].liquityAmount))}).attr("width",function(d,m){return m===0&&i.length===1&&d.liquityAmount>0?M:(e.direction,m!==i.length-1?Math.abs(i[m+1].index-d.index)*R:0)}).attr("height",function(d,m){if(m===0&&i.length===1&&d.liquityAmount>0)return O;if(e.direction)return m===i.length-1?0:Number(d.liquityAmount)?O-t(Math.abs(d.liquityAmount)):0;{if(m===i.length-1)return 0;const Fe=O-t(Math.abs(i[m+1].liquityAmount));return Number(i[m+1].liquityAmount)?Fe:0}}).attr("fill","#407497").attr("class","bars").attr("stroke-width",1).attr("stroke","#407497");const j=re.append("g");j.append("line").attr("x1",0).attr("y1",155).attr("x2",M).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const we=j.append("g");let Q=0;if(e.direction){for(let d=0;d<E.length;d++){const m=Te(Ae[d],T)||"0";console.log("0423####price####",m),Ae.push(m);const Fe=Math.abs(E[d]-$)*R;let fe=0;for(let ge=0;ge<m.length;ge++)m[ge]==="1"?fe+=4.02:m[ge]==="."?fe+=2.64:m[ge]==="7"?fe+=5.48:fe+=6;console.log(Fe,"x=>>>"),we.append("text").text(m).attr("x",Fe-fe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}Q=Math.abs(te-$)*R}else{for(let d=E.length-1;d>=0;d--){const m=Te(Ae[d],T)||0;Ae.push(m);const Fe=Math.abs(E[d]-X)*R;let fe=0;for(let ge=0;ge<m.length;ge++)m[ge]==="1"?fe+=4.02:m[ge]==="."?fe+=2.64:m[ge]==="7"?fe+=5.48:fe+=6;we.append("text").text(m).attr("x",Fe-fe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}Q=Math.abs(te-X)*R}(w.value.theme=="default"?re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+Q+", 0)");let ke,De,Ge,Oe;e.direction?(console.log("0525###d3###select###minPriceTick###",A),console.log("0525###d3###select###maxPriceTick###",U),console.log("0525###d3###select###props.minPrice###",e.minPrice),console.log("0525###d3###select###props.maxPrice###",e.maxPrice),ke=A<$?-100:parseInt(String(Math.abs(A-$)*R)),De=U<$?-100:parseInt(String(Math.abs(U-$)*R)),Ge=ae<$?-100:Math.abs(ae-$)*R,Oe=ce<$?-100:Math.abs(ce-$)*R):(De=A<$?-100:Math.abs(X-A)*R,ke=U<$?-100:Math.abs(X-U)*R,Oe=ae<$?-100:Math.abs(X-ae)*R,Ge=ce<$?-100:Math.abs(X-ce)*R),e.minPrice==="0"&&(ke=0),e.maxPrice==="∞"&&(De=M),console.log(ke,"==>minPriceTickX"),K.value?ve.value=M-ke+155+"px":ve.value=M-ke+52+"px",D.value=De+74+"px",ae&&Ge<M&&re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+Ge+", 0)"),ce&&Oe<M&&re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+Oe+", 0)");const be=re.append("g").attr("id","left-handle"),Be=re.append("g").attr("id","right-handle");w.value.theme=="default"?(be.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),be.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),be.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),be.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),Be.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),Be.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),Be.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),Be.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(be.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),be.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),be.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),be.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),Be.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),Be.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),Be.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),Be.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),console.log("0525###d3###select###minPriceTickX###",ke),console.log("0525###d3###select###maxPriceTickX###",De),be.attr("transform","translate("+ke+", 0)"),Be.attr("transform","translate("+De+", 0)");const xe=ro().extent([[0,0],[M,O]]).handleSize(30).on("end",at);re.append("g").attr("class","brush").call(xe).call(xe.move,[ke,De]);function at(d){if(!d.sourceEvent||!d.selection)return;be.attr("transform","translate("+d.selection[0]+", 0)"),Be.attr("transform","translate("+d.selection[1]+", 0)"),K.value?ve.value=M-d.selection[0]+60+"px":ve.value=M-d.selection[0]+52+"px",D.value=d.selection[1]+74+"px";let m,Fe;console.log("0525###d3###select###e.selection[0]###",d.selection[0]),console.log("0525###d3###select###e.selection[0]###",d.selection[1]),console.log("0525###d3###select###props.direction###",e.direction),console.log("0525###d3###select###width###",M),console.log("0525###d3###select###unit###",R),console.log("0525###d3###select###utickMin###",$),console.log("0525###d3###select###utickMax###",X),console.log("0525###d3###select###props.poolInfo###",e.poolInfo);let fe=0,ge=0;e.direction?(fe=r(parseInt(String(d.selection[0]/R+$)),Number(e.poolInfo.tickSpacing)),m=s.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),ge=r(parseInt(String(d.selection[1]/R+$)),Number(e.poolInfo.tickSpacing)),Fe=s.tickIndexToPrice(ge,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),console.log("0525###d3###select###minTick###",fe),console.log("0525###d3###select###maxTick###",ge),console.log("0525###d3###select###minPrice###",m),console.log("0525###d3###select###maxPrice###",Fe)):(ge=r(X-d.selection[0]/R,Number(e.poolInfo.tickSpacing)),m=1/s.tickIndexToPrice(ge,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),fe=r(X-d.selection[1]/R,Number(e.poolInfo.tickSpacing)),Fe=1/s.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),u.emit("onChangeMinPrice",String(Te(String(m),6))),u.emit("onChangeMaxPrice",String(Te(String(Fe),6)))}w.value.theme=="default"?lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632")};G(""),Me(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom],([i,p,n,A,U])=>{console.log(i,p,n,n>p,"poolInfo && minPrice && maxPrice && (maxPrice > minPrice)"),i&&p&&n&&(i!=null&&i.liquidity)&&(A!=="Custom"||console.log("绘制"),ee(i,U))},{immediate:!0});const f=G(!1);return Me(()=>e.chartLoading,(i,p)=>{i!==p&&(f.value=i)},{immediate:!0,deep:!0}),console.log(e,"props===>"),{store:w,loading:f,rangeSizeLower:pe,rangeSizeUpper:H,rangeSizeLowerPosition:ve,rangeSizeUpperPosition:D,decimalFormat:Kt,numberformat:gt}}});const ho=e=>($t("data-v-a4488f02"),e=e(),Rt(),e),wo={class:"chart-box"},ko={class:"chart"},yo=ho(()=>a("svg",{id:"chart"},null,-1));function _o(e,u,ve,D,F,pe){const H=Ct;return h(),I(it,null,[e.tickList&&e.tickList.length>0&&e.loading?(h(),Ze(H,{key:0})):x("",!0),a("div",wo,[_t(a("div",ko,[e.currentPriceTab!=="full range"?(h(),I("div",{key:0,class:"range-size range-size-lower",style:bt({right:e.rangeSizeLowerPosition})},le(("numberformat"in e?e.numberformat:Pe(gt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):x("",!0),e.currentPriceTab!=="full range"?(h(),I("div",{key:1,class:"range-size range-size-upper",style:bt({left:e.rangeSizeUpperPosition})},le(("numberformat"in e?e.numberformat:Pe(gt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):x("",!0),yo],512),[[Mt,!e.loading]])])],64)}const Ht=nt(bo,[["render",_o],["__scopeId","data-v-a4488f02"]]),Co=rt({props:{aprRewardsParameter:{type:Number,default:30},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},fromCoin:{type:Object,default:()=>({})},toCoin:{type:Object,default:()=>({})},poolInfo:{type:Object,default:()=>({})},nameTab:{type:String,default:""}},setup(e){const u=[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}],ve=ct(),D=L(()=>ve);L(()=>D.value.chainName);const F=yt(),pe=L(()=>F),H=L(()=>D.value.chainName?ut(D.value.chainName):{}),q=G(),w=async r=>{var te,ae,ce;console.log("0607###detail###getAprMethod###poolInfo###",r),console.log("0607###detail###getAprMethod###props.fromCoin###",e.fromCoin),console.log("0607###detail###getAprMethod###props.toCoin###",e.toCoin),console.log("0607###detail###getAprMethod###props.nameTab###",e.nameTab);let W;r.token_a.address.toLowerCase()===e.fromCoin.address.toLowerCase()&&r.token_b.address.toLowerCase()===e.toCoin.address.toLowerCase()?W=!0:W=!1,console.log("0607###detail###getAprMethod###directs###",W),console.log("0607###detail###getAprMethod###props.minPrice###",e.minPrice),console.log("0607###detail###getAprMethod###props.maxPrice###",e.maxPrice);let ee,K;W?(ee=Number(e.minPrice),K=isNaN(Number(e.maxPrice))?2**50:Number(e.maxPrice)):e.maxPrice!=="∞"?(ee=1/Number(e.maxPrice),K=1/Number(e.minPrice)):(ee=1/2**50,K=2**50),console.log("0607###detail###getAprMethod###lowerUserPrice###",ee),console.log("0607###detail###getAprMethod###upperUserPrice###",K);let l=[];l=D.value&&D.value.addressHistTokens&&D.value.addressHistTokens[r.poolAddress]&&D.value.addressHistTokens[r.poolAddress].data&&D.value.addressHistTokens[r.poolAddress].data.length>0&&Object.fromEntries(D.value.addressHistTokens[r.poolAddress].data.map(v=>[v.key,v.value]));let f,i;console.log(l,"===>addressHistTokensList"),e.aprRewardsParameter==7?(f=Number(l==null?void 0:l.before_7_d_contract_price_lowest),i=Number(l==null?void 0:l.before_7_d_contract_price_highest)):e.aprRewardsParameter==24?(f=Number(l==null?void 0:l.before_24_h_contract_price_lowest),i=Number(l==null?void 0:l.before_24_h_contract_price_highest)):(f=Number(l==null?void 0:l.before_30_d_contract_price_lowest),i=Number(l==null?void 0:l.before_30_d_contract_price_highest));const p=pe.value.tokensObj;console.log("getEstPositionAPRWithMulti###params###lowerUserPrice###",ee),console.log("getEstPositionAPRWithMulti###params###upperUserPrice###",K),console.log("getEstPositionAPRWithMulti###params###lowerHistPrice###",f),console.log("getEstPositionAPRWithMulti###params###upperHistPrice###",i);const n=await H.value.getEstPositionAPRWithMulti(ee,K,f,i);console.log("getEstPositionAPRWithMulti###resMulti###",n.toString());const A=D.value.newTopPoolsObj[r.poolAddress];console.log(r,"#####stats");let U;if(A){e.aprRewardsParameter==7?U=Number(A.apr_7day.replace("%","")):e.aprRewardsParameter==24?U=Number(A.apr_24h.replace("%","")):U=Number(A.apr_30day.replace("%",""));const v=Number(A.rewarder_apr[0].replace("%","")),M=Number(A.rewarder_apr[1].replace("%","")),O=Number(A.rewarder_apr[2].replace("%","")),C=new c(n.toString()).mul(U).toNumber();console.log(n.toString(),"===>resMulti.toString()");const P=new c(n.toString()).mul(v).toNumber(),E=new c(n.toString()).mul(M).toNumber(),$=new c(n.toString()).mul(O).toNumber();console.log(P,E,$,"posRewarder2_apr##");const X=C+(r.rewarder_display1?P:0)+(r.rewarder_display2?E:0)+(r.rewarder_display3?$:0);console.log(X,"###aprPercentageTotal");const R=r.rewarder_infos[0]?(te=p[r.rewarder_infos[0].coinAddress])==null?void 0:te.symbol:"--",Ae=r.rewarder_infos[1]?(ae=p[r.rewarder_infos[1].coinAddress])==null?void 0:ae.symbol:"--",T=r.rewarder_infos[2]?(ce=p[r.rewarder_infos[2].coinAddress])==null?void 0:ce.symbol:"--",re={aprFee:C==1/0||isNaN(C)?0:C,rewardAprList:[{rewarder_name:R,rewarder_apr:P==1/0||isNaN(P)?0:P,styleName:"one",rewarder_display:r.rewarder_display1},{rewarder_name:Ae,rewarder_apr:E==1/0||isNaN(E)?0:E,styleName:"two",rewarder_display:r.rewarder_display2},{rewarder_name:T,rewarder_apr:$==1/0||isNaN($)?0:$,styleName:"three",rewarder_display:r.rewarder_display2}],aprPercentageTotal:X==1/0||isNaN(X)||X===0?0:X,aprPercentage:Jt(C/X,2),is_display_rewarder:r.is_display_rewarder};q.value=re,console.log(q.value,"===>aprPercentageObj.value")}};Me(()=>[e.poolInfo,e.minPrice,e.maxPrice,D.value.addressHistTokens],([r,W,ee,K])=>{r&&!qe(r)&&K&&!qe(K)&&w(r)},{immediate:!0});const V=L(()=>lo(e.poolInfo,pe,D));Me(()=>[e.aprRewardsParameter],()=>{w(e.poolInfo)});const s=L(()=>{const r=q.value;return r&&r.is_display_rewarder?(r==null?void 0:r.aprPercentageTotal)>1e4?">10000":r.aprPercentageTotal<.01&&r.aprPercentageTotal>0?"<0.01":je(r.aprPercentageTotal,2):r&&!r.is_display_rewarder?(r==null?void 0:r.aprFee)>1e4?">10000":r.aprFee<.01&&r.aprFee>0?"<0.01":je(r.aprFee,2):"--"});return{poolMoreInfo:V,timeList:u,aprPercentageObj:q,totalApr:s}}}),Po=""+globalThis.__publicAssetsURL("sui-image/farming.png");const dt=e=>($t("data-v-e912aa95"),e=e(),Rt(),e),To={class:"est-apr"},So=dt(()=>a("div",{class:"title"},"Estimated APR",-1)),No={class:"apr-total"},Ao={class:"apr-box"},Lo={key:0,class:"apr-hover-content"},Io={class:"progress-fees progress-all"},qo=dt(()=>a("div",null,[a("div",{class:"light-hint"}),Pt(" Fees ")],-1)),Mo={key:0,class:"isFarming"},$o=dt(()=>a("img",{src:Po,alt:""},null,-1)),Ro=dt(()=>a("div",{class:"hover-text"},"Farming rewards available",-1)),Oo=[$o,Ro],Bo={class:"time-list"},Fo=["onClick"];function Uo(e,u,ve,D,F,pe){var H,q,w,V,s,r,W,ee,K;return h(),I("div",To,[So,a("div",No,[a("div",Ao,[a("span",{class:Je(e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?"haveBorder":"")},le(e.totalApr)+"%",3),e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?(h(),I("div",Lo,[a("div",Io,[qo,a("span",null,"  "+le((H=e.aprPercentageObj)!=null&&H.aprFee?((q=e.aprPercentageObj)==null?void 0:q.aprFee)>1e4?">10,000":((w=e.aprPercentageObj)==null?void 0:w.aprFee)<.01?"<0.01":("addCommom"in e?e.addCommom:Pe(je))((V=e.aprPercentageObj)==null?void 0:V.aprFee,2):(s=e.aprPercentageObj)!=null&&s.rewardAprList?"<0.01":"--")+"%",1)]),(h(!0),I(it,null,ht((r=e.aprPercentageObj)==null?void 0:r.rewardAprList,l=>_t((h(),I("div",{key:l,class:"progress-rewards progress-all"},[a("div",null,[a("div",{class:Je(["light-hint",l==null?void 0:l.styleName])},null,2),Pt(" "+le(l==null?void 0:l.rewarder_name)+" Rewards ",1)]),a("span",null,"  "+le(l!=null&&l.rewarder_apr?(l==null?void 0:l.rewarder_apr)>1e4?">10,000":(l==null?void 0:l.rewarder_apr)<.01?"<0.01":("addCommom"in e?e.addCommom:Pe(je))(l==null?void 0:l.rewarder_apr,2):"0")+"%",1)])),[[Mt,(l==null?void 0:l.rewarder_name)!="--"&&l.rewarder_display&&e.aprPercentageObj.is_display_rewarder]])),128))])):x("",!0)]),(W=e.poolInfo)!=null&&W.is_display_rewarder&&((ee=e.poolInfo)!=null&&ee.rewarderInfo)&&((K=e.poolInfo)==null?void 0:K.rewarderInfo.length)>0?(h(),I("div",Mo,Oo)):x("",!0)]),a("div",Bo,[(h(!0),I(it,null,ht(e.timeList,l=>(h(),I("div",{key:l.value,class:Je(["time-item",l.value==e.aprRewardsParameter?"time-item-active":""]),onClick:f=>e.$emit("changeAprRewardsParameter",l.value)},le(l.label),11,Fo))),128))])])}const Wt=nt(Co,[["render",Uo],["__scopeId","data-v-e912aa95"]]),jo=rt({components:{NewLiquidityD3Chart:Ht,NewLiquidityApr:Wt,NewLiquidityPrice:Ft},setup(){const{t:e,locale:u}=Ot(),ve=G("liquidity"),D=ct(),F=L(()=>D),pe=L(()=>F.value.chainName),H=yt(),q=L(()=>H),w=L(()=>F.value.chainName?ut(F.value.chainName):{});qt(()=>{ot.value=!1});const V=Tt(),s=L(()=>{let t=null;for(let b=0;b<q.value.poolConfigList.length;b++){const B=q.value.poolConfigList[b];B.address==V.query.poolAddress&&(t=B)}return console.log(t,"===>basePoolInfo"),t}),r=L(()=>{let t=null;for(const b in q.value.poolsObj){const B=q.value.poolsObj[b];B.address==V.query.poolAddress&&(console.log(B,"p===>"),t=B)}return t}),W=G(),ee=G(!0),K=async(t,b)=>{if(b){ee.value=!0;const B=t.token_a.decimals,j=t.token_b.decimals;console.log(t,"pool===>1111"),st.value=St.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,B,j).toString(),kt.value=new c(1).div(St.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,B,j)).toString(),y.value=t.needReverse?t.token_b:t.token_a,_.value=t.needReverse?t.token_a:t.token_b,W.value=t.needReverse,t.token_a.address.toLowerCase()===y.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===_.value.address.toLowerCase()?$e.value=!0:$e.value=!1,console.log(t,"187===>"),console.log(t,"###pool===>");let we={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const Q=await w.value.getTicks(we);tt.value=Q?w.value.getTickDataFromUrlData(Q):[],console.log(tt.value,"===>chartLoadingtickList.value"),i(t)}ee.value=!1,console.log(ee.value,"==>chartLoading.value")},l=G([]),f=G(),i=t=>{const b=t.token_a.decimals,B=t.token_b.decimals;let j=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[t.address]&&q.value.poolPriceConfigObj[t.address].recommend_ranges||{};const we=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[t.address]&&q.value.poolPriceConfigObj[t.address].type||"";console.log(j,"===>priceConfigList");let Q,Re;const ke=t.current_tick_index;f.value=t.current_tick_index,console.log(ke,t.tickSpacing,"==>pool.tickSpacing"),Q=ke-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),Re=ke+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const De=w.value.TickMath.tickIndexToPrice(Q,b,B).toString(),Ge=w.value.TickMath.tickIndexToPrice(Re,b,B).toString();j["full range"]={lower:w.value.TickUtil.getMinIndex(Number(r.value.tickSpacing)),upper:w.value.TickUtil.getMaxIndex(Number(r.value.tickSpacing))},j.custom={lower:Q,upper:Re,minPrice:De,maxPrice:Ge};const Oe=[];for(let be in j)j[be]&&(console.log(be,"j==>"),Oe.push({...j[be],key:be}));console.log(Oe,"priceList"),console.log(t,"###pool.type 504"),we?t.isSelfBuilt?oe.value="custom":we=="stable"?oe.value="suggested":oe.value="passive":oe.value="custom",l.value=Oe,Qe.value=j,A({key:oe.value,...j[oe.value]})},p=G(""),n=G(""),A=t=>{console.log("priceTab====>",t),console.log("priceTab###poolInfo###",r.value),oe.value=t.key.toLowerCase();const b=r.value.token_a.decimals,B=r.value.token_b.decimals,{lower:j,upper:we}=t;We.value=!1;const Q=w.value.TickMath.tickIndexToPrice(j,b,B).toString(),Re=w.value.TickMath.tickIndexToPrice(we,b,B).toString();if(t.key=="full range"){p.value=j,n.value=we,U();return}console.log($e.value,"===>direct.value"),$e.value?(vt.value=String(Q),Z.value=String(Q),ft.value=String(Re),z.value=String(Re),p.value=j,n.value=we):(vt.value=String(1/Number(Re)),Z.value=String(1/Number(Re)),ft.value=String(1/Number(Q)),z.value=String(1/Number(Q)),p.value=w.value.TickMath.priceToTickIndex(new c(1/Number(Re)),b,B),n.value=w.value.TickMath.priceToTickIndex(new c(1/Number(Q)),b,B)),console.log(Z.value,z.value,"===>111")},U=t=>{Z.value="0",z.value="∞"};Me(()=>r.value,(t,b)=>{console.log(b,"===>oldVal"),console.log(t,"===>newVal"),(!b&&t&&!qe(t)||b&&t&&b.address!==t.address)&&(console.log("池子信息"),K(t,!b||t.address!==b.address))},{immediate:!0}),Bt(()=>{tt.value=[]}),Me(()=>[s.value,r.value,q.value.recommendRangesObj],(t,b)=>{var B,j;console.log(t,"===>newValue369"),console.log(b,"===>oldValue369"),(!b||t[0]&&t[1]&&t[2]&&!qe(t[0])&&!qe(t[1]&&!qe(t[2]))||((B=t[0])==null?void 0:B.address)!==((j=b[0])==null?void 0:j.address))&&(console.log("3731111111"),t[0]&&t[2]&&!qe(t[0])&&!qe(t[2])&&(console.log(t[0],t[2],"======>374"),H.setSinglePool(t[0],t[2],pe.value)))},{immediate:!0,deep:!0});const te=t=>{if(pe.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},ae=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},ce=t=>{var B,j;const b=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[(B=r.value)==null?void 0:B.address]&&q.value.poolPriceConfigObj[(j=r.value)==null?void 0:j.address].type||"";if(console.log(b,t,"==>poolType"),b=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}},v=G(1),M=()=>{const t=v.value/2;v.value=t},O=()=>{const t=v.value*2;v.value=t};console.log(l.value,"==>priceTablList");const C=L(()=>{var t,b,B;return!r.value||qe(F.value.addressHistTokens)||!F.value.addressHistTokens[(t=r.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((B=F.value.addressHistTokens[(b=r.value)==null?void 0:b.poolAddress])==null?void 0:B.data.map(j=>[j.key,j.value]))}),P=G(30),E=G("30D"),$=L(()=>$e.value?C.value&&Te(P.value==7?C.value.before_7_d_contract_price_lowest:P.value==24?C.value.before_24_h_contract_price_lowest:C.value.before_30_d_contract_price_lowest,6)||0:C.value&&Te(new c(1).div(P.value==7?C.value.before_7_d_contract_price_highest:P.value==24?C.value.before_24_h_contract_price_highest:C.value.before_30_d_contract_price_highest).toString(),6)||0),X=L(()=>$e.value?C.value&&Te(P.value==7?C.value.before_7_d_contract_price_highest:P.value==24?C.value.before_24_h_contract_price_highest:C.value.before_30_d_contract_price_highest,6)||0:(C.value&&Te(1/Number(P.value==7?C.value.before_7_d_contract_price_lowest:P.value==24?C.value.before_24_h_contract_price_lowest:C.value.before_30_d_contract_price_lowest),6))==1/0?0:C.value&&Te(1/Number(P.value==7?C.value.before_7_d_contract_price_lowest:P.value==24?C.value.before_24_h_contract_price_lowest:C.value.before_30_d_contract_price_lowest),6)||0),R=L(()=>{const t=Number(Z.value),b=Number(z.value);return Z.value&&z.value&&Z.value!=="0"&&z.value!=="∞"?pt(1/(1-Number((t/b)**.25)),2)+"x":1}),Ae=L(()=>{var t,b,B,j,we,Q;return((t=y.value)==null?void 0:t.isSelfBuilt)||((b=_.value)==null?void 0:b.isSelfBuilt)||((j=q.value.tokensObj[(B=y.value)==null?void 0:B.address])==null?void 0:j.isSelfBuilt)||((Q=q.value.tokensObj[(we=_.value)==null?void 0:we.address])==null?void 0:Q.isSelfBuilt)}),T=t=>{console.log(t,"####0731 priceRangeChangeMin"),t!==Z.value&&oe.value=="full range"?(console.log(l.value,"===>priceTablList"),A({key:"custom",...l.value.custom})):oe.value!=="full range"&&oe.value!=="custom"?(oe.value="custom",Z.value=t):Z.value=t},re=t=>{t!==z.value&&oe.value=="full range"?A({key:"custom",...l.value.custom}):oe.value!=="full range"&&oe.value!=="custom"?(oe.value="custom",z.value=t):z.value=t};return console.log(Z.value,z.value,"683==>"),Me(()=>[Z.value,z.value],([t,b])=>{console.log(t,b,"minmax new-liquidity-left")},{deep:!0,immediate:!0}),{positionError:ot,getCoinIcon:t=>{var b;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((b=q.value.tokensObj[t==null?void 0:t.address])==null?void 0:b.logo_url)||(F.value.theme==="default"?wt("/image/coins/unknown.png"):wt("/image/coins/sui-unknown.png"))},chainName:pe,store:F,currentTab:ve,currentPrice:st,currentPriceReverse:kt,fromCoin:y,toCoin:_,direction:$e,needReverse:W,addCommom:je,decimalUi:Te,priceTablList:l,currentPriceTab:oe,sliderStyle:ce,poolInfo:r,tickList:tt,getPriceTabImage:te,getPriceTabText:ae,defaultMinPrice:vt,defaultMaxPrice:ft,minPrice:Z,maxPrice:z,currentTick:f,chartLoading:ee,zoomOut:M,zoomIn:O,zoom:v,priceTab:A,before7dContractPriceLowest:$,before7dContractPriceHighest:X,aprRewardsTime:E,lever:R,aprRewardsParameter:P,isSelfBuilt:Ae,priceRangeChangeMin:T,priceRangeChangeMax:re,toggle:Dt}}});const zo={class:"new-liquidity-left"},Do={class:"select-range"},Ho=a("span",null,"Select Range",-1),Wo={class:"range-tab"},Eo=["src"],Xo=["src"],Zo=a("span",null,"Liquidity",-1),Go=["src"],Ko=["src"],Jo=a("span",null,"Price",-1),Qo={class:"price-info"},Yo={class:"left"},xo={class:"base-coin"},Vo={class:"base-coin-title"},ei=a("svg",{class:"icon icon-up","aria-hidden":"true"},[a("use",{"xlink:href":"#icon-exchange_up1"})],-1),ti=a("svg",{class:"icon icon-down","aria-hidden":"true"},[a("use",{"xlink:href":"#icon-exchange_down1"})],-1),oi=[ei,ti],ii={class:"base-coin-bottom"},ri={alt:""},ni={class:"leverage"},ai=a("div",{class:"leverage-title"},"Leverage",-1),li={class:"laverage-value"},si={class:"current-price"},ui=a("div",{class:"current-price-title"},"Current Price",-1),ci={key:0,class:"from-pre-to"},di={class:"right"},mi={class:"price-range"},vi={class:"left"},fi={class:"price-slider"},gi={class:"slider"},pi=a("div",{class:"slider-ratio-content"},null,-1),bi=[pi],hi={class:"price-tab-list"},wi=["onClick"],ki=["src"],yi={class:"right"},_i={class:"range-tab"},Ci=["src"],Pi=["src"],Ti=a("span",null,"Liquidity",-1),Si=["src"],Ni=["src"],Ai=a("span",null,"Price",-1),Li={class:"price-zoom"},Ii={class:"current-price"},qi=a("div",{class:"current-price-title"},"Current Price",-1),Mi={key:0,class:"from-pre-to"},$i={class:"price-zoom-right"},Ri={class:"leverage"},Oi={class:"left"},Bi={key:0,class:"leverage-title"},Fi={key:1,class:"laverage-value"},Ui={class:"right"},ji={key:0,class:"day-7-price-range"},zi=a("i",null,null,-1),Di={class:"gray"},Hi={class:"apr-and-price"},Wi={key:0,class:"position-tips"},Ei=["src"],Xi={class:"error"};function Zi(e,u,ve,D,F,pe){var r,W,ee,K,l,f,i,p;const H=Ht,q=Ct,w=Wt,V=Ft,s=Qt("image");return h(),I("div",zo,[a("div",Do,[Ho,a("div",Wo,[a("div",{class:Je(["liquidity",e.currentTab=="liquidity"?"liquidity-tab-active":""]),onClick:u[0]||(u[0]=n=>e.currentTab="liquidity")},[e.chainName=="Sui"?(h(),I("img",{key:0,src:e.currentTab=="liquidity"?"/sui-image/Liquidity-Sel.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Eo)):(h(),I("img",{key:1,src:e.currentTab=="liquidity"?"/image/green_chart.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Xo)),Zo],2),a("div",{class:Je(["price",e.currentTab=="price"?"price-tab-active":""]),onClick:u[1]||(u[1]=n=>e.currentTab="price")},[e.chainName=="Sui"?(h(),I("img",{key:0,src:e.currentTab=="price"?"/sui-image/Price-Sel.png":"/sui-image/Price-Def.png",alt:""},null,8,Go)):(h(),I("img",{key:1,src:e.currentTab=="price"?"/image/price-chart.png":"/sui-image/Price-Def.png",alt:""},null,8,Ko)),Jo],2)])]),a("div",Qo,[a("div",Yo,[a("div",xo,[a("div",Vo,[a("span",null,"Base coin"+le(!e.direction),1),a("div",{class:"change-price",onClick:u[2]||(u[2]=(...n)=>e.toggle&&e.toggle(...n))},oi)]),a("div",ii,[_t(a("img",ri,null,512),[[s,e.getCoinIcon(e.fromCoin)]]),a("span",null,le((r=e.fromCoin)==null?void 0:r.symbol),1)])]),a("div",ni,[ai,a("div",li,le(e.lever),1)]),a("div",si,[ui,a("div",null,[a("span",null,le(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:Pe(je))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Pe(je))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(h(),I("span",ci,le((W=e.toCoin)==null?void 0:W.symbol)+" per "+le((ee=e.fromCoin)==null?void 0:ee.symbol),1)):x("",!0)])])]),a("div",di,[e.currentTab=="liquidity"?(h(),I("div",{key:0,class:"zoom-in",onClick:u[3]||(u[3]=(...n)=>e.zoomIn&&e.zoomIn(...n))}," - ")):x("",!0),e.currentTab=="liquidity"?(h(),I("div",{key:1,class:"zoom-out",onClick:u[4]||(u[4]=(...n)=>e.zoomOut&&e.zoomOut(...n))}," + ")):x("",!0)])]),a("div",mi,[a("div",vi,[a("div",fi,[a("div",gi,[a("div",{class:"slider-ratio",style:bt(e.sliderStyle(e.currentPriceTab))},bi,4)])]),a("div",hi,[(h(!0),I(it,null,ht(e.priceTablList,n=>(h(),I("div",{key:n.key,class:Je(["price-tab-item",e.currentPriceTab==n.key?"price-tab-item-active":""]),onClick:A=>e.priceTab(n)},[a("img",{src:e.getPriceTabImage(n.key),alt:""},null,8,ki),a("span",null,le(e.getPriceTabText(n.key)),1)],10,wi))),128))])]),a("div",yi,[a("div",_i,[a("div",{class:Je(["liquidity",e.currentTab=="liquidity"?"liquidity-tab-active":""]),onClick:u[5]||(u[5]=n=>e.currentTab="liquidity")},[e.chainName=="Sui"?(h(),I("img",{key:0,src:e.currentTab=="liquidity"?"/sui-image/Liquidity-Sel.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Ci)):(h(),I("img",{key:1,src:e.currentTab=="liquidity"?"/image/green_chart.png":"/sui-image/Price-Def.png",alt:""},null,8,Pi)),Ti],2),a("div",{class:Je(["price",e.currentTab=="price"?"price-tab-active":""]),onClick:u[6]||(u[6]=n=>e.currentTab="price")},[e.chainName=="sui"?(h(),I("img",{key:0,src:e.currentTab=="price"?"/sui-image/Price-Sel.png":"/sui-image/Price-Def.png",alt:""},null,8,Si)):(h(),I("img",{key:1,src:e.currentTab=="price"?"/image/price-chart.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Ni)),Ai],2)]),a("div",Li,[a("div",Ii,[qi,a("div",null,[a("span",null,le(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:Pe(je))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Pe(je))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(h(),I("span",Mi,le(e.direction&&!e.needReverse?`${(K=e.fromCoin)==null?void 0:K.symbol} per ${(l=e.toCoin)==null?void 0:l.symbol}`:`${(f=e.toCoin)==null?void 0:f.symbol} per ${(i=e.fromCoin)==null?void 0:i.symbol}`),1)):x("",!0)])]),a("div",$i,[e.currentTab=="liquidity"?(h(),I("div",{key:0,class:"zoom-in",onClick:u[7]||(u[7]=(...n)=>e.zoomIn&&e.zoomIn(...n))}," - ")):x("",!0),e.currentTab=="liquidity"?(h(),I("div",{key:1,class:"zoom-out",onClick:u[8]||(u[8]=(...n)=>e.zoomOut&&e.zoomOut(...n))}," + ")):x("",!0)])]),e.fromCoin&&e.toCoin&&e.poolInfo&&e.currentTab=="liquidity"?(h(),Ze(H,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):x("",!0),((p=e.tickList)==null?void 0:p.length)<=0&&e.chartLoading?(h(),Ze(q,{key:1})):x("",!0)])]),a("div",Ri,[a("div",Oi,[e.currentPriceTab!=="full range"?(h(),I("div",Bi,"Leverage")):x("",!0),e.currentPriceTab!=="full range"?(h(),I("div",Fi,le(e.lever),1)):x("",!0)]),a("div",Ui,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(h(),I("div",ji,[zi,a("span",Di,le(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),a("span",null,le(("addCommom"in e?e.addCommom:Pe(je))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.before7dContractPriceLowest,6)))+" - "+le(("addCommom"in e?e.addCommom:Pe(je))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.before7dContractPriceHighest,6))),1)])):x("",!0)])]),a("div",Hi,[Ee(w,{"apr-rewards-parameter":e.aprRewardsParameter,"name-tab":"deposit","from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,onChangeAprRewardsParameter:u[9]||(u[9]=n=>{e.aprRewardsParameter=n})},null,8,["apr-rewards-parameter","from-coin","to-coin","pool-info","min-price","max-price"]),Ee(V,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(h(),I("div",Wi,[a("img",{src:("importIcon"in e?e.importIcon:Pe(wt))("/image/icon-tips-error@2x.png"),alt:""},null,8,Ei),a("p",Xi,le(e.$t("tips.positionError")),1)])):x("",!0)])])}const Et=nt(jo,[["render",Zi]]),Gi=rt({components:{NewLiquidityTitle:Ut,NewLiquidityAssetsCard:jt,NewLiquidityDepositRatio:zt},setup(){const{t:e,locale:u}=Ot(),ve=ct(),D=L(()=>ve),F=L(()=>D.value.chainName),pe=yt(),H=L(()=>pe),q=ao(),w=L(()=>q),V=Tt(),s=L(()=>{let o=null;for(const g in H.value.poolsObj){const k=H.value.poolsObj[g];k.address==V.query.poolAddress&&(console.log(k,"p===>"),o=k)}return o}),r=G(!1),W=G(!1),ee=L(()=>D.value.theme),K=async(o,g)=>{y.value=o.needReverse?o.token_b:o.token_a,_.value=o.needReverse?o.token_a:o.token_b};Me(()=>s.value,(o,g)=>{console.log(g,"===>oldVal"),console.log(o,"===>newVal"),(!g&&o&&!qe(o)||g&&o&&g.address!==o.address)&&(console.log("池子信息"),K(o,!g||o.address!==g.address))},{immediate:!0});const l=L(()=>w.value.assets&&y.value&&w.value.assets[y.value.address]?Nt(w.value.assets[y.value.address].balance,y.value.decimals):"0"),f=L(()=>w.value.assets&&_.value&&w.value.assets[_.value.address]?Nt(w.value.assets[_.value.address].balance,_.value.decimals):"0"),i=o=>{o==="fromCoin"?(Ce.value=!0,F.value==="Aptos"?S.value=Number(l.value)>0?y.value.symbol=="APT"?new c(Number(l.value)).sub(new c(.1)).lt(new c(0))?"0":new c(Number(l.value)).sub(new c(.1)).toString():String(l.value):"":S.value=Number(l.value)>0?y.value.symbol=="SUI"?new c(Number(l.value)).sub(new c(.05)).lt(new c(0))?"0":new c(Number(l.value)).sub(new c(.05)).toString():String(l.value):""):(Ce.value=!1,F.value==="Aptos"?N.value=Number(f.value)>0?_.value.symbol=="APT"?new c(Number(f.value)).sub(new c(.1)).lt(new c(0))?"0":new c(Number(f.value)).sub(new c(.1)).toString():String(f.value):"":N.value=Number(f.value)>0?_.value.symbol=="SUI"?new c(Number(f.value)).sub(new c(.05)).lt(new c(0))?"0":new c(Number(f.value)).sub(new c(.05)).toString():String(f.value):"")},p=o=>{o==="fromCoin"?(Ce.value=!0,S.value=Number(l.value)>0?pt(new c(Number(l.value)).div(2).toString(),y.value.decimals).toString():""):(Ce.value=!1,N.value=Number(f.value)>0?pt(new c(Number(f.value)).div(2).toString(),_.value.decimals).toString():"")},n=G(),A=G(),U=G(),te=G(!1),ae=o=>{var g,k,se,J;n.value=o,o==="fromCoin"?(A.value=((g=_.value)==null?void 0:g.address)||"",U.value=V.query.actions=="new-position"?(k=y.value)==null?void 0:k.address:s.value.needReverse?s.value.token_b.address:s.value.token_a.address):(A.value=((se=y.value)==null?void 0:se.address)||"",U.value=V.query.actions=="new-position"?(J=_.value)==null?void 0:J.address:s.value.needReverse?s.value.token_a.address:s.value.token_b.address),te.value=!0,console.log(te.value,"==>showCoinSelect.value ")},ce=o=>{var se,J,ue,de,me,ne,ie,ye;const g=s.value.needReverse?s.value.token_b:s.value.token_a,k=s.value.needReverse?s.value.token_a:s.value.token_b;n.value==="fromCoin"?(((se=y.value)==null?void 0:se.address)===(g==null?void 0:g.address)||!((J=y.value)!=null&&J.address)?(_.value&&o.address.toLowerCase()===((ue=_)==null?void 0:ue.value.address.toLowerCase())&&(_.value=null),y.value=o):(y.value&&o.address.toLowerCase()===((de=y)==null?void 0:de.value.address.toLowerCase())&&(y.value=null),_.value=o),V.query.action||(V.query.fee="")):((me=_.value)==null?void 0:me.address)===(k==null?void 0:k.address)||!((ne=_.value)!=null&&ne.address)?(y.value&&o.address.toLowerCase()===((ie=y)==null?void 0:ie.value.address.toLowerCase())&&(y.value=null),_.value=o):(_.value&&o.address.toLowerCase()===((ye=_)==null?void 0:ye.value.address.toLowerCase())&&(_.value=null),y.value=o),te.value=!1},v=L(()=>D.value.chainName?ut(D.value.chainName):{}),M=L(()=>D.value.slippage),O=G(),C=async()=>{var Ue,Ne,Le,Ie;if(We.value)return console.log("跳出"),!1;if(!Z.value&&!z.value)return!1;if(!S.value&&!N.value&&!Z.value&&!z.value)return;const o=s.value||{};if(qe(o))return;const{TickUtil:g,TickMath:k,getNearestTickByTick:se}=v.value,J=o==null?void 0:o.token_a.decimals,ue=o==null?void 0:o.token_b.decimals;let de,me,ne,ie,ye,Se,Xe,Ke,he=o==null?void 0:o.current_tick_index,Y;if(o.token_a.address.toLowerCase()===y.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===_.value.address.toLowerCase()?Y=!0:Y=!1,Z.value==="0"&&z.value==="∞")ne=g.getMinIndex(Number(o.tickSpacing)),ie=g.getMaxIndex(Number(o.tickSpacing)),ye=k.tickIndexToSqrtPriceX64(ne),Se=k.tickIndexToSqrtPriceX64(ie),console.log(ne,ie,"#######updateAmounts 513");else if(oe.value=="custom"){console.log(Y,"===>directs1866"),Y?(de=Number(Z.value),me=Number(z.value)):(de=new c(1).div(z.value).toString(),me=new c(1).div(Z.value).toString());try{Xe=de==0?-443636:k.priceToTickIndex(new c(de),J,ue)}catch{Xe=-443636}try{Ke=k.priceToTickIndex(new c(me),J,ue)}catch{Ke=443636}ne=se(Xe,Number(o.tickSpacing)),ie=se(Ke,Number(o.tickSpacing)),ye=k.priceToSqrtPriceX64(new c(de),J,ue);try{Se=k.priceToSqrtPriceX64(new c(me),J,ue)}catch{console.log("0523###test###max###",me),me===1/0&&(console.log("0523###test###max###11111"),Se=k.tickIndexToSqrtPriceX64(g.getMaxIndex(Number(o.tickSpacing))))}console.log("0518###pre###tick_lower###",ne,ie,he),console.log("0518###pre###tick_upper###",ie)}else ne=(Ue=Qe.value[oe.value])==null?void 0:Ue.lower,ie=(Ne=Qe.value[oe.value])==null?void 0:Ne.upper,ye=k.tickIndexToSqrtPriceX64(ne),Se=k.tickIndexToSqrtPriceX64(ie);if(z.value!=="∞"&&ne>=ie){r.value=!0,S.value="",W.value=!0,N.value="";return}if(console.log(ie,he,ne,"1922"),z.value==="∞"||he>=ne&&he<=ie){r.value=!1,W.value=!1;let _e;if(S.value||N.value){if(Ce.value){const mt=new c(S.value).mul(Math.pow(10,y.value.decimals)).toString();_e=new ze(mt)}else{const mt=new c(N.value).mul(Math.pow(10,_.value.decimals)).toString();_e=new ze(mt)}console.log(Y,"======>directs");const{liquidityAmount:He,tokenMaxA:Ve,tokenMaxB:et,tokenMaxAOrigin:Zt,tokenMaxBOrigin:Gt}=v.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:ne,upperTick:ie,coinAmount:_e,iscoinA:Y?Ce.value:!Ce.value,roundUp:!0,slippage:Number(M.value)/100,curSqrtPrice:new ze(o.current_sqrt_price)});O.value={liquidityAmount:He,tokenMaxA:Ve,tokenMaxB:et,tokenMaxAOrigin:Zt,tokenMaxBOrigin:Gt},console.log(Ve,et,"preAdd"),Y?Ce.value?N.value=Number(et)>0?et:"":S.value=Number(Ve)>0?Ve:"":Ce.value?N.value=Ve:S.value=et}}else if(he>ie){if(Y?S.value="":N.value="",r.value=Y,W.value=!Y,S.value||N.value){let _e;if(Y){const He=new c(N.value).mul(Math.pow(10,(Le=_.value)==null?void 0:Le.decimals)).toString();_e=new ze(He),O.value={liquidityAmount:v.value.estimateLiquidityForCoinB(ye,Se,_e),tokenMaxA:0,tokenMaxB:N.value}}else{const He=new c(S.value).mul(Math.pow(10,(Ie=y.value)==null?void 0:Ie.decimals)).toString();_e=new ze(He),O.value={liquidityAmount:v.value.estimateLiquidityForCoinB(ye,Se,_e),tokenMaxA:0,tokenMaxB:S.value}}}}else if(he<ne){if(r.value=!Y,W.value=Y,Y?N.value="":S.value="",S.value||N.value){let _e;if(Y){const He=new c(S.value).mul(Math.pow(10,y.value.decimals)).toString();_e=new ze(He),O.value={liquidityAmount:v.value.estimateLiquidityForCoinA(ye,Se,_e),tokenMaxA:S.value,tokenMaxB:0}}else{const He=new c(N.value).mul(Math.pow(10,_.value.decimals)).toString();_e=new ze(He),O.value={liquidityAmount:v.value.estimateLiquidityForCoinA(ye,Se,_e),tokenMaxA:N.value,tokenMaxB:0}}}}else r.value=!0,S.value="",W.value=!0,N.value=""};Me(S,(o,g)=>{console.log(S,"===>fromCoinAmount"),o==""&&Ce.value&&(N.value=""),o&&Ce.value&&!We.value&&C()}),Me(N,(o,g)=>{console.log(o,"===>>>>newValsda"),o==""&&!Ce.value&&(S.value=""),o&&!Ce.value&&!We.value&&C()});const P=G("--"),E=L(()=>H.value.RATES),$=()=>{const o=E.value&&E.value[y.value.address]&&E.value[y.value.address].price,g=E.value&&E.value[_.value.address]&&E.value[_.value.address].price;if(o&&g){const k=new c(S.value>0?S.value:0).mul(o),se=new c(N.value>0?N.value:0).mul(g),J=k.add(se).toNumber();P.value=J>0&&J<.01?"$<0.01":"$"+je(J,2)}else P.value="--"};Me(()=>[S.value,N.value,We.value],([o,g,k])=>{(o||g)&&!k?$():(!o||!g)&&!k&&(P.value="--")},{immediate:!0}),Me(()=>P,o=>{console.log(o,"71911111")},{immediate:!0});const X=G(),R=async()=>{var Y,Ue;if(!Z.value&&!z.value)return!1;if(!S.value&&!N.value&&!Z.value&&!z.value)return;const o=s.value;if(qe(o))return;const{TickUtil:g,TickMath:k,getNearestTickByTick:se}=v.value,J=o==null?void 0:o.token_a.decimals,ue=o==null?void 0:o.token_b.decimals;let de,me,ne,ie,ye,Se,Xe;if(o.token_a.address.toLowerCase()===y.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===_.value.address.toLowerCase()?Xe=!0:Xe=!1,Z.value==="0"&&z.value==="∞")ne=g.getMinIndex(Number(o.tickSpacing)),ie=g.getMaxIndex(Number(o.tickSpacing));else if(oe.value=="custom"){Xe?(de=Number(Z.value),me=Number(z.value)):(de=new c(1).div(z.value).toString(),me=new c(1).div(Z.value).toString());try{ye=de==0?-443636:k.priceToTickIndex(new c(de),J,ue)}catch{ye=-443636}try{Se=k.priceToTickIndex(new c(me),J,ue)}catch{Se=443636}ne=se(ye,Number(o.tickSpacing)),ie=se(Se,Number(o.tickSpacing))}else ne=(Y=Qe.value[oe.value])==null?void 0:Y.lower,ie=(Ue=Qe.value[oe.value])==null?void 0:Ue.upper;const Ke=E.value[o==null?void 0:o.token_a.address].price,he=E.value[o==null?void 0:o.token_b.address].price;$e.value?new ze(o.current_sqrt_price):new ze(1/o.current_sqrt_price),console.log($e.value,"===>direction.value"),console.log(o,"poolInfos===>"),console.log(ne,ie,"####tick_lower tick_upper 889");try{const{amountA:Ne,amountB:Le,tokenAmountsInfo:Ie}=await v.value.estCoinAmountsFromTotalAmount({lowerTick:ne,upperTick:ie,decimalsA:J,decimalsB:ue,curSqrtPrice:new ze(o.current_sqrt_price),totalAmount:P.value,tokenPriceA:Ke,tokenPriceB:he});console.log(Ne,Le,"###estCoinAmountsFromTotalAmount 844"),console.log(o.needReverse,$e.value,"===>849"),X.value=Ie,o.needReverse?$e.value?(S.value=Ne,N.value=Le):(S.value=Le,N.value=Ne):(S.value=Ne,N.value=Le)}catch(Ne){console.log(Ne,"e===>")}};Me([Z,z],([o,g])=>{console.log(o,g,"==>minPrice,maxPrice"),We.value?We.value&&R():C(),g!=="∞"&&Number(o)!==0&&Number(g)!==0&&Number(o)>=Number(g)?ot.value=!0:ot.value=!1,Number(o)==0&&Number(g)==0&&st.value&&(ot.value=!0,console.log("价格区间错误"))},{deep:!0,immediate:!0});const Ae=o=>{console.log(o,"e");const g=o.replace(/[^\d.]/g,""),k="$"+je(g);We.value=!0,P.value=k,o>0?R():(S.value="",N.value="")},T=G(!1),{setTransactionTxid:re,setTransactionDesc:Ye,setIsShowWaiting:t,setIsShowSuccess:b,setPositiomNum:B,setIsShowRejected:j}=ve,we=fo(),Q=L(()=>H.value.currentPositionInfo),Re=G(!1),ke=async o=>{var ye,Se,Xe,Ke;console.log(s.value,"===> poolInfo.value"),T.value=!1,H.value.currentPositionInfo={},re(""),Ye(e("tips.increaseLiquiditySuccess",{from:r.value?"":`${S.value} ${(ye=y.value)==null?void 0:ye.symbol}`,and:!r.value&&!W.value?"and":"",to:W.value?"":`${N.value} ${(Se=_.value)==null?void 0:Se.symbol}`})),t(!0);const g=$e.value?Ce.value:!Ce.value;let k,se,J,ue,de,me;const ne=s.value.token_a.decimals,ie=s.value.token_b.decimals;if(Z.value==="0"&&z.value==="∞")J=v.value.TickUtil.getMinIndex(Number(s.value.tickSpacing)),ue=v.value.TickUtil.getMaxIndex(Number(s.value.tickSpacing));else if(oe.value=="custom"){$e.value?(k=Number(Z.value),se=Number(z.value)):(k=new c(1).div(z.value).toString(),se=new c(1).div(Z.value).toString()),console.log("0519###toAdd###min###",k),console.log("0519###toAdd###max###",se),console.log("0519###toAdd###minPrice.value###",Z.value),console.log("0519###toAdd###maxPrice.value###",z.value);try{de=k==0?v.value.TickUtil.getMinIndex(Number(s.value.tickSpacing)):v.value.TickMath.priceToTickIndex(new c(k),ne,ie)}catch{de=v.value.TickUtil.getMinIndex(Number(s.value.tickSpacing))}try{me=v.value.TickMath.priceToTickIndex(new c(se),ne,ie)}catch{me=v.value.TickUtil.getMaxIndex(Number(s.value.tickSpacing))}J=v.value.getNearestTickByTick(de,Number(s.value.tickSpacing)),ue=v.value.getNearestTickByTick(me,Number(s.value.tickSpacing))}else J=Qe.value[oe.value].lower,ue=Qe.value[oe.value].upper;console.log(J,ue,"####tick_lower tick_upper 889"),console.log(s.value,"==>poolInfo.value.curSqrtPrice");try{let he;We.value?he=await v.value.getCreateAddLiquidityPayload({pool:s.value,curSqrtPrice:new ze(s.value.current_sqrt_price),tickLower:J,tickUpper:ue,slippage:Number(M.value)/100,tokenAmounts:X.value}):he=await v.value.getAddLiquidityTransactionPayload({pool:{poolAddress:s.value.poolAddress,token_a:s.value.token_a,token_b:s.value.token_b},amount:Ce.value?S.value:N.value,fix_amount_a:g,tick_lower:J,tick_upper:ue,index:0,slippage:Number(M.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new ze(s.value.current_sqrt_price)}),console.log(he,"payload===?");let Y;if(F.value==="Aptos")Y=await w.value.currentWallet.signAndSubmitTransaction(he);else{const Ue=await w.value.currentWallet.signAndExecuteTransactionBlock(he);Y=v.value.handleTx(Ue)}if(console.log("0410###tx###",Y),Y&&Y.hash){re(Y.hash),t(!1),b(!0);let Ue;s.value.needReverse?s.value.token_a.address.toLowerCase()===y.value.address.toLowerCase()&&s.value.token_b.address.toLowerCase()===_.value.address.toLowerCase()?Ue=!1:Ue=!0:s.value.token_a.address.toLowerCase()===y.value.address.toLowerCase()&&s.value.token_b.address.toLowerCase()===_.value.address.toLowerCase()?Ue=!0:Ue=!1,console.log(Ue,"===>directs");const Ne={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:r.value?"":`${S.value} ${(Xe=y.value)==null?void 0:Xe.symbol}`,and:!r.value&&!W.value?"and":"",to:W.value?"":`${N.value} ${(Ke=_.value)==null?void 0:Ke.symbol}`}),hash:Y.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};F.value!=="Aptos"&&(Ne.res=Y.res),v.value.showTransitionPending(Ne);const Le=await v.value.watchTransaction(Ne,!0);if(Le.status){if(b(!1),H.value.setCurrentPositionLoading(!0),Re.value=!0,console.log(Le.nftInfo,"===> watchInfo.nftInfo"),F.value==="Aptos"){if(await H.value.setCurrentPositionInfo(Le.nftInfo[0].data.id.creator,Le.nftInfo[0].data.id.collection,Le.nftInfo[0].data.name,F.value),o)try{await we.subscribePosition({pool_address:Q.value.poolAddress,position_index:Q.value.index},Q.value.nftHash)}catch(Ie){console.log(Ie,"e")}}else{const Ie=Le.nftInfo,_e=await At(2e3);if(await H.value.setCurrentPositionInfo(Ie==null?void 0:Ie.pool,"","",F.value,Ie==null?void 0:Ie.position),await At(1e3),console.log("0529###nftInfo###",Ie),console.log("0529###currentPositionInfo.value.index###",Q.value.index),o)try{await we.subscribePosition({pool_address:Q.value.poolAddress,position_index:Q.value.index},Q.value.nftHash)}catch(He){console.log(He)}}setTimeout(()=>{pe.updateCurrentPools(s.value.poolAddress,F.value),v.value.getAccount(w.value.address)},3e3),setTimeout(async()=>{Lt(v,s)},3e3)}B()}else t(!1),j(!0);S.value="",N.value=""}catch(he){S.value="",N.value="",console.log("0330###Add liquidity Error###",he),t(!1),j(!0)}},De=L(()=>!S.value&&!N.value?(console.log("addLiquidityBtnDisabled11111"),!0):Number(S.value)>Number(l.value)||Number(N.value)>Number(f.value)?(console.log("addLiquidityBtnDisabled22222"),!0):Oe.value!==e("button.addLiquidity")&&Oe.value!==e("newAdd.preview")?(console.log("addLiquidityBtnDisabled33333###",Oe.value),!0):s.value&&s.value&&s.value.is_pause?(console.log("addLiquidityBtnDisabled44444"),!0):Number(S.value)<=0&&Number(N.value)<=0||!r.value&&Number(S.value)==0||!W.value&&Number(N.value)==0),Ge=L(()=>!y.value||!_.value),Oe=L(()=>s.value&&s.value.is_pause?"Pool Closed":!y.value||!_.value||Ge.value?e("modal.selectTokenModalTitle"):Number(S.value)>Number(l.value)?e("button.insufficientBalance",{name:y.value.symbol}):Number(N.value)>Number(f.value)?e("button.insufficientBalance",{name:_.value.symbol}):!Number(S.value)&&!Number(N.value)?e("button.enterAmount"):z.value!=="∞"&&Number(Z.value)>=Number(z.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),be=G({}),Be=G({}),xe=G(!1),at=(o,g)=>{console.log(n.value,"===>currentCoinKey.value"),console.log(o);const k=localStorage.getItem(o.address);console.log(H.value.tokensObj,"===>pools.value.tokensObj"),console.log(k,"===>coinLocak"),H.value.tokensObj&&H.value.tokensObj[o.address]&&H.value.tokensObj[o.address].isSelfBuilt&&!k&&(g=="fromCoin"&&(be.value=o),g=="toCoin"&&(Be.value=o),xe.value=!0)};Me(()=>[y.value,_.value],([o,g])=>{o&&!qe(o)&&at(o,"fromCoin"),g&&!qe(g)&&at(g,"toCoin")},{immediate:!0});const d=Yt(),m=()=>{F.value!=="Aptos"?d.push("/pool/list"):d.push("/pools")},Fe=o=>{We.value,ke(o)},fe=()=>{V.query.action!=="create-pool"&&V.query.actions!=="new-position"&&(Lt(v,s),C(),pe.updateCurrentPools(s.value.poolAddress,F.value)),pe.setPoolConfigList(F.value,D.value.filterCoinsObj)},ge=L(()=>{var k,se,J,ue,de,me;const o=(J=E.value[(se=(k=y)==null?void 0:k.value)==null?void 0:se.address])==null?void 0:J.price,g=(me=E.value[(de=(ue=_)==null?void 0:ue.value)==null?void 0:de.address])==null?void 0:me.price;return!!(o&&g)});return{decimalUi:Te,poolInfo:s,fromCoinAmount:S,toCoinAmount:N,fromCoin:y,toCoin:_,theme:ee,showFromCoinLock:r,showToCoinLock:W,fromCoinBlance:l,toCoinBlance:f,maxBtnSelect:i,halfBtnSelect:p,fixedFromCoin:Ce,openCoinSelect:ae,currentCoinKey:n,existingCoins:A,lastSelectCoin:U,showCoinSelect:te,onCoinSelect:ce,liquidityTotalAmount:P,toggle:Dt,onInput:Ae,isInputTotalAmount:We,isViewDetail:Re,addLiquidityBtnDisabled:De,addLiquidityBtnText:Oe,isShowTokenWarning:xe,chainName:F,closeTokenWarning:m,warningFromCoin:be,warningToCoin:Be,isShowLiquidityModal:T,currentPrice:st,currentPriceReverse:kt,currentPriceTab:oe,minPrice:Z,maxPrice:z,toAdd:ke,direction:$e,wallet:w,getAddLiquidityType:Fe,clickRefresh:fe,isShowtotalAmount:ge}}});const Ki={class:"new-liquidity-right"},Ji={class:"deposit-title"},Qi={class:"card-container"},Yi={class:"card-item"},xi={class:"card-item"},Vi={key:0,class:"total-amount"},er=a("span",null,"Total Amount",-1);function tr(e,u,ve,D,F,pe){const H=Ut,q=jt,w=no,V=Vt,s=zt,r=eo,W=uo,ee=co,K=mo,l=vo;return h(),I("div",Ki,[a("div",Ji,[Ee(H,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),a("div",Qi,[a("div",Yi,[Ee(q,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":u[0]||(u[0]=f=>e.fromCoinAmount=f),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:u[1]||(u[1]=f=>e.maxBtnSelect("fromCoin")),onOnHalf:u[2]||(u[2]=f=>e.halfBtnSelect("fromCoin")),onOnInput:u[3]||(u[3]=f=>{e.fromCoinAmount=f,e.fixedFromCoin=!0,e.isInputTotalAmount=!1}),onOnSelect:u[4]||(u[4]=f=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock?(h(),Ze(w,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):x("",!0)]),a("div",xi,[Ee(q,{modelValue:e.toCoinAmount,"onUpdate:modelValue":u[5]||(u[5]=f=>e.toCoinAmount=f),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:u[6]||(u[6]=f=>e.maxBtnSelect("toCoin")),onOnHalf:u[7]||(u[7]=f=>e.halfBtnSelect("toCoin")),onOnInput:u[8]||(u[8]=f=>{e.toCoinAmount=f,e.fixedFromCoin=!1,e.isInputTotalAmount=!1}),onOnSelect:u[9]||(u[9]=f=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock?(h(),Ze(w,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):x("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(h(),I("img",{key:0,class:"add",src:go,alt:"",onClick:u[10]||(u[10]=(...f)=>e.toggle&&e.toggle(...f))})):x("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(h(),I("img",{key:1,class:"add",src:po,alt:"",onClick:u[11]||(u[11]=(...f)=>e.toggle&&e.toggle(...f))})):x("",!0)]),e.isShowtotalAmount?(h(),I("div",Vi,[er,a("span",null,[Ee(V,{value:e.liquidityTotalAmount,placeholder:e.isInputTotalAmount?"":e.liquidityTotalAmount,onInput:u[12]||(u[12]=f=>e.onInput(f.target.value))},null,8,["value","placeholder"])])])):x("",!0),Ee(s,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),Ee(r,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:u[13]||(u[13]=f=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:xt(()=>[Pt(le(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(h(),Ze(W,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:u[14]||(u[14]=f=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):x("",!0),e.isViewDetail?(h(),Ze(ee,{key:2,"pool-info":e.poolInfo,onOnClose:u[15]||(u[15]=f=>e.isViewDetail=!1)},null,8,["pool-info"])):x("",!0),e.chainName=="Sui"&&e.isShowTokenWarning?(h(),Ze(K,{key:3,"from-coin":e.warningFromCoin,"to-coin":e.warningToCoin,onClose:e.closeTokenWarning,onClickContinue:u[16]||(u[16]=f=>e.isShowTokenWarning=!1)},null,8,["from-coin","to-coin","onClose"])):x("",!0),e.isShowLiquidityModal?(h(),Ze(l,{key:4,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:u[17]||(u[17]=f=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):x("",!0)])}const Xt=nt(Gi,[["render",tr]]),or=rt({components:{NewLiquidityLeft:Et,NewLiquidityRight:Xt},setup(){Bt(()=>{so()});const e=Tt();return{tickList:tt,route:e}}});const ir={key:0,class:"loading-spin-liquidity loading-global"},rr={class:"privide-liquidity"};function nr(e,u,ve,D,F,pe){var V,s;const H=Ct,q=Et,w=Xt;return h(),I(it,null,[!e.tickList&&((s=(V=e.route)==null?void 0:V.query)!=null&&s.poolAddress)?(h(),I("div",ir,[Ee(H)])):x("",!0),a("div",rr,[Ee(q),Ee(w)])],64)}const Dr=nt(or,[["render",nr],["__scopeId","data-v-9c3e932a"]]);export{Dr as default};
