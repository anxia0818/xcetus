import{a as ut,b as Kt,n as gt,d as Te,u as yt,e as Ue,c as Le,i as Jt,s as pt,T as St,p as Nt,f as ze,g as At}from"./pool.a7d2925b.js";import{a as rt,r as G,m as L,y as qt,D as Ae,e as nt,o as h,f as I,c as Ze,x as V,h as l,t as _t,G as Mt,H as bt,v as ue,u as Pe,F as it,J as Ct,p as $t,k as Rt,z as Je,s as ht,j as Pt,l as Ot,E as Tt,C as Bt,q as Qt,i as Ee,b as Yt,w as xt,I as Vt,B as eo}from"./entry.3f8ec2b1.js";/* empty css              */import{s as lt,m as to,l as oo,b as io,a as ro,_ as no}from"./transform.c0001ab7.js";import{D as c}from"./decimal.0e8aa3f1.js";import{u as ct,a as ao}from"./sha256.4e0ad719.js";import"./decimal.633e31ee.js";import{g as lo}from"./common-fun.01ac9e87.js";import{c as Ft,_ as jt,b as Ut,a as zt}from"./new-liquidity-title.d1970225.js";import{i as kt}from"./import-icon.de3e6c66.js";import{positionError as ot,tickList as tt,direction as $e,minPrice as Z,maxPrice as z,fromCoin as _,toCoin as w,currentPrice as st,currentPriceReverse as wt,currentPriceTab as oe,defaultMinPrice as vt,defaultMaxPrice as ft,toggle as Dt,isInputTotalAmount as We,priceConfigObj as Qe,fromCoinAmount as S,toCoinAmount as N,fixedFromCoin as Ce,resetTickList as Lt,resetData as so}from"./data.f1753387.js";import{_ as uo}from"./coin-select.eb95fb70.js";import{_ as co}from"./viewDetail.bbbaa623.js";import{_ as mo}from"./token-warning-modal.292f9ded.js";import{b as vo}from"./new-add-or-create.1fadf38a.js";/* empty css              */import{u as fo}from"./notifi.49e7d209.js";import{_ as go,a as po}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.b974a827.js";import"./precision.a7a6c57b.js";/* empty css              */import"./tick.505fdad3.js";import"./token-warning.97c2beeb.js";/* empty css              */import"./refresh-icon.8551e62e.js";/* empty css              */import"./swap-setting.01091c9c.js";/* empty css              */import"./img-no-Positions_2x.dc883078.js";import"./status-block.41a88655.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./icon-selected_3x.09e9a6f0.js";import"./useWhale.a2697ae1.js";import"./index.3a54b75f.js";function It(e,u,ve){const D=new c(10).pow(u-ve);return new c(1.0001).pow(e).mul(D)}const bo=rt({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,u){const ve=G(""),D=G(""),F=L(()=>{var i,p,a,A,j,te;return console.log(e.poolInfo,"===>props.poolInfo"),(i=e.poolInfo)!=null&&i.current_sqrt_price&&((p=e.poolInfo)!=null&&p.coinA.decimals)&&((a=e.poolInfo)!=null&&a.coinB.decimals)?s.sqrtPriceX64ToPrice((A=e.poolInfo)==null?void 0:A.current_sqrt_price,(j=e.poolInfo)==null?void 0:j.coinA.decimals,(te=e.poolInfo)==null?void 0:te.coinB.decimals).toString():"0"}),pe=L(()=>{let i=0;return e.direction?i=(Number(e.minPrice)/Number(F.value)-1)*100:i=(Number(e.minPrice)/Number(1/Number(F.value))-1)*100,i=i>0&&i<.1?.1:i,i=i<0&&i>-.1?-.1:i,i}),H=L(()=>{let i=0;return e.direction?i=(Number(e.maxPrice)/Number(F.value)-1)*100:i=(Number(e.maxPrice)/Number(1/Number(F.value))-1)*100,i=i>0&&i<.1?.1:i,i=i<0&&i>-.1?-.1:i,i}),q=ct(),y=L(()=>q),Q=L(()=>y.value.chainName?ut(y.value.chainName):{}),{TickMath:s,getNearestTickByTick:r}=Q.value,W=(i=[])=>{let p=6;const a=Math.abs(Number(i[0])-Number(i[i.length-1]));return a>=6?p=0:a>=1?p=1:a>=.1?p=2:a>=.01?p=3:a>=.001?p=4:a>=1e-4?p=5:a>=1e-5?p=6:a>=1e-6?p=7:a>=1e-7&&(p=8),p},ee=(i,p=1)=>{if(i&&i.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const a=Number(e.poolInfo.current_tick_index);console.log("0117###dataProcessing###currentTick###",a),console.log("0117###dataProcessing###props.poolInfo###",e.poolInfo),console.log("0117###dataProcessing###minPrice###",e.minPrice),console.log("0117###dataProcessing###maxPrice###",e.maxPrice),console.log("0117###dataProcessing###poolInfo###",e.poolInfo);let A=a+100*p,j=a-100*p,te,ae;if(e.maxPrice==="∞")ae=Q.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ae=s.priceToTickIndex(new c(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ae=s.priceToTickIndex(new c(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ae=443636}if(e.minPrice==="0")te=Q.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?te=s.priceToTickIndex(new c(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):te=s.priceToTickIndex(new c(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{te=-443636}let ce=0;if(e.currentPriceTab!=="full range"){if(a>=te&&a<=ae){const T=a-te,re=ae-a;ce=Math.max(Math.abs(T),Math.abs(re))}else a<te?ce=Math.abs(ae-a):ce=Math.abs(a-te);A=a+ce+100*p,j=a-ce-100*p}else{const T=(Math.abs(a)>5e3,2e4);A=a+T*p,j=a-T*p}j<-443636&&(j=-443636),A>443636&&(A=443636);const v=new c(i.liquidity).div(Math.pow(10,8)).toString(),M=e.tickList;console.log("0117####drawChart####tick_info_array####",M);const O=[],C=[];let P={};for(let T=0;T<M.length;T++){if(P=M[T],P.index<=a&&P.index>=j){if(O.length<1&&T!==0){const re=M[T-1];O.unshift({...re,index:j})}O.unshift(P)}else if(P.index>a&&P.index<=A&&(C.push(P),O.length<1&&T!==0)){const re=M[T-1];O.push({...re,index:j})}if(P.index>A){const re=M[T];if(C.push({...re,index:A}),O.length<1&&T!==0){const Ye=M[T-1];O.push({...Ye,index:j})}break}}let E="0";for(let T=O.length-1;T>=0;T--)E=new c(E).plus(new c(O[T].liquidityNet.toString()).div(Math.pow(10,8))).toString(),O[T].liquityAmount=E;let $=v;for(let T=0;T<C.length;T++)$=new c($).plus(new c(C[T].liquidityNet.toString()).div(Math.pow(10,8))).toString(),C[T].liquityAmount=$;let X=[];const R=M&&M.length>0?{index:a,liquityAmount:Number(v)}:{index:a,liquityAmount:0};(O.length>0||C.length>0)&&(X=[...O.reverse(),R,...C],e.direction||(X=X.reverse()));const Ie=[];M.forEach(T=>{Ie.push({...T,liquidityGross:T.liquidityGross.toString(),liquidityNet:T.liquidityNet.toString()})}),console.log("0117####drawChart####testTickInfoArray####",Ie),console.log("0117####drawChart####currentLiquity####",v),g(X,j,A,te,ae,a)}};let K=G(!1);qt(()=>{document.body.clientWidth<750?K.value=!1:K.value=!0,window.onresize=()=>{document.body.clientWidth<750?K.value=!1:K.value=!0,ee(e.poolInfo,e.zoom)}});const g=(i,p,a,A,j,te)=>{console.log("0117####drawChart####chartData####",i),console.log("0117####drawChart####tickMin####",p),console.log("0117####drawChart####tickMax####",a),console.log("0117####drawChart####minPriceTick####",A),console.log("0117####drawChart####maxPriceTick####",j),console.log("0117####drawChart####currentTick####",te),console.log("0117####drawChart####props.direction####",e.direction),console.log("0518###newd3###props.before7dContractPriceLowest###",e.before7dContractPriceLowest),console.log("0518###newd3###props.before7dContractPriceHighest###",e.before7dContractPriceHighest);let ae,ce;e.direction?(ae=e.before7dContractPriceLowest?s.priceToTickIndex(new c(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ce=e.before7dContractPriceHighest?s.priceToTickIndex(new c(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ae=e.before7dContractPriceLowest?s.priceToTickIndex(new c(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ce=e.before7dContractPriceHighest?s.priceToTickIndex(new c(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const v={top:30,right:35,bottom:20,left:55};let M,O;K.value?(M=460-v.left-v.right,O=205-v.top-v.bottom):(M=340-v.left-v.right,O=205-v.top-v.bottom);const C=a-p,P=parseInt(String(C/4));let E=[p+P/4,p+P,p+2*P,a-P,a-P/4];const $=p,X=a,R=M/(X-$);e.currentPriceTab==="full range"&&(E=[p,p+2*P,a]),console.log("0117####drawChart####xArr####",E),console.log("0117####drawChart####utickMin####",$),console.log("0117####drawChart####utickMax####",X),console.log("0117####drawChart####unit####",R);const Ie=E.map(d=>e.direction?It(d,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new c(1).div(It(d,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),T=W(Ie);lt("#chart").selectAll("*").remove();const re=lt("#chart").attr("width",M+v.left+v.right).attr("height",O+v.top+v.bottom).append("g").attr("transform",`translate(${v.left},${v.right})`),Ye=to(i,function(d){return Number(Math.abs(d.liquityAmount))})||0,t=oo().range([0,O]).domain([Ye,0]);io().rangeRound([0,M]).padding(.1);const B=re.append("g").attr("id","barsBox").selectAll("rect").data(i).enter().append("rect");y.value.theme=="default"?B.attr("x",function(d,m){return m===0?0:e.direction?Math.abs(d.index-$)*R:Math.abs(X-d.index)*R}).attr("y",function(d,m){return e.direction?m===i.length-1?0:t(d.liquityAmount):m===i.length-1?0:t(i[m+1].liquityAmount)}).attr("width",function(d,m){return m===0&&i.length===1&&d.liquityAmount>0?M:(e.direction,m!==i.length-1?Math.abs(i[m+1].index-d.index)*R:0)}).attr("height",function(d,m){return m===0&&i.length===1&&d.liquityAmount>0?O:e.direction?m===i.length-1?0:O-t(d.liquityAmount):m===i.length-1?0:O-t(i[m+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):B.attr("x",function(d,m){return m===0?0:e.direction?Math.abs(d.index-$)*R:Math.abs(X-d.index)*R}).attr("y",function(d,m){return e.direction?m===i.length-1?0:t(Math.abs(d.liquityAmount)):m===i.length-1?0:t(Math.abs(i[m+1].liquityAmount))}).attr("width",function(d,m){return m===0&&i.length===1&&d.liquityAmount>0?M:(e.direction,m!==i.length-1?Math.abs(i[m+1].index-d.index)*R:0)}).attr("height",function(d,m){if(m===0&&i.length===1&&d.liquityAmount>0)return O;if(e.direction)return m===i.length-1?0:Number(d.liquityAmount)?O-t(Math.abs(d.liquityAmount)):0;{if(m===i.length-1)return 0;const Fe=O-t(Math.abs(i[m+1].liquityAmount));return Number(i[m+1].liquityAmount)?Fe:0}}).attr("fill","#407497").attr("class","bars").attr("stroke-width",1).attr("stroke","#407497");const U=re.append("g");U.append("line").attr("x1",0).attr("y1",155).attr("x2",M).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const ke=U.append("g");let Y=0;if(e.direction){for(let d=0;d<E.length;d++){const m=Te(Ie[d],T)||"0";console.log("0423####price####",m),Ie.push(m);const Fe=Math.abs(E[d]-$)*R;let fe=0;for(let ge=0;ge<m.length;ge++)m[ge]==="1"?fe+=4.02:m[ge]==="."?fe+=2.64:m[ge]==="7"?fe+=5.48:fe+=6;console.log(Fe,"x=>>>"),ke.append("text").text(m).attr("x",Fe-fe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}Y=Math.abs(te-$)*R}else{for(let d=E.length-1;d>=0;d--){const m=Te(Ie[d],T)||0;Ie.push(m);const Fe=Math.abs(E[d]-X)*R;let fe=0;for(let ge=0;ge<m.length;ge++)m[ge]==="1"?fe+=4.02:m[ge]==="."?fe+=2.64:m[ge]==="7"?fe+=5.48:fe+=6;ke.append("text").text(m).attr("x",Fe-fe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}Y=Math.abs(te-X)*R}(y.value.theme=="default"?re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+Y+", 0)");let we,De,Ge,Oe;e.direction?(console.log("0525###d3###select###minPriceTick###",A),console.log("0525###d3###select###maxPriceTick###",j),console.log("0525###d3###select###props.minPrice###",e.minPrice),console.log("0525###d3###select###props.maxPrice###",e.maxPrice),we=A<$?-100:parseInt(String(Math.abs(A-$)*R)),De=j<$?-100:parseInt(String(Math.abs(j-$)*R)),Ge=ae<$?-100:Math.abs(ae-$)*R,Oe=ce<$?-100:Math.abs(ce-$)*R):(De=A<$?-100:Math.abs(X-A)*R,we=j<$?-100:Math.abs(X-j)*R,Oe=ae<$?-100:Math.abs(X-ae)*R,Ge=ce<$?-100:Math.abs(X-ce)*R),e.minPrice==="0"&&(we=0),e.maxPrice==="∞"&&(De=M),console.log(we,"==>minPriceTickX"),K.value?ve.value=M-we+155+"px":ve.value=M-we+52+"px",D.value=De+74+"px",ae&&Ge<M&&re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+Ge+", 0)"),ce&&Oe<M&&re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+Oe+", 0)");const be=re.append("g").attr("id","left-handle"),Be=re.append("g").attr("id","right-handle");y.value.theme=="default"?(be.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),be.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),be.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),be.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),Be.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),Be.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),Be.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),Be.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(be.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),be.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),be.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),be.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),Be.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),Be.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),Be.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),Be.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),console.log("0525###d3###select###minPriceTickX###",we),console.log("0525###d3###select###maxPriceTickX###",De),be.attr("transform","translate("+we+", 0)"),Be.attr("transform","translate("+De+", 0)");const xe=ro().extent([[0,0],[M,O]]).handleSize(30).on("end",at);re.append("g").attr("class","brush").call(xe).call(xe.move,[we,De]);function at(d){if(!d.sourceEvent||!d.selection)return;be.attr("transform","translate("+d.selection[0]+", 0)"),Be.attr("transform","translate("+d.selection[1]+", 0)"),K.value?ve.value=M-d.selection[0]+60+"px":ve.value=M-d.selection[0]+52+"px",D.value=d.selection[1]+74+"px";let m,Fe;console.log("0525###d3###select###e.selection[0]###",d.selection[0]),console.log("0525###d3###select###e.selection[0]###",d.selection[1]),console.log("0525###d3###select###props.direction###",e.direction),console.log("0525###d3###select###width###",M),console.log("0525###d3###select###unit###",R),console.log("0525###d3###select###utickMin###",$),console.log("0525###d3###select###utickMax###",X),console.log("0525###d3###select###props.poolInfo###",e.poolInfo);let fe=0,ge=0;e.direction?(fe=r(parseInt(String(d.selection[0]/R+$)),Number(e.poolInfo.tickSpacing)),m=s.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),ge=r(parseInt(String(d.selection[1]/R+$)),Number(e.poolInfo.tickSpacing)),Fe=s.tickIndexToPrice(ge,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),console.log("0525###d3###select###minTick###",fe),console.log("0525###d3###select###maxTick###",ge),console.log("0525###d3###select###minPrice###",m),console.log("0525###d3###select###maxPrice###",Fe)):(ge=r(X-d.selection[0]/R,Number(e.poolInfo.tickSpacing)),m=1/s.tickIndexToPrice(ge,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),fe=r(X-d.selection[1]/R,Number(e.poolInfo.tickSpacing)),Fe=1/s.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),u.emit("onChangeMinPrice",String(Te(String(m),6))),u.emit("onChangeMaxPrice",String(Te(String(Fe),6)))}y.value.theme=="default"?lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632")};G(""),Ae(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom],([i,p,a,A,j])=>{console.log(i,p,a,a>p,"poolInfo && minPrice && maxPrice && (maxPrice > minPrice)"),i&&p&&a&&(i!=null&&i.liquidity)&&(A!=="Custom"||console.log("绘制"),ee(i,j))},{immediate:!0});const n=G(!1);return Ae(()=>e.chartLoading,(i,p)=>{i!==p&&(n.value=i)},{immediate:!0,deep:!0}),console.log(e,"props===>"),{store:y,loading:n,rangeSizeLower:pe,rangeSizeUpper:H,rangeSizeLowerPosition:ve,rangeSizeUpperPosition:D,decimalFormat:Kt,numberformat:gt}}});const ho=e=>($t("data-v-a4488f02"),e=e(),Rt(),e),ko={class:"chart-box"},wo={class:"chart"},yo=ho(()=>l("svg",{id:"chart"},null,-1));function _o(e,u,ve,D,F,pe){const H=Ct;return h(),I(it,null,[e.tickList&&e.tickList.length>0&&e.loading?(h(),Ze(H,{key:0})):V("",!0),l("div",ko,[_t(l("div",wo,[e.currentPriceTab!=="full range"?(h(),I("div",{key:0,class:"range-size range-size-lower",style:bt({right:e.rangeSizeLowerPosition})},ue(("numberformat"in e?e.numberformat:Pe(gt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):V("",!0),e.currentPriceTab!=="full range"?(h(),I("div",{key:1,class:"range-size range-size-upper",style:bt({left:e.rangeSizeUpperPosition})},ue(("numberformat"in e?e.numberformat:Pe(gt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):V("",!0),yo],512),[[Mt,!e.loading]])])],64)}const Ht=nt(bo,[["render",_o],["__scopeId","data-v-a4488f02"]]),Co=rt({props:{aprRewardsParameter:{type:Number,default:30},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},fromCoin:{type:Object,default:()=>({})},toCoin:{type:Object,default:()=>({})},poolInfo:{type:Object,default:()=>({})},nameTab:{type:String,default:""}},setup(e){const u=[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}],ve=ct(),D=L(()=>ve);L(()=>D.value.chainName);const F=yt(),pe=L(()=>F),H=L(()=>D.value.chainName?ut(D.value.chainName):{}),q=G(),y=async r=>{var te,ae,ce;console.log("0607###detail###getAprMethod###poolInfo###",r),console.log("0607###detail###getAprMethod###props.fromCoin###",e.fromCoin),console.log("0607###detail###getAprMethod###props.toCoin###",e.toCoin),console.log("0607###detail###getAprMethod###props.nameTab###",e.nameTab);let W;r.token_a.address.toLowerCase()===e.fromCoin.address.toLowerCase()&&r.token_b.address.toLowerCase()===e.toCoin.address.toLowerCase()?W=!0:W=!1,console.log("0607###detail###getAprMethod###directs###",W),console.log("0607###detail###getAprMethod###props.minPrice###",e.minPrice),console.log("0607###detail###getAprMethod###props.maxPrice###",e.maxPrice);let ee,K;W?(ee=Number(e.minPrice),K=isNaN(Number(e.maxPrice))?2**50:Number(e.maxPrice)):e.maxPrice!=="∞"?(ee=1/Number(e.maxPrice),K=1/Number(e.minPrice)):(ee=1/2**50,K=2**50),console.log("0607###detail###getAprMethod###lowerUserPrice###",ee),console.log("0607###detail###getAprMethod###upperUserPrice###",K);let g=[];g=D.value&&D.value.addressHistTokens&&D.value.addressHistTokens[r.poolAddress]&&D.value.addressHistTokens[r.poolAddress].data&&D.value.addressHistTokens[r.poolAddress].data.length>0&&Object.fromEntries(D.value.addressHistTokens[r.poolAddress].data.map(v=>[v.key,v.value]));let n,i;console.log(g,"===>addressHistTokensList"),e.aprRewardsParameter==7?(n=Number(g==null?void 0:g.before_7_d_contract_price_lowest),i=Number(g==null?void 0:g.before_7_d_contract_price_highest)):e.aprRewardsParameter==24?(n=Number(g==null?void 0:g.before_24_h_contract_price_lowest),i=Number(g==null?void 0:g.before_24_h_contract_price_highest)):(n=Number(g==null?void 0:g.before_30_d_contract_price_lowest),i=Number(g==null?void 0:g.before_30_d_contract_price_highest));const p=pe.value.tokensObj;console.log("getEstPositionAPRWithMulti###params###lowerUserPrice###",ee),console.log("getEstPositionAPRWithMulti###params###upperUserPrice###",K),console.log("getEstPositionAPRWithMulti###params###lowerHistPrice###",n),console.log("getEstPositionAPRWithMulti###params###upperHistPrice###",i);const a=await H.value.getEstPositionAPRWithMulti(ee,K,n,i);console.log("getEstPositionAPRWithMulti###resMulti###",a.toString());const A=D.value.newTopPoolsObj[r.poolAddress];console.log(r,"#####stats");let j;if(A){e.aprRewardsParameter==7?j=Number(A.apr_7day.replace("%","")):e.aprRewardsParameter==24?j=Number(A.apr_24h.replace("%","")):j=Number(A.apr_30day.replace("%",""));const v=Number(A.rewarder_apr[0].replace("%","")),M=Number(A.rewarder_apr[1].replace("%","")),O=Number(A.rewarder_apr[2].replace("%","")),C=new c(a.toString()).mul(j).toNumber();console.log(a.toString(),"===>resMulti.toString()");const P=new c(a.toString()).mul(v).toNumber(),E=new c(a.toString()).mul(M).toNumber(),$=new c(a.toString()).mul(O).toNumber();console.log(P,E,$,"posRewarder2_apr##");const X=C+(r.rewarder_display1?P:0)+(r.rewarder_display2?E:0)+(r.rewarder_display3?$:0);console.log(X,"###aprPercentageTotal");const R=r.rewarder_infos[0]?(te=p[r.rewarder_infos[0].coinAddress])==null?void 0:te.symbol:"--",Ie=r.rewarder_infos[1]?(ae=p[r.rewarder_infos[1].coinAddress])==null?void 0:ae.symbol:"--",T=r.rewarder_infos[2]?(ce=p[r.rewarder_infos[2].coinAddress])==null?void 0:ce.symbol:"--",re={aprFee:C==1/0||isNaN(C)?0:C,rewardAprList:[{rewarder_name:R,rewarder_apr:P==1/0||isNaN(P)?0:P,styleName:"one",rewarder_display:r.rewarder_display1},{rewarder_name:Ie,rewarder_apr:E==1/0||isNaN(E)?0:E,styleName:"two",rewarder_display:r.rewarder_display2},{rewarder_name:T,rewarder_apr:$==1/0||isNaN($)?0:$,styleName:"three",rewarder_display:r.rewarder_display2}],aprPercentageTotal:X==1/0||isNaN(X)||X===0?0:X,aprPercentage:Jt(C/X,2),is_display_rewarder:r.is_display_rewarder};q.value=re,console.log(q.value,"===>aprPercentageObj.value")}};Ae(()=>[e.poolInfo,e.minPrice,e.maxPrice,D.value.addressHistTokens],([r,W,ee,K])=>{r&&!Le(r)&&K&&!Le(K)&&y(r)},{immediate:!0});const Q=L(()=>lo(e.poolInfo,pe,D));Ae(()=>[e.aprRewardsParameter],()=>{y(e.poolInfo)});const s=L(()=>{const r=q.value;return r&&r.is_display_rewarder?(r==null?void 0:r.aprPercentageTotal)>1e4?">10000":r.aprPercentageTotal<.01&&r.aprPercentageTotal>0?"<0.01":Ue(r.aprPercentageTotal,2):r&&!r.is_display_rewarder?(r==null?void 0:r.aprFee)>1e4?">10000":r.aprFee<.01&&r.aprFee>0?"<0.01":Ue(r.aprFee,2):"--"});return{poolMoreInfo:Q,timeList:u,aprPercentageObj:q,totalApr:s}}}),Po=""+globalThis.__publicAssetsURL("sui-image/farming.png");const dt=e=>($t("data-v-d15b04f7"),e=e(),Rt(),e),To={class:"est-apr"},So=dt(()=>l("div",{class:"title"},"Estimated APR",-1)),No={class:"apr-total"},Ao={class:"apr-box"},Lo={key:0,class:"apr-hover-content"},Io={class:"progress-fees progress-all"},qo=dt(()=>l("div",null,[l("div",{class:"light-hint"}),Pt(" Fees ")],-1)),Mo={key:0,class:"isFarming"},$o=dt(()=>l("img",{src:Po,alt:""},null,-1)),Ro=dt(()=>l("div",{class:"hover-text"},"Farming rewards available",-1)),Oo=[$o,Ro],Bo={class:"time-list"},Fo=["onClick"];function jo(e,u,ve,D,F,pe){var H,q,y,Q,s,r,W,ee,K,g;return h(),I("div",To,[So,l("div",No,[l("div",Ao,[l("span",{class:Je(e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?"haveBorder":"")},ue(e.totalApr)+"%",3),e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?(h(),I("div",Lo,[l("div",Io,[qo,l("span",null,"  "+ue(Number((H=e.aprPercentageObj)==null?void 0:H.aprFee)==0?0:(q=e.aprPercentageObj)!=null&&q.aprFee?((y=e.aprPercentageObj)==null?void 0:y.aprFee)>1e4?">10,000":((Q=e.aprPercentageObj)==null?void 0:Q.aprFee)<.01?"<0.01":("addCommom"in e?e.addCommom:Pe(Ue))((s=e.aprPercentageObj)==null?void 0:s.aprFee,2):(r=e.aprPercentageObj)!=null&&r.rewardAprList?"<0.01":"--")+"%",1)]),(h(!0),I(it,null,ht((W=e.aprPercentageObj)==null?void 0:W.rewardAprList,n=>_t((h(),I("div",{key:n,class:"progress-rewards progress-all"},[l("div",null,[l("div",{class:Je(["light-hint",n==null?void 0:n.styleName])},null,2),Pt(" "+ue(n==null?void 0:n.rewarder_name)+" Rewards ",1)]),l("span",null,"  "+ue(n!=null&&n.rewarder_apr?(n==null?void 0:n.rewarder_apr)>1e4?">10,000":(n==null?void 0:n.rewarder_apr)<.01?"<0.01":("addCommom"in e?e.addCommom:Pe(Ue))(n==null?void 0:n.rewarder_apr,2):"0")+"%",1)])),[[Mt,(n==null?void 0:n.rewarder_name)!="--"&&n.rewarder_display&&e.aprPercentageObj.is_display_rewarder]])),128))])):V("",!0)]),(ee=e.poolInfo)!=null&&ee.is_display_rewarder&&((K=e.poolInfo)!=null&&K.rewarderInfo)&&((g=e.poolInfo)==null?void 0:g.rewarderInfo.length)>0?(h(),I("div",Mo,Oo)):V("",!0)]),l("div",Bo,[(h(!0),I(it,null,ht(e.timeList,n=>(h(),I("div",{key:n.value,class:Je(["time-item",n.value==e.aprRewardsParameter?"time-item-active":""]),onClick:i=>e.$emit("changeAprRewardsParameter",n.value)},ue(n.label),11,Fo))),128))])])}const Wt=nt(Co,[["render",jo],["__scopeId","data-v-d15b04f7"]]),Uo=rt({components:{NewLiquidityD3Chart:Ht,NewLiquidityApr:Wt,NewLiquidityPrice:Ft},setup(){const{t:e,locale:u}=Ot(),ve=G("liquidity"),D=ct(),F=L(()=>D),pe=L(()=>F.value.chainName),H=yt(),q=L(()=>H),y=L(()=>F.value.chainName?ut(F.value.chainName):{});qt(()=>{ot.value=!1});const Q=Tt(),s=L(()=>{let t=null;for(let b=0;b<q.value.poolConfigList.length;b++){const B=q.value.poolConfigList[b];B.address==Q.query.poolAddress&&(t=B)}return console.log(t,"===>basePoolInfo"),t}),r=L(()=>{let t=null;for(const b in q.value.poolsObj){const B=q.value.poolsObj[b];B.address==Q.query.poolAddress&&(console.log(B,"p===>"),t=B)}return t}),W=G(),ee=G(!0),K=async(t,b)=>{if(b){ee.value=!0;const B=t.token_a.decimals,U=t.token_b.decimals;console.log(t,"pool===>1111"),st.value=St.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,B,U).toString(),wt.value=new c(1).div(St.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,B,U)).toString(),_.value=t.needReverse?t.token_b:t.token_a,w.value=t.needReverse?t.token_a:t.token_b,W.value=t.needReverse,t.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===w.value.address.toLowerCase()?$e.value=!0:$e.value=!1,console.log(t,"187===>"),console.log(t,"###pool===>");let ke={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const Y=await y.value.getTicks(ke);tt.value=Y?y.value.getTickDataFromUrlData(Y):[],console.log(tt.value,"===>chartLoadingtickList.value"),i(t)}ee.value=!1,console.log(ee.value,"==>chartLoading.value")},g=G([]),n=G(),i=t=>{const b=t.token_a.decimals,B=t.token_b.decimals;let U=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[t.address]&&q.value.poolPriceConfigObj[t.address].recommend_ranges||{};const ke=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[t.address]&&q.value.poolPriceConfigObj[t.address].type||"";console.log(U,"===>priceConfigList");let Y,Re;const we=t.current_tick_index;n.value=t.current_tick_index,console.log(we,t.tickSpacing,"==>pool.tickSpacing"),Y=we-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),Re=we+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const De=y.value.TickMath.tickIndexToPrice(Y,b,B).toString(),Ge=y.value.TickMath.tickIndexToPrice(Re,b,B).toString();U["full range"]={lower:y.value.TickUtil.getMinIndex(Number(r.value.tickSpacing)),upper:y.value.TickUtil.getMaxIndex(Number(r.value.tickSpacing))},U.custom={lower:Y,upper:Re,minPrice:De,maxPrice:Ge};const Oe=[];for(let be in U)U[be]&&(console.log(be,"j==>"),Oe.push({...U[be],key:be}));console.log(Oe,"priceList"),console.log(t,"###pool.type 504"),ke?t.isSelfBuilt?oe.value="custom":ke=="stable"?oe.value="suggested":oe.value="passive":oe.value="custom",g.value=Oe,Qe.value=U,A({key:oe.value,...U[oe.value]})},p=G(""),a=G(""),A=t=>{console.log("priceTab====>",t),console.log("priceTab###poolInfo###",r.value),oe.value=t.key.toLowerCase();const b=r.value.token_a.decimals,B=r.value.token_b.decimals,{lower:U,upper:ke}=t;We.value=!1;const Y=y.value.TickMath.tickIndexToPrice(U,b,B).toString(),Re=y.value.TickMath.tickIndexToPrice(ke,b,B).toString();if(t.key=="full range"){p.value=U,a.value=ke,j();return}console.log($e.value,"===>direct.value"),$e.value?(vt.value=String(Y),Z.value=String(Y),ft.value=String(Re),z.value=String(Re),p.value=U,a.value=ke):(vt.value=String(1/Number(Re)),Z.value=String(1/Number(Re)),ft.value=String(1/Number(Y)),z.value=String(1/Number(Y)),p.value=y.value.TickMath.priceToTickIndex(new c(1/Number(Re)),b,B),a.value=y.value.TickMath.priceToTickIndex(new c(1/Number(Y)),b,B)),console.log(Z.value,z.value,"===>111")},j=t=>{Z.value="0",z.value="∞"};Ae(()=>r.value,(t,b)=>{console.log(b,"===>oldVal"),console.log(t,"===>newVal"),(!b&&t&&!Le(t)||b&&t&&b.address!==t.address)&&(console.log("池子信息"),K(t,!b||t.address!==b.address))},{immediate:!0}),Bt(()=>{tt.value=[]}),Ae(()=>[s.value,r.value,q.value.recommendRangesObj],(t,b)=>{var B,U;console.log(t,"===>newValue369"),console.log(b,"===>oldValue369"),(!b||t[0]&&t[1]&&t[2]&&!Le(t[0])&&!Le(t[1]&&!Le(t[2]))||((B=t[0])==null?void 0:B.address)!==((U=b[0])==null?void 0:U.address))&&t[0]&&t[2]&&!Le(t[0])&&!Le(t[2])&&(console.log(t[0],t[2],"======>374"),H.setSinglePool(t[0],t[2],pe.value))},{immediate:!0,deep:!0});const te=t=>{if(pe.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},ae=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},ce=t=>{var B,U;const b=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[(B=r.value)==null?void 0:B.address]&&q.value.poolPriceConfigObj[(U=r.value)==null?void 0:U.address].type||"";if(console.log(b,t,"==>poolType"),b=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}},v=G(1),M=()=>{const t=v.value/2;v.value=t},O=()=>{const t=v.value*2;v.value=t};console.log(g.value,"==>priceTablList");const C=L(()=>{var t,b,B;return!r.value||Le(F.value.addressHistTokens)||!F.value.addressHistTokens[(t=r.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((B=F.value.addressHistTokens[(b=r.value)==null?void 0:b.poolAddress])==null?void 0:B.data.map(U=>[U.key,U.value]))}),P=G(30),E=G("30D"),$=L(()=>$e.value?C.value&&Te(P.value==7?C.value.before_7_d_contract_price_lowest:P.value==24?C.value.before_24_h_contract_price_lowest:C.value.before_30_d_contract_price_lowest,6)||0:C.value&&Te(new c(1).div(P.value==7?C.value.before_7_d_contract_price_highest:P.value==24?C.value.before_24_h_contract_price_highest:C.value.before_30_d_contract_price_highest).toString(),6)||0),X=L(()=>$e.value?C.value&&Te(P.value==7?C.value.before_7_d_contract_price_highest:P.value==24?C.value.before_24_h_contract_price_highest:C.value.before_30_d_contract_price_highest,6)||0:(C.value&&Te(1/Number(P.value==7?C.value.before_7_d_contract_price_lowest:P.value==24?C.value.before_24_h_contract_price_lowest:C.value.before_30_d_contract_price_lowest),6))==1/0?0:C.value&&Te(1/Number(P.value==7?C.value.before_7_d_contract_price_lowest:P.value==24?C.value.before_24_h_contract_price_lowest:C.value.before_30_d_contract_price_lowest),6)||0),R=L(()=>{const t=Number(Z.value),b=Number(z.value);return Z.value&&z.value&&Z.value!=="0"&&z.value!=="∞"?pt(1/(1-Number((t/b)**.25)),2)+"x":1}),Ie=L(()=>{var t,b,B,U,ke,Y;return((t=_.value)==null?void 0:t.isSelfBuilt)||((b=w.value)==null?void 0:b.isSelfBuilt)||((U=q.value.tokensObj[(B=_.value)==null?void 0:B.address])==null?void 0:U.isSelfBuilt)||((Y=q.value.tokensObj[(ke=w.value)==null?void 0:ke.address])==null?void 0:Y.isSelfBuilt)}),T=t=>{console.log(t,"####0731 priceRangeChangeMin"),t!==Z.value&&oe.value=="full range"?(console.log(g.value,"===>priceTablList"),A({key:"custom",...g.value.custom})):oe.value!=="full range"&&oe.value!=="custom"?(oe.value="custom",Z.value=t):Z.value=t},re=t=>{t!==z.value&&oe.value=="full range"?A({key:"custom",...g.value.custom}):oe.value!=="full range"&&oe.value!=="custom"?(oe.value="custom",z.value=t):z.value=t};return console.log(Z.value,z.value,"683==>"),Ae(()=>[Z.value,z.value],([t,b])=>{console.log(t,b,"minmax new-liquidity-left")},{deep:!0,immediate:!0}),{positionError:ot,getCoinIcon:t=>{var b;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((b=q.value.tokensObj[t==null?void 0:t.address])==null?void 0:b.logo_url)||(F.value.theme==="default"?kt("/image/coins/unknown.png"):kt("/image/coins/sui-unknown.png"))},chainName:pe,store:F,currentTab:ve,currentPrice:st,currentPriceReverse:wt,fromCoin:_,toCoin:w,direction:$e,needReverse:W,addCommom:Ue,decimalUi:Te,priceTablList:g,currentPriceTab:oe,sliderStyle:ce,poolInfo:r,tickList:tt,getPriceTabImage:te,getPriceTabText:ae,defaultMinPrice:vt,defaultMaxPrice:ft,minPrice:Z,maxPrice:z,currentTick:n,chartLoading:ee,zoomOut:M,zoomIn:O,zoom:v,priceTab:A,before7dContractPriceLowest:$,before7dContractPriceHighest:X,aprRewardsTime:E,lever:R,aprRewardsParameter:P,isSelfBuilt:Ie,priceRangeChangeMin:T,priceRangeChangeMax:re,toggle:Dt}}});const zo={class:"new-liquidity-left"},Do={class:"select-range"},Ho=l("span",null,"Select Range",-1),Wo={class:"range-tab"},Eo=["src"],Xo=["src"],Zo=l("span",null,"Liquidity",-1),Go=["src"],Ko=["src"],Jo=l("span",null,"Price",-1),Qo={class:"price-info"},Yo={class:"left"},xo={class:"base-coin"},Vo={class:"base-coin-title"},ei=l("span",null,"Base coin",-1),ti=l("svg",{class:"icon icon-up","aria-hidden":"true"},[l("use",{"xlink:href":"#icon-exchange_up1"})],-1),oi=l("svg",{class:"icon icon-down","aria-hidden":"true"},[l("use",{"xlink:href":"#icon-exchange_down1"})],-1),ii=[ti,oi],ri={class:"base-coin-bottom"},ni={alt:""},ai={class:"leverage"},li=l("div",{class:"leverage-title"},"Leverage",-1),si={class:"laverage-value"},ui={class:"current-price"},ci=l("div",{class:"current-price-title"},"Current Price",-1),di={key:0,class:"from-pre-to"},mi={class:"right"},vi={class:"price-range"},fi={class:"left"},gi={class:"price-slider"},pi={class:"slider"},bi=l("div",{class:"slider-ratio-content"},null,-1),hi=[bi],ki={class:"price-tab-list"},wi=["onClick"],yi=["src"],_i={class:"right"},Ci={class:"range-tab"},Pi=["src"],Ti=["src"],Si=l("span",null,"Liquidity",-1),Ni=["src"],Ai=["src"],Li=l("span",null,"Price",-1),Ii={class:"price-zoom"},qi={class:"current-price"},Mi=l("div",{class:"current-price-title"},"Current Price",-1),$i={key:0,class:"from-pre-to"},Ri={class:"price-zoom-right"},Oi={class:"leverage"},Bi={class:"left"},Fi={key:0,class:"leverage-title"},ji={key:1,class:"laverage-value"},Ui={class:"right"},zi={key:0,class:"day-7-price-range"},Di=l("i",null,null,-1),Hi={class:"gray"},Wi={class:"apr-and-price"},Ei={key:0,class:"position-tips"},Xi=["src"],Zi={class:"error"};function Gi(e,u,ve,D,F,pe){var r,W,ee,K,g,n,i,p;const H=Ht,q=Ct,y=Wt,Q=Ft,s=Qt("image");return h(),I("div",zo,[l("div",Do,[Ho,l("div",Wo,[l("div",{class:Je(["liquidity",e.currentTab=="liquidity"?"liquidity-tab-active":""]),onClick:u[0]||(u[0]=a=>e.currentTab="liquidity")},[e.chainName=="Sui"?(h(),I("img",{key:0,src:e.currentTab=="liquidity"?"/sui-image/Liquidity-Sel.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Eo)):(h(),I("img",{key:1,src:e.currentTab=="liquidity"?"/image/green_chart.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Xo)),Zo],2),l("div",{class:Je(["price",e.currentTab=="price"?"price-tab-active":""]),onClick:u[1]||(u[1]=a=>e.currentTab="price")},[e.chainName=="Sui"?(h(),I("img",{key:0,src:e.currentTab=="price"?"/sui-image/Price-Sel.png":"/sui-image/Price-Def.png",alt:""},null,8,Go)):(h(),I("img",{key:1,src:e.currentTab=="price"?"/image/price-chart.png":"/sui-image/Price-Def.png",alt:""},null,8,Ko)),Jo],2)])]),l("div",Qo,[l("div",Yo,[l("div",xo,[l("div",Vo,[ei,l("div",{class:"change-price",onClick:u[2]||(u[2]=(...a)=>e.toggle&&e.toggle(...a))},ii)]),l("div",ri,[_t(l("img",ni,null,512),[[s,e.getCoinIcon(e.fromCoin)]]),l("span",null,ue((r=e.fromCoin)==null?void 0:r.symbol),1)])]),l("div",ai,[li,l("div",si,ue(e.lever),1)]),l("div",ui,[ci,l("div",null,[l("span",null,ue(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:Pe(Ue))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Pe(Ue))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(h(),I("span",di,ue((W=e.toCoin)==null?void 0:W.symbol)+" per "+ue((ee=e.fromCoin)==null?void 0:ee.symbol),1)):V("",!0)])])]),l("div",mi,[e.currentTab=="liquidity"?(h(),I("div",{key:0,class:"zoom-in",onClick:u[3]||(u[3]=(...a)=>e.zoomIn&&e.zoomIn(...a))}," - ")):V("",!0),e.currentTab=="liquidity"?(h(),I("div",{key:1,class:"zoom-out",onClick:u[4]||(u[4]=(...a)=>e.zoomOut&&e.zoomOut(...a))}," + ")):V("",!0)])]),l("div",vi,[l("div",fi,[l("div",gi,[l("div",pi,[l("div",{class:"slider-ratio",style:bt(e.sliderStyle(e.currentPriceTab))},hi,4)])]),l("div",ki,[(h(!0),I(it,null,ht(e.priceTablList,a=>(h(),I("div",{key:a.key,class:Je(["price-tab-item",e.currentPriceTab==a.key?"price-tab-item-active":""]),onClick:A=>e.priceTab(a)},[l("img",{src:e.getPriceTabImage(a.key),alt:""},null,8,yi),l("span",null,ue(e.getPriceTabText(a.key)),1)],10,wi))),128))])]),l("div",_i,[l("div",Ci,[l("div",{class:Je(["liquidity",e.currentTab=="liquidity"?"liquidity-tab-active":""]),onClick:u[5]||(u[5]=a=>e.currentTab="liquidity")},[e.chainName=="Sui"?(h(),I("img",{key:0,src:e.currentTab=="liquidity"?"/sui-image/Liquidity-Sel.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Pi)):(h(),I("img",{key:1,src:e.currentTab=="liquidity"?"/image/green_chart.png":"/sui-image/Price-Def.png",alt:""},null,8,Ti)),Si],2),l("div",{class:Je(["price",e.currentTab=="price"?"price-tab-active":""]),onClick:u[6]||(u[6]=a=>e.currentTab="price")},[e.chainName=="sui"?(h(),I("img",{key:0,src:e.currentTab=="price"?"/sui-image/Price-Sel.png":"/sui-image/Price-Def.png",alt:""},null,8,Ni)):(h(),I("img",{key:1,src:e.currentTab=="price"?"/image/price-chart.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Ai)),Li],2)]),l("div",Ii,[l("div",qi,[Mi,l("div",null,[l("span",null,ue(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:Pe(Ue))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Pe(Ue))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(h(),I("span",$i,ue(e.direction&&!e.needReverse?`${(K=e.fromCoin)==null?void 0:K.symbol} per ${(g=e.toCoin)==null?void 0:g.symbol}`:`${(n=e.toCoin)==null?void 0:n.symbol} per ${(i=e.fromCoin)==null?void 0:i.symbol}`),1)):V("",!0)])]),l("div",Ri,[e.currentTab=="liquidity"?(h(),I("div",{key:0,class:"zoom-in",onClick:u[7]||(u[7]=(...a)=>e.zoomIn&&e.zoomIn(...a))}," - ")):V("",!0),e.currentTab=="liquidity"?(h(),I("div",{key:1,class:"zoom-out",onClick:u[8]||(u[8]=(...a)=>e.zoomOut&&e.zoomOut(...a))}," + ")):V("",!0)])]),e.fromCoin&&e.toCoin&&e.poolInfo&&e.currentTab=="liquidity"?(h(),Ze(H,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):V("",!0),((p=e.tickList)==null?void 0:p.length)<=0&&e.chartLoading?(h(),Ze(q,{key:1})):V("",!0)])]),l("div",Oi,[l("div",Bi,[e.currentPriceTab!=="full range"?(h(),I("div",Fi,"Leverage")):V("",!0),e.currentPriceTab!=="full range"?(h(),I("div",ji,ue(e.lever),1)):V("",!0)]),l("div",Ui,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(h(),I("div",zi,[Di,l("span",Hi,ue(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),l("span",null,ue(("addCommom"in e?e.addCommom:Pe(Ue))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.before7dContractPriceLowest,6)))+" - "+ue(("addCommom"in e?e.addCommom:Pe(Ue))(("decimalUi"in e?e.decimalUi:Pe(Te))(e.before7dContractPriceHighest,6))),1)])):V("",!0)])]),l("div",Wi,[Ee(y,{"apr-rewards-parameter":e.aprRewardsParameter,"name-tab":"deposit","from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,onChangeAprRewardsParameter:u[9]||(u[9]=a=>{e.aprRewardsParameter=a})},null,8,["apr-rewards-parameter","from-coin","to-coin","pool-info","min-price","max-price"]),Ee(Q,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(h(),I("div",Ei,[l("img",{src:("importIcon"in e?e.importIcon:Pe(kt))("/image/icon-tips-error@2x.png"),alt:""},null,8,Xi),l("p",Zi,ue(e.$t("tips.positionError")),1)])):V("",!0)])])}const Et=nt(Uo,[["render",Gi]]),Ki=rt({components:{NewLiquidityTitle:jt,NewLiquidityAssetsCard:Ut,NewLiquidityDepositRatio:zt},setup(){const{t:e,locale:u}=Ot(),ve=ct(),D=L(()=>ve),F=L(()=>D.value.chainName),pe=yt(),H=L(()=>pe),q=ao(),y=L(()=>q),Q=Tt(),s=L(()=>{let o=null;for(const f in H.value.poolsObj){const k=H.value.poolsObj[f];k.address==Q.query.poolAddress&&(console.log(k,"p===>"),o=k)}return o}),r=G(!1),W=G(!1),ee=L(()=>D.value.theme),K=async(o,f)=>{_.value=o.needReverse?o.token_b:o.token_a,w.value=o.needReverse?o.token_a:o.token_b};Ae(()=>s.value,(o,f)=>{console.log(f,"===>oldVal"),console.log(o,"===>newVal"),(!f&&o&&!Le(o)||f&&o&&f.address!==o.address)&&(console.log("池子信息"),K(o,!f||o.address!==f.address))},{immediate:!0});const g=L(()=>y.value.assets&&_.value&&y.value.assets[_.value.address]?Nt(y.value.assets[_.value.address].balance,_.value.decimals):"0"),n=L(()=>y.value.assets&&w.value&&y.value.assets[w.value.address]?Nt(y.value.assets[w.value.address].balance,w.value.decimals):"0"),i=o=>{o==="fromCoin"?(Ce.value=!0,F.value==="Aptos"?S.value=Number(g.value)>0?_.value.symbol=="APT"?new c(Number(g.value)).sub(new c(.1)).lt(new c(0))?"0":new c(Number(g.value)).sub(new c(.1)).toString():String(g.value):"":S.value=Number(g.value)>0?_.value.symbol=="SUI"?new c(Number(g.value)).sub(new c(.05)).lt(new c(0))?"0":new c(Number(g.value)).sub(new c(.05)).toString():String(g.value):""):(Ce.value=!1,F.value==="Aptos"?N.value=Number(n.value)>0?w.value.symbol=="APT"?new c(Number(n.value)).sub(new c(.1)).lt(new c(0))?"0":new c(Number(n.value)).sub(new c(.1)).toString():String(n.value):"":N.value=Number(n.value)>0?w.value.symbol=="SUI"?new c(Number(n.value)).sub(new c(.05)).lt(new c(0))?"0":new c(Number(n.value)).sub(new c(.05)).toString():String(n.value):"")},p=o=>{o==="fromCoin"?(Ce.value=!0,S.value=Number(g.value)>0?pt(new c(Number(g.value)).div(2).toString(),_.value.decimals).toString():""):(Ce.value=!1,N.value=Number(n.value)>0?pt(new c(Number(n.value)).div(2).toString(),w.value.decimals).toString():"")},a=G(),A=G(),j=G(),te=G(!1),ae=o=>{var f,k,le,J;a.value=o,o==="fromCoin"?(A.value=((f=w.value)==null?void 0:f.address)||"",j.value=Q.query.actions=="new-position"?(k=_.value)==null?void 0:k.address:s.value.needReverse?s.value.token_b.address:s.value.token_a.address):(A.value=((le=_.value)==null?void 0:le.address)||"",j.value=Q.query.actions=="new-position"?(J=w.value)==null?void 0:J.address:s.value.needReverse?s.value.token_a.address:s.value.token_b.address),te.value=!0,console.log(te.value,"==>showCoinSelect.value ")},ce=o=>{var le,J,se,de,me,ne,ie,ye;const f=s.value.needReverse?s.value.token_b:s.value.token_a,k=s.value.needReverse?s.value.token_a:s.value.token_b;a.value==="fromCoin"?(((le=_.value)==null?void 0:le.address)===(f==null?void 0:f.address)||!((J=_.value)!=null&&J.address)?(w.value&&o.address.toLowerCase()===((se=w)==null?void 0:se.value.address.toLowerCase())&&(w.value=null),_.value=o):(_.value&&o.address.toLowerCase()===((de=_)==null?void 0:de.value.address.toLowerCase())&&(_.value=null),w.value=o),Q.query.action||(Q.query.fee="")):((me=w.value)==null?void 0:me.address)===(k==null?void 0:k.address)||!((ne=w.value)!=null&&ne.address)?(_.value&&o.address.toLowerCase()===((ie=_)==null?void 0:ie.value.address.toLowerCase())&&(_.value=null),w.value=o):(w.value&&o.address.toLowerCase()===((ye=w)==null?void 0:ye.value.address.toLowerCase())&&(w.value=null),_.value=o),te.value=!1},v=L(()=>D.value.chainName?ut(D.value.chainName):{}),M=L(()=>D.value.slippage),O=G(),C=async()=>{var je,Ne,qe,Me;if(We.value)return console.log("跳出"),!1;if(!Z.value&&!z.value)return!1;if(!S.value&&!N.value&&!Z.value&&!z.value)return;const o=s.value||{};if(Le(o))return;const{TickUtil:f,TickMath:k,getNearestTickByTick:le}=v.value,J=o==null?void 0:o.token_a.decimals,se=o==null?void 0:o.token_b.decimals;let de,me,ne,ie,ye,Se,Xe,Ke,he=o==null?void 0:o.current_tick_index,x;if(o.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===w.value.address.toLowerCase()?x=!0:x=!1,Z.value==="0"&&z.value==="∞")ne=f.getMinIndex(Number(o.tickSpacing)),ie=f.getMaxIndex(Number(o.tickSpacing)),ye=k.tickIndexToSqrtPriceX64(ne),Se=k.tickIndexToSqrtPriceX64(ie),console.log(ne,ie,"#######updateAmounts 513");else if(oe.value=="custom"){console.log(x,"===>directs1866"),x?(de=Number(Z.value),me=Number(z.value)):(de=new c(1).div(z.value).toString(),me=new c(1).div(Z.value).toString());try{Xe=de==0?-443636:k.priceToTickIndex(new c(de),J,se)}catch{Xe=-443636}try{Ke=k.priceToTickIndex(new c(me),J,se)}catch{Ke=443636}ne=le(Xe,Number(o.tickSpacing)),ie=le(Ke,Number(o.tickSpacing)),ye=k.priceToSqrtPriceX64(new c(de),J,se);try{Se=k.priceToSqrtPriceX64(new c(me),J,se)}catch{console.log("0523###test###max###",me),me===1/0&&(console.log("0523###test###max###11111"),Se=k.tickIndexToSqrtPriceX64(f.getMaxIndex(Number(o.tickSpacing))))}console.log("0518###pre###tick_lower###",ne,ie,he),console.log("0518###pre###tick_upper###",ie)}else ne=(je=Qe.value[oe.value])==null?void 0:je.lower,ie=(Ne=Qe.value[oe.value])==null?void 0:Ne.upper,ye=k.tickIndexToSqrtPriceX64(ne),Se=k.tickIndexToSqrtPriceX64(ie);if(z.value!=="∞"&&ne>=ie){r.value=!0,S.value="",W.value=!0,N.value="";return}if(console.log(ie,he,ne,"1922"),z.value==="∞"||he>=ne&&he<=ie){r.value=!1,W.value=!1;let _e;if(S.value||N.value){if(Ce.value){const mt=new c(S.value).mul(Math.pow(10,_.value.decimals)).toString();_e=new ze(mt)}else{const mt=new c(N.value).mul(Math.pow(10,w.value.decimals)).toString();_e=new ze(mt)}console.log(x,"======>directs");const{liquidityAmount:He,tokenMaxA:Ve,tokenMaxB:et,tokenMaxAOrigin:Zt,tokenMaxBOrigin:Gt}=v.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:ne,upperTick:ie,coinAmount:_e,iscoinA:x?Ce.value:!Ce.value,roundUp:!0,slippage:Number(M.value)/100,curSqrtPrice:new ze(o.current_sqrt_price)});O.value={liquidityAmount:He,tokenMaxA:Ve,tokenMaxB:et,tokenMaxAOrigin:Zt,tokenMaxBOrigin:Gt},console.log(Ve,et,"preAdd"),x?Ce.value?N.value=Number(et)>0?et:"":S.value=Number(Ve)>0?Ve:"":Ce.value?N.value=Ve:S.value=et}}else if(he>ie){if(x?S.value="":N.value="",r.value=x,W.value=!x,S.value||N.value){let _e;if(x){const He=new c(N.value).mul(Math.pow(10,(qe=w.value)==null?void 0:qe.decimals)).toString();_e=new ze(He),O.value={liquidityAmount:v.value.estimateLiquidityForCoinB(ye,Se,_e),tokenMaxA:0,tokenMaxB:N.value}}else{const He=new c(S.value).mul(Math.pow(10,(Me=_.value)==null?void 0:Me.decimals)).toString();_e=new ze(He),O.value={liquidityAmount:v.value.estimateLiquidityForCoinB(ye,Se,_e),tokenMaxA:0,tokenMaxB:S.value}}}}else if(he<ne){if(r.value=!x,W.value=x,x?N.value="":S.value="",S.value||N.value){let _e;if(x){const He=new c(S.value).mul(Math.pow(10,_.value.decimals)).toString();_e=new ze(He),O.value={liquidityAmount:v.value.estimateLiquidityForCoinA(ye,Se,_e),tokenMaxA:S.value,tokenMaxB:0}}else{const He=new c(N.value).mul(Math.pow(10,w.value.decimals)).toString();_e=new ze(He),O.value={liquidityAmount:v.value.estimateLiquidityForCoinA(ye,Se,_e),tokenMaxA:N.value,tokenMaxB:0}}}}else r.value=!0,S.value="",W.value=!0,N.value=""};Ae(S,(o,f)=>{console.log(S,"===>fromCoinAmount"),o==""&&Ce.value&&(N.value=""),o&&Ce.value&&!We.value&&C()}),Ae(N,(o,f)=>{console.log(o,"===>>>>newValsda"),o==""&&!Ce.value&&(S.value=""),o&&!Ce.value&&!We.value&&C()});const P=G("--"),E=L(()=>H.value.RATES),$=()=>{const o=E.value&&E.value[_.value.address]&&E.value[_.value.address].price,f=E.value&&E.value[w.value.address]&&E.value[w.value.address].price;if(o&&f){const k=new c(S.value>0?S.value:0).mul(o),le=new c(N.value>0?N.value:0).mul(f),J=k.add(le).toNumber();P.value=J>0&&J<.01?"$<0.01":"$"+Ue(J,2)}else P.value="--"};Ae(()=>[S.value,N.value,We.value],([o,f,k])=>{(o||f)&&!k?$():(!o||!f)&&!k&&(P.value="--")},{immediate:!0}),Ae(()=>P,o=>{console.log(o,"71911111")},{immediate:!0});const X=G(),R=async()=>{var x,je;if(!Z.value&&!z.value)return!1;if(!S.value&&!N.value&&!Z.value&&!z.value)return;const o=s.value;if(Le(o))return;const{TickUtil:f,TickMath:k,getNearestTickByTick:le}=v.value,J=o==null?void 0:o.token_a.decimals,se=o==null?void 0:o.token_b.decimals;let de,me,ne,ie,ye,Se,Xe;if(o.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===w.value.address.toLowerCase()?Xe=!0:Xe=!1,Z.value==="0"&&z.value==="∞")ne=f.getMinIndex(Number(o.tickSpacing)),ie=f.getMaxIndex(Number(o.tickSpacing));else if(oe.value=="custom"){Xe?(de=Number(Z.value),me=Number(z.value)):(de=new c(1).div(z.value).toString(),me=new c(1).div(Z.value).toString());try{ye=de==0?-443636:k.priceToTickIndex(new c(de),J,se)}catch{ye=-443636}try{Se=k.priceToTickIndex(new c(me),J,se)}catch{Se=443636}ne=le(ye,Number(o.tickSpacing)),ie=le(Se,Number(o.tickSpacing))}else ne=(x=Qe.value[oe.value])==null?void 0:x.lower,ie=(je=Qe.value[oe.value])==null?void 0:je.upper;const Ke=E.value[o==null?void 0:o.token_a.address].price,he=E.value[o==null?void 0:o.token_b.address].price;$e.value?new ze(o.current_sqrt_price):new ze(1/o.current_sqrt_price),console.log($e.value,"===>direction.value"),console.log(o,"poolInfos===>"),console.log(ne,ie,"####tick_lower tick_upper 889");try{const{amountA:Ne,amountB:qe,tokenAmountsInfo:Me}=await v.value.estCoinAmountsFromTotalAmount({lowerTick:ne,upperTick:ie,decimalsA:J,decimalsB:se,curSqrtPrice:new ze(o.current_sqrt_price),totalAmount:P.value,tokenPriceA:Ke,tokenPriceB:he});console.log(Ne,qe,"###estCoinAmountsFromTotalAmount 844"),console.log(o.needReverse,$e.value,"===>849"),X.value=Me,o.needReverse?$e.value?(S.value=Ne,N.value=qe):(S.value=qe,N.value=Ne):(S.value=Ne,N.value=qe)}catch(Ne){console.log(Ne,"e===>")}};Ae([Z,z],([o,f])=>{console.log(o,f,"==>minPrice,maxPrice"),We.value?We.value&&R():C(),f!=="∞"&&Number(o)!==0&&Number(f)!==0&&Number(o)>=Number(f)?ot.value=!0:ot.value=!1,Number(o)==0&&Number(f)==0&&st.value&&(ot.value=!0,console.log("价格区间错误"))},{deep:!0,immediate:!0});const Ie=o=>{console.log(o,"e");const f=o.replace(/[^\d.]/g,""),k="$"+Ue(f);We.value=!0,P.value=k,o>0?R():(S.value="",N.value="")},T=G(!1),{setTransactionTxid:re,setTransactionDesc:Ye,setIsShowWaiting:t,setIsShowSuccess:b,setPositiomNum:B,setIsShowRejected:U}=ve,ke=fo(),Y=L(()=>H.value.currentPositionInfo),Re=G(!1),we=async o=>{var ye,Se,Xe,Ke;console.log(s.value,"===> poolInfo.value"),T.value=!1,H.value.currentPositionInfo={},re(""),Ye(e("tips.increaseLiquiditySuccess",{from:r.value?"":`${S.value} ${(ye=_.value)==null?void 0:ye.symbol}`,and:!r.value&&!W.value?"and":"",to:W.value?"":`${N.value} ${(Se=w.value)==null?void 0:Se.symbol}`})),t(!0);const f=$e.value?Ce.value:!Ce.value;let k,le,J,se,de,me;const ne=s.value.token_a.decimals,ie=s.value.token_b.decimals;if(Z.value==="0"&&z.value==="∞")J=v.value.TickUtil.getMinIndex(Number(s.value.tickSpacing)),se=v.value.TickUtil.getMaxIndex(Number(s.value.tickSpacing));else if(oe.value=="custom"){$e.value?(k=Number(Z.value),le=Number(z.value)):(k=new c(1).div(z.value).toString(),le=new c(1).div(Z.value).toString()),console.log("0519###toAdd###min###",k),console.log("0519###toAdd###max###",le),console.log("0519###toAdd###minPrice.value###",Z.value),console.log("0519###toAdd###maxPrice.value###",z.value);try{de=k==0?v.value.TickUtil.getMinIndex(Number(s.value.tickSpacing)):v.value.TickMath.priceToTickIndex(new c(k),ne,ie)}catch{de=v.value.TickUtil.getMinIndex(Number(s.value.tickSpacing))}try{me=v.value.TickMath.priceToTickIndex(new c(le),ne,ie)}catch{me=v.value.TickUtil.getMaxIndex(Number(s.value.tickSpacing))}J=v.value.getNearestTickByTick(de,Number(s.value.tickSpacing)),se=v.value.getNearestTickByTick(me,Number(s.value.tickSpacing))}else J=Qe.value[oe.value].lower,se=Qe.value[oe.value].upper;console.log(J,se,"####tick_lower tick_upper 889"),console.log(s.value,"==>poolInfo.value.curSqrtPrice");try{let he;We.value?he=await v.value.getCreateAddLiquidityPayload({pool:s.value,curSqrtPrice:new ze(s.value.current_sqrt_price),tickLower:J,tickUpper:se,slippage:Number(M.value)/100,tokenAmounts:X.value}):he=await v.value.getAddLiquidityTransactionPayload({pool:{poolAddress:s.value.poolAddress,token_a:s.value.token_a,token_b:s.value.token_b},amount:Ce.value?S.value:N.value,fix_amount_a:f,tick_lower:J,tick_upper:se,index:0,slippage:Number(M.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new ze(s.value.current_sqrt_price)}),console.log(he,"payload===?");let x;if(F.value==="Aptos")x=await y.value.currentWallet.signAndSubmitTransaction(he);else{const je=await y.value.currentWallet.signAndExecuteTransactionBlock(he);x=v.value.handleTx(je)}if(console.log("0410###tx###",x),x&&x.hash){re(x.hash),t(!1),b(!0);let je;s.value.needReverse?s.value.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&s.value.token_b.address.toLowerCase()===w.value.address.toLowerCase()?je=!1:je=!0:s.value.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&s.value.token_b.address.toLowerCase()===w.value.address.toLowerCase()?je=!0:je=!1,console.log(je,"===>directs");const Ne={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:r.value?"":`${S.value} ${(Xe=_.value)==null?void 0:Xe.symbol}`,and:!r.value&&!W.value?"and":"",to:W.value?"":`${N.value} ${(Ke=w.value)==null?void 0:Ke.symbol}`}),hash:x.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};F.value!=="Aptos"&&(Ne.res=x.res),v.value.showTransitionPending(Ne);const qe=await v.value.watchTransaction(Ne,!0);if(qe.status){if(b(!1),H.value.setCurrentPositionLoading(!0),Re.value=!0,console.log(qe.nftInfo,"===> watchInfo.nftInfo"),F.value==="Aptos"){if(await H.value.setCurrentPositionInfo(qe.nftInfo[0].data.id.creator,qe.nftInfo[0].data.id.collection,qe.nftInfo[0].data.name,F.value),o)try{await ke.subscribePosition({pool_address:Y.value.poolAddress,position_index:Y.value.index},Y.value.nftHash)}catch(Me){console.log(Me,"e")}}else{const Me=qe.nftInfo,_e=await At(2e3);if(await H.value.setCurrentPositionInfo(Me==null?void 0:Me.pool,"","",F.value,Me==null?void 0:Me.position),await At(1e3),console.log("0529###nftInfo###",Me),console.log("0529###currentPositionInfo.value.index###",Y.value.index),o)try{await ke.subscribePosition({pool_address:Y.value.poolAddress,position_index:Y.value.index},Y.value.nftHash)}catch(He){console.log(He)}}setTimeout(()=>{pe.updateCurrentPools(s.value.poolAddress,F.value),v.value.getAccount(y.value.address)},3e3),setTimeout(async()=>{Lt(v,s)},3e3)}B()}else t(!1),U(!0);S.value="",N.value=""}catch(he){S.value="",N.value="",console.log("0330###Add liquidity Error###",he),t(!1),U(!0)}},De=L(()=>!S.value&&!N.value?(console.log("addLiquidityBtnDisabled11111"),!0):Number(S.value)>Number(g.value)||Number(N.value)>Number(n.value)?(console.log("addLiquidityBtnDisabled22222"),!0):Oe.value!==e("button.addLiquidity")&&Oe.value!==e("newAdd.preview")?(console.log("addLiquidityBtnDisabled33333###",Oe.value),!0):s.value&&s.value&&s.value.is_pause?(console.log("addLiquidityBtnDisabled44444"),!0):Number(S.value)<=0&&Number(N.value)<=0||!r.value&&Number(S.value)==0||!W.value&&Number(N.value)==0),Ge=L(()=>!_.value||!w.value),Oe=L(()=>s.value&&s.value.is_pause?"Pool Closed":!_.value||!w.value||Ge.value?e("modal.selectTokenModalTitle"):Number(S.value)>Number(g.value)?e("button.insufficientBalance",{name:_.value.symbol}):Number(N.value)>Number(n.value)?e("button.insufficientBalance",{name:w.value.symbol}):!Number(S.value)&&!Number(N.value)?e("button.enterAmount"):z.value!=="∞"&&Number(Z.value)>=Number(z.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),be=G({}),Be=G({}),xe=G(!1),at=(o,f)=>{console.log(a.value,"===>currentCoinKey.value"),console.log(o);const k=localStorage.getItem(o.address);console.log(H.value.tokensObj,"===>pools.value.tokensObj"),console.log(k,"===>coinLocak"),H.value.tokensObj&&H.value.tokensObj[o.address]&&H.value.tokensObj[o.address].isSelfBuilt&&!k&&(f=="fromCoin"&&(be.value=o),f=="toCoin"&&(Be.value=o),xe.value=!0)};Ae(()=>[_.value,w.value],([o,f])=>{o&&!Le(o)&&at(o,"fromCoin"),f&&!Le(f)&&at(f,"toCoin")},{immediate:!0});const d=Yt(),m=()=>{F.value!=="Aptos"?d.push("/pool/list"):d.push("/pools")},Fe=o=>{We.value,we(o)},fe=()=>{Q.query.action!=="create-pool"&&Q.query.actions!=="new-position"&&(Lt(v,s),C(),pe.updateCurrentPools(s.value.poolAddress,F.value)),pe.setPoolConfigList(F.value,D.value.filterCoinsObj)},ge=L(()=>{var k,le,J,se,de,me;const o=(J=E.value[(le=(k=_)==null?void 0:k.value)==null?void 0:le.address])==null?void 0:J.price,f=(me=E.value[(de=(se=w)==null?void 0:se.value)==null?void 0:de.address])==null?void 0:me.price;return!!(o&&f)});return Ae(()=>[Q,H.value.tokensObj],([o,f])=>{var k;f&&!Le(f)&&(w.value||(w.value=H.value.tokensObj[(k=o==null?void 0:o.query)==null?void 0:k.toCoin]))},{immediate:!0,deep:!0}),{decimalUi:Te,poolInfo:s,fromCoinAmount:S,toCoinAmount:N,fromCoin:_,toCoin:w,theme:ee,showFromCoinLock:r,showToCoinLock:W,fromCoinBlance:g,toCoinBlance:n,maxBtnSelect:i,halfBtnSelect:p,fixedFromCoin:Ce,openCoinSelect:ae,currentCoinKey:a,existingCoins:A,lastSelectCoin:j,showCoinSelect:te,onCoinSelect:ce,liquidityTotalAmount:P,toggle:Dt,onInput:Ie,isInputTotalAmount:We,isViewDetail:Re,addLiquidityBtnDisabled:De,addLiquidityBtnText:Oe,isShowTokenWarning:xe,chainName:F,closeTokenWarning:m,warningFromCoin:be,warningToCoin:Be,isShowLiquidityModal:T,currentPrice:st,currentPriceReverse:wt,currentPriceTab:oe,minPrice:Z,maxPrice:z,toAdd:we,direction:$e,wallet:y,getAddLiquidityType:Fe,clickRefresh:fe,isShowtotalAmount:ge}}});const Ji={class:"new-liquidity-right"},Qi={class:"deposit-title"},Yi={class:"card-container"},xi={class:"card-item"},Vi={class:"card-item"},er={key:0,class:"total-amount"},tr=l("span",null,"Total Amount",-1);function or(e,u,ve,D,F,pe){const H=jt,q=Ut,y=no,Q=Vt,s=zt,r=eo,W=uo,ee=co,K=mo,g=vo;return h(),I("div",Ji,[l("div",Qi,[Ee(H,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),l("div",Yi,[l("div",xi,[Ee(q,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":u[0]||(u[0]=n=>e.fromCoinAmount=n),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:u[1]||(u[1]=n=>e.maxBtnSelect("fromCoin")),onOnHalf:u[2]||(u[2]=n=>e.halfBtnSelect("fromCoin")),onOnInput:u[3]||(u[3]=n=>{e.fromCoinAmount=n,e.fixedFromCoin=!0,e.isInputTotalAmount=!1}),onOnSelect:u[4]||(u[4]=n=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock?(h(),Ze(y,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):V("",!0)]),l("div",Vi,[Ee(q,{modelValue:e.toCoinAmount,"onUpdate:modelValue":u[5]||(u[5]=n=>e.toCoinAmount=n),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:u[6]||(u[6]=n=>e.maxBtnSelect("toCoin")),onOnHalf:u[7]||(u[7]=n=>e.halfBtnSelect("toCoin")),onOnInput:u[8]||(u[8]=n=>{e.toCoinAmount=n,e.fixedFromCoin=!1,e.isInputTotalAmount=!1}),onOnSelect:u[9]||(u[9]=n=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock?(h(),Ze(y,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):V("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(h(),I("img",{key:0,class:"add",src:go,alt:"",onClick:u[10]||(u[10]=(...n)=>e.toggle&&e.toggle(...n))})):V("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(h(),I("img",{key:1,class:"add",src:po,alt:"",onClick:u[11]||(u[11]=(...n)=>e.toggle&&e.toggle(...n))})):V("",!0)]),e.isShowtotalAmount?(h(),I("div",er,[tr,l("span",null,[Ee(Q,{value:e.liquidityTotalAmount,placeholder:e.isInputTotalAmount?"":e.liquidityTotalAmount,onInput:u[12]||(u[12]=n=>e.onInput(n.target.value))},null,8,["value","placeholder"])])])):V("",!0),Ee(s,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),Ee(r,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:u[13]||(u[13]=n=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:xt(()=>[Pt(ue(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(h(),Ze(W,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:u[14]||(u[14]=n=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):V("",!0),e.isViewDetail?(h(),Ze(ee,{key:2,"pool-info":e.poolInfo,onOnClose:u[15]||(u[15]=n=>e.isViewDetail=!1)},null,8,["pool-info"])):V("",!0),e.chainName=="Sui"&&e.isShowTokenWarning?(h(),Ze(K,{key:3,"from-coin":e.warningFromCoin,"to-coin":e.warningToCoin,onClose:e.closeTokenWarning,onClickContinue:u[16]||(u[16]=n=>e.isShowTokenWarning=!1)},null,8,["from-coin","to-coin","onClose"])):V("",!0),e.isShowLiquidityModal?(h(),Ze(g,{key:4,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:u[17]||(u[17]=n=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):V("",!0)])}const Xt=nt(Ki,[["render",or]]),ir=rt({components:{NewLiquidityLeft:Et,NewLiquidityRight:Xt},setup(){Bt(()=>{so()});const e=Tt();return{tickList:tt,route:e}}});const rr={key:0,class:"loading-spin-liquidity loading-global"},nr={class:"privide-liquidity"};function ar(e,u,ve,D,F,pe){var Q,s;const H=Ct,q=Et,y=Xt;return h(),I(it,null,[!e.tickList&&((s=(Q=e.route)==null?void 0:Q.query)!=null&&s.poolAddress)?(h(),I("div",rr,[Ee(H)])):V("",!0),l("div",nr,[Ee(q),Ee(y)])],64)}const Hr=nt(ir,[["render",ar],["__scopeId","data-v-9c3e932a"]]);export{Hr as default};
