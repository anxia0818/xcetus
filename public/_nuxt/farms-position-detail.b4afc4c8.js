import{_ as te}from"./apr-tips.8b0d0114.js";import{u as ae,m as ne,e as re,s as V,a as Q,c as E}from"./pool.9c35598a.js";import{a as ie,l as h,b as le,r as R,q as ce,e as de,s as ue,o as c,f as u,h as o,j as k,v as J,u as L,i as N,F as G,E as H,c as O,w as C,x as W,z as me,B as pe,P as fe,t as D,p as _e,k as ve}from"./entry.91620dd3.js";/* empty css              */import{u as he}from"./farms.baec4d27.js";import{i as we}from"./import-icon.de3e6c66.js";import{D as K}from"./decimal.0bdeb344.js";import{a as ge,u as ke}from"./sha256.5c96fd9b.js";const Pe=ie({setup(){const e=ae(),_=h(()=>e),U=he(),M=h(()=>U),F=le(),s=h(()=>_.value.currentPositionInfo),T=R(),S=a=>{var n;return((n=_.value.tokensObj[a])==null?void 0:n.logo_url)||we("/image/coins/sui-unknown.png")},y=ne("Sui"),p=R(),l=async a=>{p.value=0;try{const n=await y.calculateFarmingRewards([{pool_id:a.pool_id,position_nft_id:a.id}]),r=[];let i=new K(0);n[a.id].forEach(t=>{var g;const v=(g=_.value.tokensObj[t.rewarder_type])==null?void 0:g.decimals;let w=new K(t.rewarder_amount).div(Math.pow(10,v)).toString();Number(w)>0&&(i=i.add(w),r.push({...t,rewarderAmount:w,rewarderAmountPer:w}))}),p.value=i,T.value=r,console.log("getRewarder",a,r)}catch(n){console.log(n,"getRewarder")}},A=h(()=>M.value.farmsPoolObj),X=h(()=>A.value[s.value.poolAddress]);ce(()=>[s.value,A.value],([a,n])=>{var r;!E(a)&&a.positionSource=="farming"?l(a):!E(n)&&!E(a)&&(console.log(n,"##farmsPoolObj"),T.value=(r=n[a.poolAddress])==null?void 0:r.rewarders)},{immediate:!0});const Y=ge(),$=h(()=>Y),q=ke(),f=re("Sui"),{setIsShowSuccess:j,setIsShowRejected:I,setIsShowWaiting:d,setTransactionDesc:B,setTransactionTxid:b}=q,m=R(!1),Z=async()=>{m.value=!0,b(""),B("Claim rewards"),d(!0);const a={pool_id:s.value.pool_id,position_nft_id:s.value.id};try{const n=await y.harvestFarms(a),r=await $.value.currentWallet.signAndExecuteTransactionBlock(n);console.log("0221###sui swap res###",r);let i=f.handleTx(r);if(i&&i.hash){b(i.hash),d(!1),j(!0);let t={title:"Claim",res:i.res,hash:i.hash};f.showTransitionPending(t),await f.watchTransaction(t)&&setTimeout(()=>{l(s.value)},2e3)}else d(!1),I(!0);m.value=!1}catch(n){console.log("farmsDeposit error",n),d(!1),I(!0),m.value=!1}},x=async()=>{m.value=!0,b(""),B(`Unstake ${s.value.name}`),d(!0);const a=s.value.pool_id,n=s.value.id;try{const r=await y.farmsWithdraw(a,n),i=await $.value.currentWallet.signAndExecuteTransactionBlock(r);console.log("0221###sui swap res###",i);let t=f.handleTx(i);if(console.log(t,"unStaketx##"),t&&t.hash){b(t.hash),d(!1),j(!0);let v={res:t.res,title:"Unstake",hash:t.hash};f.showTransitionPending(v),await f.watchTransaction(v)&&setTimeout(()=>{console.log("unstake success"),F.replace(`/new-position-detail?name=${s.value.tokenName}address=${s.value.clmm_pool_id}&pos=${s.value.clmm_position_id}`),_.value.setCurrentPositionInfo(s.value.clmm_pool_id,"",s.value.tokenName,"Sui",s.value.clmm_position_id),p.value=0},2e3)}else d(!1),I(!0);m.value=!1}catch(r){console.log("farmsDeposit error",r),d(!1),I(!0),m.value=!1}},ee=async()=>{console.log(s.value,"currentPositionInfo.value"),m.value=!0,b(""),B(`Stake ${s.value.name}`),d(!0);const a={clmm_pool_id:s.value.poolAddress,clmm_position_id:s.value.pos_object_id,coinTypeA:s.value.coin_type_a,coinTypeB:s.value.coin_type_b},n=A.value[s.value.poolAddress].id;try{const r=await y.farmsDeposit(a,n),i=await $.value.currentWallet.signAndExecuteTransactionBlock(r);console.log("0221###sui swap res###",i);let t=f.handleTx(i);if(t&&t.hash){b(t.hash),d(!1),j(!0);let v={res:t.res,title:"Staked",hash:t.hash};f.showTransitionPending(v);const w=await f.watchTransaction(v);let g;console.log(t,"tx###"),w&&setTimeout(async()=>{t.res.events.forEach(z=>{z.type.indexOf("::pool::DepositEvent")>-1&&(g=z.parsedJson.wrapped_position_id)}),F.replace(`/new-position-detail?position_nft_id=${g}&positionSource=farming`),console.log(g,"###farmPositionId"),await _.value.setCurrentPositionInfo("","","","Sui",g,"farming"),m.value=!1},2e3)}else d(!1),I(!0)}catch(r){console.log("farmsDeposit error",r),d(!1),I(!0),m.value=!1}},oe=h(()=>q),se=h(()=>oe.value.addressLpTokens);return{getCoinIcon:S,rewardList:T,sFixD:V,addCommom:Q,claim:Z,unStake:x,loading:m,totalRewardAmount:p,currentPositionInfo:s,stake:ee,farmsPoolObj:A,addressLpTokens:se,farmsPoolInfo:X}}});const P=e=>(_e("data-v-c1c7437b"),e=e(),ve(),e),Se={key:0,class:"farms-position-detail"},ye={class:"farms-top"},Ie=P(()=>o("div",{class:"left"},[o("div",{class:"title"},"Farming"),o("div",{class:"desc"},"Stake Position to Earn")],-1)),be={class:"right"},Ce={class:"apr"},Te={class:"apr-tips-box"},Ae=P(()=>o("span",null,"View",-1)),De=P(()=>o("svg",{class:"arrow-icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-icon_arrow"})],-1)),Fe=[Ae,De],$e={class:"farms-bottom"},je=P(()=>o("div",{class:"title"},"Earnings",-1)),Be={key:0,class:"reward-list"},Ee={key:0,class:"rewards-item-bg"},Re={class:"rewards-item-box"},Le={alt:""},Ne={key:1},Oe={class:"rewards-item-bg"},We={class:"rewards-item-box"},Ve={alt:""},Ue=P(()=>o("span",null,"0",-1)),Me={key:1,class:"reward-list"},qe={key:0,class:"rewards-item-bg"},ze={class:"rewards-item-box"},Je={alt:""},Ge=P(()=>o("span",null,"0",-1)),He={key:1},Ke={class:"rewards-item-bg"},Qe={class:"rewards-item-box"},Xe={alt:""},Ye=P(()=>o("span",null,"0",-1)),Ze={class:"actions-box"};function xe(e,_,U,M,F,s){const T=te,S=pe,y=fe,p=ue("image");return e.farmsPoolObj&&e.farmsPoolObj[e.currentPositionInfo.poolAddress]&&e.farmsPoolObj[e.currentPositionInfo.poolAddress].status=="Live"||e.currentPositionInfo.positionSource=="farming"?(c(),u("div",Se,[o("div",ye,[Ie,o("div",be,[o("div",Ce,[k(" APR "),o("span",null,[k(J(("sFixD"in e?e.sFixD:L(V))(e.farmsPoolInfo.total_apr*100,2))+"% ",1),o("div",Te,[N(T,{"l-item":e.farmsPoolInfo,"rewarder-info":e.farmsPoolInfo.rewarder.rewardList},null,8,["l-item","rewarder-info"])])])]),o("div",{class:"view",onClick:_[0]||(_[0]=l=>e.$router.push("/farms"))},Fe)])]),o("div",$e,[je,e.rewardList&&e.rewardList.length>0?(c(),u("div",Be,[(c(!0),u(G,null,H(e.rewardList,l=>(c(),u("div",{key:l,class:"rewards-item"},[e.currentPositionInfo.positionSource=="farming"?(c(),u("div",Ee,[o("div",Re,[D(o("img",Le,null,512),[[p,e.getCoinIcon(l.rewarder_type)]]),o("span",null,J(l.rewarderAmountPer>0&&l.rewarderAmountPer<.01?"<0.01":("addCommom"in e?e.addCommom:L(Q))(("sFixD"in e?e.sFixD:L(V))(l.rewarderAmount,4))),1)])])):(c(),u("div",Ne,[o("div",Oe,[o("div",We,[D(o("img",Ve,null,512),[[p,e.getCoinIcon(l.reward_coin)]]),Ue])])]))]))),128))])):(c(),u("div",Me,[(c(!0),u(G,null,H(e.currentPositionInfo.rewards,l=>(c(),u("div",{key:l,class:"rewards-item"},[e.currentPositionInfo.positionSource=="farming"?(c(),u("div",qe,[o("div",ze,[D(o("img",Je,null,512),[[p,e.getCoinIcon(l.rewarder_type)]]),Ge])])):(c(),u("div",He,[o("div",Ke,[o("div",Qe,[D(o("img",Xe,null,512),[[p,e.getCoinIcon(l.reward_coin)]]),Ye])])]))]))),128))])),o("div",Ze,[e.currentPositionInfo&&e.currentPositionInfo.positionSource=="farming"?(c(),O(S,{key:0,class:"unstake-btn",loading:e.loading,onClick:e.unStake},{default:C(()=>[k("Unstake")]),_:1},8,["loading","onClick"])):W("",!0),e.currentPositionInfo&&e.currentPositionInfo.positionSource=="clmm"&&e.currentPositionInfo.currentStatus!=="Active"?(c(),O(y,{key:1},{title:C(()=>[k("Farming rewards are only available for active positions.")]),default:C(()=>[N(S,{class:"unstake-btn",loading:e.loading,disabled:!0,onClick:e.stake},{default:C(()=>[k("Stake")]),_:1},8,["loading","onClick"])]),_:1})):e.currentPositionInfo&&e.currentPositionInfo.positionSource=="clmm"?(c(),O(S,{key:2,class:"unstake-btn",loading:e.loading,onClick:e.stake},{default:C(()=>[k("Stake")]),_:1},8,["loading","onClick"])):W("",!0),N(S,{class:"unstake-btn btn-margin",loading:e.loading,disabled:e.totalRewardAmount==0||e.currentPositionInfo&&e.currentPositionInfo.positionSource!=="farming",onClick:me(e.claim,["stop"])},{default:C(()=>[k("â†‘ Claim")]),_:1},8,["loading","disabled","onClick"])])])])):W("",!0)}const lo=de(Pe,[["render",xe],["__scopeId","data-v-c1c7437b"]]);export{lo as _};
