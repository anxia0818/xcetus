import{a as ut,b as Kt,n as pt,d as Se,u as Ct,e as Ue,c as Ie,i as Jt,s as bt,T as Nt,p as At,f as ze,g as Lt}from"./pool.eb83db9a.js";import{a as it,r as Z,m as L,y as Mt,D as Le,e as at,o as T,f as j,c as Ge,x as V,h as a,t as Pt,G as $t,H as ht,v as ue,u as Te,F as rt,J as Tt,p as Rt,k as Ot,z as Je,s as wt,j as ct,l as Bt,E as St,C as Ft,q as Qt,i as He,w as kt,L as Yt,b as Vt,B as eo}from"./entry.f9e5814c.js";/* empty css              */import{s as lt,m as to,l as oo,b as ro,a as io,_ as ao}from"./transform.cd41bcde.js";import{D as s}from"./decimal.0e8aa3f1.js";import{u as dt,a as no}from"./sha256.92ccfdef.js";import"./decimal.633e31ee.js";import{g as lo}from"./common-fun.6aeb7fbf.js";import{d as jt,_ as Ut,c as zt,a as Ht,b as so}from"./new-liquidity-title.1180d0d8.js";import{i as yt}from"./import-icon.de3e6c66.js";/* empty css              */import{positionError as Ye,tickList as ot,direction as Oe,minPrice as x,maxPrice as M,fromCoin as P,toCoin as k,currentPrice as st,currentPriceReverse as _t,currentPriceTab as te,defaultMinPrice as ft,defaultMaxPrice as gt,toggle as Et,isInputTotalAmount as Xe,priceConfigObj as Ke,fromCoinAmount as C,toCoinAmount as A,fixedFromCoin as Pe,resetTickList as It,resetData as uo}from"./data.a1679c4c.js";import{_ as co}from"./coin-select.39b850ed.js";import{_ as mo}from"./viewDetail.80ccce65.js";import{b as vo}from"./new-add-or-create.5d360549.js";import{u as fo}from"./notifi.189f529d.js";import{_ as go,a as po}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.85a3ba98.js";import"./precision.a7a6c57b.js";import"./lock.c3948db1.js";/* empty css              *//* empty css              */import"./tick.505fdad3.js";import"./token-warning.0b1e4c33.js";import"./refresh-icon.4dcaf730.js";/* empty css              */import"./swap-setting.a938a161.js";/* empty css              */import"./img-no-Positions_2x.e87603ee.js";import"./status-block.4f03f602.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.0c8f93de.js";import"./index.dfa3bef9.js";function qt(e,c,fe){const H=new s(10).pow(c-fe);return new s(1.0001).pow(e).mul(H)}const bo=it({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,c){const fe=Z(""),H=Z(""),U=L(()=>{var r,b,u,m,B,Q;return console.log(e.poolInfo,"===>props.poolInfo"),(r=e.poolInfo)!=null&&r.current_sqrt_price&&((b=e.poolInfo)!=null&&b.coinA.decimals)&&((u=e.poolInfo)!=null&&u.coinB.decimals)?n.sqrtPriceX64ToPrice((m=e.poolInfo)==null?void 0:m.current_sqrt_price,(B=e.poolInfo)==null?void 0:B.coinA.decimals,(Q=e.poolInfo)==null?void 0:Q.coinB.decimals).toString():"0"}),he=L(()=>{let r=0;return e.direction?r=(Number(e.minPrice)/Number(U.value)-1)*100:r=(Number(e.minPrice)/Number(1/Number(U.value))-1)*100,r=r>0&&r<.1?.1:r,r=r<0&&r>-.1?-.1:r,r}),E=L(()=>{let r=0;return e.direction?r=(Number(e.maxPrice)/Number(U.value)-1)*100:r=(Number(e.maxPrice)/Number(1/Number(U.value))-1)*100,r=r>0&&r<.1?.1:r,r=r<0&&r>-.1?-.1:r,r}),$=dt(),y=L(()=>$),G=L(()=>y.value.chainName?ut(y.value.chainName):{}),{TickMath:n,getNearestTickByTick:i}=G.value,X=(r=[])=>{let b=6;const u=Math.abs(Number(r[0])-Number(r[r.length-1]));return u>=6?b=0:u>=1?b=1:u>=.1?b=2:u>=.01?b=3:u>=.001?b=4:u>=1e-4?b=5:u>=1e-5?b=6:u>=1e-6?b=7:u>=1e-7&&(b=8),b},ee=(r,b=1)=>{if(r&&r.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const u=Number(e.poolInfo.current_tick_index);console.log("0117###dataProcessing###currentTick###",u),console.log("0117###dataProcessing###props.poolInfo###",e.poolInfo),console.log("0117###dataProcessing###minPrice###",e.minPrice),console.log("0117###dataProcessing###maxPrice###",e.maxPrice),console.log("0117###dataProcessing###poolInfo###",e.poolInfo);let m=u+100*b,B=u-100*b,Q,ae;if(e.maxPrice==="∞")ae=G.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ae=n.priceToTickIndex(new s(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ae=n.priceToTickIndex(new s(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ae=443636}if(e.minPrice==="0")Q=G.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?Q=n.priceToTickIndex(new s(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):Q=n.priceToTickIndex(new s(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{Q=-443636}let me=0;if(e.currentPriceTab!=="full range"){if(u>=Q&&u<=ae){const N=u-Q,re=ae-u;me=Math.max(Math.abs(N),Math.abs(re))}else u<Q?me=Math.abs(ae-u):me=Math.abs(u-Q);m=u+me+100*b,B=u-me-100*b}else{const N=(Math.abs(u)>5e3,2e4);m=u+N*b,B=u-N*b}B<-443636&&(B=-443636),m>443636&&(m=443636);const g=new s(r.liquidity).div(Math.pow(10,8)).toString(),I=e.tickList;console.log("0117####drawChart####tick_info_array####",I);const F=[],S=[];let _={};for(let N=0;N<I.length;N++){if(_=I[N],_.index<=u&&_.index>=B){if(F.length<1&&N!==0){const re=I[N-1];F.unshift({...re,index:B,source:"left"})}F.unshift(_)}else if(_.index>u&&_.index<=m&&(S.push(_),F.length<1&&N!==0)){const re=I[N-1];F.push({...re,index:B,source:"left"})}if(_.index>m){const re=I[N];if(S.push({...re,index:m,source:"right"}),F.length<1&&N!==0){const Qe=I[N-1];F.push({...Qe,index:B,source:"left"})}break}}let W="0";for(let N=F.length-1;N>=0;N--)W=new s(W).plus(new s(F[N].liquidityNet.toString()).div(Math.pow(10,8))).toString(),F[N].liquityAmount=W;let R=g;for(let N=0;N<S.length;N++)R=new s(R).plus(new s(S[N].liquidityNet.toString()).div(Math.pow(10,8))).toString(),S[N].liquityAmount=R;let D=[];const q=I&&I.length>0?{index:u,liquityAmount:Number(g)}:{index:u,liquityAmount:0};(F.length>0||S.length>0)&&(D=[...F.reverse(),q,...S],e.direction||(D=D.reverse()));const qe=[];I.forEach(N=>{qe.push({...N,liquidityGross:N.liquidityGross.toString(),liquidityNet:N.liquidityNet.toString()})}),console.log("0117####drawChart####testTickInfoArray####",qe),console.log("0117####drawChart####currentLiquity####",g),l(D,B,m,Q,ae,u)}};let f=Z(!1);Mt(()=>{document.body.clientWidth<750?f.value=!1:f.value=!0,window.onresize=()=>{document.body.clientWidth<750?f.value=!1:f.value=!0,ee(e.poolInfo,e.zoom)}});const l=(r,b,u,m,B,Q)=>{console.log("0117####drawChart####chartData####",r),console.log("0117####drawChart####tickMin####",b),console.log("0117####drawChart####tickMax####",u),console.log("0117####drawChart####minPriceTick####",m),console.log("0117####drawChart####maxPriceTick####",B),console.log("0117####drawChart####currentTick####",Q),console.log("0117####drawChart####props.direction####",e.direction),console.log("0518###newd3###props.before7dContractPriceLowest###",e.before7dContractPriceLowest),console.log("0518###newd3###props.before7dContractPriceHighest###",e.before7dContractPriceHighest);let ae,me;e.direction?(ae=e.before7dContractPriceLowest?n.priceToTickIndex(new s(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",me=e.before7dContractPriceHighest?n.priceToTickIndex(new s(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ae=e.before7dContractPriceLowest?n.priceToTickIndex(new s(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",me=e.before7dContractPriceHighest?n.priceToTickIndex(new s(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const g={top:30,right:35,bottom:20,left:55};let I,F;f.value?(I=460-g.left-g.right,F=205-g.top-g.bottom):(I=340-g.left-g.right,F=205-g.top-g.bottom);const S=u-b,_=parseInt(String(S/4));let W=[b+_/4,b+_,b+2*_,u-_,u-_/4];const R=b,D=u,q=I/(D-R);e.currentPriceTab==="full range"&&(W=[b,b+2*_,u]),console.log("0117####drawChart####xArr####",W),console.log("0117####drawChart####utickMin####",R),console.log("0117####drawChart####utickMax####",D),console.log("0117####drawChart####unit####",q);const qe=W.map(d=>e.direction?qt(d,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new s(1).div(qt(d,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),N=X(qe);lt("#chart").selectAll("*").remove();const re=lt("#chart").attr("width",I+g.left+g.right).attr("height",F+g.top+g.bottom).append("g").attr("transform",`translate(${g.left},${g.right})`),Qe=to(r,function(d){return Number(Math.abs(d.liquityAmount))})||0,Me=oo().range([0,F]).domain([Qe,0]);ro().rangeRound([0,I]).padding(.1);const h=re.append("g").attr("id","barsBox").selectAll("rect").data(r).enter().append("rect");y.value.theme=="default"?h.attr("x",function(d,v){return v===0?0:e.direction?Math.abs(d.index-R)*q:Math.abs(D-d.index)*q}).attr("y",function(d,v){return e.direction?v===r.length-1?0:Me(d.liquityAmount):v===r.length-1?0:Me(r[v+1].liquityAmount)}).attr("width",function(d,v){return v===0&&r.length===1&&d.liquityAmount>0?I:(e.direction,v!==r.length-1?Math.abs(r[v+1].index-d.index)*q:0)}).attr("height",function(d,v){return v===0&&r.length===1&&d.liquityAmount>0?F:e.direction?v===r.length-1?0:F-Me(d.liquityAmount):v===r.length-1?0:F-Me(r[v+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):h.attr("x",function(d,v){return v===0?0:e.direction?Math.abs(d.index-R)*q:Math.abs(D-d.index)*q}).attr("y",function(d,v){return e.direction?v===r.length-1?0:Me(Math.abs(d.liquityAmount)):v===r.length-1?0:Me(Math.abs(r[v+1].liquityAmount))}).attr("width",function(d,v){return v===0&&r.length===1&&d.liquityAmount>0?I:(e.direction,v!==r.length-1?Math.abs(r[v+1].index-d.index)*q:0)}).attr("height",function(d,v){if(v===0&&r.length===1&&d.liquityAmount>0)return F;if(e.direction)return v===r.length-1?0:Number(d.liquityAmount)?F-Me(Math.abs(d.liquityAmount)):0;{if(v===r.length-1)return 0;const Fe=F-Me(Math.abs(r[v+1].liquityAmount));return Number(r[v+1].liquityAmount)?Fe:0}}).attr("fill",function(d,v){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(d,v){return"#417494"});const O=re.append("g");O.append("line").attr("x1",0).attr("y1",155).attr("x2",I).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const z=O.append("g");let ne=0;if(e.direction){for(let d=0;d<W.length;d++){const v=Se(qe[d],N)||"0";console.log("0423####price####",v),qe.push(v);const Fe=Math.abs(W[d]-R)*q;let pe=0;for(let be=0;be<v.length;be++)v[be]==="1"?pe+=4.02:v[be]==="."?pe+=2.64:v[be]==="7"?pe+=5.48:pe+=6;console.log(Fe,"x=>>>"),z.append("text").text(v).attr("x",Fe-pe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}ne=Math.abs(Q-R)*q}else{for(let d=W.length-1;d>=0;d--){const v=Se(qe[d],N)||0;qe.push(v);const Fe=Math.abs(W[d]-D)*q;let pe=0;for(let be=0;be<v.length;be++)v[be]==="1"?pe+=4.02:v[be]==="."?pe+=2.64:v[be]==="7"?pe+=5.48:pe+=6;z.append("text").text(v).attr("x",Fe-pe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}ne=Math.abs(Q-D)*q}console.log(Q,D,q,"######currentPricePositon"),(y.value.theme=="default"?re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+ne+", 0)");let le,Be,xe,Ee;e.direction?(console.log("0525###d3###select###minPriceTick###",m),console.log("0525###d3###select###maxPriceTick###",B),console.log("0525###d3###select###props.minPrice###",e.minPrice),console.log("0525###d3###select###props.maxPrice###",e.maxPrice),le=m<R?-100:parseInt(String(Math.abs(m-R)*q)),Be=B<R?-100:parseInt(String(Math.abs(B-R)*q)),xe=ae<R?-100:Math.abs(ae-R)*q,Ee=me<R?-100:Math.abs(me-R)*q):(Be=m<R?-100:Math.abs(D-m)*q,le=B<R?-100:Math.abs(D-B)*q,Ee=ae<R?-100:Math.abs(D-ae)*q,xe=me<R?-100:Math.abs(D-me)*q),e.minPrice==="0"&&(le=0),e.maxPrice==="∞"&&(Be=I),console.log(le,"==>minPriceTickX"),f.value?fe.value=I-le+87+"px":fe.value=I-le+52+"px",H.value=Be+74+"px",ae&&xe<I&&re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+xe+", 0)"),me&&Ee<I&&re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+Ee+", 0)");const Ce=re.append("g").attr("id","left-handle"),we=re.append("g").attr("id","right-handle");y.value.theme=="default"?(Ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),Ce.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),Ce.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),Ce.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),we.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),we.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),we.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),we.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(Ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),Ce.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),Ce.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),Ce.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),we.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),we.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),we.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),we.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),console.log("0525###d3###select###minPriceTickX###",le),console.log("0525###d3###select###maxPriceTickX###",Be),Ce.attr("transform","translate("+le+", 0)"),we.attr("transform","translate("+Be+", 0)");const Ve=io().extent([[0,0],[I,F]]).handleSize(30).on("end",nt);re.append("g").attr("class","brush").call(Ve).call(Ve.move,[le,Be]);function nt(d){if(!d.sourceEvent||!d.selection)return;Ce.attr("transform","translate("+d.selection[0]+", 0)"),we.attr("transform","translate("+d.selection[1]+", 0)"),f.value?fe.value=I-d.selection[0]+60+"px":fe.value=I-d.selection[0]+52+"px",H.value=d.selection[1]+74+"px";let v,Fe;console.log("0525###d3###select###e.selection[0]###",d.selection[0]),console.log("0525###d3###select###e.selection[0]###",d.selection[1]),console.log("0525###d3###select###props.direction###",e.direction),console.log("0525###d3###select###width###",I),console.log("0525###d3###select###unit###",q),console.log("0525###d3###select###utickMin###",R),console.log("0525###d3###select###utickMax###",D),console.log("0525###d3###select###props.poolInfo###",e.poolInfo);let pe=0,be=0;e.direction?(pe=i(parseInt(String(d.selection[0]/q+R)),Number(e.poolInfo.tickSpacing)),v=n.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),be=i(parseInt(String(d.selection[1]/q+R)),Number(e.poolInfo.tickSpacing)),Fe=n.tickIndexToPrice(be,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),console.log("0525###d3###select###minTick###",pe),console.log("0525###d3###select###maxTick###",be),console.log("0525###d3###select###minPrice###",v),console.log("0525###d3###select###maxPrice###",Fe)):(be=i(D-d.selection[0]/q,Number(e.poolInfo.tickSpacing)),v=1/n.tickIndexToPrice(be,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),pe=i(D-d.selection[1]/q,Number(e.poolInfo.tickSpacing)),Fe=1/n.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),c.emit("onChangeMinPrice",String(Se(String(v),6))),c.emit("onChangeMaxPrice",String(Se(String(Fe),6)))}y.value.theme=="default"?lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632")};Z(""),Le(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom],([r,b,u,m,B])=>{console.log(r,b,u,u>b,"poolInfo && minPrice && maxPrice && (maxPrice > minPrice)"),r&&b&&u&&(r!=null&&r.liquidity)&&(m!=="Custom"||console.log("绘制"),ee(r,B))},{immediate:!0});const K=Z(!1);return Le(()=>e.chartLoading,(r,b)=>{r!==b&&(K.value=r)},{immediate:!0,deep:!0}),console.log(e,"props===>"),{store:y,loading:K,rangeSizeLower:he,rangeSizeUpper:E,rangeSizeLowerPosition:fe,rangeSizeUpperPosition:H,decimalFormat:Kt,numberformat:pt}}});const ho=e=>(Rt("data-v-b6a3023e"),e=e(),Ot(),e),wo={class:"chart-box"},ko={class:"chart"},yo=ho(()=>a("svg",{id:"chart"},null,-1));function _o(e,c,fe,H,U,he){const E=Tt;return T(),j(rt,null,[e.tickList&&e.tickList.length>0&&e.loading?(T(),Ge(E,{key:0})):V("",!0),a("div",wo,[Pt(a("div",ko,[e.currentPriceTab!=="full range"?(T(),j("div",{key:0,class:"range-size range-size-lower",style:ht({right:e.rangeSizeLowerPosition})},ue(("numberformat"in e?e.numberformat:Te(pt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):V("",!0),e.currentPriceTab!=="full range"?(T(),j("div",{key:1,class:"range-size range-size-upper",style:ht({left:e.rangeSizeUpperPosition})},ue(("numberformat"in e?e.numberformat:Te(pt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):V("",!0),yo],512),[[$t,!e.loading]])])],64)}const Dt=at(bo,[["render",_o],["__scopeId","data-v-b6a3023e"]]),Co=it({props:{aprRewardsParameter:{type:Number,default:30},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},fromCoin:{type:Object,default:()=>({})},toCoin:{type:Object,default:()=>({})},poolInfo:{type:Object,default:()=>({})},nameTab:{type:String,default:""}},setup(e){const c=[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}],fe=dt(),H=L(()=>fe);L(()=>H.value.chainName);const U=Ct(),he=L(()=>U),E=L(()=>H.value.chainName?ut(H.value.chainName):{}),$=Z(),y=async i=>{var Q,ae,me;console.log("0607###detail###getAprMethod###poolInfo###",i),console.log("0607###detail###getAprMethod###props.fromCoin###",e.fromCoin),console.log("0607###detail###getAprMethod###props.toCoin###",e.toCoin),console.log("0607###detail###getAprMethod###props.nameTab###",e.nameTab);let X;i.token_a.address.toLowerCase()===e.fromCoin.address.toLowerCase()&&i.token_b.address.toLowerCase()===e.toCoin.address.toLowerCase()?X=!0:X=!1,console.log("0607###detail###getAprMethod###directs###",X),console.log("0607###detail###getAprMethod###props.minPrice###",e.minPrice),console.log("0607###detail###getAprMethod###props.maxPrice###",e.maxPrice);let ee,f;X?(ee=Number(e.minPrice),f=isNaN(Number(e.maxPrice))?2**50:Number(e.maxPrice)):e.maxPrice!=="∞"?(ee=1/Number(e.maxPrice),f=1/Number(e.minPrice)):(ee=1/2**50,f=2**50),console.log("0607###detail###getAprMethod###lowerUserPrice###",ee),console.log("0607###detail###getAprMethod###upperUserPrice###",f);let l=[];l=H.value&&H.value.addressHistTokens&&H.value.addressHistTokens[i.poolAddress]&&H.value.addressHistTokens[i.poolAddress].data&&H.value.addressHistTokens[i.poolAddress].data.length>0&&Object.fromEntries(H.value.addressHistTokens[i.poolAddress].data.map(g=>[g.key,g.value]));let K,r;console.log(l,"===>addressHistTokensList"),e.aprRewardsParameter==7?(K=Number(l==null?void 0:l.before_7_d_contract_price_lowest),r=Number(l==null?void 0:l.before_7_d_contract_price_highest)):e.aprRewardsParameter==24?(K=Number(l==null?void 0:l.before_24_h_contract_price_lowest),r=Number(l==null?void 0:l.before_24_h_contract_price_highest)):(K=Number(l==null?void 0:l.before_30_d_contract_price_lowest),r=Number(l==null?void 0:l.before_30_d_contract_price_highest));const b=he.value.tokensObj;console.log("getEstPositionAPRWithMulti###params###lowerUserPrice###",ee),console.log("getEstPositionAPRWithMulti###params###upperUserPrice###",f),console.log("getEstPositionAPRWithMulti###params###lowerHistPrice###",K),console.log("getEstPositionAPRWithMulti###params###upperHistPrice###",r);const u=await E.value.getEstPositionAPRWithMulti(ee,f,K,r);console.log("getEstPositionAPRWithMulti###resMulti###",u.toString());const m=H.value.newTopPoolsObj[i.poolAddress];console.log(i,"#####stats");let B;if(m){e.aprRewardsParameter==7?B=Number(m.apr_7day.replace("%","")):e.aprRewardsParameter==24?B=Number(m.apr_24h.replace("%","")):B=Number(m.apr_30day.replace("%",""));const g=Number(m.rewarder_apr[0].replace("%","")),I=Number(m.rewarder_apr[1].replace("%","")),F=Number(m.rewarder_apr[2].replace("%","")),S=new s(u.toString()).mul(B).toNumber();console.log(u.toString(),"===>resMulti.toString()");const _=new s(u.toString()).mul(g).toNumber(),W=new s(u.toString()).mul(I).toNumber(),R=new s(u.toString()).mul(F).toNumber();console.log(_,W,R,"posRewarder2_apr##");const D=S+(i.rewarder_display1?_:0)+(i.rewarder_display2?W:0)+(i.rewarder_display3?R:0);console.log(D,"###aprPercentageTotal");const q=i.rewarder_infos[0]?(Q=b[i.rewarder_infos[0].coinAddress])==null?void 0:Q.symbol:"--",qe=i.rewarder_infos[1]?(ae=b[i.rewarder_infos[1].coinAddress])==null?void 0:ae.symbol:"--",N=i.rewarder_infos[2]?(me=b[i.rewarder_infos[2].coinAddress])==null?void 0:me.symbol:"--",re={aprFee:S==1/0||isNaN(S)?0:S,rewardAprList:[{rewarder_name:q,rewarder_apr:_==1/0||isNaN(_)?0:_,styleName:"one",rewarder_display:i.rewarder_display1},{rewarder_name:qe,rewarder_apr:W==1/0||isNaN(W)?0:W,styleName:"two",rewarder_display:i.rewarder_display2},{rewarder_name:N,rewarder_apr:R==1/0||isNaN(R)?0:R,styleName:"three",rewarder_display:i.rewarder_display2}],aprPercentageTotal:D==1/0||isNaN(D)||D===0?0:D,aprPercentage:Jt(S/D,2),is_display_rewarder:i.is_display_rewarder};$.value=re,console.log($.value,"===>aprPercentageObj.value")}};Le(()=>[e.poolInfo,e.minPrice,e.maxPrice,H.value.addressHistTokens],([i,X,ee,f])=>{i&&!Ie(i)&&f&&!Ie(f)&&y(i)},{immediate:!0});const G=L(()=>lo(e.poolInfo,he,H));Le(()=>[e.aprRewardsParameter],()=>{y(e.poolInfo)});const n=L(()=>{const i=$.value;return i&&i.is_display_rewarder?(i==null?void 0:i.aprPercentageTotal)>1e4?">10000":i.aprPercentageTotal<.01&&i.aprPercentageTotal>0?"<0.01":Ue(i.aprPercentageTotal,2):i&&!i.is_display_rewarder?(i==null?void 0:i.aprFee)>1e4?">10000":i.aprFee<.01&&i.aprFee>0?"<0.01":Ue(i.aprFee,2):"--"});return{poolMoreInfo:G,timeList:c,aprPercentageObj:$,totalApr:n}}}),Po=""+globalThis.__publicAssetsURL("sui-image/farming.png");const mt=e=>(Rt("data-v-0e573555"),e=e(),Ot(),e),To={class:"est-apr"},So=mt(()=>a("div",{class:"title"},"Estimated APR",-1)),No={class:"apr-total"},Ao={class:"apr-box"},Lo={key:0,class:"apr-hover-content"},Io={class:"progress-fees progress-all"},qo=mt(()=>a("div",null,[a("div",{class:"light-hint"}),ct(" Fees ")],-1)),Mo={key:0,class:"isFarming"},$o=mt(()=>a("img",{src:Po,alt:""},null,-1)),Ro=mt(()=>a("div",{class:"hover-text"},"Farming rewards available",-1)),Oo=[$o,Ro],Bo={class:"time-list"},Fo=["onClick"];function jo(e,c,fe,H,U,he){var E,$,y,G,n,i,X,ee;return T(),j("div",To,[So,a("div",No,[a("div",Ao,[a("span",{class:Je(e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?"haveBorder":"")},ue(e.totalApr)+"%",3),e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?(T(),j("div",Lo,[a("div",Io,[qo,a("span",null,"  "+ue(Number((E=e.aprPercentageObj)==null?void 0:E.aprFee)==0?0:($=e.aprPercentageObj)!=null&&$.aprFee?((y=e.aprPercentageObj)==null?void 0:y.aprFee)>1e4?">10,000":((G=e.aprPercentageObj)==null?void 0:G.aprFee)<.01?"<0.01":("addCommom"in e?e.addCommom:Te(Ue))((n=e.aprPercentageObj)==null?void 0:n.aprFee,2):(i=e.aprPercentageObj)!=null&&i.rewardAprList?"<0.01":"--")+"%",1)]),(T(!0),j(rt,null,wt((X=e.aprPercentageObj)==null?void 0:X.rewardAprList,f=>Pt((T(),j("div",{key:f,class:"progress-rewards progress-all"},[a("div",null,[a("div",{class:Je(["light-hint",f==null?void 0:f.styleName])},null,2),ct(" "+ue(f==null?void 0:f.rewarder_name)+" Rewards ",1)]),a("span",null,"  "+ue(f!=null&&f.rewarder_apr?(f==null?void 0:f.rewarder_apr)>1e4?">10,000":(f==null?void 0:f.rewarder_apr)<.01?"<0.01":("addCommom"in e?e.addCommom:Te(Ue))(f==null?void 0:f.rewarder_apr,2):"0")+"%",1)])),[[$t,(f==null?void 0:f.rewarder_name)!="--"&&f.rewarder_display&&e.aprPercentageObj.is_display_rewarder]])),128))])):V("",!0)]),(ee=e.poolInfo)!=null&&ee.is_display_rewarder&&e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?(T(),j("div",Mo,Oo)):V("",!0)]),a("div",Bo,[(T(!0),j(rt,null,wt(e.timeList,f=>(T(),j("div",{key:f.value,class:Je(["time-item",f.value==e.aprRewardsParameter?"time-item-active":""]),onClick:l=>e.$emit("changeAprRewardsParameter",f.value)},ue(f.label),11,Fo))),128))])])}const Xt=at(Co,[["render",jo],["__scopeId","data-v-0e573555"]]),Uo=it({components:{NewLiquidityD3Chart:Dt,NewLiquidityApr:Xt,NewLiquidityPrice:jt},setup(){const{t:e,locale:c}=Bt(),fe=Z("liquidity"),H=dt(),U=L(()=>H),he=L(()=>U.value.chainName),E=Ct(),$=L(()=>E),y=L(()=>U.value.chainName?ut(U.value.chainName):{});Mt(()=>{Ye.value=!1});const G=St(),n=L(()=>{let t=null;for(let h=0;h<$.value.poolConfigList.length;h++){const O=$.value.poolConfigList[h];O.address==G.query.poolAddress&&(t=O)}return console.log(t,"===>basePoolInfo"),t}),i=L(()=>{let t=null;for(const h in $.value.poolsObj){const O=$.value.poolsObj[h];O.address==G.query.poolAddress&&(console.log(O,"p===>"),t=O)}return t}),X=Z(),ee=Z(!0),f=async(t,h)=>{if(h){ee.value=!0;const O=t.token_a.decimals,z=t.token_b.decimals;console.log(t,"pool===>1111"),st.value=Nt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,O,z).toString(),_t.value=new s(1).div(Nt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,O,z)).toString(),P.value=t.needReverse?t.token_b:t.token_a,k.value=t.needReverse?t.token_a:t.token_b,X.value=t.needReverse,t.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===k.value.address.toLowerCase()?Oe.value=!0:Oe.value=!1,console.log(t,"187===>"),console.log(t,"###pool===>");let ne={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const ge=await y.value.getTicks(ne);ot.value=ge?y.value.getTickDataFromUrlData(ge):[],console.log(ot.value,"===>chartLoadingtickList.value"),r(t)}ee.value=!1,console.log(ee.value,"==>chartLoading.value")},l=Z([]),K=Z(),r=t=>{const h=t.token_a.decimals,O=t.token_b.decimals;let z=$.value.poolPriceConfigObj&&$.value.poolPriceConfigObj[t.address]&&$.value.poolPriceConfigObj[t.address].recommend_ranges||{};const ne=$.value.poolPriceConfigObj&&$.value.poolPriceConfigObj[t.address]&&$.value.poolPriceConfigObj[t.address].type||"";console.log(z,"===>priceConfigList");let ge,le;const Be=t.current_tick_index;K.value=t.current_tick_index,console.log(Be,t.tickSpacing,"==>pool.tickSpacing"),ge=Be-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),le=Be+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const xe=y.value.TickMath.tickIndexToPrice(ge,h,O).toString(),Ee=y.value.TickMath.tickIndexToPrice(le,h,O).toString();z["full range"]={lower:y.value.TickUtil.getMinIndex(Number(i.value.tickSpacing)),upper:y.value.TickUtil.getMaxIndex(Number(i.value.tickSpacing))},z.custom={lower:ge,upper:le,minPrice:xe,maxPrice:Ee};const Ce=[];for(let we in z)z[we]&&(console.log(we,"j==>"),Ce.push({...z[we],key:we}));console.log(Ce,"priceList"),console.log(t,"###pool.type 504"),ne?t.isSelfBuilt?te.value="custom":ne=="stable"?te.value="suggested":te.value="passive":te.value="custom",l.value=Ce,Ke.value=z,m({key:te.value,...z[te.value]})},b=Z(""),u=Z(""),m=t=>{console.log("priceTab====>",t),console.log("priceTab###poolInfo###",i.value),te.value=t.key.toLowerCase();const h=i.value.token_a.decimals,O=i.value.token_b.decimals,{lower:z,upper:ne}=t;Xe.value=!1;const ge=y.value.TickMath.tickIndexToPrice(z,h,O).toString(),le=y.value.TickMath.tickIndexToPrice(ne,h,O).toString();if(t.key=="full range"){b.value=z,u.value=ne,B();return}console.log(Oe.value,"===>direct.value"),Oe.value?(ft.value=String(ge),x.value=String(ge),gt.value=String(le),M.value=String(le),b.value=z,u.value=ne):(ft.value=String(1/Number(le)),x.value=String(1/Number(le)),gt.value=String(1/Number(ge)),M.value=String(1/Number(ge)),b.value=y.value.TickMath.priceToTickIndex(new s(1/Number(le)),h,O),u.value=y.value.TickMath.priceToTickIndex(new s(1/Number(ge)),h,O)),console.log(x.value,M.value,"===>111")},B=t=>{x.value="0",M.value="∞"};Le(()=>i.value,(t,h)=>{console.log(h,"===>oldVal"),console.log(t,"===>newVal"),(!h&&t&&!Ie(t)||h&&t&&h.address!==t.address)&&(console.log("池子信息"),f(t,!h||t.address!==h.address))},{immediate:!0}),Ft(()=>{ot.value=[]}),Le(()=>[n.value,i.value,$.value.recommendRangesObj],(t,h)=>{var O,z;console.log(t,"===>newValue369"),console.log(h,"===>oldValue369"),(!h||t[0]&&t[1]&&t[2]&&!Ie(t[0])&&!Ie(t[1]&&!Ie(t[2]))||((O=t[0])==null?void 0:O.address)!==((z=h[0])==null?void 0:z.address))&&t[0]&&t[2]&&!Ie(t[0])&&!Ie(t[2])&&(console.log(t[0],t[2],"======>374"),E.setSinglePool(t[0],t[2],he.value))},{immediate:!0,deep:!0});const Q=t=>{if(he.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},ae=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},me=t=>{var O,z;const h=$.value.poolPriceConfigObj&&$.value.poolPriceConfigObj[(O=i.value)==null?void 0:O.address]&&$.value.poolPriceConfigObj[(z=i.value)==null?void 0:z.address].type||"";if(console.log(h,t,"==>poolType"),h=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}},g=Z(1),I=()=>{const t=g.value/2;g.value=t},F=()=>{const t=g.value*2;g.value=t};console.log(l.value,"==>priceTablList");const S=L(()=>{var t,h,O;return!i.value||Ie(U.value.addressHistTokens)||!U.value.addressHistTokens[(t=i.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((O=U.value.addressHistTokens[(h=i.value)==null?void 0:h.poolAddress])==null?void 0:O.data.map(z=>[z.key,z.value]))}),_=Z(30),W=Z("30D"),R=L(()=>Oe.value?S.value&&Se(_.value==7?S.value.before_7_d_contract_price_lowest:_.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest,6)||0:S.value&&Se(new s(1).div(_.value==7?S.value.before_7_d_contract_price_highest:_.value==24?S.value.before_24_h_contract_price_highest:S.value.before_30_d_contract_price_highest).toString(),6)||0),D=L(()=>Oe.value?S.value&&Se(_.value==7?S.value.before_7_d_contract_price_highest:_.value==24?S.value.before_24_h_contract_price_highest:S.value.before_30_d_contract_price_highest,6)||0:(S.value&&Se(1/Number(_.value==7?S.value.before_7_d_contract_price_lowest:_.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest),6))==1/0?0:S.value&&Se(1/Number(_.value==7?S.value.before_7_d_contract_price_lowest:_.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest),6)||0),q=L(()=>{const t=Number(x.value),h=Number(M.value);return x.value&&M.value&&x.value!=="0"&&M.value!=="∞"?bt(1/(1-Number((t/h)**.25)),2)+"x":1}),qe=L(()=>{var t,h,O,z,ne,ge;return((t=P.value)==null?void 0:t.isSelfBuilt)||((h=k.value)==null?void 0:h.isSelfBuilt)||((z=$.value.tokensObj[(O=P.value)==null?void 0:O.address])==null?void 0:z.isSelfBuilt)||((ge=$.value.tokensObj[(ne=k.value)==null?void 0:ne.address])==null?void 0:ge.isSelfBuilt)}),N=t=>{console.log(t,"####0731 priceRangeChangeMin"),t!==x.value&&te.value=="full range"?(console.log(l.value,"===>priceTablList"),m({key:"custom",...l.value.custom})):te.value!=="full range"&&te.value!=="custom"?(te.value="custom",x.value=t):x.value=t},re=t=>{console.log(t,"###priceRangeChangeMax maxPirce"),t!==M.value&&te.value=="full range"?m({key:"custom",...l.value.custom}):te.value!=="full range"&&te.value!=="custom"?(te.value="custom",t=="0"?M.value="∞":M.value=t):t=="0"?M.value="∞":M.value=t};return console.log(x.value,M.value,"683==>"),Le(()=>[x.value,M.value],([t,h])=>{console.log(t,h,"minmax new-liquidity-left")},{deep:!0,immediate:!0}),{positionError:Ye,getCoinIcon:t=>{var h;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((h=$.value.tokensObj[t==null?void 0:t.address])==null?void 0:h.logo_url)||(U.value.theme==="default"?yt("/image/coins/unknown.png"):yt("/image/coins/sui-unknown.png"))},chainName:he,store:U,currentTab:fe,currentPrice:st,currentPriceReverse:_t,fromCoin:P,toCoin:k,direction:Oe,needReverse:X,addCommom:Ue,decimalUi:Se,priceTablList:l,currentPriceTab:te,sliderStyle:me,poolInfo:i,tickList:ot,getPriceTabImage:Q,getPriceTabText:ae,defaultMinPrice:ft,defaultMaxPrice:gt,minPrice:x,maxPrice:M,currentTick:K,chartLoading:ee,zoomOut:I,zoomIn:F,zoom:g,priceTab:m,before7dContractPriceLowest:R,before7dContractPriceHighest:D,aprRewardsTime:W,lever:q,aprRewardsParameter:_,isSelfBuilt:qe,priceRangeChangeMin:N,priceRangeChangeMax:re,toggle:Et,getPirceTabTips:t=>{switch(t){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}}}}});const zo={class:"new-liquidity-left"},Ho={class:"price-info"},Eo={class:"left"},Do={class:"base-coin"},Xo={class:"base-coin-title"},Wo=a("span",null,"Base coin",-1),xo=a("svg",{class:"icon icon-up","aria-hidden":"true"},[a("use",{"xlink:href":"#icon-exchange_up1"})],-1),Zo=a("svg",{class:"icon icon-down","aria-hidden":"true"},[a("use",{"xlink:href":"#icon-exchange_down1"})],-1),Go=[xo,Zo],Ko={class:"base-coin-bottom"},Jo={alt:""},Qo={class:"current-price"},Yo=a("div",{class:"current-price-title"},"Current Price",-1),Vo={key:0,class:"from-pre-to"},er={class:"right"},tr={class:"price-range"},or={class:"left"},rr={class:"price-slider"},ir={class:"slider"},ar=a("div",{class:"slider-ratio-content"},null,-1),nr=[ar],lr={class:"price-tab-list"},sr=["onClick"],ur=["src"],cr={class:"right"},dr={class:"range-tab"},mr=["src"],vr=["src"],fr=a("span",null,"Liquidity",-1),gr=["src"],pr=["src"],br=a("span",null,"Price",-1),hr={class:"price-zoom"},wr={class:"current-price"},kr=a("div",{class:"current-price-title"},"Current Price",-1),yr={key:0,class:"from-pre-to"},_r={class:"price-zoom-right"},Cr={class:"leverage"},Pr={class:"left"},Tr={key:0,class:"leverage-title"},Sr={key:1,class:"laverage-value"},Nr={class:"right"},Ar={key:0,class:"day-7-price-range"},Lr=a("i",null,null,-1),Ir={class:"gray"},qr={class:"apr-leverage"},Mr={class:"leverage"},$r=a("div",{class:"leverage-title"},"Leverage",-1),Rr={class:"laverage-value"},Or={key:0,class:"position-tips"},Br=["src"],Fr={class:"error"};function jr(e,c,fe,H,U,he){var X,ee,f,l,K,r,b,u;const E=Yt,$=Dt,y=Tt,G=Xt,n=jt,i=Qt("image");return T(),j("div",zo,[a("div",Ho,[a("div",Eo,[a("div",Do,[a("div",Xo,[Wo,a("div",{class:"change-price",onClick:c[0]||(c[0]=(...m)=>e.toggle&&e.toggle(...m))},Go)]),a("div",Ko,[Pt(a("img",Jo,null,512),[[i,e.getCoinIcon(e.fromCoin)]]),a("span",null,ue((X=e.fromCoin)==null?void 0:X.symbol),1)])]),a("div",Qo,[Yo,a("div",null,[a("span",null,ue(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(T(),j("span",Vo,ue((ee=e.toCoin)==null?void 0:ee.symbol)+" per "+ue((f=e.fromCoin)==null?void 0:f.symbol),1)):V("",!0)])])]),a("div",er,[e.currentTab=="liquidity"?(T(),j("div",{key:0,class:"zoom-out",onClick:c[1]||(c[1]=(...m)=>e.zoomOut&&e.zoomOut(...m))}," + ")):V("",!0),e.currentTab=="liquidity"?(T(),j("div",{key:1,class:"zoom-in",onClick:c[2]||(c[2]=(...m)=>e.zoomIn&&e.zoomIn(...m))}," - ")):V("",!0)])]),a("div",tr,[a("div",or,[a("div",rr,[a("div",ir,[a("div",{class:"slider-ratio",style:ht(e.sliderStyle(e.currentPriceTab))},nr,4)])]),a("div",lr,[(T(!0),j(rt,null,wt(e.priceTablList,m=>(T(),j("div",{key:m.key,class:Je(["price-tab-item",e.currentPriceTab==m.key?"price-tab-item-active":""]),onClick:B=>e.priceTab(m)},[He(E,{placement:"bottom","arrow-point-at-center":""},{title:kt(()=>[ct(ue(e.getPirceTabTips(m.key)),1)]),default:kt(()=>[a("img",{src:e.getPriceTabImage(m.key),alt:""},null,8,ur),a("span",null,ue(e.getPriceTabText(m.key)),1)]),_:2},1024)],10,sr))),128))])]),a("div",cr,[a("div",dr,[a("div",{class:Je(["liquidity",e.currentTab=="liquidity"?"liquidity-tab-active":""]),onClick:c[3]||(c[3]=m=>e.currentTab="liquidity")},[e.chainName=="Sui"?(T(),j("img",{key:0,src:e.currentTab=="liquidity"?"/sui-image/Liquidity-Sel.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,mr)):(T(),j("img",{key:1,src:e.currentTab=="liquidity"?"/image/green_chart.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,vr)),fr],2),a("div",{class:Je(["price",e.currentTab=="price"?"price-tab-active":""]),onClick:c[4]||(c[4]=m=>e.currentTab="price")},[e.chainName=="Sui"?(T(),j("img",{key:0,src:e.currentTab=="price"?"/sui-image/Price-Sel.png":"/sui-image/Price-Def.png",alt:""},null,8,gr)):(T(),j("img",{key:1,src:e.currentTab=="price"?"/image/price-chart.png":"/sui-image/Price-Def.png",alt:""},null,8,pr)),br],2)]),a("div",hr,[a("div",wr,[kr,a("div",null,[a("span",null,ue(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(T(),j("span",yr,ue(e.direction&&!e.needReverse?`${(l=e.fromCoin)==null?void 0:l.symbol} per ${(K=e.toCoin)==null?void 0:K.symbol}`:`${(r=e.toCoin)==null?void 0:r.symbol} per ${(b=e.fromCoin)==null?void 0:b.symbol}`),1)):V("",!0)])]),a("div",_r,[e.currentTab=="liquidity"?(T(),j("div",{key:0,class:"zoom-out",onClick:c[5]||(c[5]=(...m)=>e.zoomOut&&e.zoomOut(...m))}," + ")):V("",!0),e.currentTab=="liquidity"?(T(),j("div",{key:1,class:"zoom-in",onClick:c[6]||(c[6]=(...m)=>e.zoomIn&&e.zoomIn(...m))}," - ")):V("",!0)])]),e.fromCoin&&e.toCoin&&e.poolInfo&&e.currentTab=="liquidity"?(T(),Ge($,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):V("",!0),((u=e.tickList)==null?void 0:u.length)<=0&&e.chartLoading?(T(),Ge(y,{key:1})):V("",!0)])]),a("div",Cr,[a("div",Pr,[e.currentPriceTab!=="full range"?(T(),j("div",Tr,"Leverage")):V("",!0),e.currentPriceTab!=="full range"?(T(),j("div",Sr,ue(e.lever),1)):V("",!0)]),a("div",Nr,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(T(),j("div",Ar,[Lr,a("span",Ir,ue(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),a("span",null,ue(("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.before7dContractPriceLowest,6)))+" - "+ue(("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.before7dContractPriceHighest,6))),1)])):V("",!0)])]),a("div",{class:Je(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[a("div",qr,[a("div",Mr,[$r,a("div",Rr,ue(e.lever),1)]),He(G,{"apr-rewards-parameter":e.aprRewardsParameter,"name-tab":"deposit","from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,onChangeAprRewardsParameter:c[7]||(c[7]=m=>{e.aprRewardsParameter=m})},null,8,["apr-rewards-parameter","from-coin","to-coin","pool-info","min-price","max-price"])]),He(n,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(T(),j("div",Or,[a("img",{src:("importIcon"in e?e.importIcon:Te(yt))("/image/icon-tips-error@2x.png"),alt:""},null,8,Br),a("p",Fr,ue(e.$t("tips.positionError")),1)])):V("",!0)],2)])}const Wt=at(Uo,[["render",jr]]),Ur=it({components:{NewLiquidityTitle:Ut,NewLiquidityAssetsCard:zt,NewLiquidityDepositRatio:Ht},setup(){const{t:e,locale:c}=Bt(),fe=dt(),H=L(()=>fe),U=L(()=>H.value.chainName),he=Ct(),E=L(()=>he),$=no(),y=L(()=>$),G=St(),n=L(()=>{let o=null;for(const p in E.value.poolsObj){const w=E.value.poolsObj[p];w.address==G.query.poolAddress&&(console.log(w,"p===>"),o=w)}return o}),i=Z(!1),X=Z(!1),ee=L(()=>H.value.theme),f=async(o,p)=>{P.value=o.needReverse?o.token_b:o.token_a,k.value=o.needReverse?o.token_a:o.token_b,C.value="",A.value=""};Le(()=>n.value,(o,p)=>{console.log(p,"===>oldVal"),console.log(o,"===>newVal"),(!p&&o&&!Ie(o)||p&&o&&p.address!==o.address)&&(console.log("池子信息"),f(o,!p||o.address!==p.address))},{immediate:!0});const l=L(()=>y.value.assets&&P.value&&y.value.assets[P.value.address]?At(y.value.assets[P.value.address].balance,P.value.decimals):"0"),K=L(()=>y.value.assets&&k.value&&y.value.assets[k.value.address]?At(y.value.assets[k.value.address].balance,k.value.decimals):"0"),r=o=>{o==="fromCoin"?(Pe.value=!0,U.value==="Aptos"?C.value=Number(l.value)>0?P.value.symbol=="APT"?new s(Number(l.value)).sub(new s(.1)).lt(new s(0))?"0":new s(Number(l.value)).sub(new s(.1)).toString():String(l.value):"":C.value=Number(l.value)>0?P.value.symbol=="SUI"?new s(Number(l.value)).sub(new s(.05)).lt(new s(0))?"0":new s(Number(l.value)).sub(new s(.05)).toString():String(l.value):""):(Pe.value=!1,U.value==="Aptos"?A.value=Number(K.value)>0?k.value.symbol=="APT"?new s(Number(K.value)).sub(new s(.1)).lt(new s(0))?"0":new s(Number(K.value)).sub(new s(.1)).toString():String(K.value):"":A.value=Number(K.value)>0?k.value.symbol=="SUI"?new s(Number(K.value)).sub(new s(.05)).lt(new s(0))?"0":new s(Number(K.value)).sub(new s(.05)).toString():String(K.value):"")},b=o=>{o==="fromCoin"?(Pe.value=!0,C.value=Number(l.value)>0?bt(new s(Number(l.value)).div(2).toString(),P.value.decimals).toString():""):(Pe.value=!1,A.value=Number(K.value)>0?bt(new s(Number(K.value)).div(2).toString(),k.value.decimals).toString():"")},u=Z(),m=Z(),B=Z(),Q=Z(!1),ae=o=>{var p,w,ce,J;u.value=o,o==="fromCoin"?(m.value=((p=k.value)==null?void 0:p.address)||"",B.value=G.query.actions=="new-position"?(w=P.value)==null?void 0:w.address:n.value.needReverse?n.value.token_b.address:n.value.token_a.address):(m.value=((ce=P.value)==null?void 0:ce.address)||"",B.value=G.query.actions=="new-position"?(J=k.value)==null?void 0:J.address:n.value.needReverse?n.value.token_a.address:n.value.token_b.address),Q.value=!0,console.log(Q.value,"==>showCoinSelect.value ")},me=o=>{var ce,J,de,ve,se,ie,oe,ke;const p=n.value.needReverse?n.value.token_b:n.value.token_a,w=n.value.needReverse?n.value.token_a:n.value.token_b;u.value==="fromCoin"?(((ce=P.value)==null?void 0:ce.address)===(p==null?void 0:p.address)||!((J=P.value)!=null&&J.address)?(k.value&&o.address.toLowerCase()===((de=k)==null?void 0:de.value.address.toLowerCase())&&(k.value=null),P.value=o):(P.value&&o.address.toLowerCase()===((ve=P)==null?void 0:ve.value.address.toLowerCase())&&(P.value=null),k.value=o),G.query.action||(G.query.fee="")):((se=k.value)==null?void 0:se.address)===(w==null?void 0:w.address)||!((ie=k.value)!=null&&ie.address)?(P.value&&o.address.toLowerCase()===((oe=P)==null?void 0:oe.value.address.toLowerCase())&&(P.value=null),k.value=o):(k.value&&o.address.toLowerCase()===((ke=k)==null?void 0:ke.value.address.toLowerCase())&&(k.value=null),P.value=o),Q.value=!1},g=L(()=>H.value.chainName?ut(H.value.chainName):{}),I=L(()=>H.value.slippage),F=Z(),S=async()=>{var je,Ae,$e,Re;if(Xe.value)return console.log("跳出"),!1;if(!x.value&&!M.value)return!1;if(!C.value&&!A.value&&!x.value&&!M.value)return;const o=n.value||{};if(Ie(o))return;const{TickUtil:p,TickMath:w,getNearestTickByTick:ce}=g.value,J=o==null?void 0:o.token_a.decimals,de=o==null?void 0:o.token_b.decimals;let ve,se,ie,oe,ke,Ne,We,Ze,ye=o==null?void 0:o.current_tick_index,Y;if(o.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===k.value.address.toLowerCase()?Y=!0:Y=!1,x.value==="0"&&M.value==="∞")ie=p.getMinIndex(Number(o.tickSpacing)),oe=p.getMaxIndex(Number(o.tickSpacing)),ke=w.tickIndexToSqrtPriceX64(ie),Ne=w.tickIndexToSqrtPriceX64(oe),console.log(ie,oe,"#######updateAmounts 513");else if(te.value=="custom"){console.log(Y,"===>directs1866"),Y?(ve=Number(x.value),se=Number(M.value)):(ve=M.value!=="∞"?new s(1).div(M.value).toString():1/0,se=new s(1).div(x.value).toString());try{We=ve==0?-443636:w.priceToTickIndex(new s(ve),J,de)}catch{We=-443636}try{Ze=w.priceToTickIndex(new s(se),J,de)}catch{Ze=443636}ie=ce(We,Number(o.tickSpacing)),oe=ce(Ze,Number(o.tickSpacing));try{ke=w.priceToSqrtPriceX64(new s(ve),J,de)}catch{(se===1/0||se==="∞")&&(ke=w.tickIndexToSqrtPriceX64(p.getMinIndex(Number(o.tickSpacing))))}try{Ne=w.priceToSqrtPriceX64(new s(se),J,de)}catch{console.log("0523###test###max###",se),(se===1/0||se==="∞")&&(console.log("0523###test###max###11111"),Ne=w.tickIndexToSqrtPriceX64(p.getMaxIndex(Number(o.tickSpacing))))}console.log("0518###pre###tick_lower###",ie,oe,ye),console.log("0518###pre###tick_upper###",oe)}else ie=(je=Ke.value[te.value])==null?void 0:je.lower,oe=(Ae=Ke.value[te.value])==null?void 0:Ae.upper,ke=w.tickIndexToSqrtPriceX64(ie),Ne=w.tickIndexToSqrtPriceX64(oe);if(M.value!=="∞"&&ie>=oe){i.value=!0,C.value="",X.value=!0,A.value="";return}if(console.log(oe,ye,ie,"1922"),M.value==="∞"||ye>=ie&&ye<=oe){i.value=!1,X.value=!1;let _e;if(C.value||A.value){if(Pe.value){const vt=new s(C.value).mul(Math.pow(10,P.value.decimals)).toString();_e=new ze(vt)}else{const vt=new s(A.value).mul(Math.pow(10,k.value.decimals)).toString();_e=new ze(vt)}console.log(Y,"======>directs");const{liquidityAmount:De,tokenMaxA:et,tokenMaxB:tt,tokenMaxAOrigin:Zt,tokenMaxBOrigin:Gt}=g.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:ie,upperTick:oe,coinAmount:_e,iscoinA:Y?Pe.value:!Pe.value,roundUp:!0,slippage:Number(I.value)/100,curSqrtPrice:new ze(o.current_sqrt_price)});F.value={liquidityAmount:De,tokenMaxA:et,tokenMaxB:tt,tokenMaxAOrigin:Zt,tokenMaxBOrigin:Gt},console.log(et,tt,"preAdd"),Y?Pe.value?A.value=Number(tt)>0?tt:"":C.value=Number(et)>0?et:"":Pe.value?A.value=et:C.value=tt}}else if(ye>oe){if(Y?C.value="":A.value="",i.value=Y,X.value=!Y,C.value||A.value){let _e;if(Y){const De=new s(A.value).mul(Math.pow(10,($e=k.value)==null?void 0:$e.decimals)).toString();_e=new ze(De),F.value={liquidityAmount:g.value.estimateLiquidityForCoinB(ke,Ne,_e),tokenMaxA:0,tokenMaxB:A.value}}else{const De=new s(C.value).mul(Math.pow(10,(Re=P.value)==null?void 0:Re.decimals)).toString();_e=new ze(De),F.value={liquidityAmount:g.value.estimateLiquidityForCoinB(ke,Ne,_e),tokenMaxA:0,tokenMaxB:C.value}}}}else if(ye<ie){if(i.value=!Y,X.value=Y,Y?A.value="":C.value="",C.value||A.value){let _e;if(Y){const De=new s(C.value).mul(Math.pow(10,P.value.decimals)).toString();_e=new ze(De),F.value={liquidityAmount:g.value.estimateLiquidityForCoinA(ke,Ne,_e),tokenMaxA:C.value,tokenMaxB:0}}else{const De=new s(A.value).mul(Math.pow(10,k.value.decimals)).toString();_e=new ze(De),F.value={liquidityAmount:g.value.estimateLiquidityForCoinA(ke,Ne,_e),tokenMaxA:A.value,tokenMaxB:0}}}}else i.value=!0,C.value="",X.value=!0,A.value=""};Le(C,(o,p)=>{console.log(C,"===>fromCoinAmount"),o==""&&Pe.value&&(A.value=""),o&&Pe.value&&!Xe.value&&S()}),Le(A,(o,p)=>{console.log(o,"===>>>>newValsda"),o==""&&!Pe.value&&(C.value=""),o&&!Pe.value&&!Xe.value&&S()});const _=Z("--"),W=L(()=>E.value.RATES),R=()=>{const o=W.value&&W.value[P.value.address]&&W.value[P.value.address].price,p=W.value&&W.value[k.value.address]&&W.value[k.value.address].price;if(o&&p){const w=new s(C.value>0?C.value:0).mul(o),ce=new s(A.value>0?A.value:0).mul(p),J=w.add(ce).toNumber();_.value=J>0&&J<.01?"$<0.01":"$"+Ue(J,2)}else _.value="--"};Le(()=>[C.value,A.value,Xe.value],([o,p,w])=>{(o||p)&&!w?R():(!o||!p)&&!w&&(_.value="--")},{immediate:!0}),Le(()=>_,o=>{console.log(o,"71911111")},{immediate:!0});const D=Z(),q=async()=>{var Y,je;if(!x.value&&!M.value)return!1;if(!C.value&&!A.value&&!x.value&&!M.value)return;const o=n.value;if(Ie(o))return;const{TickUtil:p,TickMath:w,getNearestTickByTick:ce}=g.value,J=o==null?void 0:o.token_a.decimals,de=o==null?void 0:o.token_b.decimals;let ve,se,ie,oe,ke,Ne,We;if(o.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===k.value.address.toLowerCase()?We=!0:We=!1,x.value==="0"&&M.value==="∞")ie=p.getMinIndex(Number(o.tickSpacing)),oe=p.getMaxIndex(Number(o.tickSpacing));else if(te.value=="custom"){We?(ve=Number(x.value),se=Number(M.value)):(ve=new s(1).div(M.value).toString(),se=new s(1).div(x.value).toString());try{ke=ve==0?-443636:w.priceToTickIndex(new s(ve),J,de)}catch{ke=-443636}try{Ne=w.priceToTickIndex(new s(se),J,de)}catch{Ne=443636}ie=ce(ke,Number(o.tickSpacing)),oe=ce(Ne,Number(o.tickSpacing))}else ie=(Y=Ke.value[te.value])==null?void 0:Y.lower,oe=(je=Ke.value[te.value])==null?void 0:je.upper;const Ze=W.value[o==null?void 0:o.token_a.address].price,ye=W.value[o==null?void 0:o.token_b.address].price;Oe.value?new ze(o.current_sqrt_price):new ze(1/o.current_sqrt_price),console.log(Oe.value,"===>direction.value"),console.log(o,"poolInfos===>"),console.log(ie,oe,"####tick_lower tick_upper 889"),console.log(_.value,"liquidityTotalAmount.value");try{const{amountA:Ae,amountB:$e,tokenAmountsInfo:Re}=await g.value.estCoinAmountsFromTotalAmount({lowerTick:ie,upperTick:oe,decimalsA:J,decimalsB:de,curSqrtPrice:new ze(o.current_sqrt_price),totalAmount:_.value.replace(/[^\d.]/g,""),tokenPriceA:Ze,tokenPriceB:ye});console.log(Ae,$e,"###estCoinAmountsFromTotalAmount 844"),console.log(o.needReverse,Oe.value,"===>849"),D.value=Re,o.needReverse?Oe.value?(C.value=Ae,A.value=$e):(C.value=$e,A.value=Ae):(C.value=Ae,A.value=$e)}catch(Ae){console.log(Ae,"e===>")}};Le([x,M],([o,p])=>{console.log(o,p,"==>minPrice,maxPrice"),Xe.value?Xe.value&&q():S(),p!=="∞"&&Number(o)!==0&&Number(p)!==0&&Number(o)>=Number(p)?Ye.value=!0:Ye.value=!1,Number(o)==0&&Number(p)==0&&st.value&&(Ye.value=!0,console.log("价格区间错误"))},{deep:!0,immediate:!0});const qe=o=>{console.log(o,"e");const p=o.replace(/[^\d.]/g,""),w="$"+Ue(p);Xe.value=!0,_.value=w,p>0?q():(C.value="",A.value="")},N=Z(!1),{setTransactionTxid:re,setTransactionDesc:Qe,setIsShowWaiting:Me,setIsShowSuccess:t,setPositiomNum:h,setIsShowRejected:O}=fe,z=fo(),ne=L(()=>E.value.currentPositionInfo),ge=Z(!1),le=async o=>{var ke,Ne,We,Ze;console.log(n.value,"===> poolInfo.value"),N.value=!1,E.value.currentPositionInfo={},re(""),Qe(e("tips.increaseLiquiditySuccess",{from:i.value?"":`${C.value} ${(ke=P.value)==null?void 0:ke.symbol}`,and:!i.value&&!X.value?"and":"",to:X.value?"":`${A.value} ${(Ne=k.value)==null?void 0:Ne.symbol}`})),Me(!0);const p=Oe.value?Pe.value:!Pe.value;let w,ce,J,de,ve,se;const ie=n.value.token_a.decimals,oe=n.value.token_b.decimals;if(x.value==="0"&&M.value==="∞")J=g.value.TickUtil.getMinIndex(Number(n.value.tickSpacing)),de=g.value.TickUtil.getMaxIndex(Number(n.value.tickSpacing));else if(te.value=="custom"){Oe.value?(w=Number(x.value),ce=Number(M.value)):(w=new s(1).div(M.value).toString(),ce=new s(1).div(x.value).toString()),console.log("0519###toAdd###min###",w),console.log("0519###toAdd###max###",ce),console.log("0519###toAdd###minPrice.value###",x.value),console.log("0519###toAdd###maxPrice.value###",M.value);try{ve=w==0?g.value.TickUtil.getMinIndex(Number(n.value.tickSpacing)):g.value.TickMath.priceToTickIndex(new s(w),ie,oe)}catch{ve=g.value.TickUtil.getMinIndex(Number(n.value.tickSpacing))}try{se=g.value.TickMath.priceToTickIndex(new s(ce),ie,oe)}catch{se=g.value.TickUtil.getMaxIndex(Number(n.value.tickSpacing))}J=g.value.getNearestTickByTick(ve,Number(n.value.tickSpacing)),de=g.value.getNearestTickByTick(se,Number(n.value.tickSpacing))}else J=Ke.value[te.value].lower,de=Ke.value[te.value].upper;console.log(J,de,"####tick_lower tick_upper 889"),console.log(n.value,"==>poolInfo.value.curSqrtPrice");try{let ye;Xe.value?ye=await g.value.getCreateAddLiquidityPayload({pool:n.value,curSqrtPrice:new ze(n.value.current_sqrt_price),tickLower:J,tickUpper:de,slippage:Number(I.value)/100,tokenAmounts:D.value}):ye=await g.value.getAddLiquidityTransactionPayload({pool:{poolAddress:n.value.poolAddress,token_a:n.value.token_a,token_b:n.value.token_b},amount:Pe.value?C.value:A.value,fix_amount_a:p,tick_lower:J,tick_upper:de,index:0,slippage:Number(I.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new ze(n.value.current_sqrt_price)}),console.log(ye,"payload===?");let Y;if(U.value==="Aptos")Y=await y.value.currentWallet.signAndSubmitTransaction(ye);else{const je=await y.value.currentWallet.signAndExecuteTransactionBlock(ye);Y=g.value.handleTx(je)}if(console.log("0410###tx###",Y),Y&&Y.hash){re(Y.hash),Me(!1),t(!0);let je;n.value.needReverse?n.value.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&n.value.token_b.address.toLowerCase()===k.value.address.toLowerCase()?je=!1:je=!0:n.value.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&n.value.token_b.address.toLowerCase()===k.value.address.toLowerCase()?je=!0:je=!1,console.log(je,"===>directs");const Ae={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:i.value?"":`${C.value} ${(We=P.value)==null?void 0:We.symbol}`,and:!i.value&&!X.value?"and":"",to:X.value?"":`${A.value} ${(Ze=k.value)==null?void 0:Ze.symbol}`}),hash:Y.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};U.value!=="Aptos"&&(Ae.res=Y.res),g.value.showTransitionPending(Ae);const $e=await g.value.watchTransaction(Ae,!0);if($e.status){if(t(!1),E.value.setCurrentPositionLoading(!0),ge.value=!0,console.log($e.nftInfo,"===> watchInfo.nftInfo"),U.value==="Aptos"){if(await E.value.setCurrentPositionInfo($e.nftInfo[0].data.id.creator,$e.nftInfo[0].data.id.collection,$e.nftInfo[0].data.name,U.value),o)try{await z.subscribePosition({pool_address:ne.value.poolAddress,position_index:ne.value.index},ne.value.nftHash)}catch(Re){console.log(Re,"e")}}else{const Re=$e.nftInfo,_e=await Lt(2e3);if(await E.value.setCurrentPositionInfo(Re==null?void 0:Re.pool,"","",U.value,Re==null?void 0:Re.position),await Lt(1e3),console.log("0529###nftInfo###",Re),console.log("0529###currentPositionInfo.value.index###",ne.value.index),o)try{await z.subscribePosition({pool_address:ne.value.poolAddress,position_index:ne.value.index},ne.value.nftHash)}catch(De){console.log(De)}}setTimeout(()=>{he.updateCurrentPools(n.value.poolAddress,U.value),g.value.getAccount(y.value.address)},3e3),setTimeout(async()=>{It(g,n)},3e3)}h()}else Me(!1),O(!0);C.value="",A.value=""}catch(ye){C.value="",A.value="",console.log("0330###Add liquidity Error###",ye),Me(!1),O(!0)}},Be=L(()=>!C.value&&!A.value?(console.log("addLiquidityBtnDisabled11111"),!0):Number(C.value)>Number(l.value)||Number(A.value)>Number(K.value)?(console.log("addLiquidityBtnDisabled22222"),!0):Ee.value!==e("button.addLiquidity")&&Ee.value!==e("newAdd.preview")?(console.log("addLiquidityBtnDisabled33333###",Ee.value),!0):n.value&&n.value&&n.value.is_pause?(console.log("addLiquidityBtnDisabled44444"),!0):Number(C.value)<=0&&Number(A.value)<=0||!i.value&&Number(C.value)==0||!X.value&&Number(A.value)==0),xe=L(()=>!P.value||!k.value),Ee=L(()=>n.value&&n.value.is_pause?"Pool Closed":!P.value||!k.value||xe.value?e("modal.selectTokenModalTitle"):Number(C.value)>Number(l.value)?e("button.insufficientBalance",{name:P.value.symbol}):Number(A.value)>Number(K.value)?e("button.insufficientBalance",{name:k.value.symbol}):!Number(C.value)&&!Number(A.value)?e("button.enterAmount"):M.value!=="∞"&&Number(x.value)>=Number(M.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),Ce=Z({}),we=Z({}),Ve=Z(!1),nt=(o,p)=>{console.log(u.value,"===>currentCoinKey.value"),console.log(o);const w=localStorage.getItem(o.address);console.log(E.value.tokensObj,"===>pools.value.tokensObj"),console.log(w,"===>coinLocak"),E.value.tokensObj&&E.value.tokensObj[o.address]&&E.value.tokensObj[o.address].isSelfBuilt&&!w&&(p=="fromCoin"&&(Ce.value=o),p=="toCoin"&&(we.value=o),Ve.value=!0)};Le(()=>[P.value,k.value],([o,p])=>{o&&!Ie(o)&&nt(o,"fromCoin"),p&&!Ie(p)&&nt(p,"toCoin")},{immediate:!0});const d=Vt(),v=()=>{U.value!=="Aptos"?d.push("/pool/list"):d.push("/pools")},Fe=o=>{Xe.value,le(o)},pe=()=>{G.query.action!=="create-pool"&&G.query.actions!=="new-position"&&(It(g,n),S(),he.updateCurrentPools(n.value.poolAddress,U.value)),he.setPoolConfigList(U.value,H.value.filterCoinsObj)},be=L(()=>{var w,ce,J,de,ve,se;const o=(J=W.value[(ce=(w=P)==null?void 0:w.value)==null?void 0:ce.address])==null?void 0:J.price,p=(se=W.value[(ve=(de=k)==null?void 0:de.value)==null?void 0:ve.address])==null?void 0:se.price;return!!(o&&p)});return Le(()=>[G,E.value.tokensObj],([o,p])=>{var w;p&&!Ie(p)&&(k.value||(k.value=E.value.tokensObj[(w=o==null?void 0:o.query)==null?void 0:w.toCoin]))},{immediate:!0,deep:!0}),{positionError:Ye,decimalUi:Se,poolInfo:n,fromCoinAmount:C,toCoinAmount:A,fromCoin:P,toCoin:k,theme:ee,showFromCoinLock:i,showToCoinLock:X,fromCoinBlance:l,toCoinBlance:K,maxBtnSelect:r,halfBtnSelect:b,fixedFromCoin:Pe,openCoinSelect:ae,currentCoinKey:u,existingCoins:m,lastSelectCoin:B,showCoinSelect:Q,onCoinSelect:me,liquidityTotalAmount:_,toggle:Et,onInput:qe,isInputTotalAmount:Xe,isViewDetail:ge,addLiquidityBtnDisabled:Be,addLiquidityBtnText:Ee,isShowTokenWarning:Ve,chainName:U,closeTokenWarning:v,warningFromCoin:Ce,warningToCoin:we,isShowLiquidityModal:N,currentPrice:st,currentPriceReverse:_t,currentPriceTab:te,minPrice:x,maxPrice:M,toAdd:le,direction:Oe,wallet:y,getAddLiquidityType:Fe,clickRefresh:pe,isShowtotalAmount:be}}});const zr={class:"new-liquidity-right"},Hr={class:"deposit-title"},Er={class:"card-container"},Dr={key:0,class:"lock"},Xr={class:"card-item"},Wr={class:"card-item"},xr={key:0,class:"total-amount"},Zr=a("span",null,"Total Amount",-1);function Gr(e,c,fe,H,U,he){const E=Ut,$=so,y=zt,G=ao,n=Ht,i=eo,X=co,ee=mo,f=vo;return T(),j("div",zr,[a("div",Hr,[He(E,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),a("div",Er,[e.positionError?(T(),j("div",Dr,[He($)])):V("",!0),a("div",Xr,[He(y,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":c[0]||(c[0]=l=>e.fromCoinAmount=l),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:c[1]||(c[1]=l=>e.maxBtnSelect("fromCoin")),onOnHalf:c[2]||(c[2]=l=>e.halfBtnSelect("fromCoin")),onOnInput:c[3]||(c[3]=l=>{e.fromCoinAmount=l,e.fixedFromCoin=!0,e.isInputTotalAmount=!1}),onOnSelect:c[4]||(c[4]=l=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?(T(),Ge(G,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):V("",!0)]),a("div",Wr,[He(y,{modelValue:e.toCoinAmount,"onUpdate:modelValue":c[5]||(c[5]=l=>e.toCoinAmount=l),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:c[6]||(c[6]=l=>e.maxBtnSelect("toCoin")),onOnHalf:c[7]||(c[7]=l=>e.halfBtnSelect("toCoin")),onOnInput:c[8]||(c[8]=l=>{e.toCoinAmount=l,e.fixedFromCoin=!1,e.isInputTotalAmount=!1}),onOnSelect:c[9]||(c[9]=l=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?(T(),Ge(G,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):V("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(T(),j("img",{key:1,class:"add",src:go,alt:"",onClick:c[10]||(c[10]=(...l)=>e.toggle&&e.toggle(...l))})):V("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(T(),j("img",{key:2,class:"add",src:po,alt:"",onClick:c[11]||(c[11]=(...l)=>e.toggle&&e.toggle(...l))})):V("",!0)]),e.isShowtotalAmount?(T(),j("div",xr,[Zr,a("span",null,ue(e.liquidityTotalAmount)+" ",1)])):V("",!0),He(n,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),He(i,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:c[12]||(c[12]=l=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:kt(()=>[ct(ue(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(T(),Ge(X,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:c[13]||(c[13]=l=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):V("",!0),e.isViewDetail?(T(),Ge(ee,{key:2,"pool-info":e.poolInfo,onOnClose:c[14]||(c[14]=l=>e.isViewDetail=!1)},null,8,["pool-info"])):V("",!0),e.isShowLiquidityModal?(T(),Ge(f,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:c[15]||(c[15]=l=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):V("",!0)])}const xt=at(Ur,[["render",Gr]]),Kr=it({components:{NewLiquidityLeft:Wt,NewLiquidityRight:xt},setup(){Ft(()=>{uo()});const e=St();return{tickList:ot,route:e}}});const Jr={key:0,class:"loading-spin-liquidity loading-global"},Qr={class:"privide-liquidity"};function Yr(e,c,fe,H,U,he){var G,n;const E=Tt,$=Wt,y=xt;return T(),j(rt,null,[!e.tickList&&((n=(G=e.route)==null?void 0:G.query)!=null&&n.poolAddress)?(T(),j("div",Jr,[He(E)])):V("",!0),a("div",Qr,[He($),He(y)])],64)}const $i=at(Kr,[["render",Yr],["__scopeId","data-v-9c3e932a"]]);export{$i as default};
