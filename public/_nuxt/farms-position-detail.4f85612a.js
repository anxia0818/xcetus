import{u as oe,m as te,e as ae,s as O,a as Q,c as j}from"./pool.f843b109.js";import{a as ne,l as k,b as re,r as B,q as ie,e as le,s as de,o as d,f as u,h as s,j as I,v as z,u as E,F as J,E as G,c as R,w as b,x as N,i as H,z as ce,B as ue,P as me,t as C,p as pe,k as fe}from"./entry.2f05772d.js";/* empty css              */import{u as _e}from"./farms.48cb87dd.js";import{i as ve}from"./import-icon.de3e6c66.js";import{D as K}from"./decimal.0bdeb344.js";import{a as he,u as we}from"./sha256.07ddf552.js";const ge=ne({setup(){const e=oe(),_=k(()=>e),W=_e(),V=k(()=>W),T=re(),o=k(()=>_.value.currentPositionInfo),v=B(),A=a=>{var n;return((n=_.value.tokensObj[a])==null?void 0:n.logo_url)||ve("/image/coins/sui-unknown.png")},p=te("Sui"),i=B(),U=async a=>{i.value=0;try{const n=await p.calculateFarmingRewards([{pool_id:a.pool_id,position_nft_id:a.id}]),r=[];let l=new K(0);n[a.id].forEach(t=>{var g;const h=(g=_.value.tokensObj[t.rewarder_type])==null?void 0:g.decimals;let w=new K(t.rewarder_amount).div(Math.pow(10,h)).toString();Number(w)>0&&(l=l.add(w),r.push({...t,rewarderAmount:w,rewarderAmountPer:w}))}),i.value=l,v.value=r,console.log("getRewarder",a,r)}catch(n){console.log(n,"getRewarder")}},D=k(()=>V.value.farmsPoolObj);ie(()=>[o.value,D.value],([a,n])=>{var r;!j(a)&&a.positionSource=="farming"?U(a):!j(n)&&!j(a)&&(console.log(n,"##farmsPoolObj"),v.value=(r=n[a.poolAddress])==null?void 0:r.rewarders)},{immediate:!0});const X=he(),F=k(()=>X),M=we(),f=ae("Sui"),{setIsShowSuccess:L,setIsShowRejected:P,setIsShowWaiting:c,setTransactionDesc:$,setTransactionTxid:y}=M,m=B(!1),Y=async()=>{m.value=!0,y(""),$("Claim rewards"),c(!0);const a={pool_id:o.value.pool_id,position_nft_id:o.value.id};try{const n=await p.harvestFarms(a),r=await F.value.currentWallet.signAndExecuteTransactionBlock(n);console.log("0221###sui swap res###",r);let l=f.handleTx(r);if(l&&l.hash){y(l.hash),c(!1),L(!0);let t={title:"Claim",res:l.res,hash:l.hash};f.showTransitionPending(t),await f.watchTransaction(t)&&setTimeout(()=>{U(o.value)},2e3)}else c(!1),P(!0);m.value=!1}catch(n){console.log("farmsDeposit error",n),c(!1),P(!0),m.value=!1}},Z=async()=>{m.value=!0,y(""),$(`Unstake ${o.value.name}`),c(!0);const a=o.value.pool_id,n=o.value.id;try{const r=await p.farmsWithdraw(a,n),l=await F.value.currentWallet.signAndExecuteTransactionBlock(r);console.log("0221###sui swap res###",l);let t=f.handleTx(l);if(console.log(t,"unStaketx##"),t&&t.hash){y(t.hash),c(!1),L(!0);let h={res:t.res,title:"Unstake",hash:t.hash};f.showTransitionPending(h),await f.watchTransaction(h)&&setTimeout(()=>{console.log("unstake success"),T.replace(`/new-position-detail?name=${o.value.tokenName}address=${o.value.clmm_pool_id}&pos=${o.value.clmm_position_id}`),_.value.setCurrentPositionInfo(o.value.clmm_pool_id,"",o.value.tokenName,"Sui",o.value.clmm_position_id),i.value=0},2e3)}else c(!1),P(!0);m.value=!1}catch(r){console.log("farmsDeposit error",r),c(!1),P(!0),m.value=!1}},x=async()=>{console.log(o.value,"currentPositionInfo.value"),m.value=!0,y(""),$(`Stake ${o.value.name}`),c(!0);const a={clmm_pool_id:o.value.poolAddress,clmm_position_id:o.value.pos_object_id,coinTypeA:o.value.coin_type_a,coinTypeB:o.value.coin_type_b},n=D.value[o.value.poolAddress].id;try{const r=await p.farmsDeposit(a,n),l=await F.value.currentWallet.signAndExecuteTransactionBlock(r);console.log("0221###sui swap res###",l);let t=f.handleTx(l);if(t&&t.hash){y(t.hash),c(!1),L(!0);let h={res:t.res,title:"Staked",hash:t.hash};f.showTransitionPending(h);const w=await f.watchTransaction(h);let g;console.log(t,"tx###"),w&&setTimeout(async()=>{t.res.events.forEach(q=>{q.type.indexOf("::pool::DepositEvent")>-1&&(g=q.parsedJson.wrapped_position_id)}),T.replace(`/new-position-detail?position_nft_id=${g}&positionSource=farming`),console.log(g,"###farmPositionId"),await _.value.setCurrentPositionInfo("","","","Sui",g,"farming"),m.value=!1},2e3)}else c(!1),P(!0)}catch(r){console.log("farmsDeposit error",r),c(!1),P(!0),m.value=!1}},ee=k(()=>M),se=k(()=>ee.value.addressLpTokens);return{getCoinIcon:A,rewardList:v,sFixD:O,addCommom:Q,claim:Y,unStake:Z,loading:m,totalRewardAmount:i,currentPositionInfo:o,stake:x,farmsPoolObj:D,addressLpTokens:se}}});const S=e=>(pe("data-v-320dfbf3"),e=e(),fe(),e),ke={key:0,class:"farms-position-detail"},Se={class:"farms-top"},Pe=S(()=>s("div",{class:"left"},[s("div",{class:"title"},"Farming"),s("div",{class:"desc"},"Stake Position to Earn")],-1)),ye={class:"right"},Ie={class:"apr"},be=S(()=>s("span",null,"View",-1)),Ce=S(()=>s("svg",{class:"arrow-icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-icon_arrow"})],-1)),Te=[be,Ce],Ae={class:"farms-bottom"},De=S(()=>s("div",{class:"title"},"Earnings",-1)),Fe={key:0,class:"reward-list"},Le={key:0,class:"rewards-item-bg"},$e={class:"rewards-item-box"},je={alt:""},Be={key:1},Ee={class:"rewards-item-bg"},Re={class:"rewards-item-box"},Ne={alt:""},Oe=S(()=>s("span",null,"0",-1)),We={key:1,class:"reward-list"},Ve={key:0,class:"rewards-item-bg"},Ue={class:"rewards-item-box"},Me={alt:""},qe=S(()=>s("span",null,"0",-1)),ze={key:1},Je={class:"rewards-item-bg"},Ge={class:"rewards-item-box"},He={alt:""},Ke=S(()=>s("span",null,"0",-1)),Qe={class:"actions-box"};function Xe(e,_,W,V,T,o){const v=ue,A=me,p=de("image");return e.farmsPoolObj&&e.farmsPoolObj[e.currentPositionInfo.poolAddress]&&e.farmsPoolObj[e.currentPositionInfo.poolAddress].status=="Live"||e.currentPositionInfo.positionSource=="farming"?(d(),u("div",ke,[s("div",Se,[Pe,s("div",ye,[s("div",Ie,[I(" APR "),s("span",null,z(("sFixD"in e?e.sFixD:E(O))(e.addressLpTokens&&e.addressLpTokens[e.currentPositionInfo.poolAddress]&&e.addressLpTokens[e.currentPositionInfo.poolAddress].total_apr&&e.addressLpTokens[e.currentPositionInfo.poolAddress].total_apr*100,2))+"%",1)]),s("div",{class:"view",onClick:_[0]||(_[0]=i=>e.$router.push("/farms"))},Te)])]),s("div",Ae,[De,e.rewardList&&e.rewardList.length>0?(d(),u("div",Fe,[(d(!0),u(J,null,G(e.rewardList,i=>(d(),u("div",{key:i,class:"rewards-item"},[e.currentPositionInfo.positionSource=="farming"?(d(),u("div",Le,[s("div",$e,[C(s("img",je,null,512),[[p,e.getCoinIcon(i.rewarder_type)]]),s("span",null,z(i.rewarderAmountPer>0&&i.rewarderAmountPer<.01?"<0.01":("addCommom"in e?e.addCommom:E(Q))(("sFixD"in e?e.sFixD:E(O))(i.rewarderAmount,4))),1)])])):(d(),u("div",Be,[s("div",Ee,[s("div",Re,[C(s("img",Ne,null,512),[[p,e.getCoinIcon(i.reward_coin)]]),Oe])])]))]))),128))])):(d(),u("div",We,[(d(!0),u(J,null,G(e.currentPositionInfo.rewards,i=>(d(),u("div",{key:i,class:"rewards-item"},[e.currentPositionInfo.positionSource=="farming"?(d(),u("div",Ve,[s("div",Ue,[C(s("img",Me,null,512),[[p,e.getCoinIcon(i.rewarder_type)]]),qe])])):(d(),u("div",ze,[s("div",Je,[s("div",Ge,[C(s("img",He,null,512),[[p,e.getCoinIcon(i.reward_coin)]]),Ke])])]))]))),128))])),s("div",Qe,[e.currentPositionInfo&&e.currentPositionInfo.positionSource=="farming"?(d(),R(v,{key:0,class:"unstake-btn",loading:e.loading,onClick:e.unStake},{default:b(()=>[I("Unstake")]),_:1},8,["loading","onClick"])):N("",!0),e.currentPositionInfo&&e.currentPositionInfo.positionSource=="clmm"&&e.currentPositionInfo.currentStatus!=="Active"?(d(),R(A,{key:1},{title:b(()=>[I("Farming rewards are only available for active positions.")]),default:b(()=>[H(v,{class:"unstake-btn",loading:e.loading,disabled:!0,onClick:e.stake},{default:b(()=>[I("Stake")]),_:1},8,["loading","onClick"])]),_:1})):e.currentPositionInfo&&e.currentPositionInfo.positionSource=="clmm"?(d(),R(v,{key:2,class:"unstake-btn",loading:e.loading,onClick:e.stake},{default:b(()=>[I("Stake")]),_:1},8,["loading","onClick"])):N("",!0),H(v,{class:"unstake-btn btn-margin",loading:e.loading,disabled:e.totalRewardAmount==0||e.currentPositionInfo&&e.currentPositionInfo.positionSource!=="farming",onClick:ce(e.claim,["stop"])},{default:b(()=>[I("â†‘ Claim")]),_:1},8,["loading","disabled","onClick"])])])])):N("",!0)}const as=le(ge,[["render",Xe],["__scopeId","data-v-320dfbf3"]]);export{as as _};
