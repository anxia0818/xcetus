import{_ as g,S as A,i as D,a2 as v,s as m,D as r,c as B,p as y,b as F}from"./pool.9dde039e.js";import{$ as W,m as P,L as R,a0 as V}from"./entry.31546fcc.js";function l(s){const o={fullRpcUrl:localStorage.getItem(`${s}-current-rpc`)||g[s||"Sui"].fullRpcUrl,faucetURL:localStorage.getItem(`${s}-current-rpc`)||g[s||"Sui"].faucetURL,simulationAccount:g[s||"Sui"].simulationAccount,xcetus:g[s||"Sui"].xcetus},e=W(new A(o)),u=D(),c=P(()=>u);R(()=>{c.value.address&&(e.senderAddress=c.value.address)});const d=async t=>await e.XCetusModule.getOwnerLockCetuss(t),w=async(t,n)=>v.getAvailableXCetus(t,n),C=async t=>await e.XCetusModule.getOwnerCetusCoins(t),S=async t=>await e.XCetusModule.getOwnerVeNFT(t),f=async(t,n)=>{const a={amount:t};n&&(a.venft_id=n);const i=await e.XCetusModule.convertPayload(a);return h(i)},p=async()=>{const t=await e.XCetusModule.mintVeNFTPayload();return h(t)},X=async(t,n)=>{const a=await e.XCetusModule.redeemNum(t,n);return{amountOut:a.amountOut,percent:m(new r(a.percent).mul(new r(100)).toString(),2)}},x=async(t,n)=>{const a=await e.XCetusModule.reverseRedeemNum(t,n);return{amountOut:a.amountOut,percent:m(new r(a.percent).mul(new r(100)).toString(),2)}},b=async(t,n,a)=>{const i=await e.XCetusModule.redeemLockPayload({venft_id:n,amount:t,lock_day:a});return h(i)},M=t=>v.getLockingCetuss(t),k=async(t,n)=>{const a=await e.XCetusModule.getLockCetus(t);if(a&&v.isLocked(a)){const i=e.XCetusModule.cancelRedeemPayload({venft_id:n,lock_id:t});return h(i)}},L=async(t,n)=>{const a=await e.XCetusModule.getLockCetus(t);if(a&&!v.isLocked(a)){const i=await e.XCetusModule.redeemPayload({venft_id:n,lock_id:t});return h(i)}},N=t=>{const n=Date.parse(new Date().toString())/1e3,a=new r(n).sub(t.start_time).div(new r(t.interval_day).mul(60*10)).toFixed(0,r.ROUND_UP);return new r(t.start_time).add(new r(a).mul(60*70)).toString()},T=async()=>{const t=await e.XCetusModule.getDividendManager();return{nextStartTime:N(t),...t}},_=async(t,n)=>{const a=await e.XCetusModule.getVeNFTDividendInfo(n.venft_dividends.id,t);return{rewards:a&&a.rewards||[]}},I=async t=>{const n=await e.XCetusModule.getDividendManager();if(n.bonus_types.length>0){const a=await e.XCetusModule.redeemDividendPayload(t,n.bonus_types);return h(a)}},O=async t=>{const n=await e.XCetusModule.getOwnerVeNFT(t);if(n){const a=await e.XCetusModule.getXcetusManager(),i=new r(n.xcetus_balance).div(a.treasury).mul(100).toString();return Number(i)>0&&Number(i)<.01?"<0.01":m(i,2)}else return 0},h=t=>({transactionBlock:t,options:{showEffects:!0,showEvents:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0,showBalanceChanges:!0}});return{getOwnerLockCetuss:d,getOwnerCetusCoins:C,getOwnerVeNFT:S,depositCetus:f,getMintVeNFTPayload:p,redeemNum:X,getRedeemLockPayload:b,getAvailableXCetus:w,getLockingCetuss:M,getCancelRedeemPayload:k,getVeNFTDividendInfo:_,reverseRedeemNum:x,getRedeemPayload:L,getRedeemDividendPayload:I,getMyShare:O,getDividendManager:T}}const E=V("xcetus",{state:()=>({venft_id:"",xWhaleBalance:"--",venftInfo:{},pendingAmount:"--",whaleBalance:"--",ownerLocks:[],availableXwhale:"--",redeemingXwhale:"--",nextStartTime:"",xcetusShare:"--",pendingCoinInfo:{},cetusApr:"",claimLoading:"",dividendManagerInfo:{}}),actions:{async getOwnerVeNFT(s){const o=l("Sui");try{const e=await o.getOwnerVeNFT(s);e&&!B(e)?(this.venft_id=e.id,this.xWhaleBalance=y(e.xcetus_balance,9),this.venftInfo={id:e.id,type:e.type,index:e.index,xcetus_balance:e.xcetus_balance},this.getVeNFTDividendInfo()):(this.xWhaleBalance="0",this.availableXwhale="0",this.redeemingXwhale="0",this.pendingAmount="0")}catch{this.xWhaleBalance="0",this.availableXwhale="0",this.redeemingXwhale="0",this.pendingAmount="0"}},async getVeNFTDividendInfo(){const s=l("Sui"),o=F("Sui");try{const e=await s.getVeNFTDividendInfo(this.venft_id,this.dividendManagerInfo);let u=0;if(e&&e.rewards){for(let c=0;c<e.rewards.length;c++){const d=e.rewards[c].rewards;for(let w=0;w<d.length;w++){const C=d[w],f=(await o.getTokenList()).filter(p=>p.address==C.coin_type)[0];this.pendingCoinInfo=f,u+=Number(y(C.amount,f.decimals))}}this.pendingAmount=m(u,this.pendingCoinInfo.decimals)}else this.pendingAmount="0"}catch{this.pendingAmount="0"}},async getDividendManager(){const o=await l("Sui").getDividendManager();this.nextStartTime=o.nextStartTime,this.dividendManagerInfo=o},async getAccountWhaleBalance(s){const e=await l("Sui").getOwnerCetusCoins(s);if(e&&e.length>0){let u=0;e.forEach(c=>{u+=Number(y(c.balance.toString(),9))}),this.whaleBalance=m(u,9)}else this.whaleBalance="0"},async getOwnerLockCetuss(s){const u=(await l("Sui").getOwnerLockCetuss(s)).sort((c,d)=>c.locked_until_time-d.locked_until_time);this.ownerLocks=u,this.setClaimLoading(""),this.getAvailableXCetus()},async getAvailableXCetus(){const o=await l("Sui").getAvailableXCetus(this.venftInfo,this.ownerLocks);this.availableXwhale=y(o,9),this.redeemingXwhale=this.xWhaleBalance!=="--"?new r(this.xWhaleBalance).sub(new r(this.availableXwhale)).toString():"--"},async getMyShare(s){const e=await l("Sui").getMyShare(s);this.xcetusShare=Number(e)>0&&Number(e)<.01?"<0.01":e},async getXcetusApr(){const{data:s}=await fetch(`${g.Sui.api}/v2/sui/storm/dividend_rewards`).then(e=>e.json()),o=s.apr&&s.apr.replace("%","");this.cetusApr=Number(o)>0&&Number(o)<.01?"<0.01":o},loginOut(){this.venft_id="",this.xWhaleBalance="--",this.venftInfo={},this.pendingAmount="--",this.whaleBalance="--",this.ownerLocks=[],this.availableXwhale="--",this.redeemingXwhale="--"},setClaimLoading(s){this.claimLoading=s}}});export{l as a,E as u};
