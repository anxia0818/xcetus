import{a as ut,b as Kt,n as pt,d as Se,u as Ct,e as Ue,c as Le,i as Jt,s as bt,T as Nt,p as At,f as ze,g as It}from"./pool.88cdcef5.js";import{a as at,r as D,m as I,y as qt,D as Ie,e as nt,o as L,f as Z,c as Ge,x as V,h as i,t as Pt,G as $t,H as ht,v as ue,u as Te,F as rt,J as Tt,p as Rt,k as Ot,z as ot,s as wt,j as ct,l as Bt,E as St,C as Ft,q as Qt,i as Ee,w as kt,L as Yt,b as Vt,B as eo}from"./entry.fbdb43a0.js";/* empty css              */import{s as lt,m as to,l as oo,b as ro,a as ao,_ as no}from"./transform.5d9ef67e.js";import{D as s}from"./decimal.0e8aa3f1.js";import{u as dt,a as io}from"./sha256.99c4e5e6.js";import"./decimal.633e31ee.js";import{g as lo}from"./common-fun.eb1df334.js";import{d as jt,_ as Ut,c as zt,a as Et,b as so}from"./new-liquidity-title.3bab0dec.js";import{i as yt}from"./import-icon.de3e6c66.js";/* empty css              */import{positionError as Qe,tickList as tt,direction as Oe,minPrice as x,maxPrice as M,fromCoin as P,toCoin as k,currentPrice as st,currentPriceReverse as _t,currentPriceTab as te,defaultMinPrice as ft,defaultMaxPrice as gt,toggle as Ht,isInputTotalAmount as Xe,priceConfigObj as Ke,fromCoinAmount as C,toCoinAmount as N,fixedFromCoin as Pe,resetTickList as Lt,resetData as uo}from"./data.240d9861.js";import{_ as co}from"./coin-select.421a712d.js";import{_ as mo}from"./viewDetail.ba384cd9.js";import{b as vo}from"./new-add-or-create.3d339a95.js";import{u as fo}from"./notifi.2f9a3b71.js";import{_ as go,a as po}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.590faecc.js";import"./precision.a7a6c57b.js";import"./lock.a002fb4e.js";/* empty css              *//* empty css              */import"./tick.505fdad3.js";import"./token-warning.33afbbe0.js";import"./refresh-icon.370cc906.js";/* empty css              */import"./swap-setting.67113f01.js";/* empty css              */import"./img-no-Positions_2x.f7732e83.js";import"./status-block.3a5218b7.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.021a6766.js";import"./index.d2c3cdf1.js";function Mt(e,m,fe){const z=new s(10).pow(m-fe);return new s(1.0001).pow(e).mul(z)}const bo=at({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,m){const fe=D(""),z=D(""),j=I(()=>{var r,b,u,v,B,Q;return console.log(e.poolInfo,"===>props.poolInfo"),(r=e.poolInfo)!=null&&r.current_sqrt_price&&((b=e.poolInfo)!=null&&b.coinA.decimals)&&((u=e.poolInfo)!=null&&u.coinB.decimals)?n.sqrtPriceX64ToPrice((v=e.poolInfo)==null?void 0:v.current_sqrt_price,(B=e.poolInfo)==null?void 0:B.coinA.decimals,(Q=e.poolInfo)==null?void 0:Q.coinB.decimals).toString():"0"}),he=I(()=>{let r=0;return e.direction?r=(Number(e.minPrice)/Number(j.value)-1)*100:r=(Number(e.minPrice)/Number(1/Number(j.value))-1)*100,r=r>0&&r<.1?.1:r,r=r<0&&r>-.1?-.1:r,r}),E=I(()=>{let r=0;return e.direction?r=(Number(e.maxPrice)/Number(j.value)-1)*100:r=(Number(e.maxPrice)/Number(1/Number(j.value))-1)*100,r=r>0&&r<.1?.1:r,r=r<0&&r>-.1?-.1:r,r}),R=dt(),y=I(()=>R),G=I(()=>y.value.chainName?ut(y.value.chainName):{}),{TickMath:n,getNearestTickByTick:a}=G.value,X=(r=[])=>{let b=6;const u=Math.abs(Number(r[0])-Number(r[r.length-1]));return u>=6?b=0:u>=1?b=1:u>=.1?b=2:u>=.01?b=3:u>=.001?b=4:u>=1e-4?b=5:u>=1e-5?b=6:u>=1e-6?b=7:u>=1e-7&&(b=8),b},ee=(r,b=1)=>{if(r&&r.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const u=Number(e.poolInfo.current_tick_index);console.log("0117###dataProcessing###currentTick###",u),console.log("0117###dataProcessing###props.poolInfo###",e.poolInfo),console.log("0117###dataProcessing###minPrice###",e.minPrice),console.log("0117###dataProcessing###maxPrice###",e.maxPrice),console.log("0117###dataProcessing###poolInfo###",e.poolInfo);let v=u+100*b,B=u-100*b,Q,ne;if(e.maxPrice==="∞")ne=G.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ne=n.priceToTickIndex(new s(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ne=n.priceToTickIndex(new s(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ne=443636}if(e.minPrice==="0")Q=G.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?Q=n.priceToTickIndex(new s(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):Q=n.priceToTickIndex(new s(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{Q=-443636}let me=0;if(e.currentPriceTab!=="full range"){if(u>=Q&&u<=ne){const S=u-Q,re=ne-u;me=Math.max(Math.abs(S),Math.abs(re))}else u<Q?me=Math.abs(ne-u):me=Math.abs(u-Q);v=u+me+100*b,B=u-me-100*b}else{const S=(Math.abs(u)>5e3,2e4);v=u+S*b,B=u-S*b}B<-443636&&(B=-443636),v>443636&&(v=443636);const g=new s(r.liquidity).div(Math.pow(10,8)).toString(),q=e.tickList;console.log("0117####drawChart####tick_info_array####",q);const F=[],T=[];let _={};for(let S=0;S<q.length;S++){if(_=q[S],_.index<=u&&_.index>=B){if(F.length<1&&S!==0){const re=q[S-1];F.unshift({...re,index:B,source:"left"})}F.unshift(_)}else if(_.index>u&&_.index<=v&&(T.push(_),F.length<1&&S!==0)){const re=q[S-1];F.push({...re,index:B,source:"left"})}if(_.index>v){const re=q[S];if(T.push({...re,index:v,source:"right"}),F.length<1&&S!==0){const Je=q[S-1];F.push({...Je,index:B,source:"left"})}break}}let W="0";for(let S=F.length-1;S>=0;S--)W=new s(W).plus(new s(F[S].liquidityNet.toString()).div(Math.pow(10,8))).toString(),F[S].liquityAmount=W;let O=g;for(let S=0;S<T.length;S++)O=new s(O).plus(new s(T[S].liquidityNet.toString()).div(Math.pow(10,8))).toString(),T[S].liquityAmount=O;let H=[];const $=q&&q.length>0?{index:u,liquityAmount:Number(g)}:{index:u,liquityAmount:0};(F.length>0||T.length>0)&&(H=[...F.reverse(),$,...T],e.direction||(H=H.reverse()));const Me=[];q.forEach(S=>{Me.push({...S,liquidityGross:S.liquidityGross.toString(),liquidityNet:S.liquidityNet.toString()})}),console.log("0117####drawChart####testTickInfoArray####",Me),console.log("0117####drawChart####currentLiquity####",g),l(H,B,v,Q,ne,u)}};let f=D(!1);qt(()=>{document.body.clientWidth<750?f.value=!1:f.value=!0,window.onresize=()=>{document.body.clientWidth<750?f.value=!1:f.value=!0,ee(e.poolInfo,e.zoom)}});const l=(r,b,u,v,B,Q)=>{console.log("0117####drawChart####chartData####",r),console.log("0117####drawChart####tickMin####",b),console.log("0117####drawChart####tickMax####",u),console.log("0117####drawChart####minPriceTick####",v),console.log("0117####drawChart####maxPriceTick####",B),console.log("0117####drawChart####currentTick####",Q),console.log("0117####drawChart####props.direction####",e.direction),console.log("0518###newd3###props.before7dContractPriceLowest###",e.before7dContractPriceLowest),console.log("0518###newd3###props.before7dContractPriceHighest###",e.before7dContractPriceHighest);let ne,me;e.direction?(ne=e.before7dContractPriceLowest?n.priceToTickIndex(new s(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",me=e.before7dContractPriceHighest?n.priceToTickIndex(new s(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ne=e.before7dContractPriceLowest?n.priceToTickIndex(new s(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",me=e.before7dContractPriceHighest?n.priceToTickIndex(new s(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const g={top:30,right:35,bottom:20,left:55};let q,F;f.value?(q=460-g.left-g.right,F=205-g.top-g.bottom):(q=340-g.left-g.right,F=205-g.top-g.bottom);const T=u-b,_=parseInt(String(T/4));let W=[b+_/4,b+_,b+2*_,u-_,u-_/4];const O=b,H=u,$=q/(H-O);e.currentPriceTab==="full range"&&(W=[b,b+2*_,u]),console.log("0117####drawChart####xArr####",W),console.log("0117####drawChart####utickMin####",O),console.log("0117####drawChart####utickMax####",H),console.log("0117####drawChart####unit####",$);const Me=W.map(c=>e.direction?Mt(c,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new s(1).div(Mt(c,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),S=X(Me);lt("#chart").selectAll("*").remove();const re=lt("#chart").attr("width",q+g.left+g.right).attr("height",F+g.top+g.bottom).append("g").attr("transform",`translate(${g.left},${g.right})`),Je=to(r,function(c){return Number(Math.abs(c.liquityAmount))})||0,qe=oo().range([0,F]).domain([Je,0]);ro().rangeRound([0,q]).padding(.1);const h=re.append("g").attr("id","barsBox").selectAll("rect").data(r).enter().append("rect");y.value.theme=="default"?h.attr("x",function(c,d){return d===0?0:e.direction?Math.abs(c.index-O)*$:Math.abs(H-c.index)*$}).attr("y",function(c,d){return e.direction?d===r.length-1?0:qe(c.liquityAmount):d===r.length-1?0:qe(r[d+1].liquityAmount)}).attr("width",function(c,d){return d===0&&r.length===1&&c.liquityAmount>0?q:(e.direction,d!==r.length-1?Math.abs(r[d+1].index-c.index)*$:0)}).attr("height",function(c,d){return d===0&&r.length===1&&c.liquityAmount>0?F:e.direction?d===r.length-1?0:F-qe(c.liquityAmount):d===r.length-1?0:F-qe(r[d+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):h.attr("x",function(c,d){return d===0?0:e.direction?Math.abs(c.index-O)*$:Math.abs(H-c.index)*$}).attr("y",function(c,d){return e.direction?d===r.length-1?0:qe(Math.abs(c.liquityAmount)):d===r.length-1?0:qe(Math.abs(r[d+1].liquityAmount))}).attr("width",function(c,d){return d===0&&r.length===1&&c.liquityAmount>0?q:(e.direction,d!==r.length-1?Math.abs(r[d+1].index-c.index)*$:0)}).attr("height",function(c,d){if(d===0&&r.length===1&&c.liquityAmount>0)return F;if(e.direction)return d===r.length-1?0:Number(c.liquityAmount)?F-qe(Math.abs(c.liquityAmount)):0;{if(d===r.length-1)return 0;const Fe=F-qe(Math.abs(r[d+1].liquityAmount));return Number(r[d+1].liquityAmount)?Fe:0}}).attr("fill",function(c,d){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(c,d){return"#417494"});const A=re.append("g");A.append("line").attr("x1",0).attr("y1",155).attr("x2",q).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const U=A.append("g");let ie=0;if(e.direction){for(let c=0;c<W.length;c++){const d=Se(Me[c],S)||"0";console.log("0423####price####",d),Me.push(d);const Fe=Math.abs(W[c]-O)*$;let pe=0;for(let be=0;be<d.length;be++)d[be]==="1"?pe+=4.02:d[be]==="."?pe+=2.64:d[be]==="7"?pe+=5.48:pe+=6;console.log(Fe,"x=>>>"),U.append("text").text(d).attr("x",Fe-pe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}ie=Math.abs(Q-O)*$}else{for(let c=W.length-1;c>=0;c--){const d=Se(Me[c],S)||0;Me.push(d);const Fe=Math.abs(W[c]-H)*$;let pe=0;for(let be=0;be<d.length;be++)d[be]==="1"?pe+=4.02:d[be]==="."?pe+=2.64:d[be]==="7"?pe+=5.48:pe+=6;U.append("text").text(d).attr("x",Fe-pe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}ie=Math.abs(Q-H)*$}console.log(Q,H,$,"######currentPricePositon"),(y.value.theme=="default"?re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+ie+", 0)");let le,Be,De,He;e.direction?(console.log("0525###d3###select###minPriceTick###",v),console.log("0525###d3###select###maxPriceTick###",B),console.log("0525###d3###select###props.minPrice###",e.minPrice),console.log("0525###d3###select###props.maxPrice###",e.maxPrice),le=v<O?-100:parseInt(String(Math.abs(v-O)*$)),Be=B<O?-100:parseInt(String(Math.abs(B-O)*$)),De=ne<O?-100:Math.abs(ne-O)*$,He=me<O?-100:Math.abs(me-O)*$):(Be=v<O?-100:Math.abs(H-v)*$,le=B<O?-100:Math.abs(H-B)*$,He=ne<O?-100:Math.abs(H-ne)*$,De=me<O?-100:Math.abs(H-me)*$),e.minPrice==="0"&&(le=0),e.maxPrice==="∞"&&(Be=q),console.log(le,"==>minPriceTickX"),f.value,fe.value=q-le+87+"px",z.value=Be+74+"px",ne&&De<q&&re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+De+", 0)"),me&&He<q&&re.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+He+", 0)");const Ce=re.append("g").attr("id","left-handle"),we=re.append("g").attr("id","right-handle");y.value.theme=="default"?(Ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),Ce.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),Ce.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),Ce.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),we.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),we.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),we.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),we.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(Ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),Ce.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),Ce.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),Ce.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),we.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),we.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),we.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),we.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),console.log("0525###d3###select###minPriceTickX###",le),console.log("0525###d3###select###maxPriceTickX###",Be),Ce.attr("transform","translate("+le+", 0)"),we.attr("transform","translate("+Be+", 0)");const Ye=ao().extent([[0,0],[q,F]]).handleSize(30).on("end",it);re.append("g").attr("class","brush").call(Ye).call(Ye.move,[le,Be]);function it(c){if(!c.sourceEvent||!c.selection)return;Ce.attr("transform","translate("+c.selection[0]+", 0)"),we.attr("transform","translate("+c.selection[1]+", 0)"),f.value?fe.value=q-c.selection[0]+60+"px":fe.value=q-c.selection[0]+52+"px",z.value=c.selection[1]+74+"px";let d,Fe;console.log("0525###d3###select###e.selection[0]###",c.selection[0]),console.log("0525###d3###select###e.selection[0]###",c.selection[1]),console.log("0525###d3###select###props.direction###",e.direction),console.log("0525###d3###select###width###",q),console.log("0525###d3###select###unit###",$),console.log("0525###d3###select###utickMin###",O),console.log("0525###d3###select###utickMax###",H),console.log("0525###d3###select###props.poolInfo###",e.poolInfo);let pe=0,be=0;e.direction?(pe=a(parseInt(String(c.selection[0]/$+O)),Number(e.poolInfo.tickSpacing)),d=n.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),be=a(parseInt(String(c.selection[1]/$+O)),Number(e.poolInfo.tickSpacing)),Fe=n.tickIndexToPrice(be,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),console.log("0525###d3###select###minTick###",pe),console.log("0525###d3###select###maxTick###",be),console.log("0525###d3###select###minPrice###",d),console.log("0525###d3###select###maxPrice###",Fe)):(be=a(H-c.selection[0]/$,Number(e.poolInfo.tickSpacing)),d=1/n.tickIndexToPrice(be,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),pe=a(H-c.selection[1]/$,Number(e.poolInfo.tickSpacing)),Fe=1/n.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),m.emit("onChangeMinPrice",String(Se(String(d),6))),m.emit("onChangeMaxPrice",String(Se(String(Fe),6)))}y.value.theme=="default"?lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632")};D(""),Ie(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom],([r,b,u,v,B])=>{console.log(r,b,u,u>b,"poolInfo && minPrice && maxPrice && (maxPrice > minPrice)"),r&&b&&u&&(r!=null&&r.liquidity)&&(v!=="Custom"||console.log("绘制"),ee(r,B))},{immediate:!0});const K=D(!1);return Ie(()=>e.chartLoading,(r,b)=>{r!==b&&(K.value=r)},{immediate:!0,deep:!0}),console.log(e,"props===>"),{store:y,loading:K,rangeSizeLower:he,rangeSizeUpper:E,rangeSizeLowerPosition:fe,rangeSizeUpperPosition:z,decimalFormat:Kt,numberformat:pt}}});const ho=e=>(Rt("data-v-ed5aa575"),e=e(),Ot(),e),wo={class:"chart-box"},ko={class:"chart"},yo=ho(()=>i("svg",{id:"chart"},null,-1));function _o(e,m,fe,z,j,he){const E=Tt;return L(),Z(rt,null,[e.tickList&&e.tickList.length>0&&e.loading?(L(),Ge(E,{key:0})):V("",!0),i("div",wo,[Pt(i("div",ko,[e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(L(),Z("div",{key:0,class:"range-size range-size-lower",style:ht({right:e.rangeSizeLowerPosition})},ue(("numberformat"in e?e.numberformat:Te(pt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):V("",!0),e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(L(),Z("div",{key:1,class:"range-size range-size-upper",style:ht({left:e.rangeSizeUpperPosition})},ue(("numberformat"in e?e.numberformat:Te(pt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):V("",!0),yo],512),[[$t,!e.loading]])])],64)}const xt=nt(bo,[["render",_o],["__scopeId","data-v-ed5aa575"]]),Co=at({props:{aprRewardsParameter:{type:Number,default:30},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},fromCoin:{type:Object,default:()=>({})},toCoin:{type:Object,default:()=>({})},poolInfo:{type:Object,default:()=>({})},nameTab:{type:String,default:""}},setup(e){const m=[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}],fe=dt(),z=I(()=>fe);I(()=>z.value.chainName);const j=Ct(),he=I(()=>j),E=I(()=>z.value.chainName?ut(z.value.chainName):{}),R=D(),y=async a=>{var Q,ne,me;console.log("0607###detail###getAprMethod###poolInfo###",a),console.log("0607###detail###getAprMethod###props.fromCoin###",e.fromCoin),console.log("0607###detail###getAprMethod###props.toCoin###",e.toCoin),console.log("0607###detail###getAprMethod###props.nameTab###",e.nameTab);let X;a.token_a.address.toLowerCase()===e.fromCoin.address.toLowerCase()&&a.token_b.address.toLowerCase()===e.toCoin.address.toLowerCase()?X=!0:X=!1,console.log("0607###detail###getAprMethod###directs###",X),console.log("0607###detail###getAprMethod###props.minPrice###",e.minPrice),console.log("0607###detail###getAprMethod###props.maxPrice###",e.maxPrice);let ee,f;X?(ee=Number(e.minPrice),f=isNaN(Number(e.maxPrice))?2**50:Number(e.maxPrice)):e.maxPrice!=="∞"?(ee=1/Number(e.maxPrice),f=1/Number(e.minPrice)):(ee=1/2**50,f=2**50),console.log("0607###detail###getAprMethod###lowerUserPrice###",ee),console.log("0607###detail###getAprMethod###upperUserPrice###",f);let l=[];l=z.value&&z.value.addressHistTokens&&z.value.addressHistTokens[a.poolAddress]&&z.value.addressHistTokens[a.poolAddress].data&&z.value.addressHistTokens[a.poolAddress].data.length>0&&Object.fromEntries(z.value.addressHistTokens[a.poolAddress].data.map(g=>[g.key,g.value]));let K,r;console.log(l,"===>addressHistTokensList"),e.aprRewardsParameter==7?(K=Number(l==null?void 0:l.before_7_d_contract_price_lowest),r=Number(l==null?void 0:l.before_7_d_contract_price_highest)):e.aprRewardsParameter==24?(K=Number(l==null?void 0:l.before_24_h_contract_price_lowest),r=Number(l==null?void 0:l.before_24_h_contract_price_highest)):(K=Number(l==null?void 0:l.before_30_d_contract_price_lowest),r=Number(l==null?void 0:l.before_30_d_contract_price_highest));const b=he.value.tokensObj;console.log("getEstPositionAPRWithMulti###params###lowerUserPrice###",ee),console.log("getEstPositionAPRWithMulti###params###upperUserPrice###",f),console.log("getEstPositionAPRWithMulti###params###lowerHistPrice###",K),console.log("getEstPositionAPRWithMulti###params###upperHistPrice###",r);const u=await E.value.getEstPositionAPRWithMulti(ee,f,K,r);console.log("getEstPositionAPRWithMulti###resMulti###",u.toString());const v=z.value.newTopPoolsObj[a.poolAddress];console.log(a,"#####stats");let B;if(v){e.aprRewardsParameter==7?B=Number(v.apr_7day.replace("%","")):e.aprRewardsParameter==24?B=Number(v.apr_24h.replace("%","")):B=Number(v.apr_30day.replace("%",""));const g=Number(v.rewarder_apr[0].replace("%","")),q=Number(v.rewarder_apr[1].replace("%","")),F=Number(v.rewarder_apr[2].replace("%","")),T=new s(u.toString()).mul(B).toNumber();console.log(u.toString(),"===>resMulti.toString()");const _=new s(u.toString()).mul(g).toNumber(),W=new s(u.toString()).mul(q).toNumber(),O=new s(u.toString()).mul(F).toNumber();console.log(_,W,O,"posRewarder2_apr##");const H=T+(a.rewarder_display1?_:0)+(a.rewarder_display2?W:0)+(a.rewarder_display3?O:0);console.log(H,"###aprPercentageTotal");const $=a.rewarder_infos[0]?(Q=b[a.rewarder_infos[0].coinAddress])==null?void 0:Q.symbol:"--",Me=a.rewarder_infos[1]?(ne=b[a.rewarder_infos[1].coinAddress])==null?void 0:ne.symbol:"--",S=a.rewarder_infos[2]?(me=b[a.rewarder_infos[2].coinAddress])==null?void 0:me.symbol:"--",re={aprFee:T==1/0||isNaN(T)?0:T,rewardAprList:[{rewarder_name:$,rewarder_apr:_==1/0||isNaN(_)?0:_,styleName:"one",rewarder_display:a.rewarder_display1},{rewarder_name:Me,rewarder_apr:W==1/0||isNaN(W)?0:W,styleName:"two",rewarder_display:a.rewarder_display2},{rewarder_name:S,rewarder_apr:O==1/0||isNaN(O)?0:O,styleName:"three",rewarder_display:a.rewarder_display2}],aprPercentageTotal:H==1/0||isNaN(H)||H===0?0:H,aprPercentage:Jt(T/H,2),is_display_rewarder:a.is_display_rewarder};R.value=re,console.log(R.value,"===>aprPercentageObj.value")}};Ie(()=>[e.poolInfo,e.minPrice,e.maxPrice,z.value.addressHistTokens],([a,X,ee,f])=>{a&&!Le(a)&&f&&!Le(f)&&y(a)},{immediate:!0});const G=I(()=>lo(e.poolInfo,he,z));Ie(()=>[e.aprRewardsParameter],()=>{y(e.poolInfo)});const n=I(()=>{const a=R.value;return a&&a.is_display_rewarder?(a==null?void 0:a.aprPercentageTotal)>1e4?">10000":a.aprPercentageTotal<.01&&a.aprPercentageTotal>0?"<0.01":Ue(a.aprPercentageTotal,2):a&&!a.is_display_rewarder?(a==null?void 0:a.aprFee)>1e4?">10000":a.aprFee<.01&&a.aprFee>0?"<0.01":Ue(a.aprFee,2):"--"});return{poolMoreInfo:G,timeList:m,aprPercentageObj:R,totalApr:n}}}),Po=""+globalThis.__publicAssetsURL("sui-image/farming.png");const mt=e=>(Rt("data-v-82e7880c"),e=e(),Ot(),e),To={class:"est-apr"},So=mt(()=>i("div",{class:"title"},"Estimated APR",-1)),No={class:"apr-total"},Ao={class:"apr-box"},Io={key:0,class:"apr-hover-content"},Lo={class:"progress-fees progress-all"},Mo=mt(()=>i("div",null,[i("div",{class:"light-hint"}),ct(" Fees ")],-1)),qo={key:0,class:"isFarming"},$o=mt(()=>i("img",{src:Po,alt:""},null,-1)),Ro=mt(()=>i("div",{class:"hover-text"},"Farming rewards available",-1)),Oo=[$o,Ro],Bo={class:"time-list"},Fo=["onClick"];function jo(e,m,fe,z,j,he){var E,R,y,G,n,a,X,ee;return L(),Z("div",To,[So,i("div",No,[i("div",Ao,[i("span",{class:ot(e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?"haveBorder":"")},ue(e.totalApr)+"%",3),e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?(L(),Z("div",Io,[i("div",Lo,[Mo,i("span",null,"  "+ue(Number((E=e.aprPercentageObj)==null?void 0:E.aprFee)==0?0:(R=e.aprPercentageObj)!=null&&R.aprFee?((y=e.aprPercentageObj)==null?void 0:y.aprFee)>1e4?">10,000":((G=e.aprPercentageObj)==null?void 0:G.aprFee)<.01?"<0.01":("addCommom"in e?e.addCommom:Te(Ue))((n=e.aprPercentageObj)==null?void 0:n.aprFee,2):(a=e.aprPercentageObj)!=null&&a.rewardAprList?"<0.01":"--")+"%",1)]),(L(!0),Z(rt,null,wt((X=e.aprPercentageObj)==null?void 0:X.rewardAprList,f=>Pt((L(),Z("div",{key:f,class:"progress-rewards progress-all"},[i("div",null,[i("div",{class:ot(["light-hint",f==null?void 0:f.styleName])},null,2),ct(" "+ue(f==null?void 0:f.rewarder_name)+" Rewards ",1)]),i("span",null,"  "+ue(f!=null&&f.rewarder_apr?(f==null?void 0:f.rewarder_apr)>1e4?">10,000":(f==null?void 0:f.rewarder_apr)<.01?"<0.01":("addCommom"in e?e.addCommom:Te(Ue))(f==null?void 0:f.rewarder_apr,2):"0")+"%",1)])),[[$t,(f==null?void 0:f.rewarder_name)!="--"&&f.rewarder_display&&e.aprPercentageObj.is_display_rewarder]])),128))])):V("",!0)]),(ee=e.poolInfo)!=null&&ee.is_display_rewarder&&e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?(L(),Z("div",qo,Oo)):V("",!0)]),i("div",Bo,[(L(!0),Z(rt,null,wt(e.timeList,f=>(L(),Z("div",{key:f.value,class:ot(["time-item",f.value==e.aprRewardsParameter?"time-item-active":""]),onClick:l=>e.$emit("changeAprRewardsParameter",f.value)},ue(f.label),11,Fo))),128))])])}const Xt=nt(Co,[["render",jo],["__scopeId","data-v-82e7880c"]]),Uo=at({components:{NewLiquidityD3Chart:xt,NewLiquidityApr:Xt,NewLiquidityPrice:jt},setup(){const{t:e,locale:m}=Bt(),fe=D("liquidity"),z=dt(),j=I(()=>z),he=I(()=>j.value.chainName),E=Ct(),R=I(()=>E),y=I(()=>j.value.chainName?ut(j.value.chainName):{});qt(()=>{Qe.value=!1});const G=St(),n=I(()=>{let t=null;for(let h=0;h<R.value.poolConfigList.length;h++){const A=R.value.poolConfigList[h];A.address==G.query.poolAddress&&(t=A)}return console.log(t,"===>basePoolInfo"),t}),a=I(()=>{let t=null;for(const h in R.value.poolsObj){const A=R.value.poolsObj[h];A.address==G.query.poolAddress&&(console.log(A,"p===>"),t=A)}return t}),X=D(),ee=D(!0),f=async(t,h)=>{if(h){l.value=[],ee.value=!0;const A=t.token_a.decimals,U=t.token_b.decimals;console.log(t,"pool===>1111"),st.value=Nt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,A,U).toString(),_t.value=new s(1).div(Nt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,A,U)).toString(),P.value=t.needReverse?t.token_b:t.token_a,k.value=t.needReverse?t.token_a:t.token_b,X.value=t.needReverse,t.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===k.value.address.toLowerCase()?Oe.value=!0:Oe.value=!1,console.log(t,"187===>"),console.log(t,"###pool===>");let ie={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const ge=await y.value.getTicks(ie);tt.value=ge?y.value.getTickDataFromUrlData(ge):[],console.log(tt.value,"===>chartLoadingtickList.value"),r(t)}ee.value=!1,console.log(ee.value,"==>chartLoading.value")},l=D([]),K=D(),r=t=>{const h=t.token_a.decimals,A=t.token_b.decimals;let U=R.value.poolPriceConfigObj&&R.value.poolPriceConfigObj[t.address]&&R.value.poolPriceConfigObj[t.address].recommend_ranges||{};const ie=R.value.poolPriceConfigObj&&R.value.poolPriceConfigObj[t.address]&&R.value.poolPriceConfigObj[t.address].type||"";console.log(U,"===>priceConfigList");let ge,le;const Be=t.current_tick_index;K.value=t.current_tick_index,console.log(Be,t.tickSpacing,"==>pool.tickSpacing"),ge=Be-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),le=Be+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const De=y.value.TickMath.tickIndexToPrice(ge,h,A).toString(),He=y.value.TickMath.tickIndexToPrice(le,h,A).toString();U["full range"]={lower:y.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)),upper:y.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing))},U.custom={lower:ge,upper:le,minPrice:De,maxPrice:He};const Ce=[];for(let we in U)U[we]&&(console.log(we,"j==>"),Ce.push({...U[we],key:we}));console.log(Ce,"priceList"),console.log(t,"###pool.type 504"),ie?t.isSelfBuilt?te.value="custom":ie=="stable"?te.value="suggested":te.value="passive":te.value="custom",l.value=Ce,Ke.value=U,v({key:te.value,...U[te.value]})},b=D(""),u=D(""),v=t=>{console.log("priceTab====>",t),console.log("priceTab###poolInfo###",a.value),te.value=t.key.toLowerCase();const h=a.value.token_a.decimals,A=a.value.token_b.decimals,{lower:U,upper:ie}=t;Xe.value=!1;const ge=y.value.TickMath.tickIndexToPrice(U,h,A).toString(),le=y.value.TickMath.tickIndexToPrice(ie,h,A).toString();if(t.key=="full range"){b.value=U,u.value=ie,B();return}console.log(Oe.value,"===>direct.value"),Oe.value?(ft.value=String(ge),x.value=String(ge),gt.value=String(le),M.value=String(le),b.value=U,u.value=ie):(ft.value=String(1/Number(le)),x.value=String(1/Number(le)),gt.value=String(1/Number(ge)),M.value=String(1/Number(ge)),b.value=y.value.TickMath.priceToTickIndex(new s(1/Number(le)),h,A),u.value=y.value.TickMath.priceToTickIndex(new s(1/Number(ge)),h,A)),console.log(x.value,M.value,"===>111")},B=t=>{x.value="0",M.value="∞"};Ie(()=>a.value,(t,h)=>{console.log(h,"===>oldVal"),console.log(t,"===>newVal"),(!h&&t&&!Le(t)||h&&t&&h.address!==t.address)&&(console.log("池子信息"),f(t,!h||t.address!==h.address))},{immediate:!0}),Ft(()=>{tt.value=[]}),Ie(()=>[n.value,a.value,R.value.recommendRangesObj],(t,h)=>{var A,U;console.log(t,"===>newValue369"),console.log(h,"===>oldValue369"),(!h||t[0]&&t[1]&&t[2]&&!Le(t[0])&&!Le(t[1]&&!Le(t[2]))||((A=t[0])==null?void 0:A.address)!==((U=h[0])==null?void 0:U.address))&&t[0]&&t[2]&&!Le(t[0])&&!Le(t[2])&&(console.log(t[0],t[2],"======>374"),E.setSinglePool(t[0],t[2],he.value))},{immediate:!0,deep:!0});const Q=t=>{if(he.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},ne=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},me=t=>{var A,U;const h=R.value.poolPriceConfigObj&&R.value.poolPriceConfigObj[(A=a.value)==null?void 0:A.address]&&R.value.poolPriceConfigObj[(U=a.value)==null?void 0:U.address].type||"";if(console.log(h,t,"==>poolType"),h=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}},g=D(1),q=()=>{const t=g.value/2;g.value=t},F=()=>{const t=g.value*2;g.value=t};console.log(l.value,"==>priceTablList");const T=I(()=>{var t,h,A;return!a.value||Le(j.value.addressHistTokens)||!j.value.addressHistTokens[(t=a.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((A=j.value.addressHistTokens[(h=a.value)==null?void 0:h.poolAddress])==null?void 0:A.data.map(U=>[U.key,U.value]))}),_=D(30),W=D("30D"),O=I(()=>Oe.value?T.value&&Se(_.value==7?T.value.before_7_d_contract_price_lowest:_.value==24?T.value.before_24_h_contract_price_lowest:T.value.before_30_d_contract_price_lowest,6)||0:T.value&&Se(new s(1).div(_.value==7?T.value.before_7_d_contract_price_highest:_.value==24?T.value.before_24_h_contract_price_highest:T.value.before_30_d_contract_price_highest).toString(),6)||0),H=I(()=>Oe.value?T.value&&Se(_.value==7?T.value.before_7_d_contract_price_highest:_.value==24?T.value.before_24_h_contract_price_highest:T.value.before_30_d_contract_price_highest,6)||0:(T.value&&Se(1/Number(_.value==7?T.value.before_7_d_contract_price_lowest:_.value==24?T.value.before_24_h_contract_price_lowest:T.value.before_30_d_contract_price_lowest),6))==1/0?0:T.value&&Se(1/Number(_.value==7?T.value.before_7_d_contract_price_lowest:_.value==24?T.value.before_24_h_contract_price_lowest:T.value.before_30_d_contract_price_lowest),6)||0),$=I(()=>{const t=Number(x.value),h=Number(M.value);if(x.value==M.value)return"--";if(x.value&&M.value&&x.value!=="0"&&M.value!=="∞"){const A=bt(1/(1-Number((t/h)**.25)),2);return Number(A)>0?A+"x":"--"}else return 1}),Me=I(()=>{var t,h,A,U,ie,ge;return((t=P.value)==null?void 0:t.isSelfBuilt)||((h=k.value)==null?void 0:h.isSelfBuilt)||((U=R.value.tokensObj[(A=P.value)==null?void 0:A.address])==null?void 0:U.isSelfBuilt)||((ge=R.value.tokensObj[(ie=k.value)==null?void 0:ie.address])==null?void 0:ge.isSelfBuilt)}),S=t=>{console.log(t,"####0731 priceRangeChangeMin"),t!==x.value&&te.value=="full range"?(console.log(l.value,"===>priceTablList"),v({key:"custom",...l.value.custom})):te.value!=="full range"&&te.value!=="custom"?(te.value="custom",x.value=t):x.value=t},re=t=>{console.log(t,"###priceRangeChangeMax maxPirce"),t!==M.value&&te.value=="full range"?v({key:"custom",...l.value.custom}):te.value!=="full range"&&te.value!=="custom"?(te.value="custom",t=="0"?M.value="∞":M.value=t):t=="0"?M.value="∞":M.value=t};return console.log(x.value,M.value,"683==>"),Ie(()=>[x.value,M.value],([t,h])=>{console.log(t,h,"minmax new-liquidity-left")},{deep:!0,immediate:!0}),{positionError:Qe,getCoinIcon:t=>{var h;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((h=R.value.tokensObj[t==null?void 0:t.address])==null?void 0:h.logo_url)||(j.value.theme==="default"?yt("/image/coins/unknown.png"):yt("/image/coins/sui-unknown.png"))},chainName:he,store:j,currentTab:fe,currentPrice:st,currentPriceReverse:_t,fromCoin:P,toCoin:k,direction:Oe,needReverse:X,addCommom:Ue,decimalUi:Se,priceTablList:l,currentPriceTab:te,sliderStyle:me,poolInfo:a,tickList:tt,getPriceTabImage:Q,getPriceTabText:ne,defaultMinPrice:ft,defaultMaxPrice:gt,minPrice:x,maxPrice:M,currentTick:K,chartLoading:ee,zoomOut:q,zoomIn:F,zoom:g,priceTab:v,before7dContractPriceLowest:O,before7dContractPriceHighest:H,aprRewardsTime:W,lever:$,aprRewardsParameter:_,isSelfBuilt:Me,priceRangeChangeMin:S,priceRangeChangeMax:re,toggle:Ht,getPirceTabTips:t=>{switch(t){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}}}}});const zo={class:"new-liquidity-left"},Eo=i("span",{class:"selectRange"},"Select Range",-1),Ho={class:"price-info"},xo={class:"left"},Xo={class:"base-coin"},Wo={class:"base-coin-title"},Do=i("span",null,"Base coin",-1),Zo=i("svg",{class:"icon icon-up","aria-hidden":"true"},[i("use",{"xlink:href":"#icon-exchange_up1"})],-1),Go=i("svg",{class:"icon icon-down","aria-hidden":"true"},[i("use",{"xlink:href":"#icon-exchange_down1"})],-1),Ko=[Zo,Go],Jo={class:"base-coin-bottom"},Qo={alt:""},Yo={class:"current-price"},Vo=i("div",{class:"current-price-title"},"Current Price",-1),er={key:0,class:"from-pre-to"},tr={class:"right"},or={class:"price-range"},rr={class:"left"},ar={class:"price-slider"},nr={class:"slider"},ir=i("div",{class:"slider-ratio-content"},null,-1),lr=[ir],sr={class:"price-tab-list"},ur=["onClick"],cr=["src"],dr={class:"right"},mr={class:"price-zoom"},vr={class:"current-price"},fr=i("div",{class:"current-price-title"},"Current Price",-1),gr={key:0,class:"from-pre-to"},pr={class:"price-zoom-right"},br={class:"leverage"},hr={class:"left"},wr={key:0,class:"leverage-title"},kr={key:1,class:"laverage-value"},yr={class:"right"},_r={key:0,class:"day-7-price-range"},Cr=i("i",null,null,-1),Pr={class:"gray"},Tr={class:"apr-leverage"},Sr={class:"leverage"},Nr=i("div",{class:"leverage-title"},"Leverage",-1),Ar={class:"laverage-value"},Ir={key:0,class:"position-tips"},Lr=["src"],Mr={class:"error"};function qr(e,m,fe,z,j,he){var X,ee,f,l,K,r,b,u;const E=Yt,R=xt,y=Tt,G=Xt,n=jt,a=Qt("image");return L(),Z("div",zo,[Eo,i("div",Ho,[i("div",xo,[i("div",Xo,[i("div",Wo,[Do,i("div",{class:"change-price",onClick:m[0]||(m[0]=(...v)=>e.toggle&&e.toggle(...v))},Ko)]),i("div",Jo,[Pt(i("img",Qo,null,512),[[a,e.getCoinIcon(e.fromCoin)]]),i("span",null,ue((X=e.fromCoin)==null?void 0:X.symbol),1)])]),i("div",Yo,[Vo,i("div",null,[i("span",null,ue(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(L(),Z("span",er,ue((ee=e.toCoin)==null?void 0:ee.symbol)+" per "+ue((f=e.fromCoin)==null?void 0:f.symbol),1)):V("",!0)])])]),i("div",tr,[e.currentTab=="liquidity"?(L(),Z("div",{key:0,class:"zoom-out",onClick:m[1]||(m[1]=(...v)=>e.zoomOut&&e.zoomOut(...v))}," + ")):V("",!0),e.currentTab=="liquidity"?(L(),Z("div",{key:1,class:"zoom-in",onClick:m[2]||(m[2]=(...v)=>e.zoomIn&&e.zoomIn(...v))}," - ")):V("",!0)])]),i("div",or,[i("div",rr,[i("div",ar,[i("div",nr,[i("div",{class:"slider-ratio",style:ht(e.sliderStyle(e.currentPriceTab))},lr,4)])]),i("div",sr,[(L(!0),Z(rt,null,wt(e.priceTablList,v=>(L(),Z("div",{key:v.key,class:ot(["price-tab-item",e.currentPriceTab==v.key?"price-tab-item-active":""]),onClick:B=>e.priceTab(v)},[Ee(E,{placement:"bottom","arrow-point-at-center":""},{title:kt(()=>[ct(ue(e.getPirceTabTips(v.key)),1)]),default:kt(()=>[i("img",{src:e.getPriceTabImage(v.key),alt:""},null,8,cr),i("span",null,ue(e.getPriceTabText(v.key)),1)]),_:2},1024)],10,ur))),128))])]),i("div",dr,[i("div",mr,[i("div",vr,[fr,i("div",null,[i("span",null,ue(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(L(),Z("span",gr,ue(e.direction&&!e.needReverse?`${(l=e.fromCoin)==null?void 0:l.symbol} per ${(K=e.toCoin)==null?void 0:K.symbol}`:`${(r=e.toCoin)==null?void 0:r.symbol} per ${(b=e.fromCoin)==null?void 0:b.symbol}`),1)):V("",!0)])]),i("div",pr,[e.currentTab=="liquidity"?(L(),Z("div",{key:0,class:"zoom-out",onClick:m[3]||(m[3]=(...v)=>e.zoomOut&&e.zoomOut(...v))}," + ")):V("",!0),e.currentTab=="liquidity"?(L(),Z("div",{key:1,class:"zoom-in",onClick:m[4]||(m[4]=(...v)=>e.zoomIn&&e.zoomIn(...v))}," - ")):V("",!0)])]),e.fromCoin&&e.toCoin&&e.poolInfo&&e.currentTab=="liquidity"?(L(),Ge(R,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):V("",!0),((u=e.tickList)==null?void 0:u.length)<=0&&e.chartLoading?(L(),Ge(y,{key:1})):V("",!0)])]),i("div",br,[i("div",hr,[e.currentPriceTab!=="full range"?(L(),Z("div",wr,"Leverage")):V("",!0),e.currentPriceTab!=="full range"?(L(),Z("div",kr,ue(e.lever),1)):V("",!0)]),i("div",yr,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(L(),Z("div",_r,[Cr,i("span",Pr,ue(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),i("span",null,ue(("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.before7dContractPriceLowest,6)))+" - "+ue(("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.before7dContractPriceHighest,6))),1)])):V("",!0)])]),i("div",{class:ot(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[i("div",Tr,[i("div",Sr,[Nr,i("div",Ar,ue(e.lever),1)]),Ee(G,{"apr-rewards-parameter":e.aprRewardsParameter,"name-tab":"deposit","from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,onChangeAprRewardsParameter:m[5]||(m[5]=v=>{e.aprRewardsParameter=v})},null,8,["apr-rewards-parameter","from-coin","to-coin","pool-info","min-price","max-price"])]),Ee(n,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(L(),Z("div",Ir,[i("img",{src:("importIcon"in e?e.importIcon:Te(yt))("/image/icon-tips-error@2x.png"),alt:""},null,8,Lr),i("p",Mr,ue(e.$t("tips.positionError")),1)])):V("",!0)],2)])}const Wt=nt(Uo,[["render",qr]]),$r=at({components:{NewLiquidityTitle:Ut,NewLiquidityAssetsCard:zt,NewLiquidityDepositRatio:Et},setup(){const{t:e,locale:m}=Bt(),fe=dt(),z=I(()=>fe),j=I(()=>z.value.chainName),he=Ct(),E=I(()=>he),R=io(),y=I(()=>R),G=St(),n=I(()=>{let o=null;for(const p in E.value.poolsObj){const w=E.value.poolsObj[p];w.address==G.query.poolAddress&&(console.log(w,"p===>"),o=w)}return o}),a=D(!1),X=D(!1),ee=I(()=>z.value.theme),f=async(o,p)=>{P.value=o.needReverse?o.token_b:o.token_a,k.value=o.needReverse?o.token_a:o.token_b,C.value="",N.value=""};Ie(()=>n.value,(o,p)=>{console.log(p,"===>oldVal"),console.log(o,"===>newVal"),(!p&&o&&!Le(o)||p&&o&&p.address!==o.address)&&(console.log("池子信息"),f(o,!p||o.address!==p.address))},{immediate:!0});const l=I(()=>y.value.assets&&P.value&&y.value.assets[P.value.address]?At(y.value.assets[P.value.address].balance,P.value.decimals):"0"),K=I(()=>y.value.assets&&k.value&&y.value.assets[k.value.address]?At(y.value.assets[k.value.address].balance,k.value.decimals):"0"),r=o=>{o==="fromCoin"?(Pe.value=!0,j.value==="Aptos"?C.value=Number(l.value)>0?P.value.symbol=="APT"?new s(Number(l.value)).sub(new s(.1)).lt(new s(0))?"0":new s(Number(l.value)).sub(new s(.1)).toString():String(l.value):"":C.value=Number(l.value)>0?P.value.symbol=="SUI"?new s(Number(l.value)).sub(new s(.05)).lt(new s(0))?"0":new s(Number(l.value)).sub(new s(.05)).toString():String(l.value):""):(Pe.value=!1,j.value==="Aptos"?N.value=Number(K.value)>0?k.value.symbol=="APT"?new s(Number(K.value)).sub(new s(.1)).lt(new s(0))?"0":new s(Number(K.value)).sub(new s(.1)).toString():String(K.value):"":N.value=Number(K.value)>0?k.value.symbol=="SUI"?new s(Number(K.value)).sub(new s(.05)).lt(new s(0))?"0":new s(Number(K.value)).sub(new s(.05)).toString():String(K.value):"")},b=o=>{o==="fromCoin"?(Pe.value=!0,C.value=Number(l.value)>0?bt(new s(Number(l.value)).div(2).toString(),P.value.decimals).toString():""):(Pe.value=!1,N.value=Number(K.value)>0?bt(new s(Number(K.value)).div(2).toString(),k.value.decimals).toString():"")},u=D(),v=D(),B=D(),Q=D(!1),ne=o=>{var p,w,ce,J;u.value=o,o==="fromCoin"?(v.value=((p=k.value)==null?void 0:p.address)||"",B.value=G.query.actions=="new-position"?(w=P.value)==null?void 0:w.address:n.value.needReverse?n.value.token_b.address:n.value.token_a.address):(v.value=((ce=P.value)==null?void 0:ce.address)||"",B.value=G.query.actions=="new-position"?(J=k.value)==null?void 0:J.address:n.value.needReverse?n.value.token_a.address:n.value.token_b.address),Q.value=!0,console.log(Q.value,"==>showCoinSelect.value ")},me=o=>{var ce,J,de,ve,se,ae,oe,ke;const p=n.value.needReverse?n.value.token_b:n.value.token_a,w=n.value.needReverse?n.value.token_a:n.value.token_b;u.value==="fromCoin"?(((ce=P.value)==null?void 0:ce.address)===(p==null?void 0:p.address)||!((J=P.value)!=null&&J.address)?(k.value&&o.address.toLowerCase()===((de=k)==null?void 0:de.value.address.toLowerCase())&&(k.value=null),P.value=o):(P.value&&o.address.toLowerCase()===((ve=P)==null?void 0:ve.value.address.toLowerCase())&&(P.value=null),k.value=o),G.query.action||(G.query.fee="")):((se=k.value)==null?void 0:se.address)===(w==null?void 0:w.address)||!((ae=k.value)!=null&&ae.address)?(P.value&&o.address.toLowerCase()===((oe=P)==null?void 0:oe.value.address.toLowerCase())&&(P.value=null),k.value=o):(k.value&&o.address.toLowerCase()===((ke=k)==null?void 0:ke.value.address.toLowerCase())&&(k.value=null),P.value=o),Q.value=!1},g=I(()=>z.value.chainName?ut(z.value.chainName):{}),q=I(()=>z.value.slippage),F=D(),T=async()=>{var je,Ae,$e,Re;if(Xe.value)return console.log("跳出"),!1;if(!x.value&&!M.value)return!1;if(!C.value&&!N.value&&!x.value&&!M.value)return;const o=n.value||{};if(Le(o))return;const{TickUtil:p,TickMath:w,getNearestTickByTick:ce}=g.value,J=o==null?void 0:o.token_a.decimals,de=o==null?void 0:o.token_b.decimals;let ve,se,ae,oe,ke,Ne,We,Ze,ye=o==null?void 0:o.current_tick_index,Y;if(o.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===k.value.address.toLowerCase()?Y=!0:Y=!1,x.value==="0"&&M.value==="∞")ae=p.getMinIndex(Number(o.tickSpacing)),oe=p.getMaxIndex(Number(o.tickSpacing)),ke=w.tickIndexToSqrtPriceX64(ae),Ne=w.tickIndexToSqrtPriceX64(oe),console.log(ae,oe,"#######updateAmounts 513");else if(te.value=="custom"){console.log(Y,"===>directs1866"),Y?(ve=Number(x.value),se=Number(M.value)):(ve=M.value!=="∞"?new s(1).div(M.value).toString():1/0,se=new s(1).div(x.value).toString());try{We=ve==0?-443636:w.priceToTickIndex(new s(ve),J,de)}catch{We=-443636}try{Ze=w.priceToTickIndex(new s(se),J,de)}catch{Ze=443636}ae=ce(We,Number(o.tickSpacing)),oe=ce(Ze,Number(o.tickSpacing));try{ke=w.priceToSqrtPriceX64(new s(ve),J,de)}catch{(se===1/0||se==="∞")&&(ke=w.tickIndexToSqrtPriceX64(p.getMinIndex(Number(o.tickSpacing))))}try{Ne=w.priceToSqrtPriceX64(new s(se),J,de)}catch{console.log("0523###test###max###",se),(se===1/0||se==="∞")&&(console.log("0523###test###max###11111"),Ne=w.tickIndexToSqrtPriceX64(p.getMaxIndex(Number(o.tickSpacing))))}console.log("0518###pre###tick_lower###",ae,oe,ye),console.log("0518###pre###tick_upper###",oe)}else ae=(je=Ke.value[te.value])==null?void 0:je.lower,oe=(Ae=Ke.value[te.value])==null?void 0:Ae.upper,ke=w.tickIndexToSqrtPriceX64(ae),Ne=w.tickIndexToSqrtPriceX64(oe);if(M.value!=="∞"&&ae>=oe){a.value=!0,C.value="",X.value=!0,N.value="";return}if(console.log(oe,ye,ae,"1922"),M.value==="∞"||ye>=ae&&ye<=oe){a.value=!1,X.value=!1;let _e;if(C.value||N.value){if(Pe.value){const vt=new s(C.value).mul(Math.pow(10,P.value.decimals)).toString();_e=new ze(vt)}else{const vt=new s(N.value).mul(Math.pow(10,k.value.decimals)).toString();_e=new ze(vt)}console.log(Y,"======>directs");const{liquidityAmount:xe,tokenMaxA:Ve,tokenMaxB:et,tokenMaxAOrigin:Zt,tokenMaxBOrigin:Gt}=g.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:ae,upperTick:oe,coinAmount:_e,iscoinA:Y?Pe.value:!Pe.value,roundUp:!0,slippage:Number(q.value)/100,curSqrtPrice:new ze(o.current_sqrt_price)});F.value={liquidityAmount:xe,tokenMaxA:Ve,tokenMaxB:et,tokenMaxAOrigin:Zt,tokenMaxBOrigin:Gt},console.log(Ve,et,"preAdd"),Y?Pe.value?N.value=Number(et)>0?et:"":C.value=Number(Ve)>0?Ve:"":Pe.value?N.value=Ve:C.value=et}}else if(ye>oe){if(Y?C.value="":N.value="",a.value=Y,X.value=!Y,C.value||N.value){let _e;if(Y){const xe=new s(N.value).mul(Math.pow(10,($e=k.value)==null?void 0:$e.decimals)).toString();_e=new ze(xe),F.value={liquidityAmount:g.value.estimateLiquidityForCoinB(ke,Ne,_e),tokenMaxA:0,tokenMaxB:N.value}}else{const xe=new s(C.value).mul(Math.pow(10,(Re=P.value)==null?void 0:Re.decimals)).toString();_e=new ze(xe),F.value={liquidityAmount:g.value.estimateLiquidityForCoinB(ke,Ne,_e),tokenMaxA:0,tokenMaxB:C.value}}}}else if(ye<ae){if(a.value=!Y,X.value=Y,Y?N.value="":C.value="",C.value||N.value){let _e;if(Y){const xe=new s(C.value).mul(Math.pow(10,P.value.decimals)).toString();_e=new ze(xe),F.value={liquidityAmount:g.value.estimateLiquidityForCoinA(ke,Ne,_e),tokenMaxA:C.value,tokenMaxB:0}}else{const xe=new s(N.value).mul(Math.pow(10,k.value.decimals)).toString();_e=new ze(xe),F.value={liquidityAmount:g.value.estimateLiquidityForCoinA(ke,Ne,_e),tokenMaxA:N.value,tokenMaxB:0}}}}else a.value=!0,C.value="",X.value=!0,N.value=""};Ie(C,(o,p)=>{console.log(C,"===>fromCoinAmount"),o==""&&Pe.value&&(N.value=""),o&&Pe.value&&!Xe.value&&T()}),Ie(N,(o,p)=>{console.log(o,"===>>>>newValsda"),o==""&&!Pe.value&&(C.value=""),o&&!Pe.value&&!Xe.value&&T()});const _=D("--"),W=I(()=>E.value.RATES),O=()=>{const o=W.value&&W.value[P.value.address]&&W.value[P.value.address].price,p=W.value&&W.value[k.value.address]&&W.value[k.value.address].price;if(o&&p){const w=new s(C.value>0?C.value:0).mul(o),ce=new s(N.value>0?N.value:0).mul(p),J=w.add(ce).toNumber();_.value=J>0&&J<.01?"$<0.01":"$"+Ue(J,2)}else _.value="--"};Ie(()=>[C.value,N.value,Xe.value],([o,p,w])=>{(o||p)&&!w?O():(!o||!p)&&!w&&(_.value="--")},{immediate:!0}),Ie(()=>_,o=>{console.log(o,"71911111")},{immediate:!0});const H=D(),$=async()=>{var Y,je;if(!x.value&&!M.value)return!1;if(!C.value&&!N.value&&!x.value&&!M.value)return;const o=n.value;if(Le(o))return;const{TickUtil:p,TickMath:w,getNearestTickByTick:ce}=g.value,J=o==null?void 0:o.token_a.decimals,de=o==null?void 0:o.token_b.decimals;let ve,se,ae,oe,ke,Ne,We;if(o.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===k.value.address.toLowerCase()?We=!0:We=!1,x.value==="0"&&M.value==="∞")ae=p.getMinIndex(Number(o.tickSpacing)),oe=p.getMaxIndex(Number(o.tickSpacing));else if(te.value=="custom"){We?(ve=Number(x.value),se=Number(M.value)):(ve=new s(1).div(M.value).toString(),se=new s(1).div(x.value).toString());try{ke=ve==0?-443636:w.priceToTickIndex(new s(ve),J,de)}catch{ke=-443636}try{Ne=w.priceToTickIndex(new s(se),J,de)}catch{Ne=443636}ae=ce(ke,Number(o.tickSpacing)),oe=ce(Ne,Number(o.tickSpacing))}else ae=(Y=Ke.value[te.value])==null?void 0:Y.lower,oe=(je=Ke.value[te.value])==null?void 0:je.upper;const Ze=W.value[o==null?void 0:o.token_a.address].price,ye=W.value[o==null?void 0:o.token_b.address].price;Oe.value?new ze(o.current_sqrt_price):new ze(1/o.current_sqrt_price),console.log(Oe.value,"===>direction.value"),console.log(o,"poolInfos===>"),console.log(ae,oe,"####tick_lower tick_upper 889"),console.log(_.value,"liquidityTotalAmount.value");try{const{amountA:Ae,amountB:$e,tokenAmountsInfo:Re}=await g.value.estCoinAmountsFromTotalAmount({lowerTick:ae,upperTick:oe,decimalsA:J,decimalsB:de,curSqrtPrice:new ze(o.current_sqrt_price),totalAmount:_.value.replace(/[^\d.]/g,""),tokenPriceA:Ze,tokenPriceB:ye});console.log(Ae,$e,"###estCoinAmountsFromTotalAmount 844"),console.log(o.needReverse,Oe.value,"===>849"),H.value=Re,o.needReverse?Oe.value?(C.value=Ae,N.value=$e):(C.value=$e,N.value=Ae):(C.value=Ae,N.value=$e)}catch(Ae){console.log(Ae,"e===>")}};Ie([x,M],([o,p])=>{console.log(o,p,"==>minPrice,maxPrice"),Xe.value?Xe.value&&$():T(),p!=="∞"&&Number(o)!==0&&Number(p)!==0&&Number(o)>=Number(p)?Qe.value=!0:Qe.value=!1,Number(o)==0&&Number(p)==0&&st.value&&(Qe.value=!0,console.log("价格区间错误"))},{deep:!0,immediate:!0});const Me=o=>{console.log(o,"e");const p=o.replace(/[^\d.]/g,""),w="$"+Ue(p);Xe.value=!0,_.value=w,p>0?$():(C.value="",N.value="")},S=D(!1),{setTransactionTxid:re,setTransactionDesc:Je,setIsShowWaiting:qe,setIsShowSuccess:t,setPositiomNum:h,setIsShowRejected:A}=fe,U=fo(),ie=I(()=>E.value.currentPositionInfo),ge=D(!1),le=async o=>{var ke,Ne,We,Ze;console.log(n.value,"===> poolInfo.value"),S.value=!1,E.value.currentPositionInfo={},re(""),Je(e("tips.increaseLiquiditySuccess",{from:a.value?"":`${C.value} ${(ke=P.value)==null?void 0:ke.symbol}`,and:!a.value&&!X.value?"and":"",to:X.value?"":`${N.value} ${(Ne=k.value)==null?void 0:Ne.symbol}`})),qe(!0);const p=Oe.value?Pe.value:!Pe.value;let w,ce,J,de,ve,se;const ae=n.value.token_a.decimals,oe=n.value.token_b.decimals;if(x.value==="0"&&M.value==="∞")J=g.value.TickUtil.getMinIndex(Number(n.value.tickSpacing)),de=g.value.TickUtil.getMaxIndex(Number(n.value.tickSpacing));else if(te.value=="custom"){Oe.value?(w=Number(x.value),ce=Number(M.value)):(w=new s(1).div(M.value).toString(),ce=new s(1).div(x.value).toString()),console.log("0519###toAdd###min###",w),console.log("0519###toAdd###max###",ce),console.log("0519###toAdd###minPrice.value###",x.value),console.log("0519###toAdd###maxPrice.value###",M.value);try{ve=w==0?g.value.TickUtil.getMinIndex(Number(n.value.tickSpacing)):g.value.TickMath.priceToTickIndex(new s(w),ae,oe)}catch{ve=g.value.TickUtil.getMinIndex(Number(n.value.tickSpacing))}try{se=g.value.TickMath.priceToTickIndex(new s(ce),ae,oe)}catch{se=g.value.TickUtil.getMaxIndex(Number(n.value.tickSpacing))}J=g.value.getNearestTickByTick(ve,Number(n.value.tickSpacing)),de=g.value.getNearestTickByTick(se,Number(n.value.tickSpacing))}else J=Ke.value[te.value].lower,de=Ke.value[te.value].upper;console.log(J,de,"####tick_lower tick_upper 889"),console.log(n.value,"==>poolInfo.value.curSqrtPrice");try{let ye;Xe.value?ye=await g.value.getCreateAddLiquidityPayload({pool:n.value,curSqrtPrice:new ze(n.value.current_sqrt_price),tickLower:J,tickUpper:de,slippage:Number(q.value)/100,tokenAmounts:H.value}):ye=await g.value.getAddLiquidityTransactionPayload({pool:{poolAddress:n.value.poolAddress,token_a:n.value.token_a,token_b:n.value.token_b},amount:Pe.value?C.value:N.value,fix_amount_a:p,tick_lower:J,tick_upper:de,index:0,slippage:Number(q.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new ze(n.value.current_sqrt_price)}),console.log(ye,"payload===?");let Y;if(j.value==="Aptos")Y=await y.value.currentWallet.signAndSubmitTransaction(ye);else{const je=await y.value.currentWallet.signAndExecuteTransactionBlock(ye);Y=g.value.handleTx(je)}if(console.log("0410###tx###",Y),Y&&Y.hash){re(Y.hash),qe(!1),t(!0);let je;n.value.needReverse?n.value.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&n.value.token_b.address.toLowerCase()===k.value.address.toLowerCase()?je=!1:je=!0:n.value.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&n.value.token_b.address.toLowerCase()===k.value.address.toLowerCase()?je=!0:je=!1,console.log(je,"===>directs");const Ae={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:a.value?"":`${C.value} ${(We=P.value)==null?void 0:We.symbol}`,and:!a.value&&!X.value?"and":"",to:X.value?"":`${N.value} ${(Ze=k.value)==null?void 0:Ze.symbol}`}),hash:Y.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};j.value!=="Aptos"&&(Ae.res=Y.res),g.value.showTransitionPending(Ae);const $e=await g.value.watchTransaction(Ae,!0);if($e.status){if(t(!1),E.value.setCurrentPositionLoading(!0),ge.value=!0,console.log($e.nftInfo,"===> watchInfo.nftInfo"),j.value==="Aptos"){if(await E.value.setCurrentPositionInfo($e.nftInfo[0].data.id.creator,$e.nftInfo[0].data.id.collection,$e.nftInfo[0].data.name,j.value),o)try{await U.subscribePosition({pool_address:ie.value.poolAddress,position_index:ie.value.index},ie.value.nftHash)}catch(Re){console.log(Re,"e")}}else{const Re=$e.nftInfo,_e=await It(2e3);if(await E.value.setCurrentPositionInfo(Re==null?void 0:Re.pool,"","",j.value,Re==null?void 0:Re.position),await It(1e3),console.log("0529###nftInfo###",Re),console.log("0529###currentPositionInfo.value.index###",ie.value.index),o)try{await U.subscribePosition({pool_address:ie.value.poolAddress,position_index:ie.value.index},ie.value.nftHash)}catch(xe){console.log(xe)}}setTimeout(()=>{he.updateCurrentPools(n.value.poolAddress,j.value),g.value.getAccount(y.value.address)},3e3),setTimeout(async()=>{Lt(g,n)},3e3)}h()}else qe(!1),A(!0);C.value="",N.value=""}catch(ye){C.value="",N.value="",console.log("0330###Add liquidity Error###",ye),qe(!1),A(!0)}},Be=I(()=>!C.value&&!N.value?(console.log("addLiquidityBtnDisabled11111"),!0):Number(C.value)>Number(l.value)||Number(N.value)>Number(K.value)?(console.log("addLiquidityBtnDisabled22222"),!0):He.value!==e("button.addLiquidity")&&He.value!==e("newAdd.preview")?(console.log("addLiquidityBtnDisabled33333###",He.value),!0):n.value&&n.value&&n.value.is_pause?(console.log("addLiquidityBtnDisabled44444"),!0):Number(C.value)<=0&&Number(N.value)<=0||!a.value&&Number(C.value)==0||!X.value&&Number(N.value)==0),De=I(()=>!P.value||!k.value),He=I(()=>n.value&&n.value.is_pause?"Pool Closed":!P.value||!k.value||De.value?e("modal.selectTokenModalTitle"):Number(C.value)>Number(l.value)?e("button.insufficientBalance",{name:P.value.symbol}):Number(N.value)>Number(K.value)?e("button.insufficientBalance",{name:k.value.symbol}):!Number(C.value)&&!Number(N.value)?e("button.enterAmount"):M.value!=="∞"&&Number(x.value)>=Number(M.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),Ce=D({}),we=D({}),Ye=D(!1),it=(o,p)=>{console.log(u.value,"===>currentCoinKey.value"),console.log(o);const w=localStorage.getItem(o.address);console.log(E.value.tokensObj,"===>pools.value.tokensObj"),console.log(w,"===>coinLocak"),E.value.tokensObj&&E.value.tokensObj[o.address]&&E.value.tokensObj[o.address].isSelfBuilt&&!w&&(p=="fromCoin"&&(Ce.value=o),p=="toCoin"&&(we.value=o),Ye.value=!0)};Ie(()=>[P.value,k.value],([o,p])=>{o&&!Le(o)&&it(o,"fromCoin"),p&&!Le(p)&&it(p,"toCoin")},{immediate:!0});const c=Vt(),d=()=>{j.value!=="Aptos"?c.push("/pool/list"):c.push("/pools")},Fe=o=>{Xe.value,le(o)},pe=()=>{G.query.action!=="create-pool"&&G.query.actions!=="new-position"&&(Lt(g,n),T(),he.updateCurrentPools(n.value.poolAddress,j.value)),he.setPoolConfigList(j.value,z.value.filterCoinsObj)},be=I(()=>{var w,ce,J,de,ve,se;const o=(J=W.value[(ce=(w=P)==null?void 0:w.value)==null?void 0:ce.address])==null?void 0:J.price,p=(se=W.value[(ve=(de=k)==null?void 0:de.value)==null?void 0:ve.address])==null?void 0:se.price;return!!(o&&p)});return Ie(()=>[G,E.value.tokensObj],([o,p])=>{var w;p&&!Le(p)&&(k.value||(k.value=E.value.tokensObj[(w=o==null?void 0:o.query)==null?void 0:w.toCoin]))},{immediate:!0,deep:!0}),{positionError:Qe,decimalUi:Se,poolInfo:n,fromCoinAmount:C,toCoinAmount:N,fromCoin:P,toCoin:k,theme:ee,showFromCoinLock:a,showToCoinLock:X,fromCoinBlance:l,toCoinBlance:K,maxBtnSelect:r,halfBtnSelect:b,fixedFromCoin:Pe,openCoinSelect:ne,currentCoinKey:u,existingCoins:v,lastSelectCoin:B,showCoinSelect:Q,onCoinSelect:me,liquidityTotalAmount:_,toggle:Ht,onInput:Me,isInputTotalAmount:Xe,isViewDetail:ge,addLiquidityBtnDisabled:Be,addLiquidityBtnText:He,isShowTokenWarning:Ye,chainName:j,closeTokenWarning:d,warningFromCoin:Ce,warningToCoin:we,isShowLiquidityModal:S,currentPrice:st,currentPriceReverse:_t,currentPriceTab:te,minPrice:x,maxPrice:M,toAdd:le,direction:Oe,wallet:y,getAddLiquidityType:Fe,clickRefresh:pe,isShowtotalAmount:be}}});const Rr={class:"new-liquidity-right"},Or={class:"deposit-title"},Br={class:"card-container"},Fr={key:0,class:"lock"},jr={class:"card-item"},Ur={class:"card-item"},zr={key:0,class:"total-amount"},Er=i("span",null,"Total Amount",-1);function Hr(e,m,fe,z,j,he){const E=Ut,R=so,y=zt,G=no,n=Et,a=eo,X=co,ee=mo,f=vo;return L(),Z("div",Rr,[i("div",Or,[Ee(E,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),i("div",Br,[e.positionError?(L(),Z("div",Fr,[Ee(R)])):V("",!0),i("div",jr,[Ee(y,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":m[0]||(m[0]=l=>e.fromCoinAmount=l),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:m[1]||(m[1]=l=>e.maxBtnSelect("fromCoin")),onOnHalf:m[2]||(m[2]=l=>e.halfBtnSelect("fromCoin")),onOnInput:m[3]||(m[3]=l=>{e.fromCoinAmount=l,e.fixedFromCoin=!0,e.isInputTotalAmount=!1}),onOnSelect:m[4]||(m[4]=l=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?(L(),Ge(G,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):V("",!0)]),i("div",Ur,[Ee(y,{modelValue:e.toCoinAmount,"onUpdate:modelValue":m[5]||(m[5]=l=>e.toCoinAmount=l),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:m[6]||(m[6]=l=>e.maxBtnSelect("toCoin")),onOnHalf:m[7]||(m[7]=l=>e.halfBtnSelect("toCoin")),onOnInput:m[8]||(m[8]=l=>{e.toCoinAmount=l,e.fixedFromCoin=!1,e.isInputTotalAmount=!1}),onOnSelect:m[9]||(m[9]=l=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?(L(),Ge(G,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):V("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(L(),Z("img",{key:1,class:"add",src:go,alt:"",onClick:m[10]||(m[10]=(...l)=>e.toggle&&e.toggle(...l))})):V("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(L(),Z("img",{key:2,class:"add",src:po,alt:"",onClick:m[11]||(m[11]=(...l)=>e.toggle&&e.toggle(...l))})):V("",!0)]),e.isShowtotalAmount?(L(),Z("div",zr,[Er,i("span",null,ue(e.liquidityTotalAmount)+" ",1)])):V("",!0),Ee(n,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),Ee(a,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:m[12]||(m[12]=l=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:kt(()=>[ct(ue(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(L(),Ge(X,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:m[13]||(m[13]=l=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):V("",!0),e.isViewDetail?(L(),Ge(ee,{key:2,"pool-info":e.poolInfo,onOnClose:m[14]||(m[14]=l=>e.isViewDetail=!1)},null,8,["pool-info"])):V("",!0),e.isShowLiquidityModal?(L(),Ge(f,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:m[15]||(m[15]=l=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):V("",!0)])}const Dt=nt($r,[["render",Hr]]),xr=at({components:{NewLiquidityLeft:Wt,NewLiquidityRight:Dt},setup(){Ft(()=>{uo()});const e=St();return{tickList:tt,route:e}}});const Xr={key:0,class:"loading-spin-liquidity loading-global"},Wr={class:"privide-liquidity"};function Dr(e,m,fe,z,j,he){var G,n;const E=Tt,R=Wt,y=Dt;return L(),Z(rt,null,[!e.tickList&&((n=(G=e.route)==null?void 0:G.query)!=null&&n.poolAddress)?(L(),Z("div",Xr,[Ee(E)])):V("",!0),i("div",Wr,[Ee(R),Ee(y)])],64)}const Na=nt(xr,[["render",Dr],["__scopeId","data-v-9c3e932a"]]);export{Na as default};
