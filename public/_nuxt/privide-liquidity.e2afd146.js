import{a as ut,b as Kt,n as pt,d as Se,u as Ct,e as Ue,c as Ie,i as Jt,s as bt,T as Nt,p as At,f as ze,g as Lt}from"./pool.8cad1b74.js";import{a as rt,r as x,m as L,y as Mt,D as Le,e as at,o as k,f as I,c as Ke,x as te,h as r,t as Pt,G as $t,H as ht,v as ue,u as Te,F as it,J as Tt,p as Rt,k as Ot,z as Ze,s as wt,j as ct,l as Bt,E as St,C as Ft,q as Qt,i as De,w as kt,L as Yt,b as Vt,I as eo,B as to}from"./entry.229d7c21.js";/* empty css              */import{s as lt,m as oo,l as io,b as ro,a as ao,_ as no}from"./transform.87fc3194.js";import{D as s}from"./decimal.0e8aa3f1.js";import{u as dt,a as lo}from"./sha256.48975527.js";import"./decimal.633e31ee.js";import{g as so}from"./common-fun.45e80ee3.js";import{c as jt,_ as Ut,b as zt,a as Dt}from"./new-liquidity-title.8b537fc6.js";import{i as yt}from"./import-icon.de3e6c66.js";/* empty css              */import{positionError as ot,tickList as tt,direction as Oe,minPrice as Z,maxPrice as R,fromCoin as T,toCoin as y,currentPrice as st,currentPriceReverse as _t,currentPriceTab as ee,defaultMinPrice as gt,defaultMaxPrice as ft,toggle as Ht,isInputTotalAmount as Xe,priceConfigObj as Je,fromCoinAmount as P,toCoinAmount as A,fixedFromCoin as Pe,resetTickList as It,resetData as uo}from"./data.e0f33d29.js";import{_ as co}from"./coin-select.dcc277a0.js";import{_ as mo}from"./viewDetail.66e2c3f4.js";import{b as vo}from"./new-add-or-create.3eff2131.js";/* empty css              */import{u as go}from"./notifi.a252e1c3.js";import{_ as fo,a as po}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.27f3dcf3.js";import"./precision.a7a6c57b.js";/* empty css              */import"./tick.505fdad3.js";import"./token-warning.f3e49cac.js";import"./refresh-icon.8b95f3dd.js";/* empty css              */import"./swap-setting.410b218c.js";/* empty css              */import"./img-no-Positions_2x.63e210f4.js";import"./status-block.0223aa04.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.9002b52f.js";import"./index.5148be8d.js";function qt(e,u,ge){const D=new s(10).pow(u-ge);return new s(1.0001).pow(e).mul(D)}const bo=rt({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,u){const ge=x(""),D=x(""),U=L(()=>{var i,b,c,d,F,Q;return console.log(e.poolInfo,"===>props.poolInfo"),(i=e.poolInfo)!=null&&i.current_sqrt_price&&((b=e.poolInfo)!=null&&b.coinA.decimals)&&((c=e.poolInfo)!=null&&c.coinB.decimals)?n.sqrtPriceX64ToPrice((d=e.poolInfo)==null?void 0:d.current_sqrt_price,(F=e.poolInfo)==null?void 0:F.coinA.decimals,(Q=e.poolInfo)==null?void 0:Q.coinB.decimals).toString():"0"}),he=L(()=>{let i=0;return e.direction?i=(Number(e.minPrice)/Number(U.value)-1)*100:i=(Number(e.minPrice)/Number(1/Number(U.value))-1)*100,i=i>0&&i<.1?.1:i,i=i<0&&i>-.1?-.1:i,i}),H=L(()=>{let i=0;return e.direction?i=(Number(e.maxPrice)/Number(U.value)-1)*100:i=(Number(e.maxPrice)/Number(1/Number(U.value))-1)*100,i=i>0&&i<.1?.1:i,i=i<0&&i>-.1?-.1:i,i}),q=dt(),_=L(()=>q),J=L(()=>_.value.chainName?ut(_.value.chainName):{}),{TickMath:n,getNearestTickByTick:a}=J.value,X=(i=[])=>{let b=6;const c=Math.abs(Number(i[0])-Number(i[i.length-1]));return c>=6?b=0:c>=1?b=1:c>=.1?b=2:c>=.01?b=3:c>=.001?b=4:c>=1e-4?b=5:c>=1e-5?b=6:c>=1e-6?b=7:c>=1e-7&&(b=8),b},V=(i,b=1)=>{if(i&&i.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const c=Number(e.poolInfo.current_tick_index);console.log("0117###dataProcessing###currentTick###",c),console.log("0117###dataProcessing###props.poolInfo###",e.poolInfo),console.log("0117###dataProcessing###minPrice###",e.minPrice),console.log("0117###dataProcessing###maxPrice###",e.maxPrice),console.log("0117###dataProcessing###poolInfo###",e.poolInfo);let d=c+100*b,F=c-100*b,Q,ae;if(e.maxPrice==="∞")ae=J.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ae=n.priceToTickIndex(new s(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ae=n.priceToTickIndex(new s(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ae=443636}if(e.minPrice==="0")Q=J.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?Q=n.priceToTickIndex(new s(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):Q=n.priceToTickIndex(new s(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{Q=-443636}let me=0;if(e.currentPriceTab!=="full range"){if(c>=Q&&c<=ae){const N=c-Q,ie=ae-c;me=Math.max(Math.abs(N),Math.abs(ie))}else c<Q?me=Math.abs(ae-c):me=Math.abs(c-Q);d=c+me+100*b,F=c-me-100*b}else{const N=(Math.abs(c)>5e3,2e4);d=c+N*b,F=c-N*b}F<-443636&&(F=-443636),d>443636&&(d=443636);const f=new s(i.liquidity).div(Math.pow(10,8)).toString(),M=e.tickList;console.log("0117####drawChart####tick_info_array####",M);const j=[],S=[];let C={};for(let N=0;N<M.length;N++){if(C=M[N],C.index<=c&&C.index>=F){if(j.length<1&&N!==0){const ie=M[N-1];j.unshift({...ie,index:F,source:"left"})}j.unshift(C)}else if(C.index>c&&C.index<=d&&(S.push(C),j.length<1&&N!==0)){const ie=M[N-1];j.push({...ie,index:F,source:"left"})}if(C.index>d){const ie=M[N];if(S.push({...ie,index:d,source:"right"}),j.length<1&&N!==0){const Qe=M[N-1];j.push({...Qe,index:F,source:"left"})}break}}let W="0";for(let N=j.length-1;N>=0;N--)W=new s(W).plus(new s(j[N].liquidityNet.toString()).div(Math.pow(10,8))).toString(),j[N].liquityAmount=W;let O=f;for(let N=0;N<S.length;N++)O=new s(O).plus(new s(S[N].liquidityNet.toString()).div(Math.pow(10,8))).toString(),S[N].liquityAmount=O;let E=[];const $=M&&M.length>0?{index:c,liquityAmount:Number(f)}:{index:c,liquityAmount:0};(j.length>0||S.length>0)&&(E=[...j.reverse(),$,...S],e.direction||(E=E.reverse()));const qe=[];M.forEach(N=>{qe.push({...N,liquidityGross:N.liquidityGross.toString(),liquidityNet:N.liquidityNet.toString()})}),console.log("0117####drawChart####testTickInfoArray####",qe),console.log("0117####drawChart####currentLiquity####",f),l(E,F,d,Q,ae,c)}};let g=x(!1);Mt(()=>{document.body.clientWidth<750?g.value=!1:g.value=!0,window.onresize=()=>{document.body.clientWidth<750?g.value=!1:g.value=!0,V(e.poolInfo,e.zoom)}});const l=(i,b,c,d,F,Q)=>{console.log("0117####drawChart####chartData####",i),console.log("0117####drawChart####tickMin####",b),console.log("0117####drawChart####tickMax####",c),console.log("0117####drawChart####minPriceTick####",d),console.log("0117####drawChart####maxPriceTick####",F),console.log("0117####drawChart####currentTick####",Q),console.log("0117####drawChart####props.direction####",e.direction),console.log("0518###newd3###props.before7dContractPriceLowest###",e.before7dContractPriceLowest),console.log("0518###newd3###props.before7dContractPriceHighest###",e.before7dContractPriceHighest);let ae,me;e.direction?(ae=e.before7dContractPriceLowest?n.priceToTickIndex(new s(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",me=e.before7dContractPriceHighest?n.priceToTickIndex(new s(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ae=e.before7dContractPriceLowest?n.priceToTickIndex(new s(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",me=e.before7dContractPriceHighest?n.priceToTickIndex(new s(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const f={top:30,right:35,bottom:20,left:55};let M,j;g.value?(M=460-f.left-f.right,j=205-f.top-f.bottom):(M=340-f.left-f.right,j=205-f.top-f.bottom);const S=c-b,C=parseInt(String(S/4));let W=[b+C/4,b+C,b+2*C,c-C,c-C/4];const O=b,E=c,$=M/(E-O);e.currentPriceTab==="full range"&&(W=[b,b+2*C,c]),console.log("0117####drawChart####xArr####",W),console.log("0117####drawChart####utickMin####",O),console.log("0117####drawChart####utickMax####",E),console.log("0117####drawChart####unit####",$);const qe=W.map(m=>e.direction?qt(m,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new s(1).div(qt(m,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),N=X(qe);lt("#chart").selectAll("*").remove();const ie=lt("#chart").attr("width",M+f.left+f.right).attr("height",j+f.top+f.bottom).append("g").attr("transform",`translate(${f.left},${f.right})`),Qe=oo(i,function(m){return Number(Math.abs(m.liquityAmount))})||0,Me=io().range([0,j]).domain([Qe,0]);ro().rangeRound([0,M]).padding(.1);const h=ie.append("g").attr("id","barsBox").selectAll("rect").data(i).enter().append("rect");_.value.theme=="default"?h.attr("x",function(m,v){return v===0?0:e.direction?Math.abs(m.index-O)*$:Math.abs(E-m.index)*$}).attr("y",function(m,v){return e.direction?v===i.length-1?0:Me(m.liquityAmount):v===i.length-1?0:Me(i[v+1].liquityAmount)}).attr("width",function(m,v){return v===0&&i.length===1&&m.liquityAmount>0?M:(e.direction,v!==i.length-1?Math.abs(i[v+1].index-m.index)*$:0)}).attr("height",function(m,v){return v===0&&i.length===1&&m.liquityAmount>0?j:e.direction?v===i.length-1?0:j-Me(m.liquityAmount):v===i.length-1?0:j-Me(i[v+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):h.attr("x",function(m,v){return v===0?0:e.direction?Math.abs(m.index-O)*$:Math.abs(E-m.index)*$}).attr("y",function(m,v){return e.direction?v===i.length-1?0:Me(Math.abs(m.liquityAmount)):v===i.length-1?0:Me(Math.abs(i[v+1].liquityAmount))}).attr("width",function(m,v){return v===0&&i.length===1&&m.liquityAmount>0?M:(e.direction,v!==i.length-1?Math.abs(i[v+1].index-m.index)*$:0)}).attr("height",function(m,v){if(v===0&&i.length===1&&m.liquityAmount>0)return j;if(e.direction)return v===i.length-1?0:Number(m.liquityAmount)?j-Me(Math.abs(m.liquityAmount)):0;{if(v===i.length-1)return 0;const Fe=j-Me(Math.abs(i[v+1].liquityAmount));return Number(i[v+1].liquityAmount)?Fe:0}}).attr("fill",function(m,v){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(m,v){return"#417494"});const B=ie.append("g");B.append("line").attr("x1",0).attr("y1",155).attr("x2",M).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const z=B.append("g");let ne=0;if(e.direction){for(let m=0;m<W.length;m++){const v=Se(qe[m],N)||"0";console.log("0423####price####",v),qe.push(v);const Fe=Math.abs(W[m]-O)*$;let pe=0;for(let be=0;be<v.length;be++)v[be]==="1"?pe+=4.02:v[be]==="."?pe+=2.64:v[be]==="7"?pe+=5.48:pe+=6;console.log(Fe,"x=>>>"),z.append("text").text(v).attr("x",Fe-pe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}ne=Math.abs(Q-O)*$}else{for(let m=W.length-1;m>=0;m--){const v=Se(qe[m],N)||0;qe.push(v);const Fe=Math.abs(W[m]-E)*$;let pe=0;for(let be=0;be<v.length;be++)v[be]==="1"?pe+=4.02:v[be]==="."?pe+=2.64:v[be]==="7"?pe+=5.48:pe+=6;z.append("text").text(v).attr("x",Fe-pe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}ne=Math.abs(Q-E)*$}console.log(Q,E,$,"######currentPricePositon"),(_.value.theme=="default"?ie.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):ie.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+ne+", 0)");let le,Be,xe,He;e.direction?(console.log("0525###d3###select###minPriceTick###",d),console.log("0525###d3###select###maxPriceTick###",F),console.log("0525###d3###select###props.minPrice###",e.minPrice),console.log("0525###d3###select###props.maxPrice###",e.maxPrice),le=d<O?-100:parseInt(String(Math.abs(d-O)*$)),Be=F<O?-100:parseInt(String(Math.abs(F-O)*$)),xe=ae<O?-100:Math.abs(ae-O)*$,He=me<O?-100:Math.abs(me-O)*$):(Be=d<O?-100:Math.abs(E-d)*$,le=F<O?-100:Math.abs(E-F)*$,He=ae<O?-100:Math.abs(E-ae)*$,xe=me<O?-100:Math.abs(E-me)*$),e.minPrice==="0"&&(le=0),e.maxPrice==="∞"&&(Be=M),console.log(le,"==>minPriceTickX"),g.value?ge.value=M-le+87+"px":ge.value=M-le+52+"px",D.value=Be+74+"px",ae&&xe<M&&ie.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+xe+", 0)"),me&&He<M&&ie.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+He+", 0)");const Ce=ie.append("g").attr("id","left-handle"),we=ie.append("g").attr("id","right-handle");_.value.theme=="default"?(Ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),Ce.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),Ce.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),Ce.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),we.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),we.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),we.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),we.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(Ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),Ce.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),Ce.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),Ce.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),we.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),we.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),we.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),we.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),console.log("0525###d3###select###minPriceTickX###",le),console.log("0525###d3###select###maxPriceTickX###",Be),Ce.attr("transform","translate("+le+", 0)"),we.attr("transform","translate("+Be+", 0)");const Ye=ao().extent([[0,0],[M,j]]).handleSize(30).on("end",nt);ie.append("g").attr("class","brush").call(Ye).call(Ye.move,[le,Be]);function nt(m){if(!m.sourceEvent||!m.selection)return;Ce.attr("transform","translate("+m.selection[0]+", 0)"),we.attr("transform","translate("+m.selection[1]+", 0)"),g.value?ge.value=M-m.selection[0]+60+"px":ge.value=M-m.selection[0]+52+"px",D.value=m.selection[1]+74+"px";let v,Fe;console.log("0525###d3###select###e.selection[0]###",m.selection[0]),console.log("0525###d3###select###e.selection[0]###",m.selection[1]),console.log("0525###d3###select###props.direction###",e.direction),console.log("0525###d3###select###width###",M),console.log("0525###d3###select###unit###",$),console.log("0525###d3###select###utickMin###",O),console.log("0525###d3###select###utickMax###",E),console.log("0525###d3###select###props.poolInfo###",e.poolInfo);let pe=0,be=0;e.direction?(pe=a(parseInt(String(m.selection[0]/$+O)),Number(e.poolInfo.tickSpacing)),v=n.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),be=a(parseInt(String(m.selection[1]/$+O)),Number(e.poolInfo.tickSpacing)),Fe=n.tickIndexToPrice(be,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),console.log("0525###d3###select###minTick###",pe),console.log("0525###d3###select###maxTick###",be),console.log("0525###d3###select###minPrice###",v),console.log("0525###d3###select###maxPrice###",Fe)):(be=a(E-m.selection[0]/$,Number(e.poolInfo.tickSpacing)),v=1/n.tickIndexToPrice(be,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),pe=a(E-m.selection[1]/$,Number(e.poolInfo.tickSpacing)),Fe=1/n.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),u.emit("onChangeMinPrice",String(Se(String(v),6))),u.emit("onChangeMaxPrice",String(Se(String(Fe),6)))}_.value.theme=="default"?lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632")};x(""),Le(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom],([i,b,c,d,F])=>{console.log(i,b,c,c>b,"poolInfo && minPrice && maxPrice && (maxPrice > minPrice)"),i&&b&&c&&(i!=null&&i.liquidity)&&(d!=="Custom"||console.log("绘制"),V(i,F))},{immediate:!0});const G=x(!1);return Le(()=>e.chartLoading,(i,b)=>{i!==b&&(G.value=i)},{immediate:!0,deep:!0}),console.log(e,"props===>"),{store:_,loading:G,rangeSizeLower:he,rangeSizeUpper:H,rangeSizeLowerPosition:ge,rangeSizeUpperPosition:D,decimalFormat:Kt,numberformat:pt}}});const ho=e=>(Rt("data-v-b6a3023e"),e=e(),Ot(),e),wo={class:"chart-box"},ko={class:"chart"},yo=ho(()=>r("svg",{id:"chart"},null,-1));function _o(e,u,ge,D,U,he){const H=Tt;return k(),I(it,null,[e.tickList&&e.tickList.length>0&&e.loading?(k(),Ke(H,{key:0})):te("",!0),r("div",wo,[Pt(r("div",ko,[e.currentPriceTab!=="full range"?(k(),I("div",{key:0,class:"range-size range-size-lower",style:ht({right:e.rangeSizeLowerPosition})},ue(("numberformat"in e?e.numberformat:Te(pt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):te("",!0),e.currentPriceTab!=="full range"?(k(),I("div",{key:1,class:"range-size range-size-upper",style:ht({left:e.rangeSizeUpperPosition})},ue(("numberformat"in e?e.numberformat:Te(pt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):te("",!0),yo],512),[[$t,!e.loading]])])],64)}const Et=at(bo,[["render",_o],["__scopeId","data-v-b6a3023e"]]),Co=rt({props:{aprRewardsParameter:{type:Number,default:30},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},fromCoin:{type:Object,default:()=>({})},toCoin:{type:Object,default:()=>({})},poolInfo:{type:Object,default:()=>({})},nameTab:{type:String,default:""}},setup(e){const u=[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}],ge=dt(),D=L(()=>ge);L(()=>D.value.chainName);const U=Ct(),he=L(()=>U),H=L(()=>D.value.chainName?ut(D.value.chainName):{}),q=x(),_=async a=>{var Q,ae,me;console.log("0607###detail###getAprMethod###poolInfo###",a),console.log("0607###detail###getAprMethod###props.fromCoin###",e.fromCoin),console.log("0607###detail###getAprMethod###props.toCoin###",e.toCoin),console.log("0607###detail###getAprMethod###props.nameTab###",e.nameTab);let X;a.token_a.address.toLowerCase()===e.fromCoin.address.toLowerCase()&&a.token_b.address.toLowerCase()===e.toCoin.address.toLowerCase()?X=!0:X=!1,console.log("0607###detail###getAprMethod###directs###",X),console.log("0607###detail###getAprMethod###props.minPrice###",e.minPrice),console.log("0607###detail###getAprMethod###props.maxPrice###",e.maxPrice);let V,g;X?(V=Number(e.minPrice),g=isNaN(Number(e.maxPrice))?2**50:Number(e.maxPrice)):e.maxPrice!=="∞"?(V=1/Number(e.maxPrice),g=1/Number(e.minPrice)):(V=1/2**50,g=2**50),console.log("0607###detail###getAprMethod###lowerUserPrice###",V),console.log("0607###detail###getAprMethod###upperUserPrice###",g);let l=[];l=D.value&&D.value.addressHistTokens&&D.value.addressHistTokens[a.poolAddress]&&D.value.addressHistTokens[a.poolAddress].data&&D.value.addressHistTokens[a.poolAddress].data.length>0&&Object.fromEntries(D.value.addressHistTokens[a.poolAddress].data.map(f=>[f.key,f.value]));let G,i;console.log(l,"===>addressHistTokensList"),e.aprRewardsParameter==7?(G=Number(l==null?void 0:l.before_7_d_contract_price_lowest),i=Number(l==null?void 0:l.before_7_d_contract_price_highest)):e.aprRewardsParameter==24?(G=Number(l==null?void 0:l.before_24_h_contract_price_lowest),i=Number(l==null?void 0:l.before_24_h_contract_price_highest)):(G=Number(l==null?void 0:l.before_30_d_contract_price_lowest),i=Number(l==null?void 0:l.before_30_d_contract_price_highest));const b=he.value.tokensObj;console.log("getEstPositionAPRWithMulti###params###lowerUserPrice###",V),console.log("getEstPositionAPRWithMulti###params###upperUserPrice###",g),console.log("getEstPositionAPRWithMulti###params###lowerHistPrice###",G),console.log("getEstPositionAPRWithMulti###params###upperHistPrice###",i);const c=await H.value.getEstPositionAPRWithMulti(V,g,G,i);console.log("getEstPositionAPRWithMulti###resMulti###",c.toString());const d=D.value.newTopPoolsObj[a.poolAddress];console.log(a,"#####stats");let F;if(d){e.aprRewardsParameter==7?F=Number(d.apr_7day.replace("%","")):e.aprRewardsParameter==24?F=Number(d.apr_24h.replace("%","")):F=Number(d.apr_30day.replace("%",""));const f=Number(d.rewarder_apr[0].replace("%","")),M=Number(d.rewarder_apr[1].replace("%","")),j=Number(d.rewarder_apr[2].replace("%","")),S=new s(c.toString()).mul(F).toNumber();console.log(c.toString(),"===>resMulti.toString()");const C=new s(c.toString()).mul(f).toNumber(),W=new s(c.toString()).mul(M).toNumber(),O=new s(c.toString()).mul(j).toNumber();console.log(C,W,O,"posRewarder2_apr##");const E=S+(a.rewarder_display1?C:0)+(a.rewarder_display2?W:0)+(a.rewarder_display3?O:0);console.log(E,"###aprPercentageTotal");const $=a.rewarder_infos[0]?(Q=b[a.rewarder_infos[0].coinAddress])==null?void 0:Q.symbol:"--",qe=a.rewarder_infos[1]?(ae=b[a.rewarder_infos[1].coinAddress])==null?void 0:ae.symbol:"--",N=a.rewarder_infos[2]?(me=b[a.rewarder_infos[2].coinAddress])==null?void 0:me.symbol:"--",ie={aprFee:S==1/0||isNaN(S)?0:S,rewardAprList:[{rewarder_name:$,rewarder_apr:C==1/0||isNaN(C)?0:C,styleName:"one",rewarder_display:a.rewarder_display1},{rewarder_name:qe,rewarder_apr:W==1/0||isNaN(W)?0:W,styleName:"two",rewarder_display:a.rewarder_display2},{rewarder_name:N,rewarder_apr:O==1/0||isNaN(O)?0:O,styleName:"three",rewarder_display:a.rewarder_display2}],aprPercentageTotal:E==1/0||isNaN(E)||E===0?0:E,aprPercentage:Jt(S/E,2),is_display_rewarder:a.is_display_rewarder};q.value=ie,console.log(q.value,"===>aprPercentageObj.value")}};Le(()=>[e.poolInfo,e.minPrice,e.maxPrice,D.value.addressHistTokens],([a,X,V,g])=>{a&&!Ie(a)&&g&&!Ie(g)&&_(a)},{immediate:!0});const J=L(()=>so(e.poolInfo,he,D));Le(()=>[e.aprRewardsParameter],()=>{_(e.poolInfo)});const n=L(()=>{const a=q.value;return a&&a.is_display_rewarder?(a==null?void 0:a.aprPercentageTotal)>1e4?">10000":a.aprPercentageTotal<.01&&a.aprPercentageTotal>0?"<0.01":Ue(a.aprPercentageTotal,2):a&&!a.is_display_rewarder?(a==null?void 0:a.aprFee)>1e4?">10000":a.aprFee<.01&&a.aprFee>0?"<0.01":Ue(a.aprFee,2):"--"});return{poolMoreInfo:J,timeList:u,aprPercentageObj:q,totalApr:n}}}),Po=""+globalThis.__publicAssetsURL("sui-image/farming.png");const mt=e=>(Rt("data-v-961e8ef0"),e=e(),Ot(),e),To={class:"est-apr"},So=mt(()=>r("div",{class:"title"},"Estimated APR",-1)),No={class:"apr-total"},Ao={class:"apr-box"},Lo={key:0,class:"apr-hover-content"},Io={class:"progress-fees progress-all"},qo=mt(()=>r("div",null,[r("div",{class:"light-hint"}),ct(" Fees ")],-1)),Mo={key:0,class:"isFarming"},$o=mt(()=>r("img",{src:Po,alt:""},null,-1)),Ro=mt(()=>r("div",{class:"hover-text"},"Farming rewards available",-1)),Oo=[$o,Ro],Bo={class:"time-list"},Fo=["onClick"];function jo(e,u,ge,D,U,he){var H,q,_,J,n,a,X,V;return k(),I("div",To,[So,r("div",No,[r("div",Ao,[r("span",{class:Ze(e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?"haveBorder":"")},ue(e.totalApr)+"%",3),e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?(k(),I("div",Lo,[r("div",Io,[qo,r("span",null,"  "+ue(Number((H=e.aprPercentageObj)==null?void 0:H.aprFee)==0?0:(q=e.aprPercentageObj)!=null&&q.aprFee?((_=e.aprPercentageObj)==null?void 0:_.aprFee)>1e4?">10,000":((J=e.aprPercentageObj)==null?void 0:J.aprFee)<.01?"<0.01":("addCommom"in e?e.addCommom:Te(Ue))((n=e.aprPercentageObj)==null?void 0:n.aprFee,2):(a=e.aprPercentageObj)!=null&&a.rewardAprList?"<0.01":"--")+"%",1)]),(k(!0),I(it,null,wt((X=e.aprPercentageObj)==null?void 0:X.rewardAprList,g=>Pt((k(),I("div",{key:g,class:"progress-rewards progress-all"},[r("div",null,[r("div",{class:Ze(["light-hint",g==null?void 0:g.styleName])},null,2),ct(" "+ue(g==null?void 0:g.rewarder_name)+" Rewards ",1)]),r("span",null,"  "+ue(g!=null&&g.rewarder_apr?(g==null?void 0:g.rewarder_apr)>1e4?">10,000":(g==null?void 0:g.rewarder_apr)<.01?"<0.01":("addCommom"in e?e.addCommom:Te(Ue))(g==null?void 0:g.rewarder_apr,2):"0")+"%",1)])),[[$t,(g==null?void 0:g.rewarder_name)!="--"&&g.rewarder_display&&e.aprPercentageObj.is_display_rewarder]])),128))])):te("",!0)]),(V=e.poolInfo)!=null&&V.is_display_rewarder&&e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?(k(),I("div",Mo,Oo)):te("",!0)]),r("div",Bo,[(k(!0),I(it,null,wt(e.timeList,g=>(k(),I("div",{key:g.value,class:Ze(["time-item",g.value==e.aprRewardsParameter?"time-item-active":""]),onClick:l=>e.$emit("changeAprRewardsParameter",g.value)},ue(g.label),11,Fo))),128))])])}const Xt=at(Co,[["render",jo],["__scopeId","data-v-961e8ef0"]]),Uo=rt({components:{NewLiquidityD3Chart:Et,NewLiquidityApr:Xt,NewLiquidityPrice:jt},setup(){const{t:e,locale:u}=Bt(),ge=x("liquidity"),D=dt(),U=L(()=>D),he=L(()=>U.value.chainName),H=Ct(),q=L(()=>H),_=L(()=>U.value.chainName?ut(U.value.chainName):{});Mt(()=>{ot.value=!1});const J=St(),n=L(()=>{let t=null;for(let h=0;h<q.value.poolConfigList.length;h++){const B=q.value.poolConfigList[h];B.address==J.query.poolAddress&&(t=B)}return console.log(t,"===>basePoolInfo"),t}),a=L(()=>{let t=null;for(const h in q.value.poolsObj){const B=q.value.poolsObj[h];B.address==J.query.poolAddress&&(console.log(B,"p===>"),t=B)}return t}),X=x(),V=x(!0),g=async(t,h)=>{if(h){V.value=!0;const B=t.token_a.decimals,z=t.token_b.decimals;console.log(t,"pool===>1111"),st.value=Nt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,B,z).toString(),_t.value=new s(1).div(Nt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,B,z)).toString(),T.value=t.needReverse?t.token_b:t.token_a,y.value=t.needReverse?t.token_a:t.token_b,X.value=t.needReverse,t.token_a.address.toLowerCase()===T.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===y.value.address.toLowerCase()?Oe.value=!0:Oe.value=!1,console.log(t,"187===>"),console.log(t,"###pool===>");let ne={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const fe=await _.value.getTicks(ne);tt.value=fe?_.value.getTickDataFromUrlData(fe):[],console.log(tt.value,"===>chartLoadingtickList.value"),i(t)}V.value=!1,console.log(V.value,"==>chartLoading.value")},l=x([]),G=x(),i=t=>{const h=t.token_a.decimals,B=t.token_b.decimals;let z=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[t.address]&&q.value.poolPriceConfigObj[t.address].recommend_ranges||{};const ne=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[t.address]&&q.value.poolPriceConfigObj[t.address].type||"";console.log(z,"===>priceConfigList");let fe,le;const Be=t.current_tick_index;G.value=t.current_tick_index,console.log(Be,t.tickSpacing,"==>pool.tickSpacing"),fe=Be-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),le=Be+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const xe=_.value.TickMath.tickIndexToPrice(fe,h,B).toString(),He=_.value.TickMath.tickIndexToPrice(le,h,B).toString();z["full range"]={lower:_.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)),upper:_.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing))},z.custom={lower:fe,upper:le,minPrice:xe,maxPrice:He};const Ce=[];for(let we in z)z[we]&&(console.log(we,"j==>"),Ce.push({...z[we],key:we}));console.log(Ce,"priceList"),console.log(t,"###pool.type 504"),ne?t.isSelfBuilt?ee.value="custom":ne=="stable"?ee.value="suggested":ee.value="passive":ee.value="custom",l.value=Ce,Je.value=z,d({key:ee.value,...z[ee.value]})},b=x(""),c=x(""),d=t=>{console.log("priceTab====>",t),console.log("priceTab###poolInfo###",a.value),ee.value=t.key.toLowerCase();const h=a.value.token_a.decimals,B=a.value.token_b.decimals,{lower:z,upper:ne}=t;Xe.value=!1;const fe=_.value.TickMath.tickIndexToPrice(z,h,B).toString(),le=_.value.TickMath.tickIndexToPrice(ne,h,B).toString();if(t.key=="full range"){b.value=z,c.value=ne,F();return}console.log(Oe.value,"===>direct.value"),Oe.value?(gt.value=String(fe),Z.value=String(fe),ft.value=String(le),R.value=String(le),b.value=z,c.value=ne):(gt.value=String(1/Number(le)),Z.value=String(1/Number(le)),ft.value=String(1/Number(fe)),R.value=String(1/Number(fe)),b.value=_.value.TickMath.priceToTickIndex(new s(1/Number(le)),h,B),c.value=_.value.TickMath.priceToTickIndex(new s(1/Number(fe)),h,B)),console.log(Z.value,R.value,"===>111")},F=t=>{Z.value="0",R.value="∞"};Le(()=>a.value,(t,h)=>{console.log(h,"===>oldVal"),console.log(t,"===>newVal"),(!h&&t&&!Ie(t)||h&&t&&h.address!==t.address)&&(console.log("池子信息"),g(t,!h||t.address!==h.address))},{immediate:!0}),Ft(()=>{tt.value=[]}),Le(()=>[n.value,a.value,q.value.recommendRangesObj],(t,h)=>{var B,z;console.log(t,"===>newValue369"),console.log(h,"===>oldValue369"),(!h||t[0]&&t[1]&&t[2]&&!Ie(t[0])&&!Ie(t[1]&&!Ie(t[2]))||((B=t[0])==null?void 0:B.address)!==((z=h[0])==null?void 0:z.address))&&t[0]&&t[2]&&!Ie(t[0])&&!Ie(t[2])&&(console.log(t[0],t[2],"======>374"),H.setSinglePool(t[0],t[2],he.value))},{immediate:!0,deep:!0});const Q=t=>{if(he.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},ae=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},me=t=>{var B,z;const h=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[(B=a.value)==null?void 0:B.address]&&q.value.poolPriceConfigObj[(z=a.value)==null?void 0:z.address].type||"";if(console.log(h,t,"==>poolType"),h=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}},f=x(1),M=()=>{const t=f.value/2;f.value=t},j=()=>{const t=f.value*2;f.value=t};console.log(l.value,"==>priceTablList");const S=L(()=>{var t,h,B;return!a.value||Ie(U.value.addressHistTokens)||!U.value.addressHistTokens[(t=a.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((B=U.value.addressHistTokens[(h=a.value)==null?void 0:h.poolAddress])==null?void 0:B.data.map(z=>[z.key,z.value]))}),C=x(30),W=x("30D"),O=L(()=>Oe.value?S.value&&Se(C.value==7?S.value.before_7_d_contract_price_lowest:C.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest,6)||0:S.value&&Se(new s(1).div(C.value==7?S.value.before_7_d_contract_price_highest:C.value==24?S.value.before_24_h_contract_price_highest:S.value.before_30_d_contract_price_highest).toString(),6)||0),E=L(()=>Oe.value?S.value&&Se(C.value==7?S.value.before_7_d_contract_price_highest:C.value==24?S.value.before_24_h_contract_price_highest:S.value.before_30_d_contract_price_highest,6)||0:(S.value&&Se(1/Number(C.value==7?S.value.before_7_d_contract_price_lowest:C.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest),6))==1/0?0:S.value&&Se(1/Number(C.value==7?S.value.before_7_d_contract_price_lowest:C.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest),6)||0),$=L(()=>{const t=Number(Z.value),h=Number(R.value);return Z.value&&R.value&&Z.value!=="0"&&R.value!=="∞"?bt(1/(1-Number((t/h)**.25)),2)+"x":1}),qe=L(()=>{var t,h,B,z,ne,fe;return((t=T.value)==null?void 0:t.isSelfBuilt)||((h=y.value)==null?void 0:h.isSelfBuilt)||((z=q.value.tokensObj[(B=T.value)==null?void 0:B.address])==null?void 0:z.isSelfBuilt)||((fe=q.value.tokensObj[(ne=y.value)==null?void 0:ne.address])==null?void 0:fe.isSelfBuilt)}),N=t=>{console.log(t,"####0731 priceRangeChangeMin"),t!==Z.value&&ee.value=="full range"?(console.log(l.value,"===>priceTablList"),d({key:"custom",...l.value.custom})):ee.value!=="full range"&&ee.value!=="custom"?(ee.value="custom",Z.value=t):Z.value=t},ie=t=>{console.log(t,"###priceRangeChangeMax maxPirce"),t!==R.value&&ee.value=="full range"?d({key:"custom",...l.value.custom}):ee.value!=="full range"&&ee.value!=="custom"?(ee.value="custom",t=="0"?R.value="∞":R.value=t):t=="0"?R.value="∞":R.value=t};return console.log(Z.value,R.value,"683==>"),Le(()=>[Z.value,R.value],([t,h])=>{console.log(t,h,"minmax new-liquidity-left")},{deep:!0,immediate:!0}),{positionError:ot,getCoinIcon:t=>{var h;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((h=q.value.tokensObj[t==null?void 0:t.address])==null?void 0:h.logo_url)||(U.value.theme==="default"?yt("/image/coins/unknown.png"):yt("/image/coins/sui-unknown.png"))},chainName:he,store:U,currentTab:ge,currentPrice:st,currentPriceReverse:_t,fromCoin:T,toCoin:y,direction:Oe,needReverse:X,addCommom:Ue,decimalUi:Se,priceTablList:l,currentPriceTab:ee,sliderStyle:me,poolInfo:a,tickList:tt,getPriceTabImage:Q,getPriceTabText:ae,defaultMinPrice:gt,defaultMaxPrice:ft,minPrice:Z,maxPrice:R,currentTick:G,chartLoading:V,zoomOut:M,zoomIn:j,zoom:f,priceTab:d,before7dContractPriceLowest:O,before7dContractPriceHighest:E,aprRewardsTime:W,lever:$,aprRewardsParameter:C,isSelfBuilt:qe,priceRangeChangeMin:N,priceRangeChangeMax:ie,toggle:Ht,getPirceTabTips:t=>{switch(t){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}}}}});const zo={class:"new-liquidity-left"},Do={class:"select-range"},Ho=r("span",null,"Select Range",-1),Eo={class:"range-tab"},Xo=["src"],Wo=["src"],Zo=r("span",null,"Liquidity",-1),xo=["src"],Go=["src"],Ko=r("span",null,"Price",-1),Jo={class:"price-info"},Qo={class:"left"},Yo={class:"base-coin"},Vo={class:"base-coin-title"},ei=r("span",null,"Base coin",-1),ti=r("svg",{class:"icon icon-up","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_up1"})],-1),oi=r("svg",{class:"icon icon-down","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_down1"})],-1),ii=[ti,oi],ri={class:"base-coin-bottom"},ai={alt:""},ni={class:"leverage"},li=r("div",{class:"leverage-title"},"Leverage",-1),si={class:"laverage-value"},ui={class:"current-price"},ci=r("div",{class:"current-price-title"},"Current Price",-1),di={key:0,class:"from-pre-to"},mi={class:"right"},vi={class:"price-range"},gi={class:"left"},fi={class:"price-slider"},pi={class:"slider"},bi=r("div",{class:"slider-ratio-content"},null,-1),hi=[bi],wi={class:"price-tab-list"},ki=["onClick"],yi=["src"],_i={class:"right"},Ci={class:"range-tab"},Pi=["src"],Ti=["src"],Si=r("span",null,"Liquidity",-1),Ni=["src"],Ai=["src"],Li=r("span",null,"Price",-1),Ii={class:"price-zoom"},qi={class:"current-price"},Mi=r("div",{class:"current-price-title"},"Current Price",-1),$i={key:0,class:"from-pre-to"},Ri={class:"price-zoom-right"},Oi={class:"leverage"},Bi={class:"left"},Fi={key:0,class:"leverage-title"},ji={key:1,class:"laverage-value"},Ui={class:"right"},zi={key:0,class:"day-7-price-range"},Di=r("i",null,null,-1),Hi={class:"gray"},Ei={key:0,class:"position-tips"},Xi=["src"],Wi={class:"error"};function Zi(e,u,ge,D,U,he){var X,V,g,l,G,i,b,c;const H=Yt,q=Et,_=Tt,J=Xt,n=jt,a=Qt("image");return k(),I("div",zo,[r("div",Do,[Ho,r("div",Eo,[r("div",{class:Ze(["liquidity",e.currentTab=="liquidity"?"liquidity-tab-active":""]),onClick:u[0]||(u[0]=d=>e.currentTab="liquidity")},[e.chainName=="Sui"?(k(),I("img",{key:0,src:e.currentTab=="liquidity"?"/sui-image/Liquidity-Sel.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Xo)):(k(),I("img",{key:1,src:e.currentTab=="liquidity"?"/image/green_chart.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Wo)),Zo],2),r("div",{class:Ze(["price",e.currentTab=="price"?"price-tab-active":""]),onClick:u[1]||(u[1]=d=>e.currentTab="price")},[e.chainName=="Sui"?(k(),I("img",{key:0,src:e.currentTab=="price"?"/sui-image/Price-Sel.png":"/sui-image/Price-Def.png",alt:""},null,8,xo)):(k(),I("img",{key:1,src:e.currentTab=="price"?"/image/price-chart.png":"/sui-image/Price-Def.png",alt:""},null,8,Go)),Ko],2)])]),r("div",Jo,[r("div",Qo,[r("div",Yo,[r("div",Vo,[ei,r("div",{class:"change-price",onClick:u[2]||(u[2]=(...d)=>e.toggle&&e.toggle(...d))},ii)]),r("div",ri,[Pt(r("img",ai,null,512),[[a,e.getCoinIcon(e.fromCoin)]]),r("span",null,ue((X=e.fromCoin)==null?void 0:X.symbol),1)])]),r("div",ni,[li,r("div",si,ue(e.lever),1)]),r("div",ui,[ci,r("div",null,[r("span",null,ue(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(k(),I("span",di,ue((V=e.toCoin)==null?void 0:V.symbol)+" per "+ue((g=e.fromCoin)==null?void 0:g.symbol),1)):te("",!0)])])]),r("div",mi,[e.currentTab=="liquidity"?(k(),I("div",{key:0,class:"zoom-out",onClick:u[3]||(u[3]=(...d)=>e.zoomOut&&e.zoomOut(...d))}," + ")):te("",!0),e.currentTab=="liquidity"?(k(),I("div",{key:1,class:"zoom-in",onClick:u[4]||(u[4]=(...d)=>e.zoomIn&&e.zoomIn(...d))}," - ")):te("",!0)])]),r("div",vi,[r("div",gi,[r("div",fi,[r("div",pi,[r("div",{class:"slider-ratio",style:ht(e.sliderStyle(e.currentPriceTab))},hi,4)])]),r("div",wi,[(k(!0),I(it,null,wt(e.priceTablList,d=>(k(),I("div",{key:d.key,class:Ze(["price-tab-item",e.currentPriceTab==d.key?"price-tab-item-active":""]),onClick:F=>e.priceTab(d)},[De(H,{placement:"bottom","arrow-point-at-center":""},{title:kt(()=>[ct(ue(e.getPirceTabTips(d.key)),1)]),default:kt(()=>[r("img",{src:e.getPriceTabImage(d.key),alt:""},null,8,yi),r("span",null,ue(e.getPriceTabText(d.key)),1)]),_:2},1024)],10,ki))),128))])]),r("div",_i,[r("div",Ci,[r("div",{class:Ze(["liquidity",e.currentTab=="liquidity"?"liquidity-tab-active":""]),onClick:u[5]||(u[5]=d=>e.currentTab="liquidity")},[e.chainName=="Sui"?(k(),I("img",{key:0,src:e.currentTab=="liquidity"?"/sui-image/Liquidity-Sel.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Pi)):(k(),I("img",{key:1,src:e.currentTab=="liquidity"?"/image/green_chart.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Ti)),Si],2),r("div",{class:Ze(["price",e.currentTab=="price"?"price-tab-active":""]),onClick:u[6]||(u[6]=d=>e.currentTab="price")},[e.chainName=="Sui"?(k(),I("img",{key:0,src:e.currentTab=="price"?"/sui-image/Price-Sel.png":"/sui-image/Price-Def.png",alt:""},null,8,Ni)):(k(),I("img",{key:1,src:e.currentTab=="price"?"/image/price-chart.png":"/sui-image/Price-Def.png",alt:""},null,8,Ai)),Li],2)]),r("div",Ii,[r("div",qi,[Mi,r("div",null,[r("span",null,ue(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(k(),I("span",$i,ue(e.direction&&!e.needReverse?`${(l=e.fromCoin)==null?void 0:l.symbol} per ${(G=e.toCoin)==null?void 0:G.symbol}`:`${(i=e.toCoin)==null?void 0:i.symbol} per ${(b=e.fromCoin)==null?void 0:b.symbol}`),1)):te("",!0)])]),r("div",Ri,[e.currentTab=="liquidity"?(k(),I("div",{key:0,class:"zoom-out",onClick:u[7]||(u[7]=(...d)=>e.zoomOut&&e.zoomOut(...d))}," + ")):te("",!0),e.currentTab=="liquidity"?(k(),I("div",{key:1,class:"zoom-in",onClick:u[8]||(u[8]=(...d)=>e.zoomIn&&e.zoomIn(...d))}," - ")):te("",!0)])]),e.fromCoin&&e.toCoin&&e.poolInfo&&e.currentTab=="liquidity"?(k(),Ke(q,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):te("",!0),((c=e.tickList)==null?void 0:c.length)<=0&&e.chartLoading?(k(),Ke(_,{key:1})):te("",!0)])]),r("div",Oi,[r("div",Bi,[e.currentPriceTab!=="full range"?(k(),I("div",Fi,"Leverage")):te("",!0),e.currentPriceTab!=="full range"?(k(),I("div",ji,ue(e.lever),1)):te("",!0)]),r("div",Ui,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(k(),I("div",zi,[Di,r("span",Hi,ue(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),r("span",null,ue(("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.before7dContractPriceLowest,6)))+" - "+ue(("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.before7dContractPriceHighest,6))),1)])):te("",!0)])]),r("div",{class:Ze(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[De(J,{"apr-rewards-parameter":e.aprRewardsParameter,"name-tab":"deposit","from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,onChangeAprRewardsParameter:u[9]||(u[9]=d=>{e.aprRewardsParameter=d})},null,8,["apr-rewards-parameter","from-coin","to-coin","pool-info","min-price","max-price"]),De(n,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(k(),I("div",Ei,[r("img",{src:("importIcon"in e?e.importIcon:Te(yt))("/image/icon-tips-error@2x.png"),alt:""},null,8,Xi),r("p",Wi,ue(e.$t("tips.positionError")),1)])):te("",!0)],2)])}const Wt=at(Uo,[["render",Zi]]),xi=rt({components:{NewLiquidityTitle:Ut,NewLiquidityAssetsCard:zt,NewLiquidityDepositRatio:Dt},setup(){const{t:e,locale:u}=Bt(),ge=dt(),D=L(()=>ge),U=L(()=>D.value.chainName),he=Ct(),H=L(()=>he),q=lo(),_=L(()=>q),J=St(),n=L(()=>{let o=null;for(const p in H.value.poolsObj){const w=H.value.poolsObj[p];w.address==J.query.poolAddress&&(console.log(w,"p===>"),o=w)}return o}),a=x(!1),X=x(!1),V=L(()=>D.value.theme),g=async(o,p)=>{T.value=o.needReverse?o.token_b:o.token_a,y.value=o.needReverse?o.token_a:o.token_b,P.value="",A.value=""};Le(()=>n.value,(o,p)=>{console.log(p,"===>oldVal"),console.log(o,"===>newVal"),(!p&&o&&!Ie(o)||p&&o&&p.address!==o.address)&&(console.log("池子信息"),g(o,!p||o.address!==p.address))},{immediate:!0});const l=L(()=>_.value.assets&&T.value&&_.value.assets[T.value.address]?At(_.value.assets[T.value.address].balance,T.value.decimals):"0"),G=L(()=>_.value.assets&&y.value&&_.value.assets[y.value.address]?At(_.value.assets[y.value.address].balance,y.value.decimals):"0"),i=o=>{o==="fromCoin"?(Pe.value=!0,U.value==="Aptos"?P.value=Number(l.value)>0?T.value.symbol=="APT"?new s(Number(l.value)).sub(new s(.1)).lt(new s(0))?"0":new s(Number(l.value)).sub(new s(.1)).toString():String(l.value):"":P.value=Number(l.value)>0?T.value.symbol=="SUI"?new s(Number(l.value)).sub(new s(.05)).lt(new s(0))?"0":new s(Number(l.value)).sub(new s(.05)).toString():String(l.value):""):(Pe.value=!1,U.value==="Aptos"?A.value=Number(G.value)>0?y.value.symbol=="APT"?new s(Number(G.value)).sub(new s(.1)).lt(new s(0))?"0":new s(Number(G.value)).sub(new s(.1)).toString():String(G.value):"":A.value=Number(G.value)>0?y.value.symbol=="SUI"?new s(Number(G.value)).sub(new s(.05)).lt(new s(0))?"0":new s(Number(G.value)).sub(new s(.05)).toString():String(G.value):"")},b=o=>{o==="fromCoin"?(Pe.value=!0,P.value=Number(l.value)>0?bt(new s(Number(l.value)).div(2).toString(),T.value.decimals).toString():""):(Pe.value=!1,A.value=Number(G.value)>0?bt(new s(Number(G.value)).div(2).toString(),y.value.decimals).toString():"")},c=x(),d=x(),F=x(),Q=x(!1),ae=o=>{var p,w,ce,K;c.value=o,o==="fromCoin"?(d.value=((p=y.value)==null?void 0:p.address)||"",F.value=J.query.actions=="new-position"?(w=T.value)==null?void 0:w.address:n.value.needReverse?n.value.token_b.address:n.value.token_a.address):(d.value=((ce=T.value)==null?void 0:ce.address)||"",F.value=J.query.actions=="new-position"?(K=y.value)==null?void 0:K.address:n.value.needReverse?n.value.token_a.address:n.value.token_b.address),Q.value=!0,console.log(Q.value,"==>showCoinSelect.value ")},me=o=>{var ce,K,de,ve,se,re,oe,ke;const p=n.value.needReverse?n.value.token_b:n.value.token_a,w=n.value.needReverse?n.value.token_a:n.value.token_b;c.value==="fromCoin"?(((ce=T.value)==null?void 0:ce.address)===(p==null?void 0:p.address)||!((K=T.value)!=null&&K.address)?(y.value&&o.address.toLowerCase()===((de=y)==null?void 0:de.value.address.toLowerCase())&&(y.value=null),T.value=o):(T.value&&o.address.toLowerCase()===((ve=T)==null?void 0:ve.value.address.toLowerCase())&&(T.value=null),y.value=o),J.query.action||(J.query.fee="")):((se=y.value)==null?void 0:se.address)===(w==null?void 0:w.address)||!((re=y.value)!=null&&re.address)?(T.value&&o.address.toLowerCase()===((oe=T)==null?void 0:oe.value.address.toLowerCase())&&(T.value=null),y.value=o):(y.value&&o.address.toLowerCase()===((ke=y)==null?void 0:ke.value.address.toLowerCase())&&(y.value=null),T.value=o),Q.value=!1},f=L(()=>D.value.chainName?ut(D.value.chainName):{}),M=L(()=>D.value.slippage),j=x(),S=async()=>{var je,Ae,$e,Re;if(Xe.value)return console.log("跳出"),!1;if(!Z.value&&!R.value)return!1;if(!P.value&&!A.value&&!Z.value&&!R.value)return;const o=n.value||{};if(Ie(o))return;const{TickUtil:p,TickMath:w,getNearestTickByTick:ce}=f.value,K=o==null?void 0:o.token_a.decimals,de=o==null?void 0:o.token_b.decimals;let ve,se,re,oe,ke,Ne,We,Ge,ye=o==null?void 0:o.current_tick_index,Y;if(o.token_a.address.toLowerCase()===T.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===y.value.address.toLowerCase()?Y=!0:Y=!1,Z.value==="0"&&R.value==="∞")re=p.getMinIndex(Number(o.tickSpacing)),oe=p.getMaxIndex(Number(o.tickSpacing)),ke=w.tickIndexToSqrtPriceX64(re),Ne=w.tickIndexToSqrtPriceX64(oe),console.log(re,oe,"#######updateAmounts 513");else if(ee.value=="custom"){console.log(Y,"===>directs1866"),Y?(ve=Number(Z.value),se=Number(R.value)):(ve=R.value!=="∞"?new s(1).div(R.value).toString():1/0,se=new s(1).div(Z.value).toString());try{We=ve==0?-443636:w.priceToTickIndex(new s(ve),K,de)}catch{We=-443636}try{Ge=w.priceToTickIndex(new s(se),K,de)}catch{Ge=443636}re=ce(We,Number(o.tickSpacing)),oe=ce(Ge,Number(o.tickSpacing));try{ke=w.priceToSqrtPriceX64(new s(ve),K,de)}catch{(se===1/0||se==="∞")&&(ke=w.tickIndexToSqrtPriceX64(p.getMinIndex(Number(o.tickSpacing))))}try{Ne=w.priceToSqrtPriceX64(new s(se),K,de)}catch{console.log("0523###test###max###",se),(se===1/0||se==="∞")&&(console.log("0523###test###max###11111"),Ne=w.tickIndexToSqrtPriceX64(p.getMaxIndex(Number(o.tickSpacing))))}console.log("0518###pre###tick_lower###",re,oe,ye),console.log("0518###pre###tick_upper###",oe)}else re=(je=Je.value[ee.value])==null?void 0:je.lower,oe=(Ae=Je.value[ee.value])==null?void 0:Ae.upper,ke=w.tickIndexToSqrtPriceX64(re),Ne=w.tickIndexToSqrtPriceX64(oe);if(R.value!=="∞"&&re>=oe){a.value=!0,P.value="",X.value=!0,A.value="";return}if(console.log(oe,ye,re,"1922"),R.value==="∞"||ye>=re&&ye<=oe){a.value=!1,X.value=!1;let _e;if(P.value||A.value){if(Pe.value){const vt=new s(P.value).mul(Math.pow(10,T.value.decimals)).toString();_e=new ze(vt)}else{const vt=new s(A.value).mul(Math.pow(10,y.value.decimals)).toString();_e=new ze(vt)}console.log(Y,"======>directs");const{liquidityAmount:Ee,tokenMaxA:Ve,tokenMaxB:et,tokenMaxAOrigin:xt,tokenMaxBOrigin:Gt}=f.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:re,upperTick:oe,coinAmount:_e,iscoinA:Y?Pe.value:!Pe.value,roundUp:!0,slippage:Number(M.value)/100,curSqrtPrice:new ze(o.current_sqrt_price)});j.value={liquidityAmount:Ee,tokenMaxA:Ve,tokenMaxB:et,tokenMaxAOrigin:xt,tokenMaxBOrigin:Gt},console.log(Ve,et,"preAdd"),Y?Pe.value?A.value=Number(et)>0?et:"":P.value=Number(Ve)>0?Ve:"":Pe.value?A.value=Ve:P.value=et}}else if(ye>oe){if(Y?P.value="":A.value="",a.value=Y,X.value=!Y,P.value||A.value){let _e;if(Y){const Ee=new s(A.value).mul(Math.pow(10,($e=y.value)==null?void 0:$e.decimals)).toString();_e=new ze(Ee),j.value={liquidityAmount:f.value.estimateLiquidityForCoinB(ke,Ne,_e),tokenMaxA:0,tokenMaxB:A.value}}else{const Ee=new s(P.value).mul(Math.pow(10,(Re=T.value)==null?void 0:Re.decimals)).toString();_e=new ze(Ee),j.value={liquidityAmount:f.value.estimateLiquidityForCoinB(ke,Ne,_e),tokenMaxA:0,tokenMaxB:P.value}}}}else if(ye<re){if(a.value=!Y,X.value=Y,Y?A.value="":P.value="",P.value||A.value){let _e;if(Y){const Ee=new s(P.value).mul(Math.pow(10,T.value.decimals)).toString();_e=new ze(Ee),j.value={liquidityAmount:f.value.estimateLiquidityForCoinA(ke,Ne,_e),tokenMaxA:P.value,tokenMaxB:0}}else{const Ee=new s(A.value).mul(Math.pow(10,y.value.decimals)).toString();_e=new ze(Ee),j.value={liquidityAmount:f.value.estimateLiquidityForCoinA(ke,Ne,_e),tokenMaxA:A.value,tokenMaxB:0}}}}else a.value=!0,P.value="",X.value=!0,A.value=""};Le(P,(o,p)=>{console.log(P,"===>fromCoinAmount"),o==""&&Pe.value&&(A.value=""),o&&Pe.value&&!Xe.value&&S()}),Le(A,(o,p)=>{console.log(o,"===>>>>newValsda"),o==""&&!Pe.value&&(P.value=""),o&&!Pe.value&&!Xe.value&&S()});const C=x("--"),W=L(()=>H.value.RATES),O=()=>{const o=W.value&&W.value[T.value.address]&&W.value[T.value.address].price,p=W.value&&W.value[y.value.address]&&W.value[y.value.address].price;if(o&&p){const w=new s(P.value>0?P.value:0).mul(o),ce=new s(A.value>0?A.value:0).mul(p),K=w.add(ce).toNumber();C.value=K>0&&K<.01?"$<0.01":"$"+Ue(K,2)}else C.value="--"};Le(()=>[P.value,A.value,Xe.value],([o,p,w])=>{(o||p)&&!w?O():(!o||!p)&&!w&&(C.value="--")},{immediate:!0}),Le(()=>C,o=>{console.log(o,"71911111")},{immediate:!0});const E=x(),$=async()=>{var Y,je;if(!Z.value&&!R.value)return!1;if(!P.value&&!A.value&&!Z.value&&!R.value)return;const o=n.value;if(Ie(o))return;const{TickUtil:p,TickMath:w,getNearestTickByTick:ce}=f.value,K=o==null?void 0:o.token_a.decimals,de=o==null?void 0:o.token_b.decimals;let ve,se,re,oe,ke,Ne,We;if(o.token_a.address.toLowerCase()===T.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===y.value.address.toLowerCase()?We=!0:We=!1,Z.value==="0"&&R.value==="∞")re=p.getMinIndex(Number(o.tickSpacing)),oe=p.getMaxIndex(Number(o.tickSpacing));else if(ee.value=="custom"){We?(ve=Number(Z.value),se=Number(R.value)):(ve=new s(1).div(R.value).toString(),se=new s(1).div(Z.value).toString());try{ke=ve==0?-443636:w.priceToTickIndex(new s(ve),K,de)}catch{ke=-443636}try{Ne=w.priceToTickIndex(new s(se),K,de)}catch{Ne=443636}re=ce(ke,Number(o.tickSpacing)),oe=ce(Ne,Number(o.tickSpacing))}else re=(Y=Je.value[ee.value])==null?void 0:Y.lower,oe=(je=Je.value[ee.value])==null?void 0:je.upper;const Ge=W.value[o==null?void 0:o.token_a.address].price,ye=W.value[o==null?void 0:o.token_b.address].price;Oe.value?new ze(o.current_sqrt_price):new ze(1/o.current_sqrt_price),console.log(Oe.value,"===>direction.value"),console.log(o,"poolInfos===>"),console.log(re,oe,"####tick_lower tick_upper 889"),console.log(C.value,"liquidityTotalAmount.value");try{const{amountA:Ae,amountB:$e,tokenAmountsInfo:Re}=await f.value.estCoinAmountsFromTotalAmount({lowerTick:re,upperTick:oe,decimalsA:K,decimalsB:de,curSqrtPrice:new ze(o.current_sqrt_price),totalAmount:C.value.replace(/[^\d.]/g,""),tokenPriceA:Ge,tokenPriceB:ye});console.log(Ae,$e,"###estCoinAmountsFromTotalAmount 844"),console.log(o.needReverse,Oe.value,"===>849"),E.value=Re,o.needReverse?Oe.value?(P.value=Ae,A.value=$e):(P.value=$e,A.value=Ae):(P.value=Ae,A.value=$e)}catch(Ae){console.log(Ae,"e===>")}};Le([Z,R],([o,p])=>{console.log(o,p,"==>minPrice,maxPrice"),Xe.value?Xe.value&&$():S(),p!=="∞"&&Number(o)!==0&&Number(p)!==0&&Number(o)>=Number(p)?ot.value=!0:ot.value=!1,Number(o)==0&&Number(p)==0&&st.value&&(ot.value=!0,console.log("价格区间错误"))},{deep:!0,immediate:!0});const qe=o=>{console.log(o,"e");const p=o.replace(/[^\d.]/g,""),w="$"+Ue(p);Xe.value=!0,C.value=w,p>0?$():(P.value="",A.value="")},N=x(!1),{setTransactionTxid:ie,setTransactionDesc:Qe,setIsShowWaiting:Me,setIsShowSuccess:t,setPositiomNum:h,setIsShowRejected:B}=ge,z=go(),ne=L(()=>H.value.currentPositionInfo),fe=x(!1),le=async o=>{var ke,Ne,We,Ge;console.log(n.value,"===> poolInfo.value"),N.value=!1,H.value.currentPositionInfo={},ie(""),Qe(e("tips.increaseLiquiditySuccess",{from:a.value?"":`${P.value} ${(ke=T.value)==null?void 0:ke.symbol}`,and:!a.value&&!X.value?"and":"",to:X.value?"":`${A.value} ${(Ne=y.value)==null?void 0:Ne.symbol}`})),Me(!0);const p=Oe.value?Pe.value:!Pe.value;let w,ce,K,de,ve,se;const re=n.value.token_a.decimals,oe=n.value.token_b.decimals;if(Z.value==="0"&&R.value==="∞")K=f.value.TickUtil.getMinIndex(Number(n.value.tickSpacing)),de=f.value.TickUtil.getMaxIndex(Number(n.value.tickSpacing));else if(ee.value=="custom"){Oe.value?(w=Number(Z.value),ce=Number(R.value)):(w=new s(1).div(R.value).toString(),ce=new s(1).div(Z.value).toString()),console.log("0519###toAdd###min###",w),console.log("0519###toAdd###max###",ce),console.log("0519###toAdd###minPrice.value###",Z.value),console.log("0519###toAdd###maxPrice.value###",R.value);try{ve=w==0?f.value.TickUtil.getMinIndex(Number(n.value.tickSpacing)):f.value.TickMath.priceToTickIndex(new s(w),re,oe)}catch{ve=f.value.TickUtil.getMinIndex(Number(n.value.tickSpacing))}try{se=f.value.TickMath.priceToTickIndex(new s(ce),re,oe)}catch{se=f.value.TickUtil.getMaxIndex(Number(n.value.tickSpacing))}K=f.value.getNearestTickByTick(ve,Number(n.value.tickSpacing)),de=f.value.getNearestTickByTick(se,Number(n.value.tickSpacing))}else K=Je.value[ee.value].lower,de=Je.value[ee.value].upper;console.log(K,de,"####tick_lower tick_upper 889"),console.log(n.value,"==>poolInfo.value.curSqrtPrice");try{let ye;Xe.value?ye=await f.value.getCreateAddLiquidityPayload({pool:n.value,curSqrtPrice:new ze(n.value.current_sqrt_price),tickLower:K,tickUpper:de,slippage:Number(M.value)/100,tokenAmounts:E.value}):ye=await f.value.getAddLiquidityTransactionPayload({pool:{poolAddress:n.value.poolAddress,token_a:n.value.token_a,token_b:n.value.token_b},amount:Pe.value?P.value:A.value,fix_amount_a:p,tick_lower:K,tick_upper:de,index:0,slippage:Number(M.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new ze(n.value.current_sqrt_price)}),console.log(ye,"payload===?");let Y;if(U.value==="Aptos")Y=await _.value.currentWallet.signAndSubmitTransaction(ye);else{const je=await _.value.currentWallet.signAndExecuteTransactionBlock(ye);Y=f.value.handleTx(je)}if(console.log("0410###tx###",Y),Y&&Y.hash){ie(Y.hash),Me(!1),t(!0);let je;n.value.needReverse?n.value.token_a.address.toLowerCase()===T.value.address.toLowerCase()&&n.value.token_b.address.toLowerCase()===y.value.address.toLowerCase()?je=!1:je=!0:n.value.token_a.address.toLowerCase()===T.value.address.toLowerCase()&&n.value.token_b.address.toLowerCase()===y.value.address.toLowerCase()?je=!0:je=!1,console.log(je,"===>directs");const Ae={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:a.value?"":`${P.value} ${(We=T.value)==null?void 0:We.symbol}`,and:!a.value&&!X.value?"and":"",to:X.value?"":`${A.value} ${(Ge=y.value)==null?void 0:Ge.symbol}`}),hash:Y.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};U.value!=="Aptos"&&(Ae.res=Y.res),f.value.showTransitionPending(Ae);const $e=await f.value.watchTransaction(Ae,!0);if($e.status){if(t(!1),H.value.setCurrentPositionLoading(!0),fe.value=!0,console.log($e.nftInfo,"===> watchInfo.nftInfo"),U.value==="Aptos"){if(await H.value.setCurrentPositionInfo($e.nftInfo[0].data.id.creator,$e.nftInfo[0].data.id.collection,$e.nftInfo[0].data.name,U.value),o)try{await z.subscribePosition({pool_address:ne.value.poolAddress,position_index:ne.value.index},ne.value.nftHash)}catch(Re){console.log(Re,"e")}}else{const Re=$e.nftInfo,_e=await Lt(2e3);if(await H.value.setCurrentPositionInfo(Re==null?void 0:Re.pool,"","",U.value,Re==null?void 0:Re.position),await Lt(1e3),console.log("0529###nftInfo###",Re),console.log("0529###currentPositionInfo.value.index###",ne.value.index),o)try{await z.subscribePosition({pool_address:ne.value.poolAddress,position_index:ne.value.index},ne.value.nftHash)}catch(Ee){console.log(Ee)}}setTimeout(()=>{he.updateCurrentPools(n.value.poolAddress,U.value),f.value.getAccount(_.value.address)},3e3),setTimeout(async()=>{It(f,n)},3e3)}h()}else Me(!1),B(!0);P.value="",A.value=""}catch(ye){P.value="",A.value="",console.log("0330###Add liquidity Error###",ye),Me(!1),B(!0)}},Be=L(()=>!P.value&&!A.value?(console.log("addLiquidityBtnDisabled11111"),!0):Number(P.value)>Number(l.value)||Number(A.value)>Number(G.value)?(console.log("addLiquidityBtnDisabled22222"),!0):He.value!==e("button.addLiquidity")&&He.value!==e("newAdd.preview")?(console.log("addLiquidityBtnDisabled33333###",He.value),!0):n.value&&n.value&&n.value.is_pause?(console.log("addLiquidityBtnDisabled44444"),!0):Number(P.value)<=0&&Number(A.value)<=0||!a.value&&Number(P.value)==0||!X.value&&Number(A.value)==0),xe=L(()=>!T.value||!y.value),He=L(()=>n.value&&n.value.is_pause?"Pool Closed":!T.value||!y.value||xe.value?e("modal.selectTokenModalTitle"):Number(P.value)>Number(l.value)?e("button.insufficientBalance",{name:T.value.symbol}):Number(A.value)>Number(G.value)?e("button.insufficientBalance",{name:y.value.symbol}):!Number(P.value)&&!Number(A.value)?e("button.enterAmount"):R.value!=="∞"&&Number(Z.value)>=Number(R.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),Ce=x({}),we=x({}),Ye=x(!1),nt=(o,p)=>{console.log(c.value,"===>currentCoinKey.value"),console.log(o);const w=localStorage.getItem(o.address);console.log(H.value.tokensObj,"===>pools.value.tokensObj"),console.log(w,"===>coinLocak"),H.value.tokensObj&&H.value.tokensObj[o.address]&&H.value.tokensObj[o.address].isSelfBuilt&&!w&&(p=="fromCoin"&&(Ce.value=o),p=="toCoin"&&(we.value=o),Ye.value=!0)};Le(()=>[T.value,y.value],([o,p])=>{o&&!Ie(o)&&nt(o,"fromCoin"),p&&!Ie(p)&&nt(p,"toCoin")},{immediate:!0});const m=Vt(),v=()=>{U.value!=="Aptos"?m.push("/pool/list"):m.push("/pools")},Fe=o=>{Xe.value,le(o)},pe=()=>{J.query.action!=="create-pool"&&J.query.actions!=="new-position"&&(It(f,n),S(),he.updateCurrentPools(n.value.poolAddress,U.value)),he.setPoolConfigList(U.value,D.value.filterCoinsObj)},be=L(()=>{var w,ce,K,de,ve,se;const o=(K=W.value[(ce=(w=T)==null?void 0:w.value)==null?void 0:ce.address])==null?void 0:K.price,p=(se=W.value[(ve=(de=y)==null?void 0:de.value)==null?void 0:ve.address])==null?void 0:se.price;return!!(o&&p)});return Le(()=>[J,H.value.tokensObj],([o,p])=>{var w;p&&!Ie(p)&&(y.value||(y.value=H.value.tokensObj[(w=o==null?void 0:o.query)==null?void 0:w.toCoin]))},{immediate:!0,deep:!0}),{decimalUi:Se,poolInfo:n,fromCoinAmount:P,toCoinAmount:A,fromCoin:T,toCoin:y,theme:V,showFromCoinLock:a,showToCoinLock:X,fromCoinBlance:l,toCoinBlance:G,maxBtnSelect:i,halfBtnSelect:b,fixedFromCoin:Pe,openCoinSelect:ae,currentCoinKey:c,existingCoins:d,lastSelectCoin:F,showCoinSelect:Q,onCoinSelect:me,liquidityTotalAmount:C,toggle:Ht,onInput:qe,isInputTotalAmount:Xe,isViewDetail:fe,addLiquidityBtnDisabled:Be,addLiquidityBtnText:He,isShowTokenWarning:Ye,chainName:U,closeTokenWarning:v,warningFromCoin:Ce,warningToCoin:we,isShowLiquidityModal:N,currentPrice:st,currentPriceReverse:_t,currentPriceTab:ee,minPrice:Z,maxPrice:R,toAdd:le,direction:Oe,wallet:_,getAddLiquidityType:Fe,clickRefresh:pe,isShowtotalAmount:be}}});const Gi={class:"new-liquidity-right"},Ki={class:"deposit-title"},Ji={class:"card-container"},Qi={class:"card-item"},Yi={class:"card-item"},Vi={key:0,class:"total-amount"},er=r("span",null,"Total Amount",-1);function tr(e,u,ge,D,U,he){const H=Ut,q=zt,_=no,J=eo,n=Dt,a=to,X=co,V=mo,g=vo;return k(),I("div",Gi,[r("div",Ki,[De(H,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),r("div",Ji,[r("div",Qi,[De(q,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":u[0]||(u[0]=l=>e.fromCoinAmount=l),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:u[1]||(u[1]=l=>e.maxBtnSelect("fromCoin")),onOnHalf:u[2]||(u[2]=l=>e.halfBtnSelect("fromCoin")),onOnInput:u[3]||(u[3]=l=>{e.fromCoinAmount=l,e.fixedFromCoin=!0,e.isInputTotalAmount=!1}),onOnSelect:u[4]||(u[4]=l=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock?(k(),Ke(_,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):te("",!0)]),r("div",Yi,[De(q,{modelValue:e.toCoinAmount,"onUpdate:modelValue":u[5]||(u[5]=l=>e.toCoinAmount=l),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:u[6]||(u[6]=l=>e.maxBtnSelect("toCoin")),onOnHalf:u[7]||(u[7]=l=>e.halfBtnSelect("toCoin")),onOnInput:u[8]||(u[8]=l=>{e.toCoinAmount=l,e.fixedFromCoin=!1,e.isInputTotalAmount=!1}),onOnSelect:u[9]||(u[9]=l=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock?(k(),Ke(_,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):te("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(k(),I("img",{key:0,class:"add",src:fo,alt:"",onClick:u[10]||(u[10]=(...l)=>e.toggle&&e.toggle(...l))})):te("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(k(),I("img",{key:1,class:"add",src:po,alt:"",onClick:u[11]||(u[11]=(...l)=>e.toggle&&e.toggle(...l))})):te("",!0)]),e.isShowtotalAmount?(k(),I("div",Vi,[er,r("span",null,[De(J,{value:e.liquidityTotalAmount,placeholder:e.isInputTotalAmount?"":e.liquidityTotalAmount,onInput:u[12]||(u[12]=l=>e.onInput(l.target.value))},null,8,["value","placeholder"])])])):te("",!0),De(n,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),De(a,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:u[13]||(u[13]=l=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:kt(()=>[ct(ue(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(k(),Ke(X,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:u[14]||(u[14]=l=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):te("",!0),e.isViewDetail?(k(),Ke(V,{key:2,"pool-info":e.poolInfo,onOnClose:u[15]||(u[15]=l=>e.isViewDetail=!1)},null,8,["pool-info"])):te("",!0),e.isShowLiquidityModal?(k(),Ke(g,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:u[16]||(u[16]=l=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):te("",!0)])}const Zt=at(xi,[["render",tr]]),or=rt({components:{NewLiquidityLeft:Wt,NewLiquidityRight:Zt},setup(){Ft(()=>{uo()});const e=St();return{tickList:tt,route:e}}});const ir={key:0,class:"loading-spin-liquidity loading-global"},rr={class:"privide-liquidity"};function ar(e,u,ge,D,U,he){var J,n;const H=Tt,q=Wt,_=Zt;return k(),I(it,null,[!e.tickList&&((n=(J=e.route)==null?void 0:J.query)!=null&&n.poolAddress)?(k(),I("div",ir,[De(H)])):te("",!0),r("div",rr,[De(q),De(_)])],64)}const Ur=at(or,[["render",ar],["__scopeId","data-v-9c3e932a"]]);export{Ur as default};
