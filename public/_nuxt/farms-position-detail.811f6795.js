import{u as J,m as K,e as Q,s as q,a as z,c as A}from"./pool.1ed2be8f.js";import{a as X,l as S,b as Y,r as T,q as Z,e as x,s as ee,o as d,f as P,h as s,F as se,E as oe,c as D,w as v,x as F,i as W,z as te,B as ae,P as ne,t as L,v as re,u as U,j as h,p as ie,k as le}from"./entry.ebd4a795.js";/* empty css              */import{u as ce}from"./farms.a27d8c7a.js";import{i as ue}from"./import-icon.de3e6c66.js";import{D as M}from"./decimal.0bdeb344.js";import{a as de,u as me}from"./sha256.1827b649.js";const pe=X({setup(){const e=J(),m=S(()=>e),$=ce(),j=S(()=>$),I=Y(),t=S(()=>m.value.currentPositionInfo),c=T(),y=o=>{var a;return((a=m.value.tokensObj[o])==null?void 0:a.logo_url)||ue("/image/coins/sui-unknown.png")},f=K("Sui"),i=T(),N=async o=>{const a=await f.calculateFarmingRewards([{pool_id:o.pool_id,position_nft_id:o.id}]),l=[];let r=new M(0);a[o.id].forEach(n=>{var V;const g=(V=m.value.tokensObj[n.rewarder_type])==null?void 0:V.decimals;let k=new M(n.rewarder_amount).div(Math.pow(10,g)).toString();Number(k)>0&&(r=r.add(k),l.push({...n,rewarderAmount:k,rewarderAmountPer:k}))}),i.value=r,c.value=l,console.log("getRewarder",o,l)},R=S(()=>j.value.farmsPoolObj);Z(()=>[t.value,R.value],([o,a])=>{!A(o)&&o.positionSource=="farming"?N(o):!A(a)&&!A(o)&&(console.log(a,"##farmsPoolObj"),c.value=a[o.poolAddress].rewarders)},{immediate:!0});const G=de(),B=S(()=>G),H=me(),_=Q("Sui"),{setIsShowSuccess:E,setIsShowRejected:b,setIsShowWaiting:u,setTransactionDesc:O,setTransactionTxid:C}=H,p=T(!1);return{getCoinIcon:y,rewardList:c,sFixD:q,addCommom:z,claim:async()=>{p.value=!0,C(""),O("Claim rewards"),u(!0);const o={pool_id:t.value.pool_id,position_nft_id:t.value.id};try{const a=await f.harvestFarms(o),l=await B.value.currentWallet.signAndExecuteTransactionBlock(a);console.log("0221###sui swap res###",l);let r=_.handleTx(l);if(r&&r.hash){C(r.hash),u(!1),E(!0);let n={title:"claim",res:r.res,hash:r.hash};_.showTransitionPending(n),await _.watchTransaction(n)&&setTimeout(()=>{N(t.value)},2e3)}else u(!1),b(!0);p.value=!1}catch(a){console.log("farmsDeposit error",a),u(!1),b(!0),p.value=!1}},unStake:async()=>{p.value=!0,C(""),O(`Unstake ${t.value.name}`),u(!0);const o=t.value.pool_id,a=t.value.id;try{const l=await f.farmsWithdraw(o,a),r=await B.value.currentWallet.signAndExecuteTransactionBlock(l);console.log("0221###sui swap res###",r);let n=_.handleTx(r);if(console.log(n,"unStaketx##"),n&&n.hash){C(n.hash),u(!1),E(!0);let g={res:n.res,title:"Unstake",hash:n.hash};_.showTransitionPending(g),await _.watchTransaction(g)&&setTimeout(()=>{console.log("unstake success"),I.replace(`/new-position-detail?name=${t.value.tokenName}address=${t.value.clmm_pool_id}&pos=${t.value.clmm_position_id}`),m.value.setCurrentPositionInfo(t.value.clmm_pool_id,"",t.value.tokenName,"Sui",t.value.clmm_position_id)},2e3)}else u(!1),b(!0);p.value=!1}catch(l){console.log("farmsDeposit error",l),u(!1),b(!0),p.value=!1}},loading:p,totalRewardAmount:i,currentPositionInfo:t,stake:async()=>{I.push("/farms")},farmsPoolObj:R}}});const w=e=>(ie("data-v-05360e28"),e=e(),le(),e),fe={key:0,class:"farms-position-detail"},_e={class:"farms-top"},ve=w(()=>s("div",{class:"left"},[s("div",{class:"title"},"Farming"),s("div",{class:"desc"},"Stake Position to Earn")],-1)),he={class:"right"},we=w(()=>s("div",{class:"apr"},[h(" APR "),s("span",null,"22.20%")],-1)),ge=w(()=>s("span",null,"View",-1)),ke=w(()=>s("svg",{class:"arrow-icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-icon_arrow"})],-1)),Se=[ge,ke],Pe={class:"farms-bottom"},be=w(()=>s("div",{class:"title"},"Earnings",-1)),Ce={class:"reward-list"},Ie={key:0,class:"rewards-item-bg"},ye={class:"rewards-item-box"},Ae={alt:""},Te={key:1},De={class:"rewards-item-bg"},Fe={class:"rewards-item-box"},$e={alt:""},je=w(()=>s("span",null,"0",-1)),Ne={class:"actions-box"};function Re(e,m,$,j,I,t){const c=ae,y=ne,f=ee("image");return e.farmsPoolObj&&e.farmsPoolObj[e.currentPositionInfo.poolAddress]&&e.farmsPoolObj[e.currentPositionInfo.poolAddress].status=="Live"?(d(),P("div",fe,[s("div",_e,[ve,s("div",he,[we,s("div",{class:"view",onClick:m[0]||(m[0]=i=>e.$router.push("/farms"))},Se)])]),s("div",Pe,[be,s("div",Ce,[(d(!0),P(se,null,oe(e.rewardList,i=>(d(),P("div",{key:i,class:"rewards-item"},[e.currentPositionInfo.positionSource=="farming"?(d(),P("div",Ie,[s("div",ye,[L(s("img",Ae,null,512),[[f,e.getCoinIcon(i.rewarder_type)]]),s("span",null,re(i.rewarderAmountPer>0&&i.rewarderAmountPer<.01?"<0.01":("addCommom"in e?e.addCommom:U(z))(("sFixD"in e?e.sFixD:U(q))(i.rewarderAmount,4))),1)])])):(d(),P("div",Te,[s("div",De,[s("div",Fe,[L(s("img",$e,null,512),[[f,e.getCoinIcon(i.reward_coin)]]),je])])]))]))),128))]),s("div",Ne,[e.currentPositionInfo&&e.currentPositionInfo.positionSource=="farming"?(d(),D(c,{key:0,class:"unstake-btn",loading:e.loading,onClick:e.unStake},{default:v(()=>[h("Unstake")]),_:1},8,["loading","onClick"])):F("",!0),e.currentPositionInfo&&e.currentPositionInfo.positionSource=="clmm"&&e.currentPositionInfo.currentStatus!=="Active"?(d(),D(y,{key:1},{title:v(()=>[h("Farming rewards are only available for active positions.")]),default:v(()=>[W(c,{class:"unstake-btn",loading:e.loading,disabled:!0,onClick:e.stake},{default:v(()=>[h("Stake")]),_:1},8,["loading","onClick"])]),_:1})):e.currentPositionInfo&&e.currentPositionInfo.positionSource=="clmm"?(d(),D(c,{key:2,class:"unstake-btn",loading:e.loading,onClick:e.stake},{default:v(()=>[h("Stake")]),_:1},8,["loading","onClick"])):F("",!0),W(c,{class:"unstake-btn btn-margin",loading:e.loading,disabled:e.totalRewardAmount==0||e.currentPositionInfo&&e.currentPositionInfo.positionSource!=="farming",onClick:te(e.claim,["stop"])},{default:v(()=>[h("â†‘ Claim")]),_:1},8,["loading","disabled","onClick"])])])])):F("",!0)}const Ge=x(pe,[["render",Re],["__scopeId","data-v-05360e28"]]);export{Ge as _};
