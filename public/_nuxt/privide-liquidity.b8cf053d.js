import{a as ut,b as Jt,n as pt,d as Se,u as Ct,e as Ue,c as Ie,i as Qt,s as bt,T as Nt,p as At,f as ze,g as Lt}from"./pool.bdf3fdc7.js";import{a as rt,r as G,m as L,y as Mt,D as Le,e as nt,o as k,f as I,c as Je,x as te,h as r,t as Pt,G as $t,H as ht,v as se,u as Te,F as it,J as Tt,p as Rt,k as Ot,z as Ze,s as wt,j as ct,l as Bt,E as St,C as Ft,q as Yt,i as He,w as kt,L as xt,b as Vt,I as eo,B as to}from"./entry.31f02fcc.js";/* empty css              */import{s as lt,m as oo,l as io,b as ro,a as no,_ as ao}from"./transform.2c402880.js";import{D as s}from"./decimal.0e8aa3f1.js";import{u as dt,a as lo}from"./sha256.715a2f4c.js";import"./decimal.633e31ee.js";import{g as so}from"./common-fun.4f84f2a0.js";import{c as jt,_ as Ut,b as zt,a as Ht}from"./new-liquidity-title.b58eec98.js";import{i as yt}from"./import-icon.de3e6c66.js";/* empty css              */import{positionError as ot,tickList as tt,direction as Oe,minPrice as Z,maxPrice as j,fromCoin as T,toCoin as y,currentPrice as st,currentPriceReverse as _t,currentPriceTab as ee,defaultMinPrice as ft,defaultMaxPrice as gt,toggle as Dt,isInputTotalAmount as We,priceConfigObj as Qe,fromCoinAmount as P,toCoinAmount as A,fixedFromCoin as Pe,resetTickList as It,resetData as uo}from"./data.9542d85d.js";import{_ as co}from"./coin-select.045cf4d9.js";import{_ as mo}from"./viewDetail.0eb652b9.js";import{b as vo}from"./new-add-or-create.5892325b.js";/* empty css              */import{u as fo}from"./notifi.c3ae8781.js";import{_ as go,a as po}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.18915906.js";import"./precision.a7a6c57b.js";/* empty css              */import"./tick.505fdad3.js";import"./token-warning.6de1fcc5.js";import"./refresh-icon.a79b411d.js";/* empty css              */import"./swap-setting.05cd84a2.js";/* empty css              */import"./img-no-Positions_2x.f2b85abe.js";import"./status-block.799ab62f.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.2cfc1f62.js";import"./index.5238167b.js";function qt(e,u,fe){const H=new s(10).pow(u-fe);return new s(1.0001).pow(e).mul(H)}const bo=rt({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,u){const fe=G(""),H=G(""),U=L(()=>{var i,b,c,d,B,Y;return console.log(e.poolInfo,"===>props.poolInfo"),(i=e.poolInfo)!=null&&i.current_sqrt_price&&((b=e.poolInfo)!=null&&b.coinA.decimals)&&((c=e.poolInfo)!=null&&c.coinB.decimals)?a.sqrtPriceX64ToPrice((d=e.poolInfo)==null?void 0:d.current_sqrt_price,(B=e.poolInfo)==null?void 0:B.coinA.decimals,(Y=e.poolInfo)==null?void 0:Y.coinB.decimals).toString():"0"}),he=L(()=>{let i=0;return e.direction?i=(Number(e.minPrice)/Number(U.value)-1)*100:i=(Number(e.minPrice)/Number(1/Number(U.value))-1)*100,i=i>0&&i<.1?.1:i,i=i<0&&i>-.1?-.1:i,i}),D=L(()=>{let i=0;return e.direction?i=(Number(e.maxPrice)/Number(U.value)-1)*100:i=(Number(e.maxPrice)/Number(1/Number(U.value))-1)*100,i=i>0&&i<.1?.1:i,i=i<0&&i>-.1?-.1:i,i}),q=dt(),_=L(()=>q),Q=L(()=>_.value.chainName?ut(_.value.chainName):{}),{TickMath:a,getNearestTickByTick:n}=Q.value,W=(i=[])=>{let b=6;const c=Math.abs(Number(i[0])-Number(i[i.length-1]));return c>=6?b=0:c>=1?b=1:c>=.1?b=2:c>=.01?b=3:c>=.001?b=4:c>=1e-4?b=5:c>=1e-5?b=6:c>=1e-6?b=7:c>=1e-7&&(b=8),b},V=(i,b=1)=>{if(i&&i.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const c=Number(e.poolInfo.current_tick_index);console.log("0117###dataProcessing###currentTick###",c),console.log("0117###dataProcessing###props.poolInfo###",e.poolInfo),console.log("0117###dataProcessing###minPrice###",e.minPrice),console.log("0117###dataProcessing###maxPrice###",e.maxPrice),console.log("0117###dataProcessing###poolInfo###",e.poolInfo);let d=c+100*b,B=c-100*b,Y,ne;if(e.maxPrice==="∞")ne=Q.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ne=a.priceToTickIndex(new s(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ne=a.priceToTickIndex(new s(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ne=443636}if(e.minPrice==="0")Y=Q.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?Y=a.priceToTickIndex(new s(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):Y=a.priceToTickIndex(new s(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{Y=-443636}let de=0;if(e.currentPriceTab!=="full range"){if(c>=Y&&c<=ne){const N=c-Y,ie=ne-c;de=Math.max(Math.abs(N),Math.abs(ie))}else c<Y?de=Math.abs(ne-c):de=Math.abs(c-Y);d=c+de+100*b,B=c-de-100*b}else{const N=(Math.abs(c)>5e3,2e4);d=c+N*b,B=c-N*b}B<-443636&&(B=-443636),d>443636&&(d=443636);const g=new s(i.liquidity).div(Math.pow(10,8)).toString(),M=e.tickList;console.log("0117####drawChart####tick_info_array####",M);const F=[],S=[];let C={};for(let N=0;N<M.length;N++){if(C=M[N],C.index<=c&&C.index>=B){if(F.length<1&&N!==0){const ie=M[N-1];F.unshift({...ie,index:B,source:"left"})}F.unshift(C)}else if(C.index>c&&C.index<=d&&(S.push(C),F.length<1&&N!==0)){const ie=M[N-1];F.push({...ie,index:B,source:"left"})}if(C.index>d){const ie=M[N];if(S.push({...ie,index:d,source:"right"}),F.length<1&&N!==0){const Ye=M[N-1];F.push({...Ye,index:B,source:"left"})}break}}let X="0";for(let N=F.length-1;N>=0;N--)X=new s(X).plus(new s(F[N].liquidityNet.toString()).div(Math.pow(10,8))).toString(),F[N].liquityAmount=X;let R=g;for(let N=0;N<S.length;N++)R=new s(R).plus(new s(S[N].liquidityNet.toString()).div(Math.pow(10,8))).toString(),S[N].liquityAmount=R;let E=[];const $=M&&M.length>0?{index:c,liquityAmount:Number(g)}:{index:c,liquityAmount:0};(F.length>0||S.length>0)&&(E=[...F.reverse(),$,...S],e.direction||(E=E.reverse()));const qe=[];M.forEach(N=>{qe.push({...N,liquidityGross:N.liquidityGross.toString(),liquidityNet:N.liquidityNet.toString()})}),console.log("0117####drawChart####testTickInfoArray####",qe),console.log("0117####drawChart####currentLiquity####",g),l(E,B,d,Y,ne,c)}};let f=G(!1);Mt(()=>{document.body.clientWidth<750?f.value=!1:f.value=!0,window.onresize=()=>{document.body.clientWidth<750?f.value=!1:f.value=!0,V(e.poolInfo,e.zoom)}});const l=(i,b,c,d,B,Y)=>{console.log("0117####drawChart####chartData####",i),console.log("0117####drawChart####tickMin####",b),console.log("0117####drawChart####tickMax####",c),console.log("0117####drawChart####minPriceTick####",d),console.log("0117####drawChart####maxPriceTick####",B),console.log("0117####drawChart####currentTick####",Y),console.log("0117####drawChart####props.direction####",e.direction),console.log("0518###newd3###props.before7dContractPriceLowest###",e.before7dContractPriceLowest),console.log("0518###newd3###props.before7dContractPriceHighest###",e.before7dContractPriceHighest);let ne,de;e.direction?(ne=e.before7dContractPriceLowest?a.priceToTickIndex(new s(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",de=e.before7dContractPriceHighest?a.priceToTickIndex(new s(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ne=e.before7dContractPriceLowest?a.priceToTickIndex(new s(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",de=e.before7dContractPriceHighest?a.priceToTickIndex(new s(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const g={top:30,right:35,bottom:20,left:55};let M,F;f.value?(M=460-g.left-g.right,F=205-g.top-g.bottom):(M=340-g.left-g.right,F=205-g.top-g.bottom);const S=c-b,C=parseInt(String(S/4));let X=[b+C/4,b+C,b+2*C,c-C,c-C/4];const R=b,E=c,$=M/(E-R);e.currentPriceTab==="full range"&&(X=[b,b+2*C,c]),console.log("0117####drawChart####xArr####",X),console.log("0117####drawChart####utickMin####",R),console.log("0117####drawChart####utickMax####",E),console.log("0117####drawChart####unit####",$);const qe=X.map(m=>e.direction?qt(m,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new s(1).div(qt(m,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),N=W(qe);lt("#chart").selectAll("*").remove();const ie=lt("#chart").attr("width",M+g.left+g.right).attr("height",F+g.top+g.bottom).append("g").attr("transform",`translate(${g.left},${g.right})`),Ye=oo(i,function(m){return Number(Math.abs(m.liquityAmount))})||0,Me=io().range([0,F]).domain([Ye,0]);ro().rangeRound([0,M]).padding(.1);const h=ie.append("g").attr("id","barsBox").selectAll("rect").data(i).enter().append("rect");_.value.theme=="default"?h.attr("x",function(m,v){return v===0?0:e.direction?Math.abs(m.index-R)*$:Math.abs(E-m.index)*$}).attr("y",function(m,v){return e.direction?v===i.length-1?0:Me(m.liquityAmount):v===i.length-1?0:Me(i[v+1].liquityAmount)}).attr("width",function(m,v){return v===0&&i.length===1&&m.liquityAmount>0?M:(e.direction,v!==i.length-1?Math.abs(i[v+1].index-m.index)*$:0)}).attr("height",function(m,v){return v===0&&i.length===1&&m.liquityAmount>0?F:e.direction?v===i.length-1?0:F-Me(m.liquityAmount):v===i.length-1?0:F-Me(i[v+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):h.attr("x",function(m,v){return v===0?0:e.direction?Math.abs(m.index-R)*$:Math.abs(E-m.index)*$}).attr("y",function(m,v){return e.direction?v===i.length-1?0:Me(Math.abs(m.liquityAmount)):v===i.length-1?0:Me(Math.abs(i[v+1].liquityAmount))}).attr("width",function(m,v){return v===0&&i.length===1&&m.liquityAmount>0?M:(e.direction,v!==i.length-1?Math.abs(i[v+1].index-m.index)*$:0)}).attr("height",function(m,v){if(v===0&&i.length===1&&m.liquityAmount>0)return F;if(e.direction)return v===i.length-1?0:Number(m.liquityAmount)?F-Me(Math.abs(m.liquityAmount)):0;{if(v===i.length-1)return 0;const Fe=F-Me(Math.abs(i[v+1].liquityAmount));return Number(i[v+1].liquityAmount)?Fe:0}}).attr("fill",function(m,v){return i[v].source=="left"?"#417494":"#53334C"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(m,v){return i[v].source=="left"?"#417494":"#53334C"});const O=ie.append("g");O.append("line").attr("x1",0).attr("y1",155).attr("x2",M).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const z=O.append("g");let ae=0;if(e.direction){for(let m=0;m<X.length;m++){const v=Se(qe[m],N)||"0";console.log("0423####price####",v),qe.push(v);const Fe=Math.abs(X[m]-R)*$;let pe=0;for(let be=0;be<v.length;be++)v[be]==="1"?pe+=4.02:v[be]==="."?pe+=2.64:v[be]==="7"?pe+=5.48:pe+=6;console.log(Fe,"x=>>>"),z.append("text").text(v).attr("x",Fe-pe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}ae=Math.abs(Y-R)*$}else{for(let m=X.length-1;m>=0;m--){const v=Se(qe[m],N)||0;qe.push(v);const Fe=Math.abs(X[m]-E)*$;let pe=0;for(let be=0;be<v.length;be++)v[be]==="1"?pe+=4.02:v[be]==="."?pe+=2.64:v[be]==="7"?pe+=5.48:pe+=6;z.append("text").text(v).attr("x",Fe-pe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}ae=Math.abs(Y-E)*$}console.log(Y,E,$,"######currentPricePositon"),(_.value.theme=="default"?ie.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):ie.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+ae+", 0)");let le,Be,Ge,De;e.direction?(console.log("0525###d3###select###minPriceTick###",d),console.log("0525###d3###select###maxPriceTick###",B),console.log("0525###d3###select###props.minPrice###",e.minPrice),console.log("0525###d3###select###props.maxPrice###",e.maxPrice),le=d<R?-100:parseInt(String(Math.abs(d-R)*$)),Be=B<R?-100:parseInt(String(Math.abs(B-R)*$)),Ge=ne<R?-100:Math.abs(ne-R)*$,De=de<R?-100:Math.abs(de-R)*$):(Be=d<R?-100:Math.abs(E-d)*$,le=B<R?-100:Math.abs(E-B)*$,De=ne<R?-100:Math.abs(E-ne)*$,Ge=de<R?-100:Math.abs(E-de)*$),e.minPrice==="0"&&(le=0),e.maxPrice==="∞"&&(Be=M),console.log(le,"==>minPriceTickX"),f.value?fe.value=M-le+87+"px":fe.value=M-le+52+"px",H.value=Be+74+"px",ne&&Ge<M&&ie.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+Ge+", 0)"),de&&De<M&&ie.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+De+", 0)");const ye=ie.append("g").attr("id","left-handle"),we=ie.append("g").attr("id","right-handle");_.value.theme=="default"?(ye.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),ye.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),ye.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),ye.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),we.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),we.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),we.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),we.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(ye.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),ye.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),ye.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),ye.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),we.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),we.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),we.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),we.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),console.log("0525###d3###select###minPriceTickX###",le),console.log("0525###d3###select###maxPriceTickX###",Be),ye.attr("transform","translate("+le+", 0)"),we.attr("transform","translate("+Be+", 0)");const xe=no().extent([[0,0],[M,F]]).handleSize(30).on("end",at);ie.append("g").attr("class","brush").call(xe).call(xe.move,[le,Be]);function at(m){if(!m.sourceEvent||!m.selection)return;ye.attr("transform","translate("+m.selection[0]+", 0)"),we.attr("transform","translate("+m.selection[1]+", 0)"),f.value?fe.value=M-m.selection[0]+60+"px":fe.value=M-m.selection[0]+52+"px",H.value=m.selection[1]+74+"px";let v,Fe;console.log("0525###d3###select###e.selection[0]###",m.selection[0]),console.log("0525###d3###select###e.selection[0]###",m.selection[1]),console.log("0525###d3###select###props.direction###",e.direction),console.log("0525###d3###select###width###",M),console.log("0525###d3###select###unit###",$),console.log("0525###d3###select###utickMin###",R),console.log("0525###d3###select###utickMax###",E),console.log("0525###d3###select###props.poolInfo###",e.poolInfo);let pe=0,be=0;e.direction?(pe=n(parseInt(String(m.selection[0]/$+R)),Number(e.poolInfo.tickSpacing)),v=a.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),be=n(parseInt(String(m.selection[1]/$+R)),Number(e.poolInfo.tickSpacing)),Fe=a.tickIndexToPrice(be,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),console.log("0525###d3###select###minTick###",pe),console.log("0525###d3###select###maxTick###",be),console.log("0525###d3###select###minPrice###",v),console.log("0525###d3###select###maxPrice###",Fe)):(be=n(E-m.selection[0]/$,Number(e.poolInfo.tickSpacing)),v=1/a.tickIndexToPrice(be,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),pe=n(E-m.selection[1]/$,Number(e.poolInfo.tickSpacing)),Fe=1/a.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),u.emit("onChangeMinPrice",String(Se(String(v),6))),u.emit("onChangeMaxPrice",String(Se(String(Fe),6)))}_.value.theme=="default"?lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632")};G(""),Le(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom],([i,b,c,d,B])=>{console.log(i,b,c,c>b,"poolInfo && minPrice && maxPrice && (maxPrice > minPrice)"),i&&b&&c&&(i!=null&&i.liquidity)&&(d!=="Custom"||console.log("绘制"),V(i,B))},{immediate:!0});const K=G(!1);return Le(()=>e.chartLoading,(i,b)=>{i!==b&&(K.value=i)},{immediate:!0,deep:!0}),console.log(e,"props===>"),{store:_,loading:K,rangeSizeLower:he,rangeSizeUpper:D,rangeSizeLowerPosition:fe,rangeSizeUpperPosition:H,decimalFormat:Jt,numberformat:pt}}});const ho=e=>(Rt("data-v-ce62e615"),e=e(),Ot(),e),wo={class:"chart-box"},ko={class:"chart"},yo=ho(()=>r("svg",{id:"chart"},null,-1));function _o(e,u,fe,H,U,he){const D=Tt;return k(),I(it,null,[e.tickList&&e.tickList.length>0&&e.loading?(k(),Je(D,{key:0})):te("",!0),r("div",wo,[Pt(r("div",ko,[e.currentPriceTab!=="full range"?(k(),I("div",{key:0,class:"range-size range-size-lower",style:ht({right:e.rangeSizeLowerPosition})},se(("numberformat"in e?e.numberformat:Te(pt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):te("",!0),e.currentPriceTab!=="full range"?(k(),I("div",{key:1,class:"range-size range-size-upper",style:ht({left:e.rangeSizeUpperPosition})},se(("numberformat"in e?e.numberformat:Te(pt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):te("",!0),yo],512),[[$t,!e.loading]])])],64)}const Et=nt(bo,[["render",_o],["__scopeId","data-v-ce62e615"]]),Co=rt({props:{aprRewardsParameter:{type:Number,default:30},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},fromCoin:{type:Object,default:()=>({})},toCoin:{type:Object,default:()=>({})},poolInfo:{type:Object,default:()=>({})},nameTab:{type:String,default:""}},setup(e){const u=[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}],fe=dt(),H=L(()=>fe);L(()=>H.value.chainName);const U=Ct(),he=L(()=>U),D=L(()=>H.value.chainName?ut(H.value.chainName):{}),q=G(),_=async n=>{var Y,ne,de;console.log("0607###detail###getAprMethod###poolInfo###",n),console.log("0607###detail###getAprMethod###props.fromCoin###",e.fromCoin),console.log("0607###detail###getAprMethod###props.toCoin###",e.toCoin),console.log("0607###detail###getAprMethod###props.nameTab###",e.nameTab);let W;n.token_a.address.toLowerCase()===e.fromCoin.address.toLowerCase()&&n.token_b.address.toLowerCase()===e.toCoin.address.toLowerCase()?W=!0:W=!1,console.log("0607###detail###getAprMethod###directs###",W),console.log("0607###detail###getAprMethod###props.minPrice###",e.minPrice),console.log("0607###detail###getAprMethod###props.maxPrice###",e.maxPrice);let V,f;W?(V=Number(e.minPrice),f=isNaN(Number(e.maxPrice))?2**50:Number(e.maxPrice)):e.maxPrice!=="∞"?(V=1/Number(e.maxPrice),f=1/Number(e.minPrice)):(V=1/2**50,f=2**50),console.log("0607###detail###getAprMethod###lowerUserPrice###",V),console.log("0607###detail###getAprMethod###upperUserPrice###",f);let l=[];l=H.value&&H.value.addressHistTokens&&H.value.addressHistTokens[n.poolAddress]&&H.value.addressHistTokens[n.poolAddress].data&&H.value.addressHistTokens[n.poolAddress].data.length>0&&Object.fromEntries(H.value.addressHistTokens[n.poolAddress].data.map(g=>[g.key,g.value]));let K,i;console.log(l,"===>addressHistTokensList"),e.aprRewardsParameter==7?(K=Number(l==null?void 0:l.before_7_d_contract_price_lowest),i=Number(l==null?void 0:l.before_7_d_contract_price_highest)):e.aprRewardsParameter==24?(K=Number(l==null?void 0:l.before_24_h_contract_price_lowest),i=Number(l==null?void 0:l.before_24_h_contract_price_highest)):(K=Number(l==null?void 0:l.before_30_d_contract_price_lowest),i=Number(l==null?void 0:l.before_30_d_contract_price_highest));const b=he.value.tokensObj;console.log("getEstPositionAPRWithMulti###params###lowerUserPrice###",V),console.log("getEstPositionAPRWithMulti###params###upperUserPrice###",f),console.log("getEstPositionAPRWithMulti###params###lowerHistPrice###",K),console.log("getEstPositionAPRWithMulti###params###upperHistPrice###",i);const c=await D.value.getEstPositionAPRWithMulti(V,f,K,i);console.log("getEstPositionAPRWithMulti###resMulti###",c.toString());const d=H.value.newTopPoolsObj[n.poolAddress];console.log(n,"#####stats");let B;if(d){e.aprRewardsParameter==7?B=Number(d.apr_7day.replace("%","")):e.aprRewardsParameter==24?B=Number(d.apr_24h.replace("%","")):B=Number(d.apr_30day.replace("%",""));const g=Number(d.rewarder_apr[0].replace("%","")),M=Number(d.rewarder_apr[1].replace("%","")),F=Number(d.rewarder_apr[2].replace("%","")),S=new s(c.toString()).mul(B).toNumber();console.log(c.toString(),"===>resMulti.toString()");const C=new s(c.toString()).mul(g).toNumber(),X=new s(c.toString()).mul(M).toNumber(),R=new s(c.toString()).mul(F).toNumber();console.log(C,X,R,"posRewarder2_apr##");const E=S+(n.rewarder_display1?C:0)+(n.rewarder_display2?X:0)+(n.rewarder_display3?R:0);console.log(E,"###aprPercentageTotal");const $=n.rewarder_infos[0]?(Y=b[n.rewarder_infos[0].coinAddress])==null?void 0:Y.symbol:"--",qe=n.rewarder_infos[1]?(ne=b[n.rewarder_infos[1].coinAddress])==null?void 0:ne.symbol:"--",N=n.rewarder_infos[2]?(de=b[n.rewarder_infos[2].coinAddress])==null?void 0:de.symbol:"--",ie={aprFee:S==1/0||isNaN(S)?0:S,rewardAprList:[{rewarder_name:$,rewarder_apr:C==1/0||isNaN(C)?0:C,styleName:"one",rewarder_display:n.rewarder_display1},{rewarder_name:qe,rewarder_apr:X==1/0||isNaN(X)?0:X,styleName:"two",rewarder_display:n.rewarder_display2},{rewarder_name:N,rewarder_apr:R==1/0||isNaN(R)?0:R,styleName:"three",rewarder_display:n.rewarder_display2}],aprPercentageTotal:E==1/0||isNaN(E)||E===0?0:E,aprPercentage:Qt(S/E,2),is_display_rewarder:n.is_display_rewarder};q.value=ie,console.log(q.value,"===>aprPercentageObj.value")}};Le(()=>[e.poolInfo,e.minPrice,e.maxPrice,H.value.addressHistTokens],([n,W,V,f])=>{n&&!Ie(n)&&f&&!Ie(f)&&_(n)},{immediate:!0});const Q=L(()=>so(e.poolInfo,he,H));Le(()=>[e.aprRewardsParameter],()=>{_(e.poolInfo)});const a=L(()=>{const n=q.value;return n&&n.is_display_rewarder?(n==null?void 0:n.aprPercentageTotal)>1e4?">10000":n.aprPercentageTotal<.01&&n.aprPercentageTotal>0?"<0.01":Ue(n.aprPercentageTotal,2):n&&!n.is_display_rewarder?(n==null?void 0:n.aprFee)>1e4?">10000":n.aprFee<.01&&n.aprFee>0?"<0.01":Ue(n.aprFee,2):"--"});return{poolMoreInfo:Q,timeList:u,aprPercentageObj:q,totalApr:a}}}),Po=""+globalThis.__publicAssetsURL("sui-image/farming.png");const mt=e=>(Rt("data-v-514c80fc"),e=e(),Ot(),e),To={class:"est-apr"},So=mt(()=>r("div",{class:"title"},"Estimated APR",-1)),No={class:"apr-total"},Ao={class:"apr-box"},Lo={key:0,class:"apr-hover-content"},Io={class:"progress-fees progress-all"},qo=mt(()=>r("div",null,[r("div",{class:"light-hint"}),ct(" Fees ")],-1)),Mo={key:0,class:"isFarming"},$o=mt(()=>r("img",{src:Po,alt:""},null,-1)),Ro=mt(()=>r("div",{class:"hover-text"},"Farming rewards available",-1)),Oo=[$o,Ro],Bo={class:"time-list"},Fo=["onClick"];function jo(e,u,fe,H,U,he){var D,q,_,Q,a,n,W,V;return k(),I("div",To,[So,r("div",No,[r("div",Ao,[r("span",{class:Ze(e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?"haveBorder":"")},se(e.totalApr)+"%",3),e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?(k(),I("div",Lo,[r("div",Io,[qo,r("span",null,"  "+se(Number((D=e.aprPercentageObj)==null?void 0:D.aprFee)==0?0:(q=e.aprPercentageObj)!=null&&q.aprFee?((_=e.aprPercentageObj)==null?void 0:_.aprFee)>1e4?">10,000":((Q=e.aprPercentageObj)==null?void 0:Q.aprFee)<.01?"<0.01":("addCommom"in e?e.addCommom:Te(Ue))((a=e.aprPercentageObj)==null?void 0:a.aprFee,2):(n=e.aprPercentageObj)!=null&&n.rewardAprList?"<0.01":"--")+"%",1)]),(k(!0),I(it,null,wt((W=e.aprPercentageObj)==null?void 0:W.rewardAprList,f=>Pt((k(),I("div",{key:f,class:"progress-rewards progress-all"},[r("div",null,[r("div",{class:Ze(["light-hint",f==null?void 0:f.styleName])},null,2),ct(" "+se(f==null?void 0:f.rewarder_name)+" Rewards ",1)]),r("span",null,"  "+se(f!=null&&f.rewarder_apr?(f==null?void 0:f.rewarder_apr)>1e4?">10,000":(f==null?void 0:f.rewarder_apr)<.01?"<0.01":("addCommom"in e?e.addCommom:Te(Ue))(f==null?void 0:f.rewarder_apr,2):"0")+"%",1)])),[[$t,(f==null?void 0:f.rewarder_name)!="--"&&f.rewarder_display&&e.aprPercentageObj.is_display_rewarder]])),128))])):te("",!0)]),(V=e.poolInfo)!=null&&V.is_display_rewarder&&e.poolMoreInfo&&e.poolMoreInfo.rewardes&&e.poolMoreInfo.rewardes.length>0?(k(),I("div",Mo,Oo)):te("",!0)]),r("div",Bo,[(k(!0),I(it,null,wt(e.timeList,f=>(k(),I("div",{key:f.value,class:Ze(["time-item",f.value==e.aprRewardsParameter?"time-item-active":""]),onClick:l=>e.$emit("changeAprRewardsParameter",f.value)},se(f.label),11,Fo))),128))])])}const Wt=nt(Co,[["render",jo],["__scopeId","data-v-514c80fc"]]),Uo=rt({components:{NewLiquidityD3Chart:Et,NewLiquidityApr:Wt,NewLiquidityPrice:jt},setup(){const{t:e,locale:u}=Bt(),fe=G("liquidity"),H=dt(),U=L(()=>H),he=L(()=>U.value.chainName),D=Ct(),q=L(()=>D),_=L(()=>U.value.chainName?ut(U.value.chainName):{});Mt(()=>{ot.value=!1});const Q=St(),a=L(()=>{let t=null;for(let h=0;h<q.value.poolConfigList.length;h++){const O=q.value.poolConfigList[h];O.address==Q.query.poolAddress&&(t=O)}return console.log(t,"===>basePoolInfo"),t}),n=L(()=>{let t=null;for(const h in q.value.poolsObj){const O=q.value.poolsObj[h];O.address==Q.query.poolAddress&&(console.log(O,"p===>"),t=O)}return t}),W=G(),V=G(!0),f=async(t,h)=>{if(h){V.value=!0;const O=t.token_a.decimals,z=t.token_b.decimals;console.log(t,"pool===>1111"),st.value=Nt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,O,z).toString(),_t.value=new s(1).div(Nt.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,O,z)).toString(),T.value=t.needReverse?t.token_b:t.token_a,y.value=t.needReverse?t.token_a:t.token_b,W.value=t.needReverse,t.token_a.address.toLowerCase()===T.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===y.value.address.toLowerCase()?Oe.value=!0:Oe.value=!1,console.log(t,"187===>"),console.log(t,"###pool===>");let ae={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const ge=await _.value.getTicks(ae);tt.value=ge?_.value.getTickDataFromUrlData(ge):[],console.log(tt.value,"===>chartLoadingtickList.value"),i(t)}V.value=!1,console.log(V.value,"==>chartLoading.value")},l=G([]),K=G(),i=t=>{const h=t.token_a.decimals,O=t.token_b.decimals;let z=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[t.address]&&q.value.poolPriceConfigObj[t.address].recommend_ranges||{};const ae=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[t.address]&&q.value.poolPriceConfigObj[t.address].type||"";console.log(z,"===>priceConfigList");let ge,le;const Be=t.current_tick_index;K.value=t.current_tick_index,console.log(Be,t.tickSpacing,"==>pool.tickSpacing"),ge=Be-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),le=Be+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const Ge=_.value.TickMath.tickIndexToPrice(ge,h,O).toString(),De=_.value.TickMath.tickIndexToPrice(le,h,O).toString();z["full range"]={lower:_.value.TickUtil.getMinIndex(Number(n.value.tickSpacing)),upper:_.value.TickUtil.getMaxIndex(Number(n.value.tickSpacing))},z.custom={lower:ge,upper:le,minPrice:Ge,maxPrice:De};const ye=[];for(let we in z)z[we]&&(console.log(we,"j==>"),ye.push({...z[we],key:we}));console.log(ye,"priceList"),console.log(t,"###pool.type 504"),ae?t.isSelfBuilt?ee.value="custom":ae=="stable"?ee.value="suggested":ee.value="passive":ee.value="custom",l.value=ye,Qe.value=z,d({key:ee.value,...z[ee.value]})},b=G(""),c=G(""),d=t=>{console.log("priceTab====>",t),console.log("priceTab###poolInfo###",n.value),ee.value=t.key.toLowerCase();const h=n.value.token_a.decimals,O=n.value.token_b.decimals,{lower:z,upper:ae}=t;We.value=!1;const ge=_.value.TickMath.tickIndexToPrice(z,h,O).toString(),le=_.value.TickMath.tickIndexToPrice(ae,h,O).toString();if(t.key=="full range"){b.value=z,c.value=ae,B();return}console.log(Oe.value,"===>direct.value"),Oe.value?(ft.value=String(ge),Z.value=String(ge),gt.value=String(le),j.value=String(le),b.value=z,c.value=ae):(ft.value=String(1/Number(le)),Z.value=String(1/Number(le)),gt.value=String(1/Number(ge)),j.value=String(1/Number(ge)),b.value=_.value.TickMath.priceToTickIndex(new s(1/Number(le)),h,O),c.value=_.value.TickMath.priceToTickIndex(new s(1/Number(ge)),h,O)),console.log(Z.value,j.value,"===>111")},B=t=>{Z.value="0",j.value="∞"};Le(()=>n.value,(t,h)=>{console.log(h,"===>oldVal"),console.log(t,"===>newVal"),(!h&&t&&!Ie(t)||h&&t&&h.address!==t.address)&&(console.log("池子信息"),f(t,!h||t.address!==h.address))},{immediate:!0}),Ft(()=>{tt.value=[]}),Le(()=>[a.value,n.value,q.value.recommendRangesObj],(t,h)=>{var O,z;console.log(t,"===>newValue369"),console.log(h,"===>oldValue369"),(!h||t[0]&&t[1]&&t[2]&&!Ie(t[0])&&!Ie(t[1]&&!Ie(t[2]))||((O=t[0])==null?void 0:O.address)!==((z=h[0])==null?void 0:z.address))&&t[0]&&t[2]&&!Ie(t[0])&&!Ie(t[2])&&(console.log(t[0],t[2],"======>374"),D.setSinglePool(t[0],t[2],he.value))},{immediate:!0,deep:!0});const Y=t=>{if(he.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},ne=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},de=t=>{var O,z;const h=q.value.poolPriceConfigObj&&q.value.poolPriceConfigObj[(O=n.value)==null?void 0:O.address]&&q.value.poolPriceConfigObj[(z=n.value)==null?void 0:z.address].type||"";if(console.log(h,t,"==>poolType"),h=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}},g=G(1),M=()=>{const t=g.value/2;g.value=t},F=()=>{const t=g.value*2;g.value=t};console.log(l.value,"==>priceTablList");const S=L(()=>{var t,h,O;return!n.value||Ie(U.value.addressHistTokens)||!U.value.addressHistTokens[(t=n.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((O=U.value.addressHistTokens[(h=n.value)==null?void 0:h.poolAddress])==null?void 0:O.data.map(z=>[z.key,z.value]))}),C=G(30),X=G("30D"),R=L(()=>Oe.value?S.value&&Se(C.value==7?S.value.before_7_d_contract_price_lowest:C.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest,6)||0:S.value&&Se(new s(1).div(C.value==7?S.value.before_7_d_contract_price_highest:C.value==24?S.value.before_24_h_contract_price_highest:S.value.before_30_d_contract_price_highest).toString(),6)||0),E=L(()=>Oe.value?S.value&&Se(C.value==7?S.value.before_7_d_contract_price_highest:C.value==24?S.value.before_24_h_contract_price_highest:S.value.before_30_d_contract_price_highest,6)||0:(S.value&&Se(1/Number(C.value==7?S.value.before_7_d_contract_price_lowest:C.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest),6))==1/0?0:S.value&&Se(1/Number(C.value==7?S.value.before_7_d_contract_price_lowest:C.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest),6)||0),$=L(()=>{const t=Number(Z.value),h=Number(j.value);return Z.value&&j.value&&Z.value!=="0"&&j.value!=="∞"?bt(1/(1-Number((t/h)**.25)),2)+"x":1}),qe=L(()=>{var t,h,O,z,ae,ge;return((t=T.value)==null?void 0:t.isSelfBuilt)||((h=y.value)==null?void 0:h.isSelfBuilt)||((z=q.value.tokensObj[(O=T.value)==null?void 0:O.address])==null?void 0:z.isSelfBuilt)||((ge=q.value.tokensObj[(ae=y.value)==null?void 0:ae.address])==null?void 0:ge.isSelfBuilt)}),N=t=>{console.log(t,"####0731 priceRangeChangeMin"),t!==Z.value&&ee.value=="full range"?(console.log(l.value,"===>priceTablList"),d({key:"custom",...l.value.custom})):ee.value!=="full range"&&ee.value!=="custom"?(ee.value="custom",Z.value=t):Z.value=t},ie=t=>{console.log(t,"###priceRangeChangeMax maxPirce"),t!==j.value&&ee.value=="full range"?d({key:"custom",...l.value.custom}):ee.value!=="full range"&&ee.value!=="custom"?(ee.value="custom",t=="0"?j.value="∞":j.value=t):j.value=t};return console.log(Z.value,j.value,"683==>"),Le(()=>[Z.value,j.value],([t,h])=>{console.log(t,h,"minmax new-liquidity-left")},{deep:!0,immediate:!0}),{positionError:ot,getCoinIcon:t=>{var h;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((h=q.value.tokensObj[t==null?void 0:t.address])==null?void 0:h.logo_url)||(U.value.theme==="default"?yt("/image/coins/unknown.png"):yt("/image/coins/sui-unknown.png"))},chainName:he,store:U,currentTab:fe,currentPrice:st,currentPriceReverse:_t,fromCoin:T,toCoin:y,direction:Oe,needReverse:W,addCommom:Ue,decimalUi:Se,priceTablList:l,currentPriceTab:ee,sliderStyle:de,poolInfo:n,tickList:tt,getPriceTabImage:Y,getPriceTabText:ne,defaultMinPrice:ft,defaultMaxPrice:gt,minPrice:Z,maxPrice:j,currentTick:K,chartLoading:V,zoomOut:M,zoomIn:F,zoom:g,priceTab:d,before7dContractPriceLowest:R,before7dContractPriceHighest:E,aprRewardsTime:X,lever:$,aprRewardsParameter:C,isSelfBuilt:qe,priceRangeChangeMin:N,priceRangeChangeMax:ie,toggle:Dt,getPirceTabTips:t=>{switch(t){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}}}}});const zo={class:"new-liquidity-left"},Ho={class:"select-range"},Do=r("span",null,"Select Range",-1),Eo={class:"range-tab"},Wo=["src"],Xo=["src"],Zo=r("span",null,"Liquidity",-1),Go=["src"],Ko=["src"],Jo=r("span",null,"Price",-1),Qo={class:"price-info"},Yo={class:"left"},xo={class:"base-coin"},Vo={class:"base-coin-title"},ei=r("span",null,"Base coin",-1),ti=r("svg",{class:"icon icon-up","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_up1"})],-1),oi=r("svg",{class:"icon icon-down","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_down1"})],-1),ii=[ti,oi],ri={class:"base-coin-bottom"},ni={alt:""},ai={class:"leverage"},li=r("div",{class:"leverage-title"},"Leverage",-1),si={class:"laverage-value"},ui={class:"current-price"},ci=r("div",{class:"current-price-title"},"Current Price",-1),di={key:0,class:"from-pre-to"},mi={class:"right"},vi={class:"price-range"},fi={class:"left"},gi={class:"price-slider"},pi={class:"slider"},bi=r("div",{class:"slider-ratio-content"},null,-1),hi=[bi],wi={class:"price-tab-list"},ki=["onClick"],yi=["src"],_i={class:"right"},Ci={class:"range-tab"},Pi=["src"],Ti=["src"],Si=r("span",null,"Liquidity",-1),Ni=["src"],Ai=["src"],Li=r("span",null,"Price",-1),Ii={class:"price-zoom"},qi={class:"current-price"},Mi=r("div",{class:"current-price-title"},"Current Price",-1),$i={key:0,class:"from-pre-to"},Ri={class:"price-zoom-right"},Oi={class:"leverage"},Bi={class:"left"},Fi={key:0,class:"leverage-title"},ji={key:1,class:"laverage-value"},Ui={class:"right"},zi={key:0,class:"day-7-price-range"},Hi=r("i",null,null,-1),Di={class:"gray"},Ei={key:0,class:"position-tips"},Wi=["src"],Xi={class:"error"};function Zi(e,u,fe,H,U,he){var W,V,f,l,K,i,b,c;const D=xt,q=Et,_=Tt,Q=Wt,a=jt,n=Yt("image");return k(),I("div",zo,[r("div",Ho,[Do,r("div",Eo,[r("div",{class:Ze(["liquidity",e.currentTab=="liquidity"?"liquidity-tab-active":""]),onClick:u[0]||(u[0]=d=>e.currentTab="liquidity")},[e.chainName=="Sui"?(k(),I("img",{key:0,src:e.currentTab=="liquidity"?"/sui-image/Liquidity-Sel.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Wo)):(k(),I("img",{key:1,src:e.currentTab=="liquidity"?"/image/green_chart.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Xo)),Zo],2),r("div",{class:Ze(["price",e.currentTab=="price"?"price-tab-active":""]),onClick:u[1]||(u[1]=d=>e.currentTab="price")},[e.chainName=="Sui"?(k(),I("img",{key:0,src:e.currentTab=="price"?"/sui-image/Price-Sel.png":"/sui-image/Price-Def.png",alt:""},null,8,Go)):(k(),I("img",{key:1,src:e.currentTab=="price"?"/image/price-chart.png":"/sui-image/Price-Def.png",alt:""},null,8,Ko)),Jo],2)])]),r("div",Qo,[r("div",Yo,[r("div",xo,[r("div",Vo,[ei,r("div",{class:"change-price",onClick:u[2]||(u[2]=(...d)=>e.toggle&&e.toggle(...d))},ii)]),r("div",ri,[Pt(r("img",ni,null,512),[[n,e.getCoinIcon(e.fromCoin)]]),r("span",null,se((W=e.fromCoin)==null?void 0:W.symbol),1)])]),r("div",ai,[li,r("div",si,se(e.lever),1)]),r("div",ui,[ci,r("div",null,[r("span",null,se(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(k(),I("span",di,se((V=e.toCoin)==null?void 0:V.symbol)+" per "+se((f=e.fromCoin)==null?void 0:f.symbol),1)):te("",!0)])])]),r("div",mi,[e.currentTab=="liquidity"?(k(),I("div",{key:0,class:"zoom-in",onClick:u[3]||(u[3]=(...d)=>e.zoomIn&&e.zoomIn(...d))}," - ")):te("",!0),e.currentTab=="liquidity"?(k(),I("div",{key:1,class:"zoom-out",onClick:u[4]||(u[4]=(...d)=>e.zoomOut&&e.zoomOut(...d))}," + ")):te("",!0)])]),r("div",vi,[r("div",fi,[r("div",gi,[r("div",pi,[r("div",{class:"slider-ratio",style:ht(e.sliderStyle(e.currentPriceTab))},hi,4)])]),r("div",wi,[(k(!0),I(it,null,wt(e.priceTablList,d=>(k(),I("div",{key:d.key,class:Ze(["price-tab-item",e.currentPriceTab==d.key?"price-tab-item-active":""]),onClick:B=>e.priceTab(d)},[He(D,{placement:"bottom","arrow-point-at-center":""},{title:kt(()=>[ct(se(e.getPirceTabTips(d.key)),1)]),default:kt(()=>[r("img",{src:e.getPriceTabImage(d.key),alt:""},null,8,yi),r("span",null,se(e.getPriceTabText(d.key)),1)]),_:2},1024)],10,ki))),128))])]),r("div",_i,[r("div",Ci,[r("div",{class:Ze(["liquidity",e.currentTab=="liquidity"?"liquidity-tab-active":""]),onClick:u[5]||(u[5]=d=>e.currentTab="liquidity")},[e.chainName=="Sui"?(k(),I("img",{key:0,src:e.currentTab=="liquidity"?"/sui-image/Liquidity-Sel.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Pi)):(k(),I("img",{key:1,src:e.currentTab=="liquidity"?"/image/green_chart.png":"/sui-image/Liquidity-Def.png",alt:""},null,8,Ti)),Si],2),r("div",{class:Ze(["price",e.currentTab=="price"?"price-tab-active":""]),onClick:u[6]||(u[6]=d=>e.currentTab="price")},[e.chainName=="Sui"?(k(),I("img",{key:0,src:e.currentTab=="price"?"/sui-image/Price-Sel.png":"/sui-image/Price-Def.png",alt:""},null,8,Ni)):(k(),I("img",{key:1,src:e.currentTab=="price"?"/image/price-chart.png":"/sui-image/Price-Def.png",alt:""},null,8,Ai)),Li],2)]),r("div",Ii,[r("div",qi,[Mi,r("div",null,[r("span",null,se(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPrice,6)):("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(k(),I("span",$i,se(e.direction&&!e.needReverse?`${(l=e.fromCoin)==null?void 0:l.symbol} per ${(K=e.toCoin)==null?void 0:K.symbol}`:`${(i=e.toCoin)==null?void 0:i.symbol} per ${(b=e.fromCoin)==null?void 0:b.symbol}`),1)):te("",!0)])]),r("div",Ri,[e.currentTab=="liquidity"?(k(),I("div",{key:0,class:"zoom-in",onClick:u[7]||(u[7]=(...d)=>e.zoomIn&&e.zoomIn(...d))}," - ")):te("",!0),e.currentTab=="liquidity"?(k(),I("div",{key:1,class:"zoom-out",onClick:u[8]||(u[8]=(...d)=>e.zoomOut&&e.zoomOut(...d))}," + ")):te("",!0)])]),e.fromCoin&&e.toCoin&&e.poolInfo&&e.currentTab=="liquidity"?(k(),Je(q,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):te("",!0),((c=e.tickList)==null?void 0:c.length)<=0&&e.chartLoading?(k(),Je(_,{key:1})):te("",!0)])]),r("div",Oi,[r("div",Bi,[e.currentPriceTab!=="full range"?(k(),I("div",Fi,"Leverage")):te("",!0),e.currentPriceTab!=="full range"?(k(),I("div",ji,se(e.lever),1)):te("",!0)]),r("div",Ui,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(k(),I("div",zi,[Hi,r("span",Di,se(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),r("span",null,se(("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.before7dContractPriceLowest,6)))+" - "+se(("addCommom"in e?e.addCommom:Te(Ue))(("decimalUi"in e?e.decimalUi:Te(Se))(e.before7dContractPriceHighest,6))),1)])):te("",!0)])]),r("div",{class:Ze(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[He(Q,{"apr-rewards-parameter":e.aprRewardsParameter,"name-tab":"deposit","from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,onChangeAprRewardsParameter:u[9]||(u[9]=d=>{e.aprRewardsParameter=d})},null,8,["apr-rewards-parameter","from-coin","to-coin","pool-info","min-price","max-price"]),He(a,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(k(),I("div",Ei,[r("img",{src:("importIcon"in e?e.importIcon:Te(yt))("/image/icon-tips-error@2x.png"),alt:""},null,8,Wi),r("p",Xi,se(e.$t("tips.positionError")),1)])):te("",!0)],2)])}const Xt=nt(Uo,[["render",Zi]]),Gi=rt({components:{NewLiquidityTitle:Ut,NewLiquidityAssetsCard:zt,NewLiquidityDepositRatio:Ht},setup(){const{t:e,locale:u}=Bt(),fe=dt(),H=L(()=>fe),U=L(()=>H.value.chainName),he=Ct(),D=L(()=>he),q=lo(),_=L(()=>q),Q=St(),a=L(()=>{let o=null;for(const p in D.value.poolsObj){const w=D.value.poolsObj[p];w.address==Q.query.poolAddress&&(console.log(w,"p===>"),o=w)}return o}),n=G(!1),W=G(!1),V=L(()=>H.value.theme),f=async(o,p)=>{T.value=o.needReverse?o.token_b:o.token_a,y.value=o.needReverse?o.token_a:o.token_b,P.value="",A.value=""};Le(()=>a.value,(o,p)=>{console.log(p,"===>oldVal"),console.log(o,"===>newVal"),(!p&&o&&!Ie(o)||p&&o&&p.address!==o.address)&&(console.log("池子信息"),f(o,!p||o.address!==p.address))},{immediate:!0});const l=L(()=>_.value.assets&&T.value&&_.value.assets[T.value.address]?At(_.value.assets[T.value.address].balance,T.value.decimals):"0"),K=L(()=>_.value.assets&&y.value&&_.value.assets[y.value.address]?At(_.value.assets[y.value.address].balance,y.value.decimals):"0"),i=o=>{o==="fromCoin"?(Pe.value=!0,U.value==="Aptos"?P.value=Number(l.value)>0?T.value.symbol=="APT"?new s(Number(l.value)).sub(new s(.1)).lt(new s(0))?"0":new s(Number(l.value)).sub(new s(.1)).toString():String(l.value):"":P.value=Number(l.value)>0?T.value.symbol=="SUI"?new s(Number(l.value)).sub(new s(.05)).lt(new s(0))?"0":new s(Number(l.value)).sub(new s(.05)).toString():String(l.value):""):(Pe.value=!1,U.value==="Aptos"?A.value=Number(K.value)>0?y.value.symbol=="APT"?new s(Number(K.value)).sub(new s(.1)).lt(new s(0))?"0":new s(Number(K.value)).sub(new s(.1)).toString():String(K.value):"":A.value=Number(K.value)>0?y.value.symbol=="SUI"?new s(Number(K.value)).sub(new s(.05)).lt(new s(0))?"0":new s(Number(K.value)).sub(new s(.05)).toString():String(K.value):"")},b=o=>{o==="fromCoin"?(Pe.value=!0,P.value=Number(l.value)>0?bt(new s(Number(l.value)).div(2).toString(),T.value.decimals).toString():""):(Pe.value=!1,A.value=Number(K.value)>0?bt(new s(Number(K.value)).div(2).toString(),y.value.decimals).toString():"")},c=G(),d=G(),B=G(),Y=G(!1),ne=o=>{var p,w,ue,J;c.value=o,o==="fromCoin"?(d.value=((p=y.value)==null?void 0:p.address)||"",B.value=Q.query.actions=="new-position"?(w=T.value)==null?void 0:w.address:a.value.needReverse?a.value.token_b.address:a.value.token_a.address):(d.value=((ue=T.value)==null?void 0:ue.address)||"",B.value=Q.query.actions=="new-position"?(J=y.value)==null?void 0:J.address:a.value.needReverse?a.value.token_a.address:a.value.token_b.address),Y.value=!0,console.log(Y.value,"==>showCoinSelect.value ")},de=o=>{var ue,J,ce,me,ve,re,oe,_e;const p=a.value.needReverse?a.value.token_b:a.value.token_a,w=a.value.needReverse?a.value.token_a:a.value.token_b;c.value==="fromCoin"?(((ue=T.value)==null?void 0:ue.address)===(p==null?void 0:p.address)||!((J=T.value)!=null&&J.address)?(y.value&&o.address.toLowerCase()===((ce=y)==null?void 0:ce.value.address.toLowerCase())&&(y.value=null),T.value=o):(T.value&&o.address.toLowerCase()===((me=T)==null?void 0:me.value.address.toLowerCase())&&(T.value=null),y.value=o),Q.query.action||(Q.query.fee="")):((ve=y.value)==null?void 0:ve.address)===(w==null?void 0:w.address)||!((re=y.value)!=null&&re.address)?(T.value&&o.address.toLowerCase()===((oe=T)==null?void 0:oe.value.address.toLowerCase())&&(T.value=null),y.value=o):(y.value&&o.address.toLowerCase()===((_e=y)==null?void 0:_e.value.address.toLowerCase())&&(y.value=null),T.value=o),Y.value=!1},g=L(()=>H.value.chainName?ut(H.value.chainName):{}),M=L(()=>H.value.slippage),F=G(),S=async()=>{var je,Ae,$e,Re;if(We.value)return console.log("跳出"),!1;if(!Z.value&&!j.value)return!1;if(!P.value&&!A.value&&!Z.value&&!j.value)return;const o=a.value||{};if(Ie(o))return;const{TickUtil:p,TickMath:w,getNearestTickByTick:ue}=g.value,J=o==null?void 0:o.token_a.decimals,ce=o==null?void 0:o.token_b.decimals;let me,ve,re,oe,_e,Ne,Xe,Ke,ke=o==null?void 0:o.current_tick_index,x;if(o.token_a.address.toLowerCase()===T.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===y.value.address.toLowerCase()?x=!0:x=!1,Z.value==="0"&&j.value==="∞")re=p.getMinIndex(Number(o.tickSpacing)),oe=p.getMaxIndex(Number(o.tickSpacing)),_e=w.tickIndexToSqrtPriceX64(re),Ne=w.tickIndexToSqrtPriceX64(oe),console.log(re,oe,"#######updateAmounts 513");else if(ee.value=="custom"){console.log(x,"===>directs1866"),x?(me=Number(Z.value),ve=Number(j.value)):(me=new s(1).div(j.value).toString(),ve=new s(1).div(Z.value).toString());try{Xe=me==0?-443636:w.priceToTickIndex(new s(me),J,ce)}catch{Xe=-443636}try{Ke=w.priceToTickIndex(new s(ve),J,ce)}catch{Ke=443636}re=ue(Xe,Number(o.tickSpacing)),oe=ue(Ke,Number(o.tickSpacing)),_e=w.priceToSqrtPriceX64(new s(me),J,ce);try{Ne=w.priceToSqrtPriceX64(new s(ve),J,ce)}catch{console.log("0523###test###max###",ve),ve===1/0&&(console.log("0523###test###max###11111"),Ne=w.tickIndexToSqrtPriceX64(p.getMaxIndex(Number(o.tickSpacing))))}console.log("0518###pre###tick_lower###",re,oe,ke),console.log("0518###pre###tick_upper###",oe)}else re=(je=Qe.value[ee.value])==null?void 0:je.lower,oe=(Ae=Qe.value[ee.value])==null?void 0:Ae.upper,_e=w.tickIndexToSqrtPriceX64(re),Ne=w.tickIndexToSqrtPriceX64(oe);if(j.value!=="∞"&&re>=oe){n.value=!0,P.value="",W.value=!0,A.value="";return}if(console.log(oe,ke,re,"1922"),j.value==="∞"||ke>=re&&ke<=oe){n.value=!1,W.value=!1;let Ce;if(P.value||A.value){if(Pe.value){const vt=new s(P.value).mul(Math.pow(10,T.value.decimals)).toString();Ce=new ze(vt)}else{const vt=new s(A.value).mul(Math.pow(10,y.value.decimals)).toString();Ce=new ze(vt)}console.log(x,"======>directs");const{liquidityAmount:Ee,tokenMaxA:Ve,tokenMaxB:et,tokenMaxAOrigin:Gt,tokenMaxBOrigin:Kt}=g.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:re,upperTick:oe,coinAmount:Ce,iscoinA:x?Pe.value:!Pe.value,roundUp:!0,slippage:Number(M.value)/100,curSqrtPrice:new ze(o.current_sqrt_price)});F.value={liquidityAmount:Ee,tokenMaxA:Ve,tokenMaxB:et,tokenMaxAOrigin:Gt,tokenMaxBOrigin:Kt},console.log(Ve,et,"preAdd"),x?Pe.value?A.value=Number(et)>0?et:"":P.value=Number(Ve)>0?Ve:"":Pe.value?A.value=Ve:P.value=et}}else if(ke>oe){if(x?P.value="":A.value="",n.value=x,W.value=!x,P.value||A.value){let Ce;if(x){const Ee=new s(A.value).mul(Math.pow(10,($e=y.value)==null?void 0:$e.decimals)).toString();Ce=new ze(Ee),F.value={liquidityAmount:g.value.estimateLiquidityForCoinB(_e,Ne,Ce),tokenMaxA:0,tokenMaxB:A.value}}else{const Ee=new s(P.value).mul(Math.pow(10,(Re=T.value)==null?void 0:Re.decimals)).toString();Ce=new ze(Ee),F.value={liquidityAmount:g.value.estimateLiquidityForCoinB(_e,Ne,Ce),tokenMaxA:0,tokenMaxB:P.value}}}}else if(ke<re){if(n.value=!x,W.value=x,x?A.value="":P.value="",P.value||A.value){let Ce;if(x){const Ee=new s(P.value).mul(Math.pow(10,T.value.decimals)).toString();Ce=new ze(Ee),F.value={liquidityAmount:g.value.estimateLiquidityForCoinA(_e,Ne,Ce),tokenMaxA:P.value,tokenMaxB:0}}else{const Ee=new s(A.value).mul(Math.pow(10,y.value.decimals)).toString();Ce=new ze(Ee),F.value={liquidityAmount:g.value.estimateLiquidityForCoinA(_e,Ne,Ce),tokenMaxA:A.value,tokenMaxB:0}}}}else n.value=!0,P.value="",W.value=!0,A.value=""};Le(P,(o,p)=>{console.log(P,"===>fromCoinAmount"),o==""&&Pe.value&&(A.value=""),o&&Pe.value&&!We.value&&S()}),Le(A,(o,p)=>{console.log(o,"===>>>>newValsda"),o==""&&!Pe.value&&(P.value=""),o&&!Pe.value&&!We.value&&S()});const C=G("--"),X=L(()=>D.value.RATES),R=()=>{const o=X.value&&X.value[T.value.address]&&X.value[T.value.address].price,p=X.value&&X.value[y.value.address]&&X.value[y.value.address].price;if(o&&p){const w=new s(P.value>0?P.value:0).mul(o),ue=new s(A.value>0?A.value:0).mul(p),J=w.add(ue).toNumber();C.value=J>0&&J<.01?"$<0.01":"$"+Ue(J,2)}else C.value="--"};Le(()=>[P.value,A.value,We.value],([o,p,w])=>{(o||p)&&!w?R():(!o||!p)&&!w&&(C.value="--")},{immediate:!0}),Le(()=>C,o=>{console.log(o,"71911111")},{immediate:!0});const E=G(),$=async()=>{var x,je;if(!Z.value&&!j.value)return!1;if(!P.value&&!A.value&&!Z.value&&!j.value)return;const o=a.value;if(Ie(o))return;const{TickUtil:p,TickMath:w,getNearestTickByTick:ue}=g.value,J=o==null?void 0:o.token_a.decimals,ce=o==null?void 0:o.token_b.decimals;let me,ve,re,oe,_e,Ne,Xe;if(o.token_a.address.toLowerCase()===T.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===y.value.address.toLowerCase()?Xe=!0:Xe=!1,Z.value==="0"&&j.value==="∞")re=p.getMinIndex(Number(o.tickSpacing)),oe=p.getMaxIndex(Number(o.tickSpacing));else if(ee.value=="custom"){Xe?(me=Number(Z.value),ve=Number(j.value)):(me=new s(1).div(j.value).toString(),ve=new s(1).div(Z.value).toString());try{_e=me==0?-443636:w.priceToTickIndex(new s(me),J,ce)}catch{_e=-443636}try{Ne=w.priceToTickIndex(new s(ve),J,ce)}catch{Ne=443636}re=ue(_e,Number(o.tickSpacing)),oe=ue(Ne,Number(o.tickSpacing))}else re=(x=Qe.value[ee.value])==null?void 0:x.lower,oe=(je=Qe.value[ee.value])==null?void 0:je.upper;const Ke=X.value[o==null?void 0:o.token_a.address].price,ke=X.value[o==null?void 0:o.token_b.address].price;Oe.value?new ze(o.current_sqrt_price):new ze(1/o.current_sqrt_price),console.log(Oe.value,"===>direction.value"),console.log(o,"poolInfos===>"),console.log(re,oe,"####tick_lower tick_upper 889"),console.log(C.value,"liquidityTotalAmount.value");try{const{amountA:Ae,amountB:$e,tokenAmountsInfo:Re}=await g.value.estCoinAmountsFromTotalAmount({lowerTick:re,upperTick:oe,decimalsA:J,decimalsB:ce,curSqrtPrice:new ze(o.current_sqrt_price),totalAmount:C.value.replace(/[^\d.]/g,""),tokenPriceA:Ke,tokenPriceB:ke});console.log(Ae,$e,"###estCoinAmountsFromTotalAmount 844"),console.log(o.needReverse,Oe.value,"===>849"),E.value=Re,o.needReverse?Oe.value?(P.value=Ae,A.value=$e):(P.value=$e,A.value=Ae):(P.value=Ae,A.value=$e)}catch(Ae){console.log(Ae,"e===>")}};Le([Z,j],([o,p])=>{console.log(o,p,"==>minPrice,maxPrice"),We.value?We.value&&$():S(),p!=="∞"&&Number(o)!==0&&Number(p)!==0&&Number(o)>=Number(p)?ot.value=!0:ot.value=!1,Number(o)==0&&Number(p)==0&&st.value&&(ot.value=!0,console.log("价格区间错误"))},{deep:!0,immediate:!0});const qe=o=>{console.log(o,"e");const p=o.replace(/[^\d.]/g,""),w="$"+Ue(p);We.value=!0,C.value=w,p>0?$():(P.value="",A.value="")},N=G(!1),{setTransactionTxid:ie,setTransactionDesc:Ye,setIsShowWaiting:Me,setIsShowSuccess:t,setPositiomNum:h,setIsShowRejected:O}=fe,z=fo(),ae=L(()=>D.value.currentPositionInfo),ge=G(!1),le=async o=>{var _e,Ne,Xe,Ke;console.log(a.value,"===> poolInfo.value"),N.value=!1,D.value.currentPositionInfo={},ie(""),Ye(e("tips.increaseLiquiditySuccess",{from:n.value?"":`${P.value} ${(_e=T.value)==null?void 0:_e.symbol}`,and:!n.value&&!W.value?"and":"",to:W.value?"":`${A.value} ${(Ne=y.value)==null?void 0:Ne.symbol}`})),Me(!0);const p=Oe.value?Pe.value:!Pe.value;let w,ue,J,ce,me,ve;const re=a.value.token_a.decimals,oe=a.value.token_b.decimals;if(Z.value==="0"&&j.value==="∞")J=g.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)),ce=g.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing));else if(ee.value=="custom"){Oe.value?(w=Number(Z.value),ue=Number(j.value)):(w=new s(1).div(j.value).toString(),ue=new s(1).div(Z.value).toString()),console.log("0519###toAdd###min###",w),console.log("0519###toAdd###max###",ue),console.log("0519###toAdd###minPrice.value###",Z.value),console.log("0519###toAdd###maxPrice.value###",j.value);try{me=w==0?g.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)):g.value.TickMath.priceToTickIndex(new s(w),re,oe)}catch{me=g.value.TickUtil.getMinIndex(Number(a.value.tickSpacing))}try{ve=g.value.TickMath.priceToTickIndex(new s(ue),re,oe)}catch{ve=g.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing))}J=g.value.getNearestTickByTick(me,Number(a.value.tickSpacing)),ce=g.value.getNearestTickByTick(ve,Number(a.value.tickSpacing))}else J=Qe.value[ee.value].lower,ce=Qe.value[ee.value].upper;console.log(J,ce,"####tick_lower tick_upper 889"),console.log(a.value,"==>poolInfo.value.curSqrtPrice");try{let ke;We.value?ke=await g.value.getCreateAddLiquidityPayload({pool:a.value,curSqrtPrice:new ze(a.value.current_sqrt_price),tickLower:J,tickUpper:ce,slippage:Number(M.value)/100,tokenAmounts:E.value}):ke=await g.value.getAddLiquidityTransactionPayload({pool:{poolAddress:a.value.poolAddress,token_a:a.value.token_a,token_b:a.value.token_b},amount:Pe.value?P.value:A.value,fix_amount_a:p,tick_lower:J,tick_upper:ce,index:0,slippage:Number(M.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new ze(a.value.current_sqrt_price)}),console.log(ke,"payload===?");let x;if(U.value==="Aptos")x=await _.value.currentWallet.signAndSubmitTransaction(ke);else{const je=await _.value.currentWallet.signAndExecuteTransactionBlock(ke);x=g.value.handleTx(je)}if(console.log("0410###tx###",x),x&&x.hash){ie(x.hash),Me(!1),t(!0);let je;a.value.needReverse?a.value.token_a.address.toLowerCase()===T.value.address.toLowerCase()&&a.value.token_b.address.toLowerCase()===y.value.address.toLowerCase()?je=!1:je=!0:a.value.token_a.address.toLowerCase()===T.value.address.toLowerCase()&&a.value.token_b.address.toLowerCase()===y.value.address.toLowerCase()?je=!0:je=!1,console.log(je,"===>directs");const Ae={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:n.value?"":`${P.value} ${(Xe=T.value)==null?void 0:Xe.symbol}`,and:!n.value&&!W.value?"and":"",to:W.value?"":`${A.value} ${(Ke=y.value)==null?void 0:Ke.symbol}`}),hash:x.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};U.value!=="Aptos"&&(Ae.res=x.res),g.value.showTransitionPending(Ae);const $e=await g.value.watchTransaction(Ae,!0);if($e.status){if(t(!1),D.value.setCurrentPositionLoading(!0),ge.value=!0,console.log($e.nftInfo,"===> watchInfo.nftInfo"),U.value==="Aptos"){if(await D.value.setCurrentPositionInfo($e.nftInfo[0].data.id.creator,$e.nftInfo[0].data.id.collection,$e.nftInfo[0].data.name,U.value),o)try{await z.subscribePosition({pool_address:ae.value.poolAddress,position_index:ae.value.index},ae.value.nftHash)}catch(Re){console.log(Re,"e")}}else{const Re=$e.nftInfo,Ce=await Lt(2e3);if(await D.value.setCurrentPositionInfo(Re==null?void 0:Re.pool,"","",U.value,Re==null?void 0:Re.position),await Lt(1e3),console.log("0529###nftInfo###",Re),console.log("0529###currentPositionInfo.value.index###",ae.value.index),o)try{await z.subscribePosition({pool_address:ae.value.poolAddress,position_index:ae.value.index},ae.value.nftHash)}catch(Ee){console.log(Ee)}}setTimeout(()=>{he.updateCurrentPools(a.value.poolAddress,U.value),g.value.getAccount(_.value.address)},3e3),setTimeout(async()=>{It(g,a)},3e3)}h()}else Me(!1),O(!0);P.value="",A.value=""}catch(ke){P.value="",A.value="",console.log("0330###Add liquidity Error###",ke),Me(!1),O(!0)}},Be=L(()=>!P.value&&!A.value?(console.log("addLiquidityBtnDisabled11111"),!0):Number(P.value)>Number(l.value)||Number(A.value)>Number(K.value)?(console.log("addLiquidityBtnDisabled22222"),!0):De.value!==e("button.addLiquidity")&&De.value!==e("newAdd.preview")?(console.log("addLiquidityBtnDisabled33333###",De.value),!0):a.value&&a.value&&a.value.is_pause?(console.log("addLiquidityBtnDisabled44444"),!0):Number(P.value)<=0&&Number(A.value)<=0||!n.value&&Number(P.value)==0||!W.value&&Number(A.value)==0),Ge=L(()=>!T.value||!y.value),De=L(()=>a.value&&a.value.is_pause?"Pool Closed":!T.value||!y.value||Ge.value?e("modal.selectTokenModalTitle"):Number(P.value)>Number(l.value)?e("button.insufficientBalance",{name:T.value.symbol}):Number(A.value)>Number(K.value)?e("button.insufficientBalance",{name:y.value.symbol}):!Number(P.value)&&!Number(A.value)?e("button.enterAmount"):j.value!=="∞"&&Number(Z.value)>=Number(j.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),ye=G({}),we=G({}),xe=G(!1),at=(o,p)=>{console.log(c.value,"===>currentCoinKey.value"),console.log(o);const w=localStorage.getItem(o.address);console.log(D.value.tokensObj,"===>pools.value.tokensObj"),console.log(w,"===>coinLocak"),D.value.tokensObj&&D.value.tokensObj[o.address]&&D.value.tokensObj[o.address].isSelfBuilt&&!w&&(p=="fromCoin"&&(ye.value=o),p=="toCoin"&&(we.value=o),xe.value=!0)};Le(()=>[T.value,y.value],([o,p])=>{o&&!Ie(o)&&at(o,"fromCoin"),p&&!Ie(p)&&at(p,"toCoin")},{immediate:!0});const m=Vt(),v=()=>{U.value!=="Aptos"?m.push("/pool/list"):m.push("/pools")},Fe=o=>{We.value,le(o)},pe=()=>{Q.query.action!=="create-pool"&&Q.query.actions!=="new-position"&&(It(g,a),S(),he.updateCurrentPools(a.value.poolAddress,U.value)),he.setPoolConfigList(U.value,H.value.filterCoinsObj)},be=L(()=>{var w,ue,J,ce,me,ve;const o=(J=X.value[(ue=(w=T)==null?void 0:w.value)==null?void 0:ue.address])==null?void 0:J.price,p=(ve=X.value[(me=(ce=y)==null?void 0:ce.value)==null?void 0:me.address])==null?void 0:ve.price;return!!(o&&p)});return Le(()=>[Q,D.value.tokensObj],([o,p])=>{var w;p&&!Ie(p)&&(y.value||(y.value=D.value.tokensObj[(w=o==null?void 0:o.query)==null?void 0:w.toCoin]))},{immediate:!0,deep:!0}),{decimalUi:Se,poolInfo:a,fromCoinAmount:P,toCoinAmount:A,fromCoin:T,toCoin:y,theme:V,showFromCoinLock:n,showToCoinLock:W,fromCoinBlance:l,toCoinBlance:K,maxBtnSelect:i,halfBtnSelect:b,fixedFromCoin:Pe,openCoinSelect:ne,currentCoinKey:c,existingCoins:d,lastSelectCoin:B,showCoinSelect:Y,onCoinSelect:de,liquidityTotalAmount:C,toggle:Dt,onInput:qe,isInputTotalAmount:We,isViewDetail:ge,addLiquidityBtnDisabled:Be,addLiquidityBtnText:De,isShowTokenWarning:xe,chainName:U,closeTokenWarning:v,warningFromCoin:ye,warningToCoin:we,isShowLiquidityModal:N,currentPrice:st,currentPriceReverse:_t,currentPriceTab:ee,minPrice:Z,maxPrice:j,toAdd:le,direction:Oe,wallet:_,getAddLiquidityType:Fe,clickRefresh:pe,isShowtotalAmount:be}}});const Ki={class:"new-liquidity-right"},Ji={class:"deposit-title"},Qi={class:"card-container"},Yi={class:"card-item"},xi={class:"card-item"},Vi={key:0,class:"total-amount"},er=r("span",null,"Total Amount",-1);function tr(e,u,fe,H,U,he){const D=Ut,q=zt,_=ao,Q=eo,a=Ht,n=to,W=co,V=mo,f=vo;return k(),I("div",Ki,[r("div",Ji,[He(D,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),r("div",Qi,[r("div",Yi,[He(q,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":u[0]||(u[0]=l=>e.fromCoinAmount=l),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:u[1]||(u[1]=l=>e.maxBtnSelect("fromCoin")),onOnHalf:u[2]||(u[2]=l=>e.halfBtnSelect("fromCoin")),onOnInput:u[3]||(u[3]=l=>{e.fromCoinAmount=l,e.fixedFromCoin=!0,e.isInputTotalAmount=!1}),onOnSelect:u[4]||(u[4]=l=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock?(k(),Je(_,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):te("",!0)]),r("div",xi,[He(q,{modelValue:e.toCoinAmount,"onUpdate:modelValue":u[5]||(u[5]=l=>e.toCoinAmount=l),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:u[6]||(u[6]=l=>e.maxBtnSelect("toCoin")),onOnHalf:u[7]||(u[7]=l=>e.halfBtnSelect("toCoin")),onOnInput:u[8]||(u[8]=l=>{e.toCoinAmount=l,e.fixedFromCoin=!1,e.isInputTotalAmount=!1}),onOnSelect:u[9]||(u[9]=l=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock?(k(),Je(_,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):te("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(k(),I("img",{key:0,class:"add",src:go,alt:"",onClick:u[10]||(u[10]=(...l)=>e.toggle&&e.toggle(...l))})):te("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(k(),I("img",{key:1,class:"add",src:po,alt:"",onClick:u[11]||(u[11]=(...l)=>e.toggle&&e.toggle(...l))})):te("",!0)]),e.isShowtotalAmount?(k(),I("div",Vi,[er,r("span",null,[He(Q,{value:e.liquidityTotalAmount,placeholder:e.isInputTotalAmount?"":e.liquidityTotalAmount,onInput:u[12]||(u[12]=l=>e.onInput(l.target.value))},null,8,["value","placeholder"])])])):te("",!0),He(a,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),He(n,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:u[13]||(u[13]=l=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:kt(()=>[ct(se(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(k(),Je(W,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:u[14]||(u[14]=l=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):te("",!0),e.isViewDetail?(k(),Je(V,{key:2,"pool-info":e.poolInfo,onOnClose:u[15]||(u[15]=l=>e.isViewDetail=!1)},null,8,["pool-info"])):te("",!0),e.isShowLiquidityModal?(k(),Je(f,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:u[16]||(u[16]=l=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):te("",!0)])}const Zt=nt(Gi,[["render",tr]]),or=rt({components:{NewLiquidityLeft:Xt,NewLiquidityRight:Zt},setup(){Ft(()=>{uo()});const e=St();return{tickList:tt,route:e}}});const ir={key:0,class:"loading-spin-liquidity loading-global"},rr={class:"privide-liquidity"};function nr(e,u,fe,H,U,he){var Q,a;const D=Tt,q=Xt,_=Zt;return k(),I(it,null,[!e.tickList&&((a=(Q=e.route)==null?void 0:Q.query)!=null&&a.poolAddress)?(k(),I("div",ir,[He(D)])):te("",!0),r("div",rr,[He(q),He(_)])],64)}const Ur=nt(or,[["render",nr],["__scopeId","data-v-9c3e932a"]]);export{Ur as default};
