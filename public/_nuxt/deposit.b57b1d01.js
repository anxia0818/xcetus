import{j as io,n as bt,d as me,e as Pt,u as Bt,a as Be,c as ie,s as ht,T as st,G as no,b as He,l as Nt,p as qt}from"./pool.a1941d40.js";import{a as it,r as F,l as A,H as Rt,q as _e,e as nt,o as M,f as Z,t as Ot,N as ao,h as r,O as kt,v as J,u as re,x as te,c as xe,p as _t,k as Ct,S as Ut,y as jt,m as Tt,K as zt,s as ro,F as yt,E as Mt,i as Oe,j as ot,A as ft,$ as lo,w as ct,P as Ht,a2 as so,b as uo,B as co}from"./entry.58564c79.js";/* empty css              */import{s as dt,m as mo,l as vo,b as fo,a as go}from"./transform.c672907f.js";import{D as a}from"./decimal.0bdeb344.js";import{u as mt,a as po}from"./sha256.21b2e963.js";import{d as Xt,_ as Et,c as Dt,a as Wt,b as bo}from"./new-liquidity-title.473a0b1a.js";import{i as wt}from"./import-icon.de3e6c66.js";/* empty css              *//* empty css              */import{positionError as et,fromCoin as P,toCoin as h,tickList as Qe,minPrice as I,maxPrice as k,currentPrice as tt,currentPriceReverse as ut,direction as le,currentPriceTab as x,defaultMinPrice as gt,defaultMaxPrice as pt,toggle as xt,isStableFarmingRange as je,isInputTotalAmount as Ee,priceConfigObj as Ye,fromCoinAmount as _,toCoinAmount as S,fixedFromCoin as Le,resetTickList as $t,resetData as ho}from"./data.3efe872d.js";import{u as St}from"./farms.6671d8b0.js";import{_ as Zt}from"./icon_farms_2x.09214b0c.js";import{_ as ko}from"./coin-lock.8b1b4da2.js";import{_ as yo}from"./coin-select.367d22fe.js";import{_ as wo}from"./viewDetail.4b17dfc5.js";import{a as Po}from"./new-add-or-create.ae7d16c2.js";import{u as _o}from"./notifi.a43f09d7.js";import{_ as Co,a as To}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.a28135f4.js";import"./lock.70b745f6.js";/* empty css              *//* empty css              */import"./token-warning.dbbd8992.js";import"./swap-setting.36992090.js";import"./icon-error_2x.98c7676c.js";import"./img-lock_2x.6929bf4d.js";import"./img-no-Positions_2x.1f36e10d.js";import"./img-no-Positions_2x.db6f1802.js";import"./status-block.d0f6e7e1.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.78600248.js";function Ft(e,s,ge){const se=new a(10).pow(s-ge);return new a(1.0001).pow(e).mul(se)}const So=it({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,s){const ge=F(""),se=F(""),$=A(()=>{var n,C,m,D,B,G;return(n=e.poolInfo)!=null&&n.current_sqrt_price&&((C=e.poolInfo)!=null&&C.coinA)&&((m=e.poolInfo)!=null&&m.coinB)?i.sqrtPriceX64ToPrice((D=e.poolInfo)==null?void 0:D.current_sqrt_price,(B=e.poolInfo)==null?void 0:B.coinA.decimals,(G=e.poolInfo)==null?void 0:G.coinB.decimals).toString():"0"}),ce=A(()=>{let n=0;return e.direction?n=(Number(e.minPrice)/Number($.value)-1)*100:n=(Number(e.minPrice)/Number(1/Number($.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),U=A(()=>{let n=0;return e.direction?n=(Number(e.maxPrice)/Number($.value)-1)*100:n=(Number(e.maxPrice)/Number(1/Number($.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),j=mt(),N=A(()=>j),ne=A(()=>N.value.chainName?Pt(N.value.chainName):{}),{TickMath:i,getNearestTickByTick:f}=ne.value,Q=(n=[])=>{let C=6;const m=Math.abs(Number(n[0])-Number(n[n.length-1]));return m>=6?C=0:m>=1?C=1:m>=.1?C=2:m>=.01?C=3:m>=.001?C=4:m>=1e-4?C=5:m>=1e-5?C=6:m>=1e-6?C=7:m>=1e-7&&(C=8),C},Ce=(n,C=1)=>{if(n&&n.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const m=Number(e.poolInfo.current_tick_index);console.log("0117###dataProcessing###currentTick###",m),console.log("0117###dataProcessing###props.poolInfo###",e.poolInfo),console.log("0117###dataProcessing###minPrice###",e.minPrice),console.log("0117###dataProcessing###maxPrice###",e.maxPrice),console.log("0117###dataProcessing###poolInfo###",e.poolInfo);let D=m+100*C,B=m-100*C,G,w;if(e.maxPrice==="∞")w=ne.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?w=i.priceToTickIndex(new a(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):w=i.priceToTickIndex(new a(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{w=443636}if(e.minPrice==="0")G=ne.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?G=i.priceToTickIndex(new a(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):G=i.priceToTickIndex(new a(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{G=-443636}let we=0;if(e.currentPriceTab!=="full range"){if(m>=G&&m<=w){const L=m-G,ve=w-m;we=Math.max(Math.abs(L),Math.abs(ve))}else m<G?we=Math.abs(w-m):we=Math.abs(m-G);D=m+we+100*C,B=m-we-100*C}else{const L=(Math.abs(m)>5e3,2e4);D=m+L*C,B=m-L*C}B<-443636&&(B=-443636),D>443636&&(D=443636);const g=new a(n.liquidity).div(Math.pow(10,8)).toString(),q=e.tickList;console.log("0117####drawChart####tick_info_array####",q);const z=[],Te=[];let y={};for(let L=0;L<q.length;L++){if(y=q[L],y.index<=m&&y.index>=B){if(z.length<1&&L!==0){const ve=q[L-1];z.unshift({...ve,index:B,source:"left"})}z.unshift(y)}else if(y.index>m&&y.index<=D&&(Te.push(y),z.length<1&&L!==0)){const ve=q[L-1];z.push({...ve,index:B,source:"left"})}if(y.index>D){const ve=q[L];if(Te.push({...ve,index:D,source:"right"}),z.length<1&&L!==0){const Ke=q[L-1];z.push({...Ke,index:B,source:"left"})}break}}let R="0";for(let L=z.length-1;L>=0;L--)R=new a(R).plus(new a(z[L].liquidityNet.toString()).div(Math.pow(10,8))).toString(),z[L].liquityAmount=R;let Y=g;for(let L=0;L<Te.length;L++)Y=new a(Y).plus(new a(Te[L].liquidityNet.toString()).div(Math.pow(10,8))).toString(),Te[L].liquityAmount=Y;let V=[];const O=q&&q.length>0?{index:m,liquityAmount:Number(g)}:{index:m,liquityAmount:0};(z.length>0||Te.length>0)&&(V=[...z.reverse(),O,...Te],e.direction||(V=V.reverse()));const ze=[];q.forEach(L=>{ze.push({...L,liquidityGross:L.liquidityGross.toString(),liquidityNet:L.liquidityNet.toString()})}),console.log("0117####drawChart####testTickInfoArray####",ze),console.log("0117####drawChart####currentLiquity####",g),console.log(V,"###chartData"),v(V,B,D,G,w,m)}};let Ne=F(!1);const de=F(!1);Rt(()=>{const n=document.body.clientWidth;de.value=!0,n<750?Ne.value=!1:Ne.value=!0,window.onresize=()=>{document.body.clientWidth<750?Ne.value=!1:Ne.value=!0,console.log("这里执行了吗"),Ce(e.poolInfo,e.zoom)}});const v=(n,C,m,D,B,G)=>{console.log("0117####drawChart####chartData####",n),console.log("0117####drawChart####tickMin####",C),console.log("0117####drawChart####tickMax####",m),console.log("0117####drawChart####minPriceTick####",D),console.log("0117####drawChart####maxPriceTick####",B),console.log("0117####drawChart####currentTick####",G),console.log("0117####drawChart####props.direction####",e.direction),console.log("0518###newd3###props.before7dContractPriceLowest###",e.before7dContractPriceLowest),console.log("0518###newd3###props.before7dContractPriceHighest###",e.before7dContractPriceHighest);let w,we;e.direction?(w=e.before7dContractPriceLowest?i.priceToTickIndex(new a(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",we=e.before7dContractPriceHighest?i.priceToTickIndex(new a(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(w=e.before7dContractPriceLowest?i.priceToTickIndex(new a(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",we=e.before7dContractPriceHighest?i.priceToTickIndex(new a(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const g={top:30,right:35,bottom:20,left:80};let q,z;Ne.value?(q=460-g.left-g.right,z=205-g.top-g.bottom):(q=340-g.left-g.right,z=205-g.top-g.bottom);const Te=m-C,y=parseInt(String(Te/4));let R=[C+y/4,C+y,C+2*y,m-y,m-y/4];const Y=C,V=m,O=q/(V-Y);e.currentPriceTab==="full range"&&(R=[C,C+2*y,m]),console.log("0117####drawChart####xArr####",R),console.log("0117####drawChart####utickMin####",Y),console.log("0117####drawChart####utickMax####",V),console.log("0117####drawChart####unit####",O);const ze=R.map(d=>e.direction?Ft(d,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new a(1).div(Ft(d,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),L=Q(ze);dt("#chart").selectAll("*").remove();const ve=dt("#chart").attr("width",q+g.left+g.right).attr("height",z+g.top+g.bottom).append("g").attr("transform",`translate(${g.left},${g.right})`),Ke=mo(n,function(d){return Number(Math.abs(d.liquityAmount))})||0,$e=vo().range([0,z]).domain([Ke,0]);fo().rangeRound([0,q]).padding(.1);const Ve=ve.append("g").attr("id","barsBox").selectAll("rect").data(n).enter().append("rect");N.value.theme=="default"?Ve.attr("x",function(d,l){return l===0?0:e.direction?Math.abs(d.index-Y)*O:Math.abs(V-d.index)*O}).attr("y",function(d,l){return e.direction?l===n.length-1?0:$e(d.liquityAmount):l===n.length-1?0:$e(n[l+1].liquityAmount)}).attr("width",function(d,l){return l===0&&n.length===1&&d.liquityAmount>0?q:(e.direction,l!==n.length-1?Math.abs(n[l+1].index-d.index)*O:0)}).attr("height",function(d,l){return l===0&&n.length===1&&d.liquityAmount>0?z:e.direction?l===n.length-1?0:z-$e(d.liquityAmount):l===n.length-1?0:z-$e(n[l+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):Ve.attr("x",function(d,l){return l===0?0:e.direction?Math.abs(d.index-Y)*O:Math.abs(V-d.index)*O}).attr("y",function(d,l){return e.direction?l===n.length-1?0:$e(Math.abs(d.liquityAmount)):l===n.length-1?0:$e(Math.abs(n[l+1].liquityAmount))}).attr("width",function(d,l){return l===0&&n.length===1&&d.liquityAmount>0?q:(e.direction,l!==n.length-1?Math.abs(n[l+1].index-d.index)*O:0)}).attr("height",function(d,l){if(l===0&&n.length===1&&d.liquityAmount>0)return z;if(e.direction)return l===n.length-1?0:Number(d.liquityAmount)?z-$e(Math.abs(d.liquityAmount)):0;{if(l===n.length-1)return 0;const ke=z-$e(Math.abs(n[l+1].liquityAmount));return Number(n[l+1].liquityAmount)?ke:0}}).attr("fill",function(d,l){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(d,l){return"#417494"});const Je=ve.append("g");Je.append("line").attr("x1",0).attr("y1",155).attr("x2",q).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const Ze=Je.append("g");let H=0;if(e.direction){for(let d=0;d<R.length;d++){const l=me(ze[d],L)||"0";console.log("0423####price####",l),ze.push(l);const ke=Math.abs(R[d]-Y)*O;let ae=0;for(let ye=0;ye<l.length;ye++)l[ye]==="1"?ae+=4.02:l[ye]==="."?ae+=2.64:l[ye]==="7"?ae+=5.48:ae+=6;console.log(ke,"x=>>>"),Ze.append("text").text(l).attr("x",ke-ae/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}H=Math.abs(G-Y)*O}else{for(let d=R.length-1;d>=0;d--){const l=me(ze[d],L)||0;ze.push(l);const ke=Math.abs(R[d]-V)*O;let ae=0;for(let ye=0;ye<l.length;ye++)l[ye]==="1"?ae+=4.02:l[ye]==="."?ae+=2.64:l[ye]==="7"?ae+=5.48:ae+=6;Ze.append("text").text(l).attr("x",ke-ae/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}H=Math.abs(G-V)*O}console.log(G,V,O,"######currentPricePositon"),(N.value.theme=="default"?ve.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):ve.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+H+", 0)");let t,c,b,T;e.direction?(t=D<Y?-100:parseInt(String(Math.abs(D-Y)*O)),c=B<Y?-100:parseInt(String(Math.abs(B-Y)*O)),b=w<Y?-100:Math.abs(w-Y)*O,T=we<Y?-100:Math.abs(we-Y)*O):(c=D<Y?-100:Math.abs(V-D)*O,t=B<Y?-100:Math.abs(V-B)*O,T=w>V?-100:Math.abs(V-w)*O,b=we>V?-100:Math.abs(V-we)*O),e.minPrice==="0"&&(t=0),e.maxPrice==="∞"&&(c=q),console.log(t,"==>minPriceTickX"),Ne.value?ge.value=q-t+94+"px":ge.value=q-t+87+"px",se.value=c+98+"px",w&&b<q&&ve.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+b+", 0)"),we&&T<q&&ve.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+T+", 0)");const X=ve.append("g").attr("id","left-handle"),E=ve.append("g").attr("id","right-handle");N.value.theme=="default"?(X.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),X.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),X.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),X.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),E.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),E.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),E.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),E.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(X.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),X.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),X.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),X.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),E.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),E.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),E.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),E.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),console.log("0525###d3###select###minPriceTickX###",t),console.log("0525###d3###select###maxPriceTickX###",c),X.attr("transform","translate("+t+", 0)"),E.attr("transform","translate("+c+", 0)");const pe=go().extent([[0,0],[q,z]]).handleSize(30).on("end",De);ve.append("g").attr("class","brush").call(pe).call(pe.move,[t,c]);function De(d){if(!d.sourceEvent||!d.selection)return;X.attr("transform","translate("+d.selection[0]+", 0)"),E.attr("transform","translate("+d.selection[1]+", 0)"),Ne.value,ge.value=q-d.selection[0]+87+"px",se.value=d.selection[1]+74+"px";let l,ke;console.log("0525###d3###select###e.selection[0]###",d.selection[0]),console.log("0525###d3###select###e.selection[0]###",d.selection[1]),console.log("0525###d3###select###props.direction###",e.direction),console.log("0525###d3###select###width###",q),console.log("0525###d3###select###unit###",O),console.log("0525###d3###select###utickMin###",Y),console.log("0525###d3###select###utickMax###",V),console.log("0525###d3###select###props.poolInfo###",e.poolInfo);let ae=0,ye=0;e.direction?(ae=f(parseInt(String(d.selection[0]/O+Y)),Number(e.poolInfo.tickSpacing)),l=i.tickIndexToPrice(ae,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),ye=f(parseInt(String(d.selection[1]/O+Y)),Number(e.poolInfo.tickSpacing)),ke=i.tickIndexToPrice(ye,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),console.log("1114###d3###select###minTick###",ae),console.log("1114###d3###select###maxTick###",ye),console.log("1114###d3###select###minPrice###",l),console.log("1114###d3###select###maxPrice###",ke)):(ye=f(V-d.selection[0]/O,Number(e.poolInfo.tickSpacing)),l=1/i.tickIndexToPrice(ye,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),ae=f(V-d.selection[1]/O,Number(e.poolInfo.tickSpacing)),ke=1/i.tickIndexToPrice(ae,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),s.emit("onChangeMinPrice",String(me(String(l),6))),s.emit("onChangeMaxPrice",String(me(String(ke),6)))}N.value.theme=="default"?dt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):dt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632"),console.log("画完了##")};return F(""),_e(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom,e.tickList],([n,C,m,D,B,G])=>{console.log(n,C,m,m>C,B,"poolInfo && minPrice && maxPrice && (maxPrice > minPrice)"),n&&C&&m&&(n!=null&&n.liquidity)&&(D!=="Custom"||console.log("绘制"),Ce(n,B))},{immediate:!0}),console.log(e,"props===>"),{store:N,loading:de,rangeSizeLower:ce,rangeSizeUpper:U,rangeSizeLowerPosition:ge,rangeSizeUpperPosition:se,decimalFormat:io,numberformat:bt}}});const Io=e=>(_t("data-v-5d4865b0"),e=e(),Ct(),e),Ao={class:"chart-box"},Lo={class:"chart"},No=Io(()=>r("svg",{id:"chart"},null,-1));function qo(e,s,ge,se,$,ce){const U=Ut;return M(),Z("div",Ao,[Ot(r("div",Lo,[e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(M(),Z("div",{key:0,class:"range-size range-size-lower",style:kt({right:e.rangeSizeLowerPosition})},J(("numberformat"in e?e.numberformat:re(bt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):te("",!0),e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(M(),Z("div",{key:1,class:"range-size range-size-upper",style:kt({left:e.rangeSizeUpperPosition})},J(("numberformat"in e?e.numberformat:re(bt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):te("",!0),No],512),[[ao,!e.chartLoading]]),e.chartLoading?(M(),xe(U,{key:0})):te("",!0)])}const Gt=nt(So,[["render",qo],["__scopeId","data-v-5d4865b0"]]),Mo=it({props:{lever:{type:String,default:""}},setup(){return{}}});const $o=e=>(_t("data-v-6edeb42a"),e=e(),Ct(),e),Fo={class:"lever"},Bo=$o(()=>r("div",{class:"lever-title"},"Leverage",-1)),Ro={class:"lever-text"};function Oo(e,s,ge,se,$,ce){return M(),Z("div",Fo,[Bo,r("div",Ro,J(e.lever),1)])}const Uo=nt(Mo,[["render",Oo],["__scopeId","data-v-6edeb42a"]]),jo=it({components:{NewLiquidityD3Chart:Gt,NewLiquidityPrice:Xt},setup(){const{t:e,locale:s}=jt(),ge=F("liquidity"),se=mt(),$=A(()=>se),ce=A(()=>$.value.chainName),U=Bt(),j=A(()=>U),N=A(()=>$.value.chainName?Pt($.value.chainName):{});Rt(()=>{et.value=!1});const ne=Tt(),i=A(()=>{let t=null;for(let c=0;c<j.value.poolConfigList.length;c++){const b=j.value.poolConfigList[c];b.address==ne.query.poolAddress&&(t=b)}return console.log(t,"===>basePoolInfo"),t}),f=A(()=>{let t=null;for(const c in j.value.poolsObj){const b=j.value.poolsObj[c];b.address==ne.query.poolAddress&&(console.log(b,"p===>"),t=b)}return t}),Q=F(),Ce=F(!0),Ne=async(t,c)=>{if(console.log(Ce.value,"==>chartLoading.value"),Ce.value=!0,c){Qe.value=[],v.value=[],je.value=!1;const b=t.token_a.decimals,T=t.token_b.decimals;console.log(t,"pool===>1111"),console.log("poolPrice###pool.current_tick_index####",t.current_tick_index);const X=st.tickIndexToPrice(t.current_tick_index,b,T);console.log("poolPrice###",X.toString()),tt.value=st.sqrtPriceX64ToPrice((t==null?void 0:t.current_sqrt_price)||(t==null?void 0:t.object.current_sqrt_price),b,T).toString(),console.log(tt.value,"##currentPrice.value"),ut.value=new a(1).div(st.sqrtPriceX64ToPrice((t==null?void 0:t.current_sqrt_price)||(t==null?void 0:t.object.current_sqrt_price),b,T)).toString(),console.log(ut.value,"##currentPriceReverse.value"),P.value=t.needReverse?t.token_b:t.token_a,h.value=t.needReverse?t.token_a:t.token_b,Q.value=t.needReverse,t.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===h.value.address.toLowerCase()?le.value=!0:le.value=!1,console.log(t,"187===>"),console.log(t,"###pool===>");let E={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const{list:pe,address:De}=await N.value.getTicks(E);Qe.value=pe&&De==t.address?N.value.getTickDataFromUrlData(pe):[],console.log(Qe.value,"===>chartLoadingtickList.value"),Ce.value=!1,C(t)}},de=t=>{var T,X;const c=t.token_a.decimals,b=t.token_b.decimals;console.log(t,"pool===>1111"),console.log("poolPrice###pool.current_tick_index####",t.current_tick_index),tt.value=st.sqrtPriceX64ToPrice((t==null?void 0:t.current_sqrt_price)||((T=t==null?void 0:t.object)==null?void 0:T.current_sqrt_price),c,b).toString(),ut.value=new a(1).div(st.sqrtPriceX64ToPrice((t==null?void 0:t.current_sqrt_price)||((X=t==null?void 0:t.object)==null?void 0:X.current_sqrt_price),c,b)).toString()},v=F([]),n=F(),C=async t=>{const c=t.token_a.decimals,b=t.token_b.decimals;let T=j.value.poolPriceConfigObj&&j.value.poolPriceConfigObj[t.address]&&j.value.poolPriceConfigObj[t.address].recommend_ranges||{};const X=j.value.poolPriceConfigObj&&j.value.poolPriceConfigObj[t.address]&&j.value.poolPriceConfigObj[t.address].type||"";console.log(T,"===>priceConfigList");let E,pe;const De=no(t.current_tick_index,t.tickSpacing);n.value=t.current_tick_index,console.log(De,t.tickSpacing,"==>pool.tickSpacing"),E=De-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),pe=De+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const d=N.value.TickMath.tickIndexToPrice(E,c,b).toString(),l=N.value.TickMath.tickIndexToPrice(pe,c,b).toString();T["full range"]={lower:N.value.TickUtil.getMinIndex(Number(f.value.tickSpacing)),upper:N.value.TickUtil.getMaxIndex(Number(f.value.tickSpacing))},T.custom={lower:E,upper:pe,minPrice:d,maxPrice:l};const ke=[];for(let ae in T)T[ae]&&(console.log(ae,"j==>"),ke.push({...T[ae],key:ae}));console.log(ke,"priceList"),console.log(t,"###pool.type 504"),X&&ke&&ke.length>2?t.isSelfBuilt?x.value="custom":X=="stable"?x.value="suggested":x.value="passive":x.value="custom",v.value=ke||{},Ye.value=T,B({key:x.value,...T[x.value]})},m=F(""),D=F(""),B=t=>{console.log("priceTab====>",t),console.log("priceTab###poolInfo###",f.value),x.value=t.key.toLowerCase();const c=f.value.token_a.decimals,b=f.value.token_b.decimals,{lower:T,upper:X}=t;Ee.value=!1;const E=N.value.TickMath.tickIndexToPrice(T,c,b).toString(),pe=N.value.TickMath.tickIndexToPrice(X,c,b).toString();if(t.key=="full range"){m.value=T,D.value=X,G();return}console.log(le.value,"===>direct.value"),le.value?(gt.value=String(E),I.value=String(E),pt.value=String(pe),k.value=String(pe),m.value=T,D.value=X):(gt.value=new a(1).div(new a(pe)).toString(),I.value=new a(1).div(new a(pe)).toString(),pt.value=new a(1).div(new a(E)).toString(),k.value=new a(1).div(new a(E)).toString(),m.value=N.value.TickMath.priceToTickIndex(new a(1/Number(pe)),c,b),D.value=N.value.TickMath.priceToTickIndex(new a(1/Number(E)),c,b)),console.log(I.value,k.value,"===>111")},G=t=>{I.value="0",k.value="∞"};_e(()=>f.value,(t,c)=>{console.log(c,"===>oldVal"),console.log(t,"===>newVal"),(!c&&t&&!ie(t)||c&&t&&c.address!==t.address)&&(console.log("池子信息"),Ne(t,!c||t.address!==c.address)),t&&!ie(t)&&de(t),t||(Qe.value=[])},{immediate:!0}),zt(()=>{P.value=F(),h.value=F(),Qe.value=[]}),_e(()=>[i.value,f.value,j.value.recommendRangesObj],(t,c)=>{var b,T;console.log(t,"===>newValue369"),console.log(c,"===>oldValue369"),(!c||t[0]&&t[1]&&t[2]&&!ie(t[0])&&!ie(t[1]&&!ie(t[2]))||((b=t[0])==null?void 0:b.address)!==((T=c[0])==null?void 0:T.address))&&t[0]&&t[2]&&!ie(t[0])&&!ie(t[2])&&(console.log(t[0],t[2],"======>374"),U.setSinglePool(t[0],t[2],ce.value))},{immediate:!0,deep:!0});const w=t=>{if(ce.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},we=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},g=t=>{var b,T;const c=j.value.poolPriceConfigObj&&j.value.poolPriceConfigObj[(b=f.value)==null?void 0:b.address]&&j.value.poolPriceConfigObj[(T=f.value)==null?void 0:T.address].type||"";if(console.log(c,t,"==>poolType"),v.value.length>2)if(c=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"25%"};case"full range":return{top:"49%"};case"custom":return{top:"75%"}}else if(c=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"full range":return{top:"35%"};case"custom":return{top:"60%"}}},q=F(1),z=()=>{const t=q.value/2;q.value=t},Te=()=>{const t=q.value*2;q.value=t};console.log(v.value,"==>priceTablList");const y=A(()=>{var t,c,b;return!f.value||ie($.value.addressHistTokens)||!$.value.addressHistTokens[(t=f.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((b=$.value.addressHistTokens[(c=f.value)==null?void 0:c.poolAddress])==null?void 0:b.data.map(T=>[T.key,T.value]))}),R=F(30),Y=F("30D"),V=A(()=>le.value?y.value&&me(R.value==7?y.value.before_7_d_contract_price_lowest:R.value==24?y.value.before_24_h_contract_price_lowest:y.value.before_30_d_contract_price_lowest,6)||0:y.value&&me(new a(1).div(R.value==7?y.value.before_7_d_contract_price_highest:R.value==24?y.value.before_24_h_contract_price_highest:y.value.before_30_d_contract_price_highest).toString(),6)||0),O=A(()=>le.value?y.value&&me(R.value==7?y.value.before_7_d_contract_price_highest:R.value==24?y.value.before_24_h_contract_price_highest:y.value.before_30_d_contract_price_highest,6)||0:(y.value&&me(1/Number(R.value==7?y.value.before_7_d_contract_price_lowest:R.value==24?y.value.before_24_h_contract_price_lowest:y.value.before_30_d_contract_price_lowest),6))==1/0?0:y.value&&me(1/Number(R.value==7?y.value.before_7_d_contract_price_lowest:R.value==24?y.value.before_24_h_contract_price_lowest:y.value.before_30_d_contract_price_lowest),6)||0),ze=A(()=>{const t=Number(I.value),c=Number(k.value);if(I.value=="0"&&k.value=="∞"||x.value=="full range")return"1x";if(I.value==k.value||x.value=="full range")return"--";if(I.value&&k.value&&I.value!=="0"&&k.value!=="∞"){const b=ht(1/(1-Number((t/c)**.25)),2);return Number(b)>0?b+"x":"--"}else return 1}),L=A(()=>{var t,c,b,T,X,E;return((t=P.value)==null?void 0:t.isSelfBuilt)||((c=h.value)==null?void 0:c.isSelfBuilt)||((T=j.value.tokensObj[(b=P.value)==null?void 0:b.address])==null?void 0:T.isSelfBuilt)||((E=j.value.tokensObj[(X=h.value)==null?void 0:X.address])==null?void 0:E.isSelfBuilt)}),ve=(t,c)=>{console.log(t,"####0731 priceRangeChangeMin"),t!==I.value&&x.value=="full range"?(console.log(v.value,"===>priceTablList"),B({key:"custom",...v.value.custom})):x.value!=="full range"&&x.value!=="custom"?(x.value="custom",I.value=t):I.value=t,H.value&&(je.value?(le.value&&I.value!==H.value.minPrice&&(je.value=!1),!le.value&&Number(I.value)!==1/Number(H.value.maxPrice)&&(je.value=!1)):(le.value&&I.value==H.value.minPrice&&k.value==H.value.maxPrice&&(je.value=!0),!le.value&&Number(I.value)==1/Number(H.value.maxPrice)&&Number(k.value)==1/Number(H.value.minPrice)&&(je.value=!0)))},Ke=(t,c)=>{console.log(t,"###priceRangeChangeMax maxPirce"),t!==k.value&&x.value=="full range"?B({key:"custom",...v.value.custom}):x.value!=="full range"&&x.value!=="custom"?(x.value="custom",t=="0"?k.value="∞":k.value=t):t=="0"?k.value="∞":k.value=t,H.value&&(je.value?(le.value&&k.value!==H.value.maxPrice&&(je.value=!1),!le.value&&Number(k.value)!==1/Number(H.value.minPrice)&&(je.value=!1)):(le.value&&I.value==H.value.minPrice&&k.value==H.value.maxPrice&&(je.value=!0),!le.value&&Number(I.value)==1/Number(H.value.maxPrice)&&Number(k.value)==1/Number(H.value.minPrice)&&(je.value=!0)))};console.log(I.value,k.value,"683==>"),_e(()=>[I.value,k.value],([t,c])=>{console.log(t,c,"minmax new-liquidity-left")},{deep:!0,immediate:!0});const $e=t=>{var c;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((c=j.value.tokensObj[t==null?void 0:t.address])==null?void 0:c.logo_url)||($.value.theme==="default"?wt("/image/coins/unknown.png"):wt("/image/coins/sui-unknown.png"))},at=t=>{switch(t){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}},Ve=[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}],Je=St(),Ze=A(()=>Je),H=A(()=>{var t;return Ze.value.farmsPoolObj[(t=f==null?void 0:f.value)==null?void 0:t.address]}),rt=A(()=>j.value.poolPriceConfigObj);return _e(()=>[je.value,f.value,v.value,rt.value,H.value,le.value],(t,c)=>{var b,T;if(console.log(H,le,"##farmsPoolInfo"),t[0]&&t[4]&&!ie(t[4]))x.value="custom",I.value=t[5]?t[4].minPrice:String(1/t[4].maxPrice),k.value=t[5]?t[4].maxPrice:String(1/t[4].minPrice),console.log(I.value,k.value,"###1195");else if(t[1]&&!ie(t[1])&&t[2]&&!ie(t[2])&&t[3]&&!ie(t[3])&&t[4]&&!ie(t[4])){const X=t[3]&&t[3][(b=t[1])==null?void 0:b.address]&&t[3][(T=t[1])==null?void 0:T.address].type||"",E=t[2].filter(pe=>pe.key===(t[2].length==4?"passive":"suggested"));console.log(X,"##poolType"),E!=null&&E[0]&&(!c||c[0]!==t[0])&&B({...E[0]})}},{immediate:!0}),{positionError:et,getCoinIcon:$e,chainName:ce,store:$,currentTab:ge,currentPrice:tt,currentPriceReverse:ut,fromCoin:P,toCoin:h,direction:le,needReverse:Q,addCommom:Be,decimalUi:me,priceTablList:v,currentPriceTab:x,sliderStyle:g,poolInfo:f,tickList:Qe,getPriceTabImage:w,getPriceTabText:we,defaultMinPrice:gt,defaultMaxPrice:pt,minPrice:I,maxPrice:k,currentTick:n,chartLoading:Ce,zoomOut:z,zoomIn:Te,zoom:q,priceTab:B,before7dContractPriceLowest:V,before7dContractPriceHighest:O,aprRewardsTime:Y,lever:ze,aprRewardsParameter:R,isSelfBuilt:L,priceRangeChangeMin:ve,priceRangeChangeMax:Ke,toggle:xt,getPirceTabTips:at,timeList:Ve,farmsPoolInfo:H,checkNullObj:ie,isStableFarmingRange:je}}});const zo={class:"new-liquidity-left"},Ho=r("span",{class:"selectRange"},"Select Range",-1),Xo={class:"price-info"},Eo={class:"left"},Do={class:"base-coin"},Wo={class:"base-coin-title"},xo=r("span",null,"Base coin",-1),Zo=r("svg",{class:"icon icon-up","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_up1"})],-1),Go=r("svg",{class:"icon icon-down","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_down1"})],-1),Ko=[Zo,Go],Jo={class:"base-coin-bottom"},Qo={alt:""},Yo={class:"current-price"},Vo=r("div",{class:"current-price-title"},"Current Price",-1),ei={key:0,class:"from-pre-to"},ti={class:"right"},oi={class:"price-range"},ii={class:"left"},ni={class:"price-slider"},ai={class:"slider"},ri=r("div",{class:"slider-ratio-content"},null,-1),li=[ri],si={class:"price-tab-list"},ui=["onClick"],ci=["src"],di={class:"right"},mi={class:"price-zoom"},vi={class:"current-price"},fi=r("div",{class:"current-price-title"},"Current Price",-1),gi={key:0,class:"from-pre-to"},pi={class:"price-zoom-right"},bi={class:"leverage"},hi=r("div",{class:"left"},null,-1),ki={class:"right"},yi={class:"right-time"},wi={key:0,class:"day-7-price-range"},Pi=r("i",null,null,-1),_i={class:"gray"},Ci={class:"time-list"},Ti=["onClick"],Si={class:"right-price-h5"},Ii={class:"range pc-range"},Ai={key:0,class:"stable-farming-range pc-stable-farming-range"},Li=r("img",{src:Zt},null,-1),Ni={class:"check-box-active"},qi={key:1,class:"stable-farming-range h5-stable-farming-range"},Mi=r("span",null,[r("img",{src:Zt}),ot(" Farm rewards range： ")],-1),$i={class:"check-box-active"},Fi={key:0,class:"position-tips"},Bi=["src"],Ri={class:"error"};function Oi(e,s,ge,se,$,ce){var Q,Ce,Ne,de,v,n,C,m,D,B,G;const U=Ht,j=Gt,N=Uo,ne=lo,i=Xt,f=ro("image");return M(),Z("div",zo,[Ho,r("div",Xo,[r("div",Eo,[r("div",Do,[r("div",Wo,[xo,r("div",{class:"change-price",onClick:s[0]||(s[0]=(...w)=>e.toggle&&e.toggle(...w))},Ko)]),r("div",Jo,[Ot(r("img",Qo,null,512),[[f,e.getCoinIcon(e.fromCoin)]]),r("span",null,J((Q=e.fromCoin)==null?void 0:Q.symbol),1)])]),r("div",Yo,[Vo,r("div",null,[r("span",null,J(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:re(Be))(("decimalUi"in e?e.decimalUi:re(me))(e.currentPrice,6)):("addCommom"in e?e.addCommom:re(Be))(("decimalUi"in e?e.decimalUi:re(me))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(M(),Z("span",ei,J((Ce=e.toCoin)==null?void 0:Ce.symbol)+" per "+J((Ne=e.fromCoin)==null?void 0:Ne.symbol),1)):te("",!0)])])]),r("div",ti,[e.currentTab=="liquidity"?(M(),Z("div",{key:0,class:"zoom-out",onClick:s[1]||(s[1]=(...w)=>e.zoomOut&&e.zoomOut(...w))}," + ")):te("",!0),e.currentTab=="liquidity"?(M(),Z("div",{key:1,class:"zoom-in",onClick:s[2]||(s[2]=(...w)=>e.zoomIn&&e.zoomIn(...w))}," - ")):te("",!0)])]),r("div",oi,[r("div",ii,[r("div",ni,[r("div",ai,[r("div",{class:"slider-ratio",style:kt(e.sliderStyle(e.currentPriceTab))},li,4)])]),r("div",si,[(M(!0),Z(yt,null,Mt(e.priceTablList,w=>(M(),Z("div",{key:w.key,class:ft(["price-tab-item",e.currentPriceTab==w.key?"price-tab-item-active":""]),onClick:we=>e.priceTab(w)},[Oe(U,{placement:"bottom","arrow-point-at-center":""},{title:ct(()=>[ot(J(e.getPirceTabTips(w.key)),1)]),default:ct(()=>[r("img",{src:e.getPriceTabImage(w.key),alt:""},null,8,ci),r("span",null,J(e.getPriceTabText(w.key)),1)]),_:2},1024)],10,ui))),128))])]),r("div",di,[r("div",mi,[r("div",vi,[fi,r("div",null,[r("span",null,J(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:re(Be))(("decimalUi"in e?e.decimalUi:re(me))(e.currentPrice,6)):("addCommom"in e?e.addCommom:re(Be))(("decimalUi"in e?e.decimalUi:re(me))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(M(),Z("span",gi,J(e.direction&&!e.needReverse?`${(de=e.fromCoin)==null?void 0:de.symbol} per ${(v=e.toCoin)==null?void 0:v.symbol}`:`${(n=e.toCoin)==null?void 0:n.symbol} per ${(C=e.fromCoin)==null?void 0:C.symbol}`),1)):te("",!0)])]),r("div",pi,[e.currentTab=="liquidity"?(M(),Z("div",{key:0,class:"zoom-out",onClick:s[3]||(s[3]=(...w)=>e.zoomOut&&e.zoomOut(...w))}," + ")):te("",!0),e.currentTab=="liquidity"?(M(),Z("div",{key:1,class:"zoom-in",onClick:s[4]||(s[4]=(...w)=>e.zoomIn&&e.zoomIn(...w))}," - ")):te("",!0)])]),e.poolInfo?(M(),xe(j,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):te("",!0)])]),r("div",bi,[hi,r("div",ki,[r("div",yi,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(M(),Z("div",wi,[Pi,r("span",_i,J(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),r("span",null,J(("addCommom"in e?e.addCommom:re(Be))(("decimalUi"in e?e.decimalUi:re(me))(e.before7dContractPriceLowest,6)))+" - "+J(("addCommom"in e?e.addCommom:re(Be))(("decimalUi"in e?e.decimalUi:re(me))(e.before7dContractPriceHighest,6))),1)])):te("",!0),r("div",Ci,[(M(!0),Z(yt,null,Mt(e.timeList,w=>(M(),Z("div",{key:w.value,class:ft(["time-item",w.value==e.aprRewardsParameter?"time-item-active":""]),onClick:we=>e.aprRewardsParameter=w.value},J(w.label),11,Ti))),128))])]),r("div",Si,[r("span",null,J(("addCommom"in e?e.addCommom:re(Be))(("decimalUi"in e?e.decimalUi:re(me))(e.before7dContractPriceLowest,6)))+" - "+J(("addCommom"in e?e.addCommom:re(Be))(("decimalUi"in e?e.decimalUi:re(me))(e.before7dContractPriceHighest,6))),1)])])]),r("div",{class:ft(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[Oe(N,{lever:e.lever},null,8,["lever"]),r("div",Ii,[e.farmsPoolInfo&&!("checkNullObj"in e?e.checkNullObj:re(ie))(e.farmsPoolInfo)&&e.fromCoin&&e.toCoin?(M(),Z("div",Ai,[r("span",null,[Li,ot(" Farm rewards range："+J(("decimalUi"in e?e.decimalUi:re(me))(e.direction?e.farmsPoolInfo.minPrice:1/e.farmsPoolInfo.maxPrice,6))+" - "+J(("decimalUi"in e?e.decimalUi:re(me))(e.direction?e.farmsPoolInfo.maxPrice:1/e.farmsPoolInfo.minPrice,6))+" "+J((m=e.toCoin)==null?void 0:m.symbol)+" per "+J((D=e.fromCoin)==null?void 0:D.symbol),1)]),r("div",Ni,[Oe(ne,{class:"range-alerts-switch",checked:e.isStableFarmingRange,onClick:s[5]||(s[5]=w=>e.isStableFarmingRange=!e.isStableFarmingRange)},null,8,["checked"])])])):te("",!0),e.farmsPoolInfo&&!("checkNullObj"in e?e.checkNullObj:re(ie))(e.farmsPoolInfo)&&e.fromCoin&&e.toCoin?(M(),Z("div",qi,[Mi,r("div",$i,[ot(J(("decimalUi"in e?e.decimalUi:re(me))(e.direction?e.farmsPoolInfo.minPrice:1/e.farmsPoolInfo.maxPrice,6))+" - "+J(("decimalUi"in e?e.decimalUi:re(me))(e.direction?e.farmsPoolInfo.maxPrice:1/e.farmsPoolInfo.minPrice,6))+" "+J((B=e.toCoin)==null?void 0:B.symbol)+" per "+J((G=e.fromCoin)==null?void 0:G.symbol)+" ",1),Oe(ne,{class:"range-alerts-switch",checked:e.isStableFarmingRange,onClick:s[6]||(s[6]=w=>e.isStableFarmingRange=!e.isStableFarmingRange)},null,8,["checked"])])])):te("",!0),Oe(i,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"])]),e.positionError&&e.poolInfo?(M(),Z("div",Fi,[r("img",{src:("importIcon"in e?e.importIcon:re(wt))("/image/icon-tips-error@2x.png"),alt:""},null,8,Bi),r("p",Ri,J(e.$t("tips.positionError")),1)])):te("",!0)],2)])}const Kt=nt(jo,[["render",Oi]]),Ui=it({props:{poolInfo:{type:Object,default:()=>({})},isActive:{type:Boolean,default:!0}},setup(e,s){const ge=St(),se=F(!1),$=F(),ce=F(!0),U=A(()=>ge),j=A(()=>U.value.farmsPoolList.filter(i=>i.status=="Live"));_e(()=>e.poolInfo,i=>{i&&!ie(i)&&ge.getFarmsPoolList()},{immediate:!0});const N=i=>{const f=i.filter(Q=>{var Ce;return Q.status=="Live"&&Q.clmm_pool_id==((Ce=e.poolInfo)==null?void 0:Ce.poolAddress)});f&&f.length>0?(se.value=!0,$.value=f[0],s.emit("sendFarmsPoolInfo",ce.value&&e.isActive?$.value:"")):se.value=!1,console.log(f,"##isFarmingPool")};return _e(()=>j.value,i=>{i&&i.length>0&&N(i)},{immediate:!0}),_e(()=>[e.isActive,ce.value,$.value],([i,f,Q])=>{console.log(i,f,"##props.isActive"),s.emit("sendFarmsPoolInfo",f&&e.isActive?Q:"")},{immediate:!0}),{isShowAutoStake:se,changeIsOpen:()=>{ce.value=!ce.value,s.emit("sendFarmsPoolInfo",ce.value&&e.isActive?$.value:"")},isOpen:ce}}}),ji=""+globalThis.__publicAssetsURL("sui-image/farming_huo.png"),zi=""+globalThis.__publicAssetsURL("sui-image/icon_sel@2x.png");const It=e=>(_t("data-v-94dffe19"),e=e(),Ct(),e),Hi={key:0,class:"farms-auto-stake"},Xi=It(()=>r("img",{class:"farms-icon",src:ji,alt:""},null,-1)),Ei=It(()=>r("div",{class:"desc"},"Automatically stake your position into the farm to enjoy higher yield.",-1)),Di={key:0,src:zi,alt:""},Wi=It(()=>r("div",{class:"check-box"},null,-1));function xi(e,s,ge,se,$,ce){const U=Ht;return e.isShowAutoStake?(M(),Z("div",Hi,[Xi,Ei,e.isActive?(M(),Z("div",{key:0,class:"check-box-active",onClick:s[0]||(s[0]=(...j)=>e.changeIsOpen&&e.changeIsOpen(...j))},[e.isOpen?(M(),Z("img",Di)):te("",!0)])):(M(),xe(U,{key:1,"overlay-style":{"min-width":"200px"}},so({default:ct(()=>[Wi]),_:2},[e.isActive?void 0:{name:"title",fn:ct(()=>[ot("Farming rewards only available for active positions.")]),key:"0"}]),1024))])):te("",!0)}const Zi=nt(Ui,[["render",xi],["__scopeId","data-v-94dffe19"]]),Gi=it({components:{NewLiquidityTitle:Et,NewLiquidityAssetsCard:Dt,NewLiquidityDepositRatio:Wt},setup(){const{t:e,locale:s}=jt(),ge=mt(),se=A(()=>ge),$=A(()=>se.value.chainName),ce=Bt(),U=A(()=>ce),j=po(),N=A(()=>j),ne=Tt(),i=A(()=>{let o=null;for(const u in U.value.poolsObj){const p=U.value.poolsObj[u];p.address==ne.query.poolAddress&&(console.log(p,"p===>"),o=p)}return o}),f=F(!1),Q=F(!1),Ce=A(()=>se.value.theme),Ne=async(o,u)=>{P.value=o.needReverse?o.token_b:o.token_a,h.value=o.needReverse?o.token_a:o.token_b,_.value="",S.value=""},de=A(()=>N.value.assets&&P.value&&N.value.assets[P.value.address]?qt(N.value.assets[P.value.address].balance,P.value.decimals):"0"),v=A(()=>N.value.assets&&h.value&&N.value.assets[h.value.address]?qt(N.value.assets[h.value.address].balance,h.value.decimals):"0"),n=o=>{o==="fromCoin"?(Le.value=!0,$.value==="Aptos"?_.value=Number(de.value)>0?P.value.symbol=="APT"?new a(Number(de.value)).sub(new a(.1)).lt(new a(0))?"0":new a(Number(de.value)).sub(new a(.1)).toString():String(de.value):"":_.value=Number(de.value)>0?P.value.symbol=="SUI"?new a(Number(de.value)).sub(new a(.05)).lt(new a(0))?"0":new a(Number(de.value)).sub(new a(.05)).toString():String(de.value):""):(Le.value=!1,$.value==="Aptos"?S.value=Number(v.value)>0?h.value.symbol=="APT"?new a(Number(v.value)).sub(new a(.1)).lt(new a(0))?"0":new a(Number(v.value)).sub(new a(.1)).toString():String(v.value):"":S.value=Number(v.value)>0?h.value.symbol=="SUI"?new a(Number(v.value)).sub(new a(.05)).lt(new a(0))?"0":new a(Number(v.value)).sub(new a(.05)).toString():String(v.value):"")},C=o=>{o==="fromCoin"?(Le.value=!0,_.value=Number(de.value)>0?ht(new a(Number(de.value)).div(2).toString(),P.value.decimals).toString():""):(Le.value=!1,S.value=Number(v.value)>0?ht(new a(Number(v.value)).div(2).toString(),h.value.decimals).toString():"")},m=F(),D=F(),B=F(),G=F(!1),w=o=>{var u,p,be,W;m.value=o,o==="fromCoin"?(D.value=((u=h.value)==null?void 0:u.address)||"",B.value=ne.query.actions=="new-position"?(p=P.value)==null?void 0:p.address:i.value.needReverse?i.value.token_b.address:i.value.token_a.address):(D.value=((be=P.value)==null?void 0:be.address)||"",B.value=ne.query.actions=="new-position"?(W=h.value)==null?void 0:W.address:i.value.needReverse?i.value.token_a.address:i.value.token_b.address),G.value=!0,console.log(G.value,"==>showCoinSelect.value ")},we=o=>{var be,W,fe,he,ue,oe,ee,Se;const u=i.value.needReverse?i.value.token_b:i.value.token_a,p=i.value.needReverse?i.value.token_a:i.value.token_b;m.value==="fromCoin"?(((be=P.value)==null?void 0:be.address)===(u==null?void 0:u.address)||!((W=P.value)!=null&&W.address)?(h.value&&o.address.toLowerCase()===((fe=h)==null?void 0:fe.value.address.toLowerCase())&&(h.value=null),P.value=o):(P.value&&o.address.toLowerCase()===((he=P)==null?void 0:he.value.address.toLowerCase())&&(P.value=null),h.value=o),ne.query.action||(ne.query.fee="")):((ue=h.value)==null?void 0:ue.address)===(p==null?void 0:p.address)||!((oe=h.value)!=null&&oe.address)?(P.value&&o.address.toLowerCase()===((ee=P)==null?void 0:ee.value.address.toLowerCase())&&(P.value=null),h.value=o):(h.value&&o.address.toLowerCase()===((Se=h)==null?void 0:Se.value.address.toLowerCase())&&(h.value=null),P.value=o),G.value=!1},g=A(()=>se.value.chainName?Pt(se.value.chainName):{}),q=A(()=>se.value.slippage),z=F(),Te=async()=>{var Ue,qe,Me,Re;if(Ee.value)return console.log("跳出"),!1;if(!I.value&&!k.value)return!1;if(!_.value&&!S.value&&!I.value&&!k.value)return;const o=i.value||{};if(ie(o))return;const{TickUtil:u,TickMath:p,getNearestTickByTick:be}=g.value,W=o==null?void 0:o.token_a.decimals,fe=o==null?void 0:o.token_b.decimals;let he,ue,oe,ee,Se,Fe,Xe,We,Pe=o==null?void 0:o.current_tick_index,K;if(o.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===h.value.address.toLowerCase()?K=!0:K=!1,I.value==="0"&&k.value==="∞")oe=u.getMinIndex(Number(o.tickSpacing)),ee=u.getMaxIndex(Number(o.tickSpacing)),Se=p.tickIndexToSqrtPriceX64(oe),Fe=p.tickIndexToSqrtPriceX64(ee),console.log(oe,ee,"#######updateAmounts 513");else if(x.value=="custom"){console.log(K,"===>directs1866"),K?(he=I.value,ue=k.value):(he=k.value!=="∞"?new a(1).div(k.value).toString():1/0,ue=new a(1).div(I.value).toString());try{Xe=new a(he).equals(new a(0))?-443636:p.priceToTickIndex(new a(he),W,fe)}catch{Xe=-443636}try{We=p.priceToTickIndex(new a(ue),W,fe)}catch{We=443636}console.log("1113###updateAmounts###min###",he),console.log("1113###updateAmounts###max###",ue),console.log("1113###updateAmounts###minTick###",Xe),console.log("1113###updateAmounts###maxTick###",We),oe=be(Xe,Number(o.tickSpacing),!0),ee=be(We,Number(o.tickSpacing),!0),console.log("1113###updateAmounts###tick_lower###",oe),console.log("1113###updateAmounts###tick_upper###",ee);try{Se=p.priceToSqrtPriceX64(new a(he),W,fe)}catch{(ue===1/0||ue==="∞")&&(Se=p.tickIndexToSqrtPriceX64(u.getMinIndex(Number(o.tickSpacing))))}try{Fe=p.priceToSqrtPriceX64(new a(ue),W,fe)}catch{console.log("0523###test###max###",ue),(ue===1/0||ue==="∞")&&(console.log("0523###test###max###11111"),Fe=p.tickIndexToSqrtPriceX64(u.getMaxIndex(Number(o.tickSpacing))))}console.log("0518###pre###tick_lower###",oe,ee,Pe),console.log("0518###pre###tick_upper###",ee)}else oe=(Ue=Ye.value[x.value])==null?void 0:Ue.lower,ee=(qe=Ye.value[x.value])==null?void 0:qe.upper,Se=p.tickIndexToSqrtPriceX64(oe),Fe=p.tickIndexToSqrtPriceX64(ee);if(console.log("1116###updateAmounts###tick_lower####",oe),console.log("1116###updateAmounts###tick_upper####",ee),console.log("1116###updateAmounts###currentTickIndex####",Pe),k.value!=="∞"&&oe>=ee){f.value=!0,_.value="",Q.value=!0,S.value="";return}if(console.log(ee,Pe,oe,"1922"),k.value==="∞"||Pe>=oe&&Pe<ee){f.value=!1,Q.value=!1;let Ie;if(_.value||S.value){if(Le.value){const vt=new a(_.value).mul(Math.pow(10,P.value.decimals)).toString();Ie=new He(vt)}else{const vt=new a(S.value).mul(Math.pow(10,h.value.decimals)).toString();Ie=new He(vt)}console.log(K,"======>directs"),p.tickIndexToSqrtPriceX64(i.value.current_tick_index);const{liquidityAmount:Ae,tokenMaxA:Ge,tokenMaxB:lt,tokenMaxAOrigin:to,tokenMaxBOrigin:oo}=g.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:oe,upperTick:ee,coinAmount:Ie,iscoinA:K?Le.value:!Le.value,roundUp:!0,slippage:Number(q.value)/100,curSqrtPrice:new He(i.value.current_sqrt_price)});z.value={liquidityAmount:Ae,tokenMaxA:Ge,tokenMaxB:lt,tokenMaxAOrigin:to,tokenMaxBOrigin:oo},console.log(Ge,lt,"preAdd"),K?Le.value?S.value=Number(lt)>0?lt:"":_.value=Number(Ge)>0?Ge:"":Le.value?S.value=Ge:_.value=lt}}else if(Pe>=ee){if(K?_.value="":S.value="",f.value=K,Q.value=!K,_.value||S.value){let Ie;if(K){const Ae=new a(S.value).mul(Math.pow(10,(Me=h.value)==null?void 0:Me.decimals)).toString();Ie=new He(Ae),z.value={liquidityAmount:g.value.estimateLiquidityForCoinB(Se,Fe,Ie),tokenMaxA:0,tokenMaxB:S.value}}else{const Ae=new a(_.value).mul(Math.pow(10,(Re=P.value)==null?void 0:Re.decimals)).toString();Ie=new He(Ae),z.value={liquidityAmount:g.value.estimateLiquidityForCoinB(Se,Fe,Ie),tokenMaxA:0,tokenMaxB:_.value}}}}else if(Pe<oe){if(f.value=!K,Q.value=K,K?S.value="":_.value="",_.value||S.value){let Ie;if(K){const Ae=new a(_.value).mul(Math.pow(10,P.value.decimals)).toString();Ie=new He(Ae),z.value={liquidityAmount:g.value.estimateLiquidityForCoinA(Se,Fe,Ie),tokenMaxA:_.value,tokenMaxB:0}}else{const Ae=new a(S.value).mul(Math.pow(10,h.value.decimals)).toString();Ie=new He(Ae),z.value={liquidityAmount:g.value.estimateLiquidityForCoinA(Se,Fe,Ie),tokenMaxA:S.value,tokenMaxB:0}}}}else f.value=!0,_.value="",Q.value=!0,S.value=""};_e(()=>i.value,(o,u)=>{console.log(u,"===>oldVal"),console.log(o,"===>newVal"),(!u&&o&&!ie(o)||u&&o&&u.address!==o.address)&&(console.log("池子信息"),Ne(o,!u||o.address!==u.address)),o&&!ie(o)&&Te()},{immediate:!0}),_e(_,(o,u)=>{console.log(_,"===>fromCoinAmount"),o==""&&Le.value&&(S.value=""),o&&Le.value&&!Ee.value&&Te()}),_e(S,(o,u)=>{console.log(o,"===>>>>newValsda"),o==""&&!Le.value&&(_.value=""),o&&!Le.value&&!Ee.value&&Te()}),_e(()=>le.value,(o,u)=>{Te()}),_e(()=>[P.value,h.value],([o,u])=>{o&&u&&(f.value=!1,Q.value=!1)});const y=F("--"),R=A(()=>U.value.RATES),Y=()=>{const o=R.value&&R.value[P.value.address]&&R.value[P.value.address].price,u=R.value&&R.value[h.value.address]&&R.value[h.value.address].price;if(o&&u){const p=new a(_.value>0?_.value:0).mul(o),be=new a(S.value>0?S.value:0).mul(u),W=p.add(be).toNumber();y.value=W>0&&W<.01?"<$0.01":"$"+Be(W,2)}else y.value="--"};_e(()=>[_.value,S.value,Ee.value],([o,u,p])=>{(o||u)&&!p?Y():(!o||!u)&&!p&&(y.value="--")},{immediate:!0}),_e(()=>y,o=>{console.log(o,"71911111")},{immediate:!0});const V=F(),O=async()=>{var K,Ue;if(!I.value&&!k.value)return!1;if(!_.value&&!S.value&&!I.value&&!k.value)return;const o=i.value;if(ie(o))return;const{TickUtil:u,TickMath:p,getNearestTickByTick:be}=g.value,W=o==null?void 0:o.token_a.decimals,fe=o==null?void 0:o.token_b.decimals;let he,ue,oe,ee,Se,Fe,Xe;if(o.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===h.value.address.toLowerCase()?Xe=!0:Xe=!1,I.value==="0"&&k.value==="∞")oe=u.getMinIndex(Number(o.tickSpacing)),ee=u.getMaxIndex(Number(o.tickSpacing));else if(x.value=="custom"){Xe?(he=Number(I.value),ue=Number(k.value)):(he=new a(1).div(k.value).toString(),ue=new a(1).div(I.value).toString());try{Se=he==0?-443636:p.priceToTickIndex(new a(he),W,fe)}catch{Se=-443636}try{Fe=p.priceToTickIndex(new a(ue),W,fe)}catch{Fe=443636}oe=be(Se,Number(o.tickSpacing),!0),ee=be(Fe,Number(o.tickSpacing),!0)}else oe=(K=Ye.value[x.value])==null?void 0:K.lower,ee=(Ue=Ye.value[x.value])==null?void 0:Ue.upper;const We=R.value[o==null?void 0:o.token_a.address].price,Pe=R.value[o==null?void 0:o.token_b.address].price;le.value?new He(o.current_sqrt_price):new He(1/o.current_sqrt_price),console.log(le.value,"===>direction.value"),console.log(o,"poolInfos===>"),console.log(oe,ee,"####tick_lower tick_upper 889"),console.log(y.value,"liquidityTotalAmount.value");try{const{amountA:qe,amountB:Me,tokenAmountsInfo:Re}=await g.value.estCoinAmountsFromTotalAmount({lowerTick:oe,upperTick:ee,decimalsA:W,decimalsB:fe,curSqrtPrice:new He(o.current_sqrt_price),totalAmount:y.value.replace(/[^\d.]/g,""),tokenPriceA:We,tokenPriceB:Pe});console.log(qe,Me,"###estCoinAmountsFromTotalAmount 844"),console.log(o.needReverse,le.value,"===>849"),V.value=Re,o.needReverse?le.value?(_.value=qe,S.value=Me):(_.value=Me,S.value=qe):(_.value=qe,S.value=Me)}catch(qe){console.log(qe,"e===>")}};_e([I,k],([o,u])=>{console.log(o,u,"==>minPrice,maxPrice"),Ee.value?Ee.value&&O():Te(),u!=="∞"&&Number(o)!==0&&Number(u)!==0&&Number(o)>=Number(u)?et.value=!0:et.value=!1,Number(o)==0&&Number(u)==0&&tt.value&&(et.value=!0,console.log("价格区间错误"))},{deep:!0,immediate:!0});const ze=o=>{console.log(o,"e");const u=o.replace(/[^\d.]/g,""),p="$"+Be(u);Ee.value=!0,y.value=p,u>0?O():(_.value="",S.value="")},L=F(!1),{setTransactionTxid:ve,setTransactionDesc:Ke,setIsShowWaiting:$e,setIsShowSuccess:at,setPositiomNum:Ve,setIsShowRejected:Je}=ge,Ze=_o(),H=A(()=>U.value.currentPositionInfo),rt=F(!1),t=F(!0),c=St(),b=A(()=>c),T=A(()=>b.value.farmsPoolObj);_e(()=>[T.value,i.value],([o,u])=>{o&&!ie(o)&&u&&!ie(u)&&(o[u.address]||(t.value=!1))},{immediate:!0});const X=F(),E=o=>{console.log(o,"getFarmsPoolInfo:"),X.value=o,o?t.value=!0:t.value=!1},pe=async o=>{var Se,Fe,Xe,We;console.log(i.value,"===> poolInfo.value"),console.log(X.value,"##farmPoolInfo"),L.value=!1,U.value.currentPositionInfo={},ve(""),Ke(e("tips.increaseLiquiditySuccess",{from:f.value?"":`${Be(_.value)} ${(Se=P.value)==null?void 0:Se.symbol}`,and:!f.value&&!Q.value?"and":"",to:Q.value?"":`${Be(S.value)} ${(Fe=h.value)==null?void 0:Fe.symbol}`})),$e(!0);const u=le.value?Le.value:!Le.value;let p,be,W,fe,he,ue;const oe=i.value.token_a.decimals,ee=i.value.token_b.decimals;if(I.value==="0"&&k.value==="∞")W=g.value.TickUtil.getMinIndex(Number(i.value.tickSpacing)),fe=g.value.TickUtil.getMaxIndex(Number(i.value.tickSpacing));else if(x.value=="custom"){le.value?(p=I.value,be=k.value):(p=new a(1).div(k.value).toString(),be=new a(1).div(I.value).toString()),console.log("0519###toAdd###min###",p),console.log("0519###toAdd###max###",be),console.log("0519###toAdd###minPrice.value###",I.value),console.log("0519###toAdd###maxPrice.value###",k.value);try{he=p==0?g.value.TickUtil.getMinIndex(Number(i.value.tickSpacing)):g.value.TickMath.priceToTickIndex(new a(p),oe,ee)}catch{he=g.value.TickUtil.getMinIndex(Number(i.value.tickSpacing))}try{ue=g.value.TickMath.priceToTickIndex(new a(be),oe,ee)}catch{ue=g.value.TickUtil.getMaxIndex(Number(i.value.tickSpacing))}W=g.value.getNearestTickByTick(he,Number(i.value.tickSpacing),!0),fe=g.value.getNearestTickByTick(ue,Number(i.value.tickSpacing),!0)}else W=Ye.value[x.value].lower,fe=Ye.value[x.value].upper;console.log(W,fe,"####tick_lower tick_upper 889"),console.log(i.value,"==>poolInfo.value.curSqrtPrice"),console.log("1202###Add###tick_lower####",W),console.log("1202###Add###tick_upper####",fe),console.log("1202###Add###poolInfo.value####",i.value);try{let Pe;Ee.value?Pe=await g.value.getCreateAddLiquidityPayload({pool:i.value,curSqrtPrice:new He(i.value.current_sqrt_price),tickLower:W,tickUpper:fe,slippage:Number(q.value)/100,tokenAmounts:V.value}):Pe=await g.value.getAddLiquidityTransactionPayload({pool:{poolAddress:i.value.poolAddress,token_a:i.value.token_a,token_b:i.value.token_b},amount:Le.value?_.value:S.value,fix_amount_a:u,tick_lower:W,tick_upper:fe,index:0,slippage:Number(q.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new He(i.value.current_sqrt_price),farmPoolInfo:X.value}),console.log(Pe,"payload===?");let K;if($.value==="Aptos")K=await N.value.currentWallet.signAndSubmitTransaction(Pe);else{const Ue=await g.value.signAndExecuteTransactionBlock(N.value.currentWallet,Pe);K=g.value.handleTx(Ue)}if(console.log("0410###tx###",K),K&&K.hash){ve(K.hash),$e(!1),at(!0);let Ue;i.value.needReverse?i.value.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&i.value.token_b.address.toLowerCase()===h.value.address.toLowerCase()?Ue=!1:Ue=!0:i.value.token_a.address.toLowerCase()===P.value.address.toLowerCase()&&i.value.token_b.address.toLowerCase()===h.value.address.toLowerCase()?Ue=!0:Ue=!1,console.log(Ue,"===>directs");const qe={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:f.value?"":`${Be(_.value)} ${(Xe=P.value)==null?void 0:Xe.symbol}`,and:!f.value&&!Q.value?"and":"",to:Q.value?"":`${Be(S.value)} ${(We=h.value)==null?void 0:We.symbol}`}),hash:K.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};$.value!=="Aptos"&&(qe.res=K.res),g.value.showTransitionPending(qe),console.log(qe,"toAdd params###");const Me=await g.value.watchTransaction(qe,!0);if(console.log("new liquidity right add watchInfo: ",Me),console.log("new liquidity right add tx: ",K),Me.status){if(at(!1),U.value.setCurrentPositionLoading(!0),rt.value=!0,console.log(Me.nftInfo,"===> watchInfo.nftInfo"),$.value==="Aptos"){if(await U.value.setCurrentPositionInfo(Me.nftInfo[0].data.id.creator,Me.nftInfo[0].data.id.collection,Me.nftInfo[0].data.name,$.value),o)try{await Ze.subscribePosition({pool_address:H.value.poolAddress,position_index:H.value.index},H.value.nftHash)}catch(Re){console.log(Re,"e")}}else{const Re=Me.nftInfo,Ie=await Nt(2e3);if(t.value){console.log("auto stake farming");let Ae;Me.res.events.forEach(Ge=>{Ge.type.indexOf("::pool::DepositEvent")>-1&&(Ae=Ge.parsedJson.wrapped_position_id)}),console.log(Ae,"###farmPositionId"),await U.value.setCurrentPositionInfo("","","","Sui",Ae,"farming")}else console.log("not auto"),await U.value.setCurrentPositionInfo(Re==null?void 0:Re.pool,"","",$.value,Re==null?void 0:Re.position);if(await Nt(1e3),console.log("0529###nftInfo###",Re),console.log("0529###currentPositionInfo.value.index###",H.value),o&&!t.value)try{await Ze.subscribePosition({pool_address:H.value.poolAddress,position_index:H.value.index},H.value.nftHash)}catch(Ae){console.log(Ae)}else if(o&&t.value)try{await Ze.subscribePosition({pool_address:H.value.clmm_pool_id,position_index:H.value.name.split("-")[1]},H.value.clmm_position_id)}catch(Ae){console.log(Ae)}}setTimeout(()=>{ce.updateCurrentPools(i.value.poolAddress,$.value),g.value.getAccount(N.value.address)},3e3),setTimeout(async()=>{$t(g,i)},7e3)}Ve()}else $e(!1),Je(!0);_.value="",S.value=""}catch(Pe){_.value="",S.value="",console.log("0330###Add liquidity Error###",Pe),$e(!1),Je(!0)}},De=A(()=>!_.value&&!S.value?(console.log("addLiquidityBtnDisabled11111"),!0):Number(_.value)>Number(de.value)||Number(S.value)>Number(v.value)?(console.log("addLiquidityBtnDisabled22222"),!0):l.value!==e("button.addLiquidity")&&l.value!==e("newAdd.preview")?(console.log("addLiquidityBtnDisabled33333###",l.value),!0):i.value&&i.value&&i.value.is_pause?(console.log("addLiquidityBtnDisabled44444"),!0):Number(_.value)<=0&&Number(S.value)<=0||!f.value&&Number(_.value)==0||!Q.value&&Number(S.value)==0),d=A(()=>!P.value||!h.value),l=A(()=>i.value&&i.value.is_pause?"Pool Closed":!P.value||!h.value||d.value?e("modal.selectTokenModalTitle"):Number(_.value)>Number(de.value)?e("button.insufficientBalance",{name:P.value.symbol}):Number(S.value)>Number(v.value)?e("button.insufficientBalance",{name:h.value.symbol}):!Number(_.value)&&!Number(S.value)?e("button.enterAmount"):k.value!=="∞"&&Number(I.value)>=Number(k.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),ke=F({}),ae=F({}),ye=F(!1),At=(o,u)=>{console.log(m.value,"===>currentCoinKey.value"),console.log(o);const p=localStorage.getItem(o.address);console.log(U.value.tokensObj,"===>pools.value.tokensObj"),console.log(p,"===>coinLocak"),U.value.tokensObj&&U.value.tokensObj[o.address]&&U.value.tokensObj[o.address].isSelfBuilt&&!p&&(u=="fromCoin"&&(ke.value=o),u=="toCoin"&&(ae.value=o),ye.value=!0)};_e(()=>[P.value,h.value],([o,u])=>{o&&!ie(o)&&At(o,"fromCoin"),u&&!ie(u)&&At(u,"toCoin")},{immediate:!0});const Lt=uo(),Qt=()=>{$.value!=="Aptos"?Lt.push("/pool/list"):Lt.push("/pools")},Yt=o=>{Ee.value,pe(o)},Vt=()=>{ne.query.action!=="create-pool"&&ne.query.actions!=="new-position"&&($t(g,i),Te(),ce.updateCurrentPools(i.value.poolAddress,$.value)),ce.setPoolConfigList($.value,se.value.filterCoinsObj)},eo=A(()=>{var p,be,W,fe,he,ue;const o=(W=R.value[(be=(p=P)==null?void 0:p.value)==null?void 0:be.address])==null?void 0:W.price,u=(ue=R.value[(he=(fe=h)==null?void 0:fe.value)==null?void 0:he.address])==null?void 0:ue.price;return!!(o&&u)});return _e(()=>[ne,U.value.tokensObj],([o,u])=>{var p;u&&!ie(u)&&(h.value||(h.value=U.value.tokensObj[(p=o==null?void 0:o.query)==null?void 0:p.toCoin]))},{immediate:!0,deep:!0}),{positionError:et,decimalUi:me,poolInfo:i,fromCoinAmount:_,toCoinAmount:S,fromCoin:P,toCoin:h,theme:Ce,showFromCoinLock:f,showToCoinLock:Q,fromCoinBlance:de,toCoinBlance:v,maxBtnSelect:n,halfBtnSelect:C,fixedFromCoin:Le,openCoinSelect:w,currentCoinKey:m,existingCoins:D,lastSelectCoin:B,showCoinSelect:G,onCoinSelect:we,liquidityTotalAmount:y,toggle:xt,onInput:ze,isInputTotalAmount:Ee,isViewDetail:rt,addLiquidityBtnDisabled:De,addLiquidityBtnText:l,isShowTokenWarning:ye,chainName:$,closeTokenWarning:Qt,warningFromCoin:ke,warningToCoin:ae,isShowLiquidityModal:L,currentPrice:tt,currentPriceReverse:ut,currentPriceTab:x,minPrice:I,maxPrice:k,toAdd:pe,direction:le,wallet:N,getAddLiquidityType:Yt,clickRefresh:Vt,isShowtotalAmount:eo,isAutoStakeFarming:t,farmPoolInfo:X,getFarmsPoolInfo:E}}});const Ki={class:"new-liquidity-right"},Ji={class:"deposit-title"},Qi={class:"card-container"},Yi={key:0,class:"lock"},Vi={class:"card-item"},en={class:"card-item"},tn={key:0,class:"total-amount"},on=r("span",null,"Total Amount",-1);function nn(e,s,ge,se,$,ce){const U=Et,j=bo,N=Dt,ne=ko,i=Wt,f=co,Q=yo,Ce=wo,Ne=Po,de=Zi;return M(),Z("div",Ki,[r("div",Ji,[Oe(U,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),r("div",Qi,[e.positionError?(M(),Z("div",Yi,[Oe(j)])):te("",!0),r("div",Vi,[Oe(N,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":s[0]||(s[0]=v=>e.fromCoinAmount=v),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:s[1]||(s[1]=v=>e.maxBtnSelect("fromCoin")),onOnHalf:s[2]||(s[2]=v=>e.halfBtnSelect("fromCoin")),onOnInput:s[3]||(s[3]=v=>{e.fromCoinAmount=v,e.fixedFromCoin=!0,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?(M(),xe(ne,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):te("",!0)]),r("div",en,[Oe(N,{modelValue:e.toCoinAmount,"onUpdate:modelValue":s[4]||(s[4]=v=>e.toCoinAmount=v),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:s[5]||(s[5]=v=>e.maxBtnSelect("toCoin")),onOnHalf:s[6]||(s[6]=v=>e.halfBtnSelect("toCoin")),onOnInput:s[7]||(s[7]=v=>{e.toCoinAmount=v,e.fixedFromCoin=!1,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?(M(),xe(ne,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):te("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(M(),Z("img",{key:1,class:"add",src:Co,alt:"",onClick:s[8]||(s[8]=(...v)=>e.toggle&&e.toggle(...v))})):te("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(M(),Z("img",{key:2,class:"add",src:To,alt:"",onClick:s[9]||(s[9]=(...v)=>e.toggle&&e.toggle(...v))})):te("",!0)]),e.isShowtotalAmount?(M(),Z("div",tn,[on,r("span",null,J(e.liquidityTotalAmount)+" ",1)])):te("",!0),Oe(i,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),Oe(f,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:s[10]||(s[10]=v=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:ct(()=>[ot(J(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(M(),xe(Q,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:s[11]||(s[11]=v=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):te("",!0),e.isViewDetail?(M(),xe(Ce,{key:2,"pool-info":e.poolInfo,"farm-pool-info":e.farmPoolInfo,"is-auto-stake-farming":e.isAutoStakeFarming,onOnClose:s[12]||(s[12]=v=>e.isViewDetail=!1)},null,8,["pool-info","farm-pool-info","is-auto-stake-farming"])):te("",!0),e.isShowLiquidityModal?(M(),xe(Ne,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:s[13]||(s[13]=v=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):te("",!0),e.chainName=="Sui"?(M(),xe(de,{key:4,"pool-info":e.poolInfo,"is-active":!e.showFromCoinLock&&!e.showToCoinLock,"is-auto-stake-farming":e.isAutoStakeFarming,onSendFarmsPoolInfo:e.getFarmsPoolInfo},null,8,["pool-info","is-active","is-auto-stake-farming","onSendFarmsPoolInfo"])):te("",!0)])}const Jt=nt(Gi,[["render",nn]]),an=it({components:{NewLiquidityLeft:Kt,NewLiquidityRight:Jt},setup(){zt(()=>{ho()});const e=Tt(),s=mt();return A(()=>s),{tickList:Qe,route:e}}});const rn={key:0,class:"loading-spin-liquidity loading-global"},ln={class:"privide-liquidity"};function sn(e,s,ge,se,$,ce){var ne,i;const U=Ut,j=Kt,N=Jt;return M(),Z(yt,null,[!e.tickList&&((i=(ne=e.route)==null?void 0:ne.query)!=null&&i.poolAddress)?(M(),Z("div",rn,[Oe(U)])):te("",!0),r("div",ln,[Oe(j),Oe(N)])],64)}const Xn=nt(an,[["render",sn],["__scopeId","data-v-1b76f12f"]]);export{Xn as default};
