import{u as es,m as os,e as ts,s as $,a as K,c as A}from"./pool.8f56de0c.js";import{a as as,l as h,b as ns,r as D,q as rs,e as is,s as ls,o as r,f as c,h as e,j as g,v as q,u as F,F as z,E as G,c as L,w as k,x as R,i as H,z as ds,B as cs,P as us,t as y,p as ms,k as ps}from"./entry.810270b9.js";/* empty css              */import{u as fs}from"./farms.ae0dede1.js";import{i as _s}from"./import-icon.de3e6c66.js";import{D as J}from"./decimal.0bdeb344.js";import{a as hs,u as vs}from"./sha256.dc9e4f3d.js";const ws=as({setup(){const s=es(),f=h(()=>s),j=fs(),N=h(()=>j),C=ns(),n=h(()=>f.value.currentPositionInfo),u=D(),T=t=>{var a;return((a=f.value.tokensObj[t])==null?void 0:a.logo_url)||_s("/image/coins/sui-unknown.png")},m=os("Sui"),o=D(),B=async t=>{o.value=0;try{const a=await m.calculateFarmingRewards([{pool_id:t.pool_id,position_nft_id:t.id}]),i=[];let d=new J(0);a[t.id].forEach(l=>{var M;const S=(M=f.value.tokensObj[l.rewarder_type])==null?void 0:M.decimals;let P=new J(l.rewarder_amount).div(Math.pow(10,S)).toString();Number(P)>0&&(d=d.add(P),i.push({...l,rewarderAmount:P,rewarderAmountPer:P}))}),o.value=d,u.value=i,console.log("getRewarder",t,i)}catch(a){console.log(a,"getRewarder")}},E=h(()=>N.value.farmsPoolObj);rs(()=>[n.value,E.value],([t,a])=>{var i;!A(t)&&t.positionSource=="farming"?B(t):!A(a)&&!A(t)&&(console.log(a,"##farmsPoolObj"),u.value=(i=a[t.poolAddress])==null?void 0:i.rewarders)},{immediate:!0});const Q=hs(),O=h(()=>Q),V=vs(),w=ts("Sui"),{setIsShowSuccess:W,setIsShowRejected:b,setIsShowWaiting:p,setTransactionDesc:U,setTransactionTxid:I}=V,_=D(!1),X=async()=>{_.value=!0,I(""),U("Claim rewards"),p(!0);const t={pool_id:n.value.pool_id,position_nft_id:n.value.id};try{const a=await m.harvestFarms(t),i=await O.value.currentWallet.signAndExecuteTransactionBlock(a);console.log("0221###sui swap res###",i);let d=w.handleTx(i);if(d&&d.hash){I(d.hash),p(!1),W(!0);let l={title:"Claim",res:d.res,hash:d.hash};w.showTransitionPending(l),await w.watchTransaction(l)&&setTimeout(()=>{B(n.value)},2e3)}else p(!1),b(!0);_.value=!1}catch(a){console.log("farmsDeposit error",a),p(!1),b(!0),_.value=!1}},Y=async()=>{_.value=!0,I(""),U(`Unstake ${n.value.name}`),p(!0);const t=n.value.pool_id,a=n.value.id;try{const i=await m.farmsWithdraw(t,a),d=await O.value.currentWallet.signAndExecuteTransactionBlock(i);console.log("0221###sui swap res###",d);let l=w.handleTx(d);if(console.log(l,"unStaketx##"),l&&l.hash){I(l.hash),p(!1),W(!0);let S={res:l.res,title:"Unstake",hash:l.hash};w.showTransitionPending(S),await w.watchTransaction(S)&&setTimeout(()=>{console.log("unstake success"),C.replace(`/new-position-detail?name=${n.value.tokenName}address=${n.value.clmm_pool_id}&pos=${n.value.clmm_position_id}`),f.value.setCurrentPositionInfo(n.value.clmm_pool_id,"",n.value.tokenName,"Sui",n.value.clmm_position_id),o.value=0},2e3)}else p(!1),b(!0);_.value=!1}catch(i){console.log("farmsDeposit error",i),p(!1),b(!0),_.value=!1}},Z=async()=>{C.push("/farms")},x=h(()=>V),ss=h(()=>x.value.addressLpTokens);return{getCoinIcon:T,rewardList:u,sFixD:$,addCommom:K,claim:X,unStake:Y,loading:_,totalRewardAmount:o,currentPositionInfo:n,stake:Z,farmsPoolObj:E,addressLpTokens:ss}}});const v=s=>(ms("data-v-6e16d172"),s=s(),ps(),s),gs={key:0,class:"farms-position-detail"},ks={class:"farms-top"},Ss=v(()=>e("div",{class:"left"},[e("div",{class:"title"},"Farming"),e("div",{class:"desc"},"Stake Position to Earn")],-1)),Ps={class:"right"},bs={class:"apr"},Is=v(()=>e("span",null,"View",-1)),ys=v(()=>e("svg",{class:"arrow-icon","aria-hidden":"true"},[e("use",{"xlink:href":"#icon-icon_arrow"})],-1)),Cs=[Is,ys],Ts={class:"farms-bottom"},As=v(()=>e("div",{class:"title"},"Earnings",-1)),Ds={key:0,class:"reward-list"},Fs={key:0,class:"rewards-item-bg"},Ls={class:"rewards-item-box"},Rs={alt:""},$s={key:1},js={class:"rewards-item-bg"},Ns={class:"rewards-item-box"},Bs={alt:""},Es=v(()=>e("span",null,"0",-1)),Os={key:1,class:"reward-list"},Vs={key:0,class:"rewards-item-bg"},Ws={class:"rewards-item-box"},Us={alt:""},Ms=v(()=>e("span",null,"0",-1)),qs={key:1},zs={class:"rewards-item-bg"},Gs={class:"rewards-item-box"},Hs={alt:""},Js=v(()=>e("span",null,"0",-1)),Ks={class:"actions-box"};function Qs(s,f,j,N,C,n){const u=cs,T=us,m=ls("image");return s.farmsPoolObj&&s.farmsPoolObj[s.currentPositionInfo.poolAddress]&&s.farmsPoolObj[s.currentPositionInfo.poolAddress].status=="Live"||s.currentPositionInfo.positionSource=="farming"?(r(),c("div",gs,[e("div",ks,[Ss,e("div",Ps,[e("div",bs,[g(" APR "),e("span",null,q(("sFixD"in s?s.sFixD:F($))(s.addressLpTokens&&s.addressLpTokens[s.currentPositionInfo.poolAddress]&&s.addressLpTokens[s.currentPositionInfo.poolAddress].stable_farming&&s.addressLpTokens[s.currentPositionInfo.poolAddress].stable_farming.apr*100,2))+"%",1)]),e("div",{class:"view",onClick:f[0]||(f[0]=o=>s.$router.push("/farms"))},Cs)])]),e("div",Ts,[As,s.rewardList&&s.rewardList.length>0?(r(),c("div",Ds,[(r(!0),c(z,null,G(s.rewardList,o=>(r(),c("div",{key:o,class:"rewards-item"},[s.currentPositionInfo.positionSource=="farming"?(r(),c("div",Fs,[e("div",Ls,[y(e("img",Rs,null,512),[[m,s.getCoinIcon(o.rewarder_type)]]),e("span",null,q(o.rewarderAmountPer>0&&o.rewarderAmountPer<.01?"<0.01":("addCommom"in s?s.addCommom:F(K))(("sFixD"in s?s.sFixD:F($))(o.rewarderAmount,4))),1)])])):(r(),c("div",$s,[e("div",js,[e("div",Ns,[y(e("img",Bs,null,512),[[m,s.getCoinIcon(o.reward_coin)]]),Es])])]))]))),128))])):(r(),c("div",Os,[(r(!0),c(z,null,G(s.currentPositionInfo.rewards,o=>(r(),c("div",{key:o,class:"rewards-item"},[s.currentPositionInfo.positionSource=="farming"?(r(),c("div",Vs,[e("div",Ws,[y(e("img",Us,null,512),[[m,s.getCoinIcon(o.rewarder_type)]]),Ms])])):(r(),c("div",qs,[e("div",zs,[e("div",Gs,[y(e("img",Hs,null,512),[[m,s.getCoinIcon(o.reward_coin)]]),Js])])]))]))),128))])),e("div",Ks,[s.currentPositionInfo&&s.currentPositionInfo.positionSource=="farming"?(r(),L(u,{key:0,class:"unstake-btn",loading:s.loading,onClick:s.unStake},{default:k(()=>[g("Unstake")]),_:1},8,["loading","onClick"])):R("",!0),s.currentPositionInfo&&s.currentPositionInfo.positionSource=="clmm"&&s.currentPositionInfo.currentStatus!=="Active"?(r(),L(T,{key:1},{title:k(()=>[g("Farming rewards are only available for active positions.")]),default:k(()=>[H(u,{class:"unstake-btn",loading:s.loading,disabled:!0,onClick:s.stake},{default:k(()=>[g("Stake")]),_:1},8,["loading","onClick"])]),_:1})):s.currentPositionInfo&&s.currentPositionInfo.positionSource=="clmm"?(r(),L(u,{key:2,class:"unstake-btn",loading:s.loading,onClick:s.stake},{default:k(()=>[g("Stake")]),_:1},8,["loading","onClick"])):R("",!0),H(u,{class:"unstake-btn btn-margin",loading:s.loading,disabled:s.totalRewardAmount==0||s.currentPositionInfo&&s.currentPositionInfo.positionSource!=="farming",onClick:ds(s.claim,["stop"])},{default:k(()=>[g("â†‘ Claim")]),_:1},8,["loading","disabled","onClick"])])])])):R("",!0)}const te=is(ws,[["render",Qs],["__scopeId","data-v-6e16d172"]]);export{te as _};
