import{u as O,m as U,e as M,s as j,a as W,c as q}from"./pool.7c4b57b4.js";import{a as z,l as S,b as G,r as C,q as H,e as J,s as K,o as T,f as y,h as s,F as Q,E as X,i as $,w as N,z as Y,B as Z,t as ee,v as se,u as B,j as P,p as te,k as ae}from"./entry.234eaa43.js";import{u as oe}from"./farms.11079457.js";import{i as ne}from"./import-icon.de3e6c66.js";import{D as E}from"./decimal.0bdeb344.js";import{a as re,u as ie}from"./sha256.405fa579.js";const le=z({setup(){const e=O(),u=S(()=>e),b=oe();S(()=>b);const D=G(),t=S(()=>u.value.currentPositionInfo),k=C(),w=a=>{var r;return((r=u.value.tokensObj[a])==null?void 0:r.logo_url)||ne("/image/coins/sui-unknown.png")},_=U("Sui"),l=C(),I=async a=>{const r=await _.calculateFarmingRewards([{pool_id:a.pool_id,position_nft_id:a.id}]),i=[];let o=new E(0);r[a.id].forEach(n=>{var R;const p=(R=u.value.tokensObj[n.rewarder_type])==null?void 0:R.decimals;let f=new E(n.rewarder_amount).div(Math.pow(10,p)).toString();Number(f)>0&&(o=o.add(f),i.push({...n,rewarderAmount:f,rewarderAmountPer:f}))}),l.value=o,k.value=i,console.log("getRewarder",a,i)};H(()=>[t.value],([a])=>{q(a)||I(a)},{immediate:!0});const V=re(),A=S(()=>V),L=ie(),m=M("Sui"),{setIsShowSuccess:F,setIsShowRejected:h,setIsShowWaiting:c,setTransactionDesc:x,setTransactionTxid:g}=L,d=C(!1);return{getCoinIcon:w,rewardList:k,sFixD:j,addCommom:W,claim:async()=>{d.value=!0,g(""),x("Claim"),c(!0);const a={pool_id:t.value.pool_id,position_nft_id:t.value.id};try{const r=await _.harvestFarms(a),i=await A.value.currentWallet.signAndExecuteTransactionBlock(r);console.log("0221###sui swap res###",i);let o=m.handleTx(i);if(o&&o.hash){g(o.hash),c(!1),F(!0);let n={title:"claim",res:o.res};m.showTransitionPending(n),await m.watchTransaction(n)&&setTimeout(()=>{I(t.value)},2e3)}else c(!1),h(!0);d.value=!1}catch(r){console.log("farmsDeposit error",r),c(!1),h(!0),d.value=!1}},unStake:async()=>{d.value=!0,g(""),x("UnStake"),c(!0);const a=t.value.pool_id,r=t.value.id;try{const i=await _.farmsWithdraw(a,r),o=await A.value.currentWallet.signAndExecuteTransactionBlock(i);console.log("0221###sui swap res###",o);let n=m.handleTx(o);if(n&&n.hash){g(n.hash),c(!1),F(!0);let p={res:n.res,title:"Unstake"};m.showTransitionPending(p),await m.watchTransaction(p)&&setTimeout(()=>{console.log("unstake success"),D.replace(`/new-position-detail?name=${t.value.tokenName}address=${t.value.clmm_pool_id}&pos=${t.value.clmm_position_id}`),u.value.setCurrentPositionInfo(t.value.clmm_pool_id,"",t.value.tokenName,"Sui",t.value.clmm_position_id)},2e3)}else c(!1),h(!0);d.value=!1}catch(i){console.log("farmsDeposit error",i),c(!1),h(!0),d.value=!1}},loading:d,totalRewardAmount:l}}});const v=e=>(te("data-v-e9f16c34"),e=e(),ae(),e),ce={class:"farms-position-detail"},ue={class:"farms-top"},de=v(()=>s("div",{class:"left"},[s("div",{class:"title"},"Farming"),s("div",{class:"desc"},"Stake Position to Earn")],-1)),me={class:"right"},_e=v(()=>s("div",{class:"apr"},[P(" APR "),s("span",null,"22.20%")],-1)),pe=v(()=>s("span",null,"View",-1)),fe=v(()=>s("svg",{class:"arrow-icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-icon_arrow"})],-1)),ve=[pe,fe],we={class:"farms-bottom"},he=v(()=>s("div",{class:"title"},"Earnings",-1)),ge={class:"reward-list"},Se={alt:""},ke={class:"actions-box"};function Ce(e,u,b,D,t,k){const w=Z,_=K("image");return T(),y("div",ce,[s("div",ue,[de,s("div",me,[_e,s("div",{class:"view",onClick:u[0]||(u[0]=l=>e.$router.push("/farms"))},ve)])]),s("div",we,[he,s("div",ge,[(T(!0),y(Q,null,X(e.rewardList,l=>(T(),y("div",{key:l,class:"rewards-item"},[s("div",null,[ee(s("img",Se,null,512),[[_,e.getCoinIcon(l.rewarder_type)]]),s("span",null,se(l.rewarderAmountPer>0&&l.rewarderAmountPer<.01?"<0.01":("addCommom"in e?e.addCommom:B(W))(("sFixD"in e?e.sFixD:B(j))(l.rewarderAmount,4))),1)])]))),128))]),s("div",ke,[$(w,{class:"unstake-btn",loading:e.loading,onClick:e.unStake},{default:N(()=>[P("Unstake")]),_:1},8,["loading","onClick"]),$(w,{class:"unstake-btn",loading:e.loading,disabled:e.totalRewardAmount==0,onClick:Y(e.claim,["stop"])},{default:N(()=>[P("â†‘ Claim")]),_:1},8,["loading","disabled","onClick"])])])])}const xe=J(le,[["render",Ce],["__scopeId","data-v-e9f16c34"]]);export{xe as _};
