import{u as G,m as H,e as J,s as U,a as M,c as b}from"./pool.b53c6670.js";import{a as K,l as h,b as Q,r as I,q as X,e as Y,s as Z,o as p,f as g,h as s,F as x,E as ee,c as O,w as T,i as se,z as oe,x as ae,B as te,t as V,v as ne,u as W,j as P,p as re,k as ie}from"./entry.4f648195.js";import{u as le}from"./farms.69d54ffd.js";import{i as ce}from"./import-icon.de3e6c66.js";import{D as L}from"./decimal.0bdeb344.js";import{a as ue,u as de}from"./sha256.ef37954e.js";const me=K({setup(){const e=G(),u=h(()=>e),A=le(),D=h(()=>A),y=Q(),a=h(()=>u.value.currentPositionInfo),d=I(),k=o=>{var t;return((t=u.value.tokensObj[o])==null?void 0:t.logo_url)||ce("/image/coins/sui-unknown.png")},n=H("Sui"),F=I(),N=async o=>{const t=await n.calculateFarmingRewards([{pool_id:o.pool_id,position_nft_id:o.id}]),l=[];let r=new L(0);t[o.id].forEach(i=>{var E;const v=(E=u.value.tokensObj[i.rewarder_type])==null?void 0:E.decimals;let w=new L(i.rewarder_amount).div(Math.pow(10,v)).toString();Number(w)>0&&(r=r.add(w),l.push({...i,rewarderAmount:w,rewarderAmountPer:w}))}),F.value=r,d.value=l,console.log("getRewarder",o,l)},R=h(()=>D.value.farmsPoolObj);X(()=>[a.value,R.value],([o,t])=>{!b(o)&&o.positionSource=="farming"?N(o):!b(t)&&!b(o)&&(console.log(t,"##farmsPoolObj"),d.value=t[o.poolAddress].rewarders)},{immediate:!0});const q=ue(),$=h(()=>q),z=de(),f=J("Sui"),{setIsShowSuccess:j,setIsShowRejected:S,setIsShowWaiting:c,setTransactionDesc:B,setTransactionTxid:C}=z,m=I(!1);return{getCoinIcon:k,rewardList:d,sFixD:U,addCommom:M,claim:async()=>{m.value=!0,C(""),B("Claim"),c(!0);const o={pool_id:a.value.pool_id,position_nft_id:a.value.id};try{const t=await n.harvestFarms(o),l=await $.value.currentWallet.signAndExecuteTransactionBlock(t);console.log("0221###sui swap res###",l);let r=f.handleTx(l);if(r&&r.hash){C(r.hash),c(!1),j(!0);let i={title:"claim",res:r.res};f.showTransitionPending(i),await f.watchTransaction(i)&&setTimeout(()=>{N(a.value)},2e3)}else c(!1),S(!0);m.value=!1}catch(t){console.log("farmsDeposit error",t),c(!1),S(!0),m.value=!1}},unStake:async()=>{m.value=!0,C(""),B("Unstake"),c(!0);const o=a.value.pool_id,t=a.value.id;try{const l=await n.farmsWithdraw(o,t),r=await $.value.currentWallet.signAndExecuteTransactionBlock(l);console.log("0221###sui swap res###",r);let i=f.handleTx(r);if(i&&i.hash){C(i.hash),c(!1),j(!0);let v={res:i.res,title:"Unstake"};f.showTransitionPending(v),await f.watchTransaction(v)&&setTimeout(()=>{console.log("unstake success"),y.replace(`/new-position-detail?name=${a.value.tokenName}address=${a.value.clmm_pool_id}&pos=${a.value.clmm_position_id}`),u.value.setCurrentPositionInfo(a.value.clmm_pool_id,"",a.value.tokenName,"Sui",a.value.clmm_position_id)},2e3)}else c(!1),S(!0);m.value=!1}catch(l){console.log("farmsDeposit error",l),c(!1),S(!0),m.value=!1}},loading:m,totalRewardAmount:F,currentPositionInfo:a,stake:async()=>{y.push("/farms")},farmsPoolObj:R}}});const _=e=>(re("data-v-ed4fa0e7"),e=e(),ie(),e),pe={key:0,class:"farms-position-detail"},fe={class:"farms-top"},_e=_(()=>s("div",{class:"left"},[s("div",{class:"title"},"Farming"),s("div",{class:"desc"},"Stake Position to Earn")],-1)),ve={class:"right"},we=_(()=>s("div",{class:"apr"},[P(" APR "),s("span",null,"22.20%")],-1)),he=_(()=>s("span",null,"View",-1)),ge=_(()=>s("svg",{class:"arrow-icon","aria-hidden":"true"},[s("use",{"xlink:href":"#icon-icon_arrow"})],-1)),ke=[he,ge],Se={class:"farms-bottom"},Ce=_(()=>s("div",{class:"title"},"Earnings",-1)),Pe={class:"reward-list"},ye={key:0},be={alt:""},Ie={key:1},Te={alt:""},Ae=_(()=>s("span",null,"0",-1)),De={class:"actions-box"};function Fe(e,u,A,D,y,a){const d=te,k=Z("image");return e.farmsPoolObj&&e.farmsPoolObj[e.currentPositionInfo.poolAddress]?(p(),g("div",pe,[s("div",fe,[_e,s("div",ve,[we,s("div",{class:"view",onClick:u[0]||(u[0]=n=>e.$router.push("/farms"))},ke)])]),s("div",Se,[Ce,s("div",Pe,[(p(!0),g(x,null,ee(e.rewardList,n=>(p(),g("div",{key:n,class:"rewards-item"},[e.currentPositionInfo.positionSource=="farming"?(p(),g("div",ye,[V(s("img",be,null,512),[[k,e.getCoinIcon(n.rewarder_type)]]),s("span",null,ne(n.rewarderAmountPer>0&&n.rewarderAmountPer<.01?"<0.01":("addCommom"in e?e.addCommom:W(M))(("sFixD"in e?e.sFixD:W(U))(n.rewarderAmount,4))),1)])):(p(),g("div",Ie,[V(s("img",Te,null,512),[[k,e.getCoinIcon(n.reward_coin)]]),Ae]))]))),128))]),s("div",De,[e.currentPositionInfo&&e.currentPositionInfo.positionSource=="farming"?(p(),O(d,{key:0,class:"unstake-btn",loading:e.loading,onClick:e.unStake},{default:T(()=>[P("Unstake")]),_:1},8,["loading","onClick"])):(p(),O(d,{key:1,class:"unstake-btn",loading:e.loading,onClick:e.stake},{default:T(()=>[P("Stake")]),_:1},8,["loading","onClick"])),se(d,{class:"unstake-btn",loading:e.loading,disabled:e.totalRewardAmount==0||e.currentPositionInfo&&e.currentPositionInfo.positionSource!=="farming",onClick:oe(e.claim,["stop"])},{default:T(()=>[P("â†‘ Claim")]),_:1},8,["loading","disabled","onClick"])])])])):ae("",!0)}const Le=Y(me,[["render",Fe],["__scopeId","data-v-ed4fa0e7"]]);export{Le as _};
