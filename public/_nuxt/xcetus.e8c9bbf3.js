import{_ as f,S as O,i as D,X as p,s as C,D as i,c as I,p as m,b as _}from"./pool.ccb2d30f.js";import{P as W,b as F,L as P,Q as R}from"./entry.555960f3.js";function h(s){const l={fullRpcUrl:localStorage.getItem(`${s}-current-rpc`)||f[s||"Sui"].fullRpcUrl,faucetURL:localStorage.getItem(`${s}-current-rpc`)||f[s||"Sui"].faucetURL,simulationAccount:f[s||"Sui"].simulationAccount,xcetus:f[s||"Sui"].xcetus};console.log("defaultNetworkOptions####",l);const e=W(new O(l)),c=D(),r=F(()=>c);P(()=>{r.value.address&&(e.senderAddress=r.value.address)}),console.log(e.senderAddress,"===>sdk.senderAddress");const v=async t=>{const n=await e.XCetusModule.getOwnerLockCetuss(t);return console.log(n,"===>lockWhales"),n},g=async(t,n)=>{const a=p.getAvailableXCetus(t,n);return console.log(a,"==>availableXwhale"),a},u=async t=>{const n=await e.XCetusModule.getOwnerCetusCoins(t);return console.log(n,"===>coins"),n},S=async t=>await e.XCetusModule.getOwnerVeNFT(t),w=async(t,n)=>{const a={amount:t};n&&(a.venft_id=n);const o=await e.XCetusModule.convertPayload(a);return d(o)},y=async()=>{const t=await e.XCetusModule.mintVeNFTPayload();return d(t)},X=async(t,n)=>{const a=await e.XCetusModule.redeemNum(t,n);return console.log(a,"result===>"),{amountOut:a.amountOut,percent:C(new i(a.percent).mul(new i(100)).toString(),2)}},x=async(t,n)=>{const a=await e.XCetusModule.reverseRedeemNum(t,n);return{amountOut:a.amountOut,percent:C(new i(a.percent).mul(new i(100)).toString(),2)}},b=async(t,n,a)=>{const o=await e.XCetusModule.redeemLockPayload({venft_id:n,amount:t,lock_day:a});return console.log(o,"tx===>"),d(o)},k=t=>p.getLockingCetuss(t),M=async(t,n)=>{const a=await e.XCetusModule.getLockCetus(t);if(a&&p.isLocked(a)){const o=e.XCetusModule.cancelRedeemPayload({venft_id:n,lock_id:t});return d(o)}},T=async(t,n)=>{const a=await e.XCetusModule.getLockCetus(t);if(a&&!p.isLocked(a)){const o=await e.XCetusModule.redeemPayload({venft_id:n,lock_id:t});return d(o)}},L=t=>{const n=Date.parse(new Date().toString())/1e3,a=new i(n).sub(t.start_time).div(new i(t.interval_day).mul(60)).toFixed(0,i.ROUND_UP);return new i(t.start_time).add(new i(a).mul(7*60)).toString()},N=async t=>{const n=await e.XCetusModule.getDividendManager();console.log("dividendManager:",n);const a=L(n);console.log(a.toString(),"===>nextStartTime"),console.log(n.venft_dividends.id,t,"====params");const o=await e.XCetusModule.getVeNFTDividendInfo(n.venft_dividends.id,t);return console.log("veNFTDividendInfo: ",o),{nextStartTime:a,rewards:o&&o.rewards||[]}},A=async t=>{const n=await e.XCetusModule.getDividendManager();if(console.log("dividendManager: ",n),n.bonus_types.length>0){const a=await e.XCetusModule.redeemDividendPayload(t,n.bonus_types);return d(a)}},B=async t=>{const n=await e.XCetusModule.getOwnerVeNFT(t);if(console.log("nfts: ",n),n){const a=await e.XCetusModule.getXcetusManager();console.log("xcetusManager: ",a);const o=new i(n.xcetus_balance).div(a.treasury).mul(100).toString();return console.log("rate: ",o),Number(o)>0&&Number(o)<.01?"<0.01":C(o,2)}else return 0},d=t=>({transactionBlock:t,options:{showEffects:!0,showEvents:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0,showBalanceChanges:!0}});return{getOwnerLockCetuss:v,getOwnerCetusCoins:u,getOwnerVeNFT:S,depositCetus:w,getMintVeNFTPayload:y,redeemNum:X,getRedeemLockPayload:b,getAvailableXCetus:g,getLockingCetuss:k,getCancelRedeemPayload:M,getVeNFTDividendInfo:N,reverseRedeemNum:x,getRedeemPayload:T,getRedeemDividendPayload:A,getMyShare:B}}const j=R("xcetus",{state:()=>({venft_id:"",xWhaleBalance:"--",venftInfo:{},pendingAmount:"--",whaleBalance:"--",ownerLocks:[],availableXwhale:"--",redeemingXwhale:"--",nextStartTime:"",xcetusShare:"--",pendingCoinInfo:{},cetusApr:"",claimLoading:""}),actions:{async getOwnerVeNFT(s){const l=h("Sui");try{const e=await l.getOwnerVeNFT(s);console.log(e,"===>result"),e&&!I(e)?(this.venft_id=e.id,this.xWhaleBalance=m(e.xcetus_balance,9),this.venftInfo={id:e.id,type:e.type,index:e.index,xcetus_balance:e.xcetus_balance},console.log("执行37"),this.getVeNFTDividendInfo()):(this.xWhaleBalance="0",this.availableXwhale="0",this.redeemingXwhale="0",this.pendingAmount="0")}catch{this.xWhaleBalance="0",this.availableXwhale="0",this.redeemingXwhale="0",this.pendingAmount="0"}},async getVeNFTDividendInfo(){const s=h("Sui"),l=_("Sui");try{const e=await s.getVeNFTDividendInfo(this.venft_id);let c=0;if(console.log("执行58"),console.log(e,"===>result"),this.nextStartTime=e.nextStartTime,e&&e.rewards){for(let r=0;r<e.rewards.length;r++){const v=e.rewards[r].rewards;for(let g=0;g<v.length;g++){const u=v[g],w=(await l.getTokenList()).filter(y=>y.address==u.coin_type)[0];this.pendingCoinInfo=w,console.log(u.amount,"ele.amount===>"),console.log(m(u.amount,w.decimals),"==>prettyAmount(ele.amount, tokenInfo[0].decimals)"),c+=Number(m(u.amount,w.decimals))}}console.log(c,"amount===>"),this.pendingAmount=C(c,this.pendingCoinInfo.decimals),console.log(this.nextStartTime,"===>nextStartTime")}else this.pendingAmount="0"}catch{this.pendingAmount="0"}},async getAccountWhaleBalance(s){const e=await h("Sui").getOwnerCetusCoins(s);if(console.log(e,"==>assets"),e&&e.length>0){let c=0;e.forEach(r=>{c+=Number(m(r.balance.toString(),9))}),this.whaleBalance=C(c,9)}else console.log(this.whaleBalance,"===>this.whaleBalance"),this.whaleBalance="0",console.log(this.whaleBalance,"===>this.whaleBalance")},async getOwnerLockCetuss(s){const e=await h("Sui").getOwnerLockCetuss(s);console.log(e,"assets===>"),this.ownerLocks=e,this.setClaimLoading(""),this.getAvailableXCetus()},async getAvailableXCetus(){const l=await h("Sui").getAvailableXCetus(this.venftInfo,this.ownerLocks);console.log(l,"==>result1111"),this.availableXwhale=m(l,9),console.log(this.xWhaleBalance,"===>this.xWhaleBalance"),console.log(this.availableXwhale,"===>this.availableXwhale"),this.redeemingXwhale=this.xWhaleBalance!=="--"?new i(this.xWhaleBalance).sub(new i(this.availableXwhale)).toString():"--",console.log(new i(this.xWhaleBalance).sub(new i(this.availableXwhale)).toString(),"new Decimal(this.xWhaleBalance).sub(new Decimal(this.availableXwhale)).toString()")},async getMyShare(s){const e=await h("Sui").getMyShare(s);this.xcetusShare=Number(e)>0&&Number(e)<.01?"<0.01":e,console.log(e,"result===>124")},async getXcetusApr(){const{data:s}=await fetch(`${f.Sui.api}/v2/sui/storm/dividend_rewards`).then(e=>e.json()),l=s.apr&&s.apr.replace("%","");this.cetusApr=Number(l)>0&&Number(l)<.01?"<0.01":l,console.log(s,"data===>")},loginOut(){this.venft_id="",this.xWhaleBalance="--",this.venftInfo={},this.pendingAmount="--",this.whaleBalance="--",this.ownerLocks=[],this.availableXwhale="--",this.redeemingXwhale="--"},setClaimLoading(s){this.claimLoading=s}}});export{h as a,j as u};
