var vi=Object.defineProperty;var Ci=(e,t,n)=>t in e?vi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var q=(e,t,n)=>(Ci(e,typeof t!="symbol"?t+"":t,n),n);import{s as c,b as K,o as h,n as x,l as I,d as dt,e as ge,g as X,h as j,i as y,j as Ie,k as lt,m as jn,p as k,t as ne,q as me,B as V,v as Si,w as Ti,x as je,y as Ai,z as Pt,A as Ut,C as Pi,D as Ii,E as Oi}from"./sha256.9ff4ccd8.js";import{e as g}from"./pool.a52494cd.js";import{D as W}from"./decimal.0e8aa3f1.js";const Dn=32;function ji(e){return Di(e)&&xi(e)===Dn}function H(e,t=!1){let n=e.toLowerCase();return!t&&n.startsWith("0x")&&(n=n.slice(2)),`0x${n.padStart(Dn*2,"0")}`}function ce(e,t=!1){return H(e,t)}function Di(e){return/^(0x|0X)?[a-fA-F0-9]+$/.test(e)&&e.length%2===0}function xi(e){return/^(0x|0X)/.test(e)?(e.length-2)/2:e.length/2}BigInt(1e9);ce("0x6");ce("0x5");c();c();c();c();c();c();const Ge=K([h({AddressOwner:c()}),h({ObjectOwner:c()}),h({Shared:h({initial_shared_version:x(c())})}),I("Immutable")]),Ei=dt("SuiJsonValue",()=>!0),Bi=K([h({u32:c()}),h({u64:c()}),h({f64:c()})]);h({attributes:ge(c(),x(Bi)),featureFlags:ge(c(),X()),maxSupportedProtocolVersion:c(),minSupportedProtocolVersion:c(),protocolVersion:c()});K([c(),I("package")]);const be=h({digest:c(),objectId:c(),version:K([j(),c()])}),Mi=h({payment:y(be),owner:c(),price:c(),budget:c()}),Ni=Ie(be,h({type:c(),owner:Ge,previousTransaction:c()})),Ri=ge(c(),lt()),$i=ge(c(),jn()),qi=h({type:c(),fields:Ri,hasPublicTransfer:X()}),Vt=h({disassembled:$i}),Fi=K([Ie(qi,h({dataType:I("moveObject")})),Ie(Vt,h({dataType:I("package")}))]),Li=h({type:c(),hasPublicTransfer:X(),version:c(),bcsBytes:c()}),Ki=h({id:c(),moduleMap:ge(c(),c())}),Ui=K([Ie(Li,h({dataType:I("moveObject")})),Ie(Ki,h({dataType:I("package")}))]);BigInt(1e9);c();const xn=h({code:c(),error:k(c()),object_id:k(c()),parent_object_id:k(c()),version:k(c()),digest:k(c())}),Vi=h({data:x(k(ge(c(),c()))),error:x(k(xn))}),Gi=K([Vi,k(ge(c(),c()))]),En=h({objectId:c(),version:c(),digest:c(),type:x(k(c())),content:x(k(Fi)),bcs:x(k(Ui)),owner:x(k(Ge)),previousTransaction:x(k(c())),storageRebate:x(k(c())),display:x(k(Gi))});h({showType:x(k(X())),showContent:x(k(X())),showBcs:x(k(X())),showOwner:x(k(X())),showPreviousTransaction:x(k(X())),showStorageRebate:x(k(X())),showDisplay:x(k(X()))});K([I("Exists"),I("notExists"),I("Deleted")]);y(Ni);const Xi=h({data:x(k(En)),error:x(k(xn))});function zi(e){return e.data}function Wi(e){if(e.error&&"object_id"in e.error&&"version"in e.error&&"digest"in e.error){const t=e.error;return{objectId:t.object_id,version:t.version,digest:t.digest}}}function Ji(e){if("reference"in e)return e.reference;const t=zi(e);return t?{objectId:t.objectId,version:t.version,digest:t.digest}:Wi(e)}h({objectId:c(),atCheckpoint:k(j())});h({data:y(Xi),nextCursor:k(x(c())),hasNextPage:X()});K([h({details:En,status:I("VersionFound")}),h({details:c(),status:I("ObjectNotExists")}),h({details:be,status:I("ObjectDeleted")}),h({details:ne([c(),j()]),status:I("VersionNotFound")}),h({details:h({asked_version:j(),latest_version:j(),object_id:c()}),status:I("VersionTooHigh")})]);const Bn=h({txDigest:c(),eventSeq:c()}),Mn=h({id:Bn,packageId:c(),transactionModule:c(),sender:c(),type:c(),parsedJson:k(ge(c(),lt())),bcs:k(c()),timestampMs:k(c())});h({data:y(Mn),nextCursor:x(Bn),hasNextPage:X()});c();const Zi=h({epoch:c(),storage_charge:c(),computation_charge:c(),storage_rebate:c(),epoch_start_timestamp_ms:k(c())}),Hi=h({epoch:c(),round:c(),commit_timestamp_ms:c()}),Yi=h({objects:y(c())}),fe=K([I("GasCoin"),h({Input:j()}),h({Result:j()}),h({NestedResult:ne([j(),j()])})]),Qi=h({arguments:k(y(fe)),type_arguments:k(y(c())),package:c(),module:c(),function:c()}),eo=K([h({MoveCall:Qi}),h({TransferObjects:ne([y(fe),fe])}),h({SplitCoins:ne([fe,y(fe)])}),h({MergeCoins:ne([fe,y(fe)])}),h({Publish:K([ne([Vt,y(c())]),y(c())])}),h({Upgrade:K([ne([Vt,y(c()),c(),fe]),ne([y(c()),c(),fe])])}),h({MakeMoveVec:ne([x(c()),y(fe)])})]),to=K([h({type:I("pure"),valueType:x(c()),value:Ei}),h({type:I("object"),objectType:I("immOrOwnedObject"),objectId:c(),version:c(),digest:c()}),h({type:I("object"),objectType:I("sharedObject"),objectId:c(),initialSharedVersion:c(),mutable:X()})]),no=h({transactions:y(eo),inputs:y(to)}),io=K([Ie(Zi,h({kind:I("ChangeEpoch")})),Ie(Hi,h({kind:I("ConsensusCommitPrologue")})),Ie(Yi,h({kind:I("Genesis")})),Ie(no,h({kind:I("ProgrammableTransaction")}))]),Nn=h({messageVersion:I("v1"),transaction:io,sender:c(),gasData:Mi});c();const oo=K([c(),y(c())]);h({epoch:c(),signature:oo,signers_map:y(j())});const so=h({computationCost:c(),storageCost:c(),storageRebate:c(),nonRefundableStorageFee:c()}),ro=K([I("success"),I("failure")]),ao=h({status:ro,error:k(c())}),ft=h({owner:Ge,reference:be}),co=h({objectId:c(),sequenceNumber:c()}),Qt=h({messageVersion:I("v1"),status:ao,executedEpoch:c(),modifiedAtVersions:k(y(co)),gasUsed:so,sharedObjects:k(y(be)),transactionDigest:c(),created:k(y(ft)),mutated:k(y(ft)),unwrapped:k(y(ft)),deleted:k(y(be)),unwrappedThenDeleted:k(y(be)),wrapped:k(y(be)),gasObject:ft,eventsDigest:x(k(c())),dependencies:k(y(c()))}),en=y(Mn),uo=ne([y(j()),c()]),lo=ne([fe,y(j()),c()]),_o=h({mutableReferenceOutputs:k(y(lo)),returnValues:k(y(uo))});h({effects:Qt,events:en,results:k(y(_o)),error:k(c())});c();const po=h({data:Nn,txSignatures:y(c())}),mo=h({type:I("published"),packageId:c(),version:c(),digest:c(),modules:y(c())}),ho=h({type:I("transferred"),sender:c(),recipient:Ge,objectType:c(),objectId:c(),version:c(),digest:c()}),go=h({type:I("mutated"),sender:c(),owner:Ge,objectType:c(),objectId:c(),version:c(),previousVersion:c(),digest:c()}),fo=h({type:I("deleted"),sender:c(),objectType:c(),objectId:c(),version:c()}),bo=h({type:I("wrapped"),sender:c(),objectType:c(),objectId:c(),version:c()}),yo=h({type:I("created"),sender:c(),owner:Ge,objectType:c(),objectId:c(),version:c(),digest:c()}),Rn=K([mo,ho,go,fo,bo,yo]),$n=h({owner:Ge,coinType:c(),amount:c()}),ko=h({digest:c(),transaction:k(po),effects:k(Qt),events:k(en),timestampMs:k(c()),checkpoint:k(c()),confirmedLocalExecution:k(X()),objectChanges:k(y(Rn)),balanceChanges:k(y($n)),errors:k(y(c()))});h({showInput:k(X()),showEffects:k(X()),showEvents:k(X()),showObjectChanges:k(X()),showBalanceChanges:k(X())});h({data:y(ko),nextCursor:x(c()),hasNextPage:X()});h({effects:Qt,events:en,objectChanges:y(Rn),balanceChanges:y($n),input:k(Nn)});const wo=K([c(),h({Object:c()})]);y(wo);const vo=h({address:c(),name:c()}),Co=K([I("Private"),I("Public"),I("Friend")]),tn=h({abilities:y(c())}),So=h({constraints:tn,isPhantom:X()}),To=h({TypeParameter:j()}),Bt=ne([h({module:c(),package:c(),function:c()}),c()]);h({rank3Days:y(Bt),rank7Days:y(Bt),rank30Days:y(Bt)});function qn(e){if(!e)return!1;if(typeof e=="string"||me(e,To)||Fn(e))return!0;if(typeof e!="object")return!1;const t=e;return!!(me(t.Reference,Qe)||me(t.MutableReference,Qe)||me(t.Vector,Qe))}const Qe=dt("SuiMoveNormalizedType",qn);function Fn(e){if(!e||typeof e!="object")return!1;const t=e;if(!t.Struct||typeof t.Struct!="object")return!1;const n=t.Struct;return!(typeof n.address!="string"||typeof n.module!="string"||typeof n.name!="string"||!Array.isArray(n.typeArguments)||!n.typeArguments.every(i=>qn(i)))}dt("SuiMoveNormalizedStructType",Fn);const Ao=h({visibility:Co,isEntry:X(),typeParameters:y(tn),parameters:y(Qe),return:y(Qe)}),Po=h({name:c(),type:Qe}),Io=h({abilities:tn,typeParameters:y(So),fields:y(Po)}),Oo=h({fileFormatVersion:j(),address:c(),name:c(),friends:y(vo),structs:ge(c(),Io),exposedFunctions:ge(c(),Ao)});ge(c(),Oo);function Ln(e){return typeof e=="object"&&"MutableReference"in e?e.MutableReference:void 0}function jo(e){return typeof e=="object"&&"Reference"in e?e.Reference:void 0}function Kn(e){if(typeof e=="object"&&"Struct"in e)return e;const t=jo(e),n=Ln(e);if(typeof t=="object"&&"Struct"in t)return t;if(typeof n=="object"&&"Struct"in n)return n}const Do=h({apy:j(),address:c()});h({epoch:c(),apys:y(Do)});h({value:j()});const xo=h({stakedSuiId:c(),stakeRequestEpoch:c(),stakeActiveEpoch:c(),principal:c(),status:K([I("Active"),I("Pending"),I("Unstaked")]),estimatedReward:k(c())});h({validatorAddress:c(),stakingPool:c(),stakes:y(xo)});const Eo=h({balance:h({value:j()}),distribution_counter:j(),current_distribution_amount:j(),stake_subsidy_period_length:j(),stake_subsidy_decrease_rate:j()});h({type:c(),fields:Eo});h({value:j()});const Bo=h({id:c(),size:j(),head:h({vec:y()}),tail:h({vec:y()})});h({id:c(),size:j()});h({type:c(),fields:Bo});const Mo=h({exchangeRates:h({id:c(),size:j()}),id:c(),pendingStake:j(),pendingPoolTokenWithdraw:j(),pendingTotalSuiWithdraw:j(),poolTokenBalance:j(),rewardsPool:h({value:j()}),activationEpoch:h({vec:y()}),deactivationEpoch:h({vec:y()}),suiBalance:j()});h({type:c(),fields:Mo});const No=y(ne([c(),c()]));h({epoch:c(),validators:No});const Un=h({suiAddress:c(),protocolPubkeyBytes:c(),networkPubkeyBytes:c(),workerPubkeyBytes:c(),proofOfPossessionBytes:c(),operationCapId:c(),name:c(),description:c(),imageUrl:c(),projectUrl:c(),p2pAddress:c(),netAddress:c(),primaryAddress:c(),workerAddress:c(),nextEpochProtocolPubkeyBytes:x(c()),nextEpochProofOfPossession:x(c()),nextEpochNetworkPubkeyBytes:x(c()),nextEpochWorkerPubkeyBytes:x(c()),nextEpochNetAddress:x(c()),nextEpochP2pAddress:x(c()),nextEpochPrimaryAddress:x(c()),nextEpochWorkerAddress:x(c()),votingPower:c(),gasPrice:c(),commissionRate:c(),nextEpochStake:c(),nextEpochGasPrice:c(),nextEpochCommissionRate:c(),stakingPoolId:c(),stakingPoolActivationEpoch:x(c()),stakingPoolDeactivationEpoch:x(c()),stakingPoolSuiBalance:c(),rewardsPool:c(),poolTokenBalance:c(),pendingStake:c(),pendingPoolTokenWithdraw:c(),pendingTotalSuiWithdraw:c(),exchangeRatesId:c(),exchangeRatesSize:c()});h({epoch:c(),protocolVersion:c(),systemStateVersion:c(),storageFundTotalObjectStorageRebates:c(),storageFundNonRefundableBalance:c(),referenceGasPrice:c(),safeMode:X(),safeModeStorageRewards:c(),safeModeComputationRewards:c(),safeModeStorageRebates:c(),safeModeNonRefundableStorageFee:c(),epochStartTimestampMs:c(),epochDurationMs:c(),stakeSubsidyStartEpoch:c(),maxValidatorCount:c(),minValidatorJoiningStake:c(),validatorLowStakeThreshold:c(),validatorVeryLowStakeThreshold:c(),validatorLowStakeGracePeriod:c(),stakeSubsidyBalance:c(),stakeSubsidyDistributionCounter:c(),stakeSubsidyCurrentDistributionAmount:c(),stakeSubsidyPeriodLength:c(),stakeSubsidyDecreaseRate:j(),totalStake:c(),activeValidators:y(Un),pendingActiveValidatorsId:c(),pendingActiveValidatorsSize:c(),pendingRemovals:y(c()),stakingPoolMappingsId:c(),stakingPoolMappingsSize:c(),inactivePoolsId:c(),inactivePoolsSize:c(),validatorCandidatesId:c(),validatorCandidatesSize:c(),atRiskValidators:y(ne([c(),c()])),validatorReportRecords:y(ne([c(),y(c())]))});const Ro=h({coinType:c(),coinObjectId:c(),version:c(),digest:c(),balance:c(),previousTransaction:c()});h({data:y(Ro),nextCursor:x(c()),hasNextPage:X()});h({coinType:c(),coinObjectCount:j(),totalBalance:c(),lockedBalance:h({epochId:k(j()),number:k(j())})});h({value:c()});const $o=h({lastCheckpointId:c(),epochEndTimestamp:c(),protocolVersion:c(),referenceGasPrice:c(),totalStake:c(),storageFundReinvestment:c(),storageCharge:c(),storageRebate:c(),storageFundBalance:c(),stakeSubsidyAmount:c(),totalGasFees:c(),totalStakeRewardsDistributed:c(),leftoverStorageFundInflow:c()}),qo=h({epoch:c(),validators:y(Un),epochTotalTransactions:c(),firstCheckpointId:c(),epochStartTimestamp:c(),endOfEpochInfo:x($o),referenceGasPrice:x(j())});h({data:y(qo),nextCursor:x(c()),hasNextPage:X()});h({data:y(c()),hasNextPage:X(),nextCursor:x(c())});const Fo=K([I("DynamicField"),I("DynamicObject")]),Lo=h({type:c(),value:lt()}),Ko=h({name:Lo,bcsName:c(),type:Fo,objectType:c(),objectId:c(),version:j(),digest:c()});h({data:y(Ko),nextCursor:x(c()),hasNextPage:X()});const Uo=h({computationCost:c(),storageCost:c(),storageRebate:c(),nonRefundableStorageFee:c()});c();c();h({digest:y(j())});const Vn=lt();c();const Vo=h({nextEpochCommittee:y(ne([c(),c()])),nextEpochProtocolVersion:c(),epochCommitments:y(Vn)});h({transaction:c(),effects:c()});const Go=h({epoch:c(),sequenceNumber:c(),digest:c(),networkTotalTransactions:c(),previousDigest:k(c()),epochRollingGasCostSummary:Uo,timestampMs:c(),endOfEpochData:k(Vo),validatorSignature:c(),transactions:y(c()),checkpointCommitments:y(Vn)});h({data:y(Go),nextCursor:x(c()),hasNextPage:X()});h({currentTps:j(),tps30Days:j(),currentCheckpoint:c(),currentEpoch:c(),totalAddresses:c(),totalObjects:c(),totalPackages:c()});const Xo=h({checkpoint:j(),epoch:j(),timestampMs:j(),cumulativeAddresses:j(),cumulativeActiveAddresses:j(),dailyActiveAddresses:j()});y(Xo);const Gn="0x2",nn="0x1",zo="object",Wo="ID",Jo=`${Gn}::sui::SUI`;ce("0x6");h({decimals:j(),name:c(),symbol:c(),description:c(),iconUrl:x(c()),id:x(c())});const Zo="ascii",Ho="String",Yo="string",Qo="String",es="option",ts="Option",ns={address:Gn,module:zo,name:Wo},is={address:nn,module:Zo,name:Ho},os={address:nn,module:Yo,name:Qo},ss={address:nn,module:es,name:ts},bt=(e,t)=>e.address===t.address&&e.module===t.module&&e.name===t.name;function rs(e){var n;const t=(n=Kn(e))==null?void 0:n.Struct;return(t==null?void 0:t.address)==="0x2"&&(t==null?void 0:t.module)==="tx_context"&&(t==null?void 0:t.name)==="TxContext"}function Mt(e,t){if(!(typeof t>"u")&&typeof t!==e)throw new Error(`Expect ${t} to be ${e}, received ${typeof t}`)}const as=["Address","Bool","U8","U16","U32","U64","U128","U256"];function Gt(e,t){if(typeof e=="string"&&as.includes(e)){if(e in["U8","U16","U32","U64","U128","U256"])Mt("number",t);else if(e==="Bool")Mt("boolean",t);else if(e==="Address"&&(Mt("string",t),t&&!ji(t)))throw new Error("Invalid Sui Address");return e.toLowerCase()}else if(typeof e=="string")throw new Error(`Unknown pure normalized type ${JSON.stringify(e,null,2)}`);if("Vector"in e){if((t===void 0||typeof t=="string")&&e.Vector==="U8")return"string";if(t!==void 0&&!Array.isArray(t))throw new Error(`Expect ${t} to be a array, received ${typeof t}`);const n=Gt(e.Vector,t?t[0]:void 0);return n===void 0?void 0:`vector<${n}>`}if("Struct"in e){if(bt(e.Struct,is))return"string";if(bt(e.Struct,os))return"utf8string";if(bt(e.Struct,ns))return"address";if(bt(e.Struct,ss)){const n={Vector:e.Struct.typeArguments[0]};return Gt(n,t)}}}const Xe="vector",cs={kind:"TransactionKind",sender:V.ADDRESS,gasData:"GasData",expiration:"TransactionExpiration"},us={enums:{"Option<T>":{None:null,Some:"T"},ObjectArg:{ImmOrOwned:"SuiObjectRef",Shared:"SharedObjectRef"},CallArg:{Pure:[Xe,V.U8],Object:"ObjectArg",ObjVec:[Xe,"ObjectArg"]},TypeTag:{bool:null,u8:null,u64:null,u128:null,address:null,signer:null,vector:"TypeTag",struct:"StructTag",u16:null,u32:null,u256:null},TransactionKind:{ProgrammableTransaction:"ProgrammableTransaction",ChangeEpoch:null,Genesis:null,ConsensusCommitPrologue:null},TransactionExpiration:{None:null,Epoch:"unsafe_u64"},TransactionData:{V1:"TransactionDataV1"}},structs:{SuiObjectRef:{objectId:V.ADDRESS,version:V.U64,digest:"ObjectDigest"},SharedObjectRef:{objectId:V.ADDRESS,initialSharedVersion:V.U64,mutable:V.BOOL},StructTag:{address:V.ADDRESS,module:V.STRING,name:V.STRING,typeParams:[Xe,"TypeTag"]},GasData:{payment:[Xe,"SuiObjectRef"],owner:V.ADDRESS,price:V.U64,budget:V.U64},SenderSignedData:{data:"TransactionData",txSignatures:[Xe,[Xe,V.U8]]},TransactionDataV1:cs},aliases:{ObjectDigest:V.BASE58}},on=new V({...Si(),types:us});on.registerType("utf8string",(e,t)=>{const n=Array.from(new TextEncoder().encode(t));return e.writeVec(n,(i,o)=>i.write8(o))},e=>{let t=e.readVec(n=>n.read8());return new TextDecoder().decode(new Uint8Array(t))});on.registerType("unsafe_u64",(e,t)=>e.write64(t),e=>Number.parseInt(e.read64(),10));const ds=/^vector<(.+)>$/,ls=/^([^:]+)::([^:]+)::([^<]+)(<(.+)>)?/;class Ae{static parseFromStr(t,n=!1){if(t==="address")return{address:null};if(t==="bool")return{bool:null};if(t==="u8")return{u8:null};if(t==="u16")return{u16:null};if(t==="u32")return{u32:null};if(t==="u64")return{u64:null};if(t==="u128")return{u128:null};if(t==="u256")return{u256:null};if(t==="signer")return{signer:null};const i=t.match(ds);if(i)return{vector:Ae.parseFromStr(i[1],n)};const o=t.match(ls);if(o)return{struct:{address:n?H(o[1]):o[1],module:o[2],name:o[3],typeParams:o[5]===void 0?[]:Ae.parseStructTypeArgs(o[5],n)}};throw new Error(`Encountered unexpected token when parsing type args for ${t}`)}static parseStructTypeArgs(t,n=!1){return Ti(t).map(i=>Ae.parseFromStr(i,n))}static tagToString(t){if("bool"in t)return"bool";if("u8"in t)return"u8";if("u16"in t)return"u16";if("u32"in t)return"u32";if("u64"in t)return"u64";if("u128"in t)return"u128";if("u256"in t)return"u256";if("address"in t)return"address";if("signer"in t)return"signer";if("vector"in t)return`vector<${Ae.tagToString(t.vector)}>`;if("struct"in t){const n=t.struct,i=n.typeParams.map(Ae.tagToString).join(", ");return`${n.address}::${n.module}::${n.name}${i?`<${i}>`:""}`}throw new Error("Invalid TypeTag")}}const Xn="Argument",te="vector",_s="Option",ps="CallArg",mn="TypeTag",ms="ProgrammableTransaction",Xt="ProgrammableMoveCall",zn="Transaction",hn="CompressedSignature",gn="PublicKey",fn="MultiSigPublicKey",bn="MultiSigPkMap",hs="MultiSig",sn="EnumKind",gs=[sn,zn],Ce=[sn,Xn],Wn="SimpleProgrammableMoveCall",he=new V(on);rn(he,"FixedArray[64]",64);rn(he,"FixedArray[33]",33);rn(he,"FixedArray[32]",32);he.registerStructType(ms,{inputs:[te,ps],transactions:[te,gs]}).registerEnumType(Xn,{GasCoin:null,Input:{index:V.U16},Result:{index:V.U16},NestedResult:{index:V.U16,resultIndex:V.U16}}).registerStructType(Xt,{package:V.ADDRESS,module:V.STRING,function:V.STRING,type_arguments:[te,mn],arguments:[te,Ce]}).registerEnumType(zn,{MoveCall:Wn,TransferObjects:{objects:[te,Ce],address:Ce},SplitCoins:{coin:Ce,amounts:[te,Ce]},MergeCoins:{destination:Ce,sources:[te,Ce]},Publish:{modules:[te,[te,V.U8]],dependencies:[te,V.ADDRESS]},MakeMoveVec:{type:[_s,mn],objects:[te,Ce]},Upgrade:{modules:[te,[te,V.U8]],dependencies:[te,V.ADDRESS],packageId:V.ADDRESS,ticket:Ce}}).registerEnumType(hn,{ED25519:["FixedArray[64]","u8"],Secp256k1:["FixedArray[64]","u8"],Secp256r1:["FixedArray[64]","u8"]}).registerEnumType(gn,{ED25519:["FixedArray[32]","u8"],Secp256k1:["FixedArray[33]","u8"],Secp256r1:["FixedArray[33]","u8"]}).registerStructType(bn,{pubKey:gn,weight:V.U8}).registerStructType(fn,{pk_map:[te,bn],threshold:V.U16}).registerStructType(hs,{sigs:[te,hn],bitmap:V.U16,multisig_pk:fn});he.registerType([sn,"T"],function(t,n,i,o){const r={[n.kind]:n},[a]=i;return this.getTypeInterface(a)._encodeRaw.call(this,t,r,i,o)},function(t,n,i){const[o]=n,s=this.getTypeInterface(o)._decodeRaw.call(this,t,n,i),r=Object.keys(s)[0];return{kind:r,...s[r]}},e=>{if(typeof e!="object"&&!("kind"in e))throw new Error(`EnumKind: Missing property "kind" in the input ${JSON.stringify(e)}`);return!0});he.registerType(Wn,function(t,n,i,o){const[s,r,a]=n.target.split("::"),d=n.typeArguments.map(u=>Ae.parseFromStr(u,!0));return this.getTypeInterface(Xt)._encodeRaw.call(this,t,{package:H(s),module:r,function:a,type_arguments:d,arguments:n.arguments},i,o)},function(t,n,i){let o=he.getTypeInterface(Xt)._decodeRaw.call(this,t,n,i);return{target:[o.package,o.module,o.function].join("::"),arguments:o.arguments,typeArguments:o.type_arguments.map(Ae.tagToString)}},e=>e.target.split("::").length===3);function rn(e,t,n){e.registerType(t,function(o,s,r,a){if(s.length!==n)throw new Error(`Expected fixed array of length ${n}, got ${s.length}`);if(r.length!==1)throw new Error(`Expected one type parameter in a fixed array, got ${r.length}`);let[d]=typeof r[0]=="string"?[r[0],[]]:r[0];for(let u of s)this.getTypeInterface(d)._encodeRaw.call(this,o,u,r,a);return o},function(o,s,r){if(s.length!==1)throw new Error(`Expected one type parameter in a fixed array, got ${s.length}`);let a=[],[d]=typeof s[0]=="string"?[s[0],[]]:s[0];for(let u=0;u<n;u++)a.push(this.getTypeInterface(d)._decodeRaw.call(this,o,s,r));return a})}const fs=K([h({ImmOrOwned:be}),h({Shared:h({objectId:c(),initialSharedVersion:K([je(),c()]),mutable:X()})})]),It=h({Pure:y(je())}),bs=h({Object:fs}),tt=K([It,bs]),Pe={Pure(e,t){return{Pure:Array.from(e instanceof Uint8Array?e:he.ser(t,e,{maxSize:1/0}).toBytes())}},ObjectRef({objectId:e,digest:t,version:n}){return{Object:{ImmOrOwned:{digest:t,version:n,objectId:H(e)}}}},SharedObjectRef({objectId:e,mutable:t,initialSharedVersion:n}){return{Object:{Shared:{mutable:t,initialSharedVersion:n,objectId:H(e)}}}}};function yn(e){return typeof e=="string"?H(e):"ImmOrOwned"in e.Object?H(e.Object.ImmOrOwned.objectId):H(e.Object.Shared.objectId)}function ys(e){return typeof e=="object"&&"Object"in e&&"Shared"in e.Object?e.Object.Shared:void 0}function ks(e){var t;return((t=ys(e))==null?void 0:t.mutable)??!1}function le(e,t){return Ai(e,t)}const Ot=Symbol("transaction-argument-type"),ws=e=>K([h({None:K([I(!0),I(null)])}),h({Some:e})]),rt=h({kind:I("Input"),index:je(),value:k(lt()),type:k(K([I("pure"),I("object")]))}),an=[rt,h({kind:I("GasCoin")}),h({kind:I("Result"),index:je()}),h({kind:I("NestedResult"),index:je(),resultIndex:je()})],vs=K([...an]),Ue=K([...an]);Ue[Ot]={kind:"object"};const Jn=e=>{const t=K([...an]);return t[Ot]={kind:"pure",type:e},t},Zn=h({kind:I("MoveCall"),target:dt("target",c().validator),typeArguments:y(c()),arguments:y(vs)}),Hn=h({kind:I("TransferObjects"),objects:y(Ue),address:Jn(V.ADDRESS)}),Yn=h({kind:I("SplitCoins"),coin:Ue,amounts:y(Jn("u64"))}),Qn=h({kind:I("MergeCoins"),destination:Ue,sources:y(Ue)}),ei=h({kind:I("MakeMoveVec"),type:k(ws(ge(c(),jn()))),objects:y(Ue)}),ti=h({kind:I("Publish"),modules:y(y(je())),dependencies:y(c())}),ni=h({kind:I("Upgrade"),modules:y(y(je())),dependencies:y(c()),packageId:c(),ticket:Ue}),ii=[Zn,Hn,Yn,Qn,ti,ni,ei],oi=K([...ii]);function Cs(e){return Ut(e,oi),ii.find(t=>me(e,t))}const Ee={MoveCall(e){return le({kind:"MoveCall",target:e.target,arguments:e.arguments??[],typeArguments:e.typeArguments??[]},Zn)},TransferObjects(e,t){return le({kind:"TransferObjects",objects:e,address:t},Hn)},SplitCoins(e,t){return le({kind:"SplitCoins",coin:e,amounts:t},Yn)},MergeCoins(e,t){return le({kind:"MergeCoins",destination:e,sources:t},Qn)},Publish({modules:e,dependencies:t}){return le({kind:"Publish",modules:e.map(n=>typeof n=="string"?Array.from(Pt(n)):n),dependencies:t.map(n=>ce(n))},ti)},Upgrade({modules:e,dependencies:t,packageId:n,ticket:i}){return le({kind:"Upgrade",modules:e.map(o=>typeof o=="string"?Array.from(Pt(o)):o),dependencies:t.map(o=>ce(o)),packageId:n,ticket:i},ni)},MakeMoveVec({type:e,objects:t}){return le({kind:"MakeMoveVec",type:e?{Some:Ae.parseFromStr(e)}:{None:null},objects:t},ei)}};function Ss(e,t){const n=Array.from(`${e}::`).map(o=>o.charCodeAt(0)),i=new Uint8Array(n.length+t.length);return i.set(n),i.set(t,n.length),Pi(i,{dkLen:32})}const Ts=k(x(K([h({Epoch:je()}),h({None:K([I(!0),I(null)])})]))),kn=dt("StringEncodedBigint",e=>{if(!["string","number","bigint"].includes(typeof e))return!1;try{return BigInt(e),!0}catch{return!1}}),As=h({budget:k(kn),price:k(kn),payment:k(y(be)),owner:k(c())}),yt=h({version:I(1),sender:k(c()),expiration:Ts,gasConfig:As,inputs:y(rt),transactions:y(oi)});function wn(e){return H(e).replace("0x","")}class Oe{constructor(t){this.version=1,this.sender=t==null?void 0:t.sender,this.expiration=t==null?void 0:t.expiration,this.gasConfig=(t==null?void 0:t.gasConfig)??{},this.inputs=(t==null?void 0:t.inputs)??[],this.transactions=(t==null?void 0:t.transactions)??[]}static fromKindBytes(t){const n=he.de("TransactionKind",t),i=n==null?void 0:n.ProgrammableTransaction;if(!i)throw new Error("Unable to deserialize from bytes.");const o=le({version:1,gasConfig:{},inputs:i.inputs.map((s,r)=>le({kind:"Input",value:s,index:r,type:me(s,It)?"pure":"object"},rt)),transactions:i.transactions},yt);return Oe.restore(o)}static fromBytes(t){var r;const n=he.de("TransactionData",t),i=n==null?void 0:n.V1,o=(r=i==null?void 0:i.kind)==null?void 0:r.ProgrammableTransaction;if(!i||!o)throw new Error("Unable to deserialize from bytes.");const s=le({version:1,sender:i.sender,expiration:i.expiration,gasConfig:i.gasData,inputs:o.inputs.map((a,d)=>le({kind:"Input",value:a,index:d,type:me(a,It)?"pure":"object"},rt)),transactions:o.transactions},yt);return Oe.restore(s)}static restore(t){Ut(t,yt);const n=new Oe;return Object.assign(n,t),n}static getDigestFromBytes(t){const n=Ss("TransactionData",t);return Ii(n)}build({maxSizeBytes:t=1/0,overrides:n,onlyTransactionKind:i}={}){const o=this.inputs.map(_=>(Ut(_.value,tt),_.value)),s={ProgrammableTransaction:{inputs:o,transactions:this.transactions}};if(i)return he.ser("TransactionKind",s,{maxSize:t}).toBytes();const r=(n==null?void 0:n.expiration)??this.expiration,a=(n==null?void 0:n.sender)??this.sender,d={...this.gasConfig,...n==null?void 0:n.gasConfig};if(!a)throw new Error("Missing transaction sender");if(!d.budget)throw new Error("Missing gas budget");if(!d.payment)throw new Error("Missing gas payment");if(!d.price)throw new Error("Missing gas price");const u={sender:wn(a),expiration:r||{None:!0},gasData:{payment:d.payment,owner:wn(this.gasConfig.owner??a),price:BigInt(d.price),budget:BigInt(d.budget)},kind:{ProgrammableTransaction:{inputs:o,transactions:this.transactions}}};return he.ser("TransactionData",{V1:u},{maxSize:t}).toBytes()}getDigest(){const t=this.build({onlyTransactionKind:!1});return Oe.getDigestFromBytes(t)}snapshot(){return le(this,yt)}}var cn=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},z=(e,t,n)=>(cn(e,t,"read from private field"),n?n.call(e):t.get(e)),Be=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},kt=(e,t,n,i)=>(cn(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),re=(e,t,n)=>(cn(e,t,"access private method"),n),L,St,zt,Re,Ve,un,si,dn,ri,ln,ai,_n,ci,Tt,Wt;const Ps={maxPureArgumentSize:16*1024,maxTxGas:5e10,maxGasObjects:256,maxTxSizeBytes:128*1024};function Is(e){const t={kind:"Result",index:e},n=[],i=o=>n[o]??(n[o]={kind:"NestedResult",index:e,resultIndex:o});return new Proxy(t,{set(){throw new Error("The transaction result is a proxy, and does not support setting properties directly")},get(o,s){if(s in o)return Reflect.get(o,s);if(s===Symbol.iterator)return function*(){let a=0;for(;;)yield i(a),a++};if(typeof s=="symbol")return;const r=parseInt(s,10);if(!(Number.isNaN(r)||r<0))return i(r)}})}function at(e){if(!e.client&&!e.provider)throw new Error("No provider passed to Transaction#build, but transaction data was not sufficient to build offline.");return e.client??e.provider}const vn=Symbol.for("@mysten/transaction"),Nt={maxTxGas:"max_tx_gas",maxGasObjects:"max_gas_payment_objects",maxTxSizeBytes:"max_tx_size_bytes",maxPureArgumentSize:"max_pure_argument_size"},Os=1000n,js=50,Ds=(e,t)=>Array.from({length:Math.ceil(e.length/t)},(n,i)=>e.slice(i*t,i*t+t)),xs=class Jt{constructor(t){Be(this,St),Be(this,Re),Be(this,un),Be(this,dn),Be(this,ln),Be(this,_n),Be(this,Tt),Be(this,L,void 0),kt(this,L,new Oe(t?t.blockData:void 0))}static is(t){return!!t&&typeof t=="object"&&t[vn]===!0}static fromKind(t){const n=new Jt;return kt(n,L,Oe.fromKindBytes(typeof t=="string"?Pt(t):t)),n}static from(t){const n=new Jt;return typeof t!="string"||!t.startsWith("{")?kt(n,L,Oe.fromBytes(typeof t=="string"?Pt(t):t)):kt(n,L,Oe.restore(JSON.parse(t))),n}static get Transactions(){return Ee}static get Inputs(){return Pe}setSender(t){z(this,L).sender=t}setSenderIfNotSet(t){z(this,L).sender||(z(this,L).sender=t)}setExpiration(t){z(this,L).expiration=t}setGasPrice(t){z(this,L).gasConfig.price=String(t)}setGasBudget(t){z(this,L).gasConfig.budget=String(t)}setGasOwner(t){z(this,L).gasConfig.owner=t}setGasPayment(t){z(this,L).gasConfig.payment=t.map(n=>Oi(n,be))}get blockData(){return z(this,L).snapshot()}get[vn](){return!0}get gas(){return{kind:"GasCoin"}}object(t){const n=yn(t);return z(this,L).inputs.find(o=>o.type==="object"&&n===yn(o.value))??re(this,St,zt).call(this,"object",t)}objectRef(...t){return this.object(Pe.ObjectRef(...t))}sharedObjectRef(...t){return this.object(Pe.SharedObjectRef(...t))}pure(t,n){return re(this,St,zt).call(this,"pure",t instanceof Uint8Array?Pe.Pure(t):n?Pe.Pure(t,n):t)}add(t){const n=z(this,L).transactions.push(t);return Is(n-1)}splitCoins(...t){return this.add(Ee.SplitCoins(...t))}mergeCoins(...t){return this.add(Ee.MergeCoins(...t))}publish(...t){return this.add(Ee.Publish(...t))}upgrade(...t){return this.add(Ee.Upgrade(...t))}moveCall(...t){return this.add(Ee.MoveCall(...t))}transferObjects(...t){return this.add(Ee.TransferObjects(...t))}makeMoveVec(...t){return this.add(Ee.MakeMoveVec(...t))}serialize(){return JSON.stringify(z(this,L).snapshot())}async sign(t){const{signer:n,...i}=t,o=await this.build(i);return n.signTransactionBlock(o)}async build(t={}){return await re(this,Tt,Wt).call(this,t),z(this,L).build({maxSizeBytes:re(this,Re,Ve).call(this,"maxTxSizeBytes",t),onlyTransactionKind:t.onlyTransactionKind})}async getDigest(t={}){return await re(this,Tt,Wt).call(this,t),z(this,L).getDigest()}};L=new WeakMap;St=new WeakSet;zt=function(e,t){const n=z(this,L).inputs.length,i=le({kind:"Input",value:typeof t=="bigint"?String(t):t,index:n,type:e},rt);return z(this,L).inputs.push(i),i};Re=new WeakSet;Ve=function(e,{protocolConfig:t,limits:n}){if(n&&typeof n[e]=="number")return n[e];if(!t)return Ps[e];const i=t==null?void 0:t.attributes[Nt[e]];if(!i)throw new Error(`Missing expected protocol config: "${Nt[e]}"`);const o="u64"in i?i.u64:"u32"in i?i.u32:i.f64;if(!o)throw new Error(`Unexpected protocol config value found for: "${Nt[e]}"`);return Number(o)};un=new WeakSet;si=function(e){const t=re(this,Re,Ve).call(this,"maxPureArgumentSize",e);z(this,L).inputs.forEach((n,i)=>{if(me(n.value,It)&&n.value.Pure.length>t)throw new Error(`Input at index ${i} is too large, max pure input size is ${t} bytes, got ${n.value.Pure.length} bytes`)})};dn=new WeakSet;ri=async function(e){if(z(this,L).gasConfig.payment){const o=re(this,Re,Ve).call(this,"maxGasObjects",e);if(z(this,L).gasConfig.payment.length>o)throw new Error(`Payment objects exceed maximum amount: ${o}`)}if(e.onlyTransactionKind||z(this,L).gasConfig.payment)return;const t=z(this,L).gasConfig.owner??z(this,L).sender,i=(await at(e).getCoins({owner:t,coinType:Jo})).data.filter(o=>!z(this,L).inputs.find(r=>me(r.value,tt)&&"Object"in r.value&&"ImmOrOwned"in r.value.Object?o.coinObjectId===r.value.Object.ImmOrOwned.objectId:!1)).slice(0,re(this,Re,Ve).call(this,"maxGasObjects",e)-1).map(o=>({objectId:o.coinObjectId,digest:o.digest,version:o.version}));if(!i.length)throw new Error("No valid gas coins found for the transaction.");this.setGasPayment(i)};ln=new WeakSet;ai=async function(e){e.onlyTransactionKind||z(this,L).gasConfig.price||this.setGasPrice(await at(e).getReferenceGasPrice())};_n=new WeakSet;ci=async function(e){const{inputs:t,transactions:n}=z(this,L),i=[],o=[];if(n.forEach(s=>{if(s.kind==="MoveCall"){s.arguments.some(d=>d.kind==="Input"&&!me(t[d.index].value,tt))&&i.push(s);return}const r=Cs(s);r.schema&&Object.entries(s).forEach(([a,d])=>{if(a==="kind")return;const u=r.schema[a],_=u.type==="array",p=_?u.schema[Ot]:u[Ot];if(!p)return;const m=b=>{const S=t[b];if(!S)throw new Error(`Missing input ${d.index}`);if(!me(S.value,tt))if(p.kind==="object"&&typeof S.value=="string")o.push({id:S.value,input:S});else if(p.kind==="pure")S.value=Pe.Pure(S.value,p.type);else throw new Error("Unexpected input format.")};if(_)d.forEach(b=>{b.kind==="Input"&&m(b.index)});else{if(d.kind!=="Input")return;m(d.index)}})}),i.length&&await Promise.all(i.map(async s=>{const[r,a,d]=s.target.split("::"),u=await at(e).getNormalizedMoveFunction({package:ce(r),module:a,function:d}),p=u.parameters.length>0&&rs(u.parameters.at(-1))?u.parameters.slice(0,u.parameters.length-1):u.parameters;if(p.length!==s.arguments.length)throw new Error("Incorrect number of arguments.");p.forEach((m,b)=>{const S=s.arguments[b];if(S.kind!=="Input")return;const w=t[S.index];if(me(w.value,tt))return;const v=w.value,P=Gt(m,v);if(P){w.value=Pe.Pure(v,P);return}if(Kn(m)!=null||typeof m=="object"&&"TypeParameter"in m){if(typeof v!="string")throw new Error(`Expect the argument to be an object id string, got ${JSON.stringify(v,null,2)}`);o.push({id:v,input:w,normalizedType:m});return}throw new Error(`Unknown call arg type ${JSON.stringify(m,null,2)} for value ${JSON.stringify(v,null,2)}`)})})),o.length){const s=[...new Set(o.map(({id:_})=>_))],r=Ds(s,js),a=(await Promise.all(r.map(_=>at(e).multiGetObjects({ids:_,options:{showOwner:!0}})))).flat();let d=new Map(s.map((_,p)=>[_,a[p]]));const u=Array.from(d).filter(([_,p])=>p.error).map(([_,p])=>_);if(u.length)throw new Error(`The following input objects are invalid: ${u.join(", ")}`);o.forEach(({id:_,input:p,normalizedType:m})=>{var v;const b=d.get(_),S=(v=b.data)==null?void 0:v.owner,w=S&&typeof S=="object"&&"Shared"in S?S.Shared.initial_shared_version:void 0;if(w){const P=ks(p.value)||m!=null&&Ln(m)!=null;p.value=Pe.SharedObjectRef({objectId:_,initialSharedVersion:w,mutable:P})}else p.value=Pe.ObjectRef(Ji(b))})}};Tt=new WeakSet;Wt=async function(e){if(!e.onlyTransactionKind&&!z(this,L).sender)throw new Error("Missing transaction sender");const t=e.client||e.provider;if(!e.protocolConfig&&!e.limits&&t&&(e.protocolConfig=await t.getProtocolConfig()),await Promise.all([re(this,ln,ai).call(this,e),re(this,_n,ci).call(this,e)]),!e.onlyTransactionKind&&(await re(this,dn,ri).call(this,e),!z(this,L).gasConfig.budget)){const n=await at(e).dryRunTransactionBlock({transactionBlock:z(this,L).build({maxSizeBytes:re(this,Re,Ve).call(this,"maxTxSizeBytes",e),overrides:{gasConfig:{budget:String(re(this,Re,Ve).call(this,"maxTxGas",e)),payment:[]}}})});if(n.effects.status.status!=="success")throw new Error(`Dry run failed, could not automatically determine a budget: ${n.effects.status.error}`,{cause:n});const i=Os*BigInt(this.blockData.gasConfig.price||1n),o=BigInt(n.effects.gasUsed.computationCost)+i,s=o+BigInt(n.effects.gasUsed.storageCost)-BigInt(n.effects.gasUsed.storageRebate);this.setGasBudget(s>o?s:o)}re(this,un,si).call(this,e)};let T=xs;var Es=Object.defineProperty,Bs=(e,t,n)=>t in e?Es(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ms=(e,t,n)=>(Bs(e,typeof t!="symbol"?t+"":t,n),n),De=5*60*1e3,M=24*60*60*1e3;function Q(e){return Date.parse(new Date().toString())+e}var xe=class{constructor(e,t=0){q(this,"overdueTime");q(this,"value");this.overdueTime=t,this.value=e}isValid(){return this.value===null?!1:this.overdueTime===0?!0:!(Date.parse(new Date().toString())>this.overdueTime)}};W.config({precision:64,rounding:W.ROUND_DOWN,toExpNeg:-64,toExpPos:64});var ee=W,de=class extends Error{constructor(t,n){super(t);q(this,"message");q(this,"errorCode");this.message=t,this.errorCode=n}static isClmmpoolsErrorCode(t,n){return t instanceof de&&t.errorCode===n}},Z=new g(0),nt=new g(1),xt=new g(2);xt.pow(new g(128));var Zt=xt.pow(new g(64)).sub(nt),Ns=xt.pow(new g(128)).sub(nt),Te=class{static toX64_BN(e){return e.mul(new g(2).pow(new g(64)))}static toX64_Decimal(e){return e.mul(ee.pow(2,64))}static toX64(e){return new g(e.mul(ee.pow(2,64)).floor().toFixed())}static fromX64(e){return new ee(e.toString()).mul(ee.pow(2,-64))}static fromX64_Decimal(e){return e.mul(ee.pow(2,-64))}static fromX64_BN(e){return e.div(new g(2).pow(new g(64)))}static shiftRightRoundUp(e){let t=e.shrn(64);return e.mod(Zt).gt(Z)&&(t=t.add(nt)),t}static divRoundUp(e,t){return e.mod(t).eq(Z)?e.div(t):e.div(t).add(new g(1))}static subUnderflowU128(e,t){return e.lt(t)?e.sub(t).add(Ns):e.sub(t)}static checkUnsignedSub(e,t){const n=e.sub(t);if(n.isNeg())throw new de("Unsigned integer sub overflow","UnsignedIntegerOverflow");return n}static checkMul(e,t,n){const i=e.mul(t);if(this.isOverflow(i,n))throw new de("Multiplication overflow","MultiplicationOverflow");return i}static checkMulDivFloor(e,t,n,i){if(n.eq(Z))throw new de("Devide by zero","DivideByZero");const o=e.mul(t).div(n);if(this.isOverflow(o,i))throw new de("Multiplication div overflow","MulDivOverflow");return o}static checkMulDivCeil(e,t,n,i){if(n.eq(Z))throw new de("Devide by zero","DivideByZero");const o=e.mul(t).add(n.sub(nt)).div(n);if(this.isOverflow(o,i))throw new de("Multiplication div overflow","MulDivOverflow");return o}static checkMulDivRound(e,t,n,i){if(n.eq(Z))throw new de("Devide by zero","DivideByZero");const o=e.mul(t.add(n.shrn(1))).div(n);if(this.isOverflow(o,i))throw new de("Multiplication div overflow","MulDivOverflow");return o}static checkMulShiftRight(e,t,n,i){const o=e.mul(t).div(new g(2).pow(new g(n)));if(this.isOverflow(o,i))throw new de("Multiplication shift right overflow","MulShiftRightOverflow");return o}static checkMulShiftRight64RoundUpIf(e,t,n,i){const o=e.mul(t),r=i&&o.and(Zt).gt(Z)?o.shrn(64).add(nt):o.shrn(64);if(this.isOverflow(r,n))throw new de("Multiplication shift right overflow","MulShiftRightOverflow");return r}static checkMulShiftLeft(e,t,n,i){const o=e.mul(t).shln(n);if(this.isOverflow(o,i))throw new de("Multiplication shift left overflow","MulShiftLeftOverflow");return o}static checkDivRoundUpIf(e,t,n){if(t.eq(Z))throw new de("Devide by zero","DivideByZero");return n?this.divRoundUp(e,t):e.div(t)}static isOverflow(e,t){return e.gte(xt.pow(new g(t)))}},Rs=443636,$s=-443636,ui="79226673515401279992447579055",di="4295048016",Cn=new g(1e6),C="0x0000000000000000000000000000000000000000000000000000000000000006",qs="pool_script",Sn="pool_script_v2",it="router",Tn="router_with_partner",Ze="fetcher_script",Fs="utils",Rt="custodian_v2",Ls="clob_v2",Ks="endpoints_v2",li=(e=>(e.Deleted="Deleted",e.Exists="Exists",e.NotExists="NotExists",e))(li||{});function f(e){if(e.config===void 0)throw Error(`package: ${e.package_id}  not config in sdk SdkOptions`);return e.config}var Us=14,Vs="59543866431248",Gs="184467440737095516",Xs="15793534762490258745";function zs(e,t,n){const i=e.toTwos(n).shln(t);return i.imaskn(n+1),i.fromTwos(n)}function N(e,t,n){const i=e.toTwos(n).shrn(t);return i.imaskn(n-t+1),i.fromTwos(n-t)}function Ws(e){let t;return e&1?t=new g("79232123823359799118286999567"):t=new g("79228162514264337593543950336"),e&2&&(t=N(t.mul(new g("79236085330515764027303304731")),96,256)),e&4&&(t=N(t.mul(new g("79244008939048815603706035061")),96,256)),e&8&&(t=N(t.mul(new g("79259858533276714757314932305")),96,256)),e&16&&(t=N(t.mul(new g("79291567232598584799939703904")),96,256)),e&32&&(t=N(t.mul(new g("79355022692464371645785046466")),96,256)),e&64&&(t=N(t.mul(new g("79482085999252804386437311141")),96,256)),e&128&&(t=N(t.mul(new g("79736823300114093921829183326")),96,256)),e&256&&(t=N(t.mul(new g("80248749790819932309965073892")),96,256)),e&512&&(t=N(t.mul(new g("81282483887344747381513967011")),96,256)),e&1024&&(t=N(t.mul(new g("83390072131320151908154831281")),96,256)),e&2048&&(t=N(t.mul(new g("87770609709833776024991924138")),96,256)),e&4096&&(t=N(t.mul(new g("97234110755111693312479820773")),96,256)),e&8192&&(t=N(t.mul(new g("119332217159966728226237229890")),96,256)),e&16384&&(t=N(t.mul(new g("179736315981702064433883588727")),96,256)),e&32768&&(t=N(t.mul(new g("407748233172238350107850275304")),96,256)),e&65536&&(t=N(t.mul(new g("2098478828474011932436660412517")),96,256)),e&131072&&(t=N(t.mul(new g("55581415166113811149459800483533")),96,256)),e&262144&&(t=N(t.mul(new g("38992368544603139932233054999993551")),96,256)),N(t,32,256)}function Js(e){const t=Math.abs(e);let n;return t&1?n=new g("18445821805675392311"):n=new g("18446744073709551616"),t&2&&(n=N(n.mul(new g("18444899583751176498")),64,256)),t&4&&(n=N(n.mul(new g("18443055278223354162")),64,256)),t&8&&(n=N(n.mul(new g("18439367220385604838")),64,256)),t&16&&(n=N(n.mul(new g("18431993317065449817")),64,256)),t&32&&(n=N(n.mul(new g("18417254355718160513")),64,256)),t&64&&(n=N(n.mul(new g("18387811781193591352")),64,256)),t&128&&(n=N(n.mul(new g("18329067761203520168")),64,256)),t&256&&(n=N(n.mul(new g("18212142134806087854")),64,256)),t&512&&(n=N(n.mul(new g("17980523815641551639")),64,256)),t&1024&&(n=N(n.mul(new g("17526086738831147013")),64,256)),t&2048&&(n=N(n.mul(new g("16651378430235024244")),64,256)),t&4096&&(n=N(n.mul(new g("15030750278693429944")),64,256)),t&8192&&(n=N(n.mul(new g("12247334978882834399")),64,256)),t&16384&&(n=N(n.mul(new g("8131365268884726200")),64,256)),t&32768&&(n=N(n.mul(new g("3584323654723342297")),64,256)),t&65536&&(n=N(n.mul(new g("696457651847595233")),64,256)),t&131072&&(n=N(n.mul(new g("26294789957452057")),64,256)),t&262144&&(n=N(n.mul(new g("37481735321082")),64,256)),n}var D=class{static priceToSqrtPriceX64(e,t,n){return Te.toX64(e.mul(ee.pow(10,n-t)).sqrt())}static sqrtPriceX64ToPrice(e,t,n){return Te.fromX64(e).pow(2).mul(ee.pow(10,t-n))}static tickIndexToSqrtPriceX64(e){return e>0?new g(Ws(e)):new g(Js(e))}static sqrtPriceX64ToTickIndex(e){if(e.gt(new g(ui))||e.lt(new g(di)))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");const t=e.bitLength()-1,n=new g(t-64),i=zs(n,32,128);let o=new g("8000000000000000","hex"),s=0,r=new g(0),a=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new g(0))&&s<Us;){a=a.mul(a);const S=a.shrn(127);a=a.shrn(63+S.toNumber()),r=r.add(o.mul(S)),o=o.shrn(1),s+=1}const d=r.shrn(32),_=i.add(d).mul(new g(Vs)),p=N(_.sub(new g(Gs)),64,128).toNumber(),m=N(_.add(new g(Xs)),64,128).toNumber();return p===m?p:D.tickIndexToSqrtPriceX64(m).lte(e)?m:p}static tickIndexToPrice(e,t,n){return D.sqrtPriceX64ToPrice(D.tickIndexToSqrtPriceX64(e),t,n)}static priceToTickIndex(e,t,n){return D.sqrtPriceX64ToTickIndex(D.priceToSqrtPriceX64(e,t,n))}static priceToInitializableTickIndex(e,t,n,i){return D.getInitializableTickIndex(D.priceToTickIndex(e,t,n),i)}static getInitializableTickIndex(e,t){return e-e%t}static getNextInitializableTickIndex(e,t){return D.getInitializableTickIndex(e,t)+t}static getPrevInitializableTickIndex(e,t){return D.getInitializableTickIndex(e,t)-t}};new g(365);new g(24);new g(3600);new g(.5);var $e=class{static getDefaultSqrtPriceLimit(e){return new g(e?di:ui)}static getDefaultOtherAmountThreshold(e){return e?Z:Zt}};function wt(e,t,n){const i=g.min(e,t),o=g.max(e,t),s=Te.fromX64_BN(n.mul(o).mul(i)),r=o.sub(i);return s.div(r)}function vt(e,t,n){const i=g.min(e,t),s=g.max(e,t).sub(i);return n.shln(64).div(s)}var ae=class{static updateFeeRate(e,t,n,i,o){const s=Te.checkMulDivCeil(t,new g(i),Cn,64),r=n===0?Z:Te.checkMulDivFloor(t,new g(n),Cn,64),a=t.mul(s).mul(r);if(o?e.feeProtocolCoinA=e.feeProtocolCoinA.add(s):e.feeProtocolCoinB=e.feeProtocolCoinB.add(s),a.eq(Z)||e.liquidity.eq(Z))return{refFee:r,clmm:e};const d=a.shln(64).div(e.liquidity);return o?e.feeGrowthGlobalA=e.feeGrowthGlobalA.add(d):e.feeGrowthGlobalB=e.feeGrowthGlobalB.add(d),{refFee:r,clmm:e}}static getCoinAmountFromLiquidity(e,t,n,i,o){const s=new ee(e.toString()),r=new ee(t.toString()),a=new ee(n.toString()),d=new ee(i.toString());let u,_;return t.lt(n)?(u=Te.toX64_Decimal(s).mul(d.sub(a)).div(a.mul(d)),_=new ee(0)):t.lt(i)?(u=Te.toX64_Decimal(s).mul(d.sub(r)).div(r.mul(d)),_=Te.fromX64_Decimal(s.mul(r.sub(a)))):(u=new ee(0),_=Te.fromX64_Decimal(s.mul(d.sub(a)))),o?{coinA:new g(u.ceil().toString()),coinB:new g(_.ceil().toString())}:{coinA:new g(u.floor().toString()),coinB:new g(_.floor().toString())}}static estLiquidityAndcoinAmountFromOneAmounts(e,t,n,i,o,s,r){const a=D.sqrtPriceX64ToTickIndex(r),d=D.tickIndexToSqrtPriceX64(e),u=D.tickIndexToSqrtPriceX64(t);let _;if(a<e){if(!i)throw new Error("lower tick cannot calculate liquidity by coinB");_=wt(d,u,n)}else if(a>t){if(i)throw new Error("upper tick cannot calculate liquidity by coinA");_=vt(u,d,n)}else i?_=wt(r,u,n):_=vt(r,d,n);const p=ae.getCoinAmountFromLiquidity(_,r,d,u,o),m=o?l(p.coinA.toString()).mul(1+s).toString():l(p.coinA.toString()).mul(1-s).toString(),b=o?l(p.coinB.toString()).mul(1+s).toString():l(p.coinB.toString()).mul(1-s).toString();return{coinAmountA:p.coinA,coinAmountB:p.coinB,tokenMaxA:o?new g(ee.ceil(m).toString()):new g(ee.floor(m).toString()),tokenMaxB:o?new g(ee.ceil(b).toString()):new g(ee.floor(b).toString()),liquidityAmount:_,fix_amount_a:i}}static estimateLiquidityFromcoinAmounts(e,t,n,i){if(t>n)throw new Error("lower tick cannot be greater than lower tick");const o=D.sqrtPriceX64ToTickIndex(e),s=D.tickIndexToSqrtPriceX64(t),r=D.tickIndexToSqrtPriceX64(n);if(o<t)return wt(s,r,i.coinA);if(o>=n)return vt(r,s,i.coinB);const a=wt(e,r,i.coinA),d=vt(e,s,i.coinB);return g.min(a,d)}static estCoinAmountsFromTotalAmount(e,t,n,i,o,s){const{ratioA:r,ratioB:a}=ae.calculateDepositRatioFixTokenA(e,t,n);console.log({ratioA:r,ratioB:a});const d=l(i).mul(r).div(o),u=l(i).mul(a).div(s);return{amountA:d,amountB:u}}static calculateDepositRatioFixTokenA(e,t,n){const i=new g(1e8),{coinAmountB:o}=ae.estLiquidityAndcoinAmountFromOneAmounts(e,t,i,!0,!0,0,n),s=D.sqrtPriceX64ToPrice(n,0,0),r=l(i.toString()).mul(s),a=r.add(o.toString()),d=r.div(a),u=l(o.toString()).div(a);return{ratioA:d,ratioB:u}}},Zs=0,_i=1,Hs=2;function An(e,t){return e===t?Zs:e<t?_i:Hs}function Ys(e,t){let n=0;const i=e.length<=t.length?e.length:t.length,o=An(e.length,t.length);for(;n<i;){const s=An(e.charCodeAt(n),t.charCodeAt(n));if(n+=1,s!==0)return s}return o}function Qs(e,t){return Ys(e,t)===_i}function Ht(e,...t){const n=Array.isArray(t[t.length-1])?t.pop():[];let o=[e,...t].filter(Boolean).join("::");return n&&n.length&&(o+=`<${n.join(", ")}>`),o}function A(e){var t;try{let n=e.replace(/\s/g,"");const i=n.match(/(<.+>)$/),o=(t=i==null?void 0:i[0])==null?void 0:t.match(/(\w+::\w+::\w+)(?:<.*?>(?!>))?/g);if(o){n=n.slice(0,n.indexOf("<"));const u={...A(n),type_arguments:o.map(_=>A(_).source_address)};return u.type_arguments=u.type_arguments.map(_=>G.isSuiCoin(_)?_:A(_).source_address),u.source_address=Ht(u.full_address,u.type_arguments),u}const s=n.split("::"),a={full_address:n,address:n===mi||n===ir?"0x2":ce(s[0]),module:s[1],name:s[2],type_arguments:[],source_address:""};return a.full_address=`${a.address}::${a.module}::${a.name}`,a.source_address=Ht(a.full_address,a.type_arguments),a}catch{return{full_address:e,address:"",module:"",name:"",type_arguments:[],source_address:e}}}function Ke(e){return A(e).source_address}function er(e){return e.toLowerCase().startsWith("0x")?ce(e):e}function pi(e){for(const t in e){const n=typeof e[t];if(n==="object")pi(e[t]);else if(n==="string"){const i=e[t];e[t]=er(i)}}}var tr="0x2::coin::Coin",nr=/^0x2::coin::Coin<(.+)>$/,mi="0x2::sui::SUI",ir="0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI",G=class{static getCoinTypeArg(e){const t=e.type.match(nr);return t?t[1]:null}static isSUI(e){const t=G.getCoinTypeArg(e);return t?G.getCoinSymbol(t)==="SUI":!1}static getCoinSymbol(e){return e.substring(e.lastIndexOf(":")+1)}static getBalance(e){return BigInt(e.fields.balance)}static totalBalance(e,t){let n=BigInt(0);return e.forEach(i=>{t===i.coinAddress&&(n+=BigInt(i.balance))}),n}static getID(e){return e.fields.id.id}static getCoinTypeFromArg(e){return`${tr}<${e}>`}static getFaucetCoins(e){const{events:t}=e,n=[];return t==null||t.forEach(i=>{const{type:o}=i;if(A(o).name==="InitEvent"){const s=i.parsedJson;n.push({transactionModule:i.transactionModule,suplyID:s.suplyID,decimals:s.decimals})}}),n}static getCoinAssets(e,t){const n=[];return t.forEach(i=>{Ke(i.coinAddress)===Ke(e)&&n.push(i)}),n}static isSuiCoin(e){return A(e).full_address===mi}static selectCoinObjectIdGreaterThanOrEqual(e,t,n=[]){const i=G.selectCoinAssetGreaterThanOrEqual(e,t,n),o=i.selectedCoins.map(a=>a.coinObjectId),s=i.remainingCoins,r=i.selectedCoins.map(a=>a.balance.toString());return{objectArray:o,remainCoins:s,amountArray:r}}static selectCoinAssetGreaterThanOrEqual(e,t,n=[]){const i=G.sortByBalance(e.filter(d=>!n.includes(d.coinObjectId))),o=G.calculateTotalBalance(i);if(o<t)return{selectedCoins:[],remainingCoins:i};if(o===t)return{selectedCoins:i,remainingCoins:[]};let s=BigInt(0);const r=[],a=[...i];for(;s<o;){const d=t-s,u=a.findIndex(p=>p.balance>=d);if(u!==-1){r.push(a[u]),a.splice(u,1);break}const _=a.pop();_.balance>0&&(r.push(_),s+=_.balance)}return{selectedCoins:G.sortByBalance(r),remainingCoins:G.sortByBalance(a)}}static sortByBalance(e){return e.sort((t,n)=>t.balance<n.balance?-1:t.balance>n.balance?1:0)}static sortByBalanceDes(e){return e.sort((t,n)=>t.balance>n.balance?-1:t.balance<n.balance?0:1)}static calculateTotalBalance(e){return e.reduce((t,n)=>t+n.balance,BigInt(0))}},ot=class{constructor(e,t){q(this,"numerator");q(this,"denominator");this.toString=()=>`${this.numerator.toString()}/${this.denominator.toString()}`,this.numerator=e,this.denominator=t}static fromDecimal(e){return ot.fromFraction(e.toDecimalPlaces(1).mul(10).toNumber(),1e3)}static fromFraction(e,t){const n=typeof e=="number"?new g(e.toString()):e,i=typeof t=="number"?new g(t.toString()):t;return new ot(n,i)}};function Yt(e,{numerator:t,denominator:n},i){return i?e.mul(n.add(t)).div(n):e.mul(n).div(n.add(t))}function $t(e,t,n){return{tokenMaxA:Yt(e.coinA,t,n),tokenMaxB:Yt(e.coinB,t,n)}}function l(e){return W.isDecimal(e)?e:new W(e===void 0?0:e)}function or(e){return l(10).pow(l(e).abs())}function _t(e){return e.data}function hi(e){if(e.error&&"object_id"in e.error&&"version"in e.error&&"digest"in e.error){const{error:t}=e;return{objectId:t.object_id,version:t.version,digest:t.digest}}}function gi(e){if(e.error&&"object_id"in e.error&&!("version"in e.error)&&!("digest"in e.error))return e.error.object_id}function sr(e){if("reference"in e)return e.reference;const t=_t(e);return t?{objectId:t.objectId,version:t.version,digest:t.digest}:hi(e)}function ct(e){var t;return"objectId"in e?e.objectId:((t=sr(e))==null?void 0:t.objectId)??gi(e)}function rr(e){return e.data!==void 0}function ar(e){return e.content!==void 0}function fi(e){const t="data"in e?_t(e):e;if(!(!t||!ar(t)||t.content.dataType!=="moveObject"))return t.content}function we(e){var t;return(t=fi(e))==null?void 0:t.type}function ut(e){var n;const t=rr(e)?e.data:e;return!(t!=null&&t.type)&&"data"in e?((n=t==null?void 0:t.content)==null?void 0:n.dataType)==="package"?"package":we(e):t==null?void 0:t.type}function bi(e){var t;return(t=_t(e))==null?void 0:t.previousTransaction}function jt(e){var t;return(t=_t(e))==null?void 0:t.owner}function cr(e){var n;const t=(n=_t(e))==null?void 0:n.display;return t||{data:null,error:null}}function $(e){var n;const t=(n=fi(e))==null?void 0:n.fields;if(t)return"fields"in t?t.fields:t}function ur(e,t){const n=or(l(t));return Number(l(e).mul(n))}function He(e,t=32){return BigInt.asUintN(t,BigInt(e)).toString()}function ke(e,t=32){return Number(BigInt.asIntN(t,BigInt(e)))}function Et(e){const t=cr(e).data,n={creator:"",description:"",image_url:"",link:"",name:"",project_url:""};return t&&(n.creator=t.creator,n.description=t.description,n.image_url=t.image_url,n.link=t.link,n.name=t.name,n.project_url=t.project_url),n}function pn(e){let t={creator:"",description:"",image_url:"",link:"",name:"",project_url:""},n={...t,pos_object_id:"",owner:"",type:"",coin_type_a:"",coin_type_b:"",liquidity:"",tick_lower_index:0,tick_upper_index:0,index:0,pool:"",reward_amount_owed_0:"0",reward_amount_owed_1:"0",reward_amount_owed_2:"0",reward_growth_inside_0:"0",reward_growth_inside_1:"0",reward_growth_inside_2:"0",fee_growth_inside_a:"0",fee_owed_a:"0",fee_growth_inside_b:"0",fee_owed_b:"0",position_status:"Exists"},i=$(e);if(i){const r=we(e),a=jt(e);"nft"in i?(i=i.nft.fields,t.description=i.description,t.name=i.name,t.link=i.url):t=Et(e),n={...t,pos_object_id:i.id.id,owner:a.AddressOwner,type:r,coin_type_a:i.coin_type_a.fields.name,coin_type_b:i.coin_type_b.fields.name,liquidity:i.liquidity,tick_lower_index:ke(BigInt(i.tick_lower_index.fields.bits)),tick_upper_index:ke(BigInt(i.tick_upper_index.fields.bits)),index:i.index,pool:i.pool,reward_amount_owed_0:"0",reward_amount_owed_1:"0",reward_amount_owed_2:"0",reward_growth_inside_0:"0",reward_growth_inside_1:"0",reward_growth_inside_2:"0",fee_growth_inside_a:"0",fee_owed_a:"0",fee_growth_inside_b:"0",fee_owed_b:"0",position_status:"Exists"}}const o=hi(e);o&&(n.pos_object_id=o.objectId,n.position_status="Deleted");const s=gi(e);return s&&(n.pos_object_id=s,n.position_status="NotExists"),n}function dr(e){const t=G.isSuiCoin(e.coinTypeA),n=G.isSuiCoin(e.coinTypeB);return{isAdjustCoinA:t,isAdjustCoinB:n}}function lr(e,t){return W.ceil(l(e).div(1+t)).toString()}var B=class{static createCollectRewarderAndFeeParams(e,t,n,i,o,s){o===void 0&&(o=[...i]),s===void 0&&(s=[...i]);const r=Ke(n.coinTypeA),a=Ke(n.coinTypeB);if(n.collect_fee){const u=B.buildCoinForAmount(t,o,BigInt(0),r,!1);o=u.remainCoins;const _=B.buildCoinForAmount(t,s,BigInt(0),a,!1);s=_.remainCoins,t=e.Position.createCollectFeePaylod({pool_id:n.pool_id,pos_id:n.pos_id,coinTypeA:n.coinTypeA,coinTypeB:n.coinTypeB},t,u.targetCoin,_.targetCoin)}const d=[];return n.rewarder_coin_types.forEach(u=>{switch(Ke(u)){case n.coinTypeA:d.push(B.buildCoinForAmount(t,o,BigInt(0),u,!1).targetCoin);break;case n.coinTypeB:d.push(B.buildCoinForAmount(t,s,BigInt(0),u,!1).targetCoin);break;default:d.push(B.buildCoinForAmount(t,i,BigInt(0),u,!1).targetCoin);break}}),t=e.Rewarder.createCollectRewarderPaylod(n,t,d),t}static async adjustTransactionForGas(e,t,n,i){i.setSender(e.senderAddress);const o=G.selectCoinAssetGreaterThanOrEqual(t,n).selectedCoins;if(o.length===0)throw new Error("Insufficient balance");const s=G.calculateTotalBalance(t);if(s-n>1e9)return{fixAmount:n};const r=await e.fullClient.calculationTxGas(i);if(G.selectCoinAssetGreaterThanOrEqual(t,BigInt(r),o.map(d=>d.coinObjectId)).selectedCoins.length===0){const d=BigInt(r)+BigInt(500);if(s-n<d){if(n-=d,n<0)throw new Error("gas Insufficient balance");const u=new T;return{fixAmount:n,newTx:u}}}return{fixAmount:n}}static async buildAddLiquidityFixTokenForGas(e,t,n,i){let o=await B.buildAddLiquidityFixToken(e,t,n);const{isAdjustCoinA:s}=dr(n),r=s?n.amount_a:n.amount_b,a=await B.adjustTransactionForGas(e,G.getCoinAssets(s?n.coinTypeA:n.coinTypeB,t),BigInt(r),o),{fixAmount:d}=a,{newTx:u}=a;if(u!==void 0){let _,p;if(s)n.amount_a=Number(d),_=B.buildAddLiquidityFixTokenCoinInput(u,!n.fix_amount_a,d.toString(),n.slippage,n.coinTypeA,t,!1),p=B.buildAddLiquidityFixTokenCoinInput(u,n.fix_amount_a,n.amount_b,n.slippage,n.coinTypeB,t,!1);else return n.amount_b=Number(d),_=B.buildAddLiquidityFixTokenCoinInput(u,!n.fix_amount_a,n.amount_a,n.slippage,n.coinTypeA,t,!1),p=B.buildAddLiquidityFixTokenCoinInput(u,n.fix_amount_a,d.toString(),n.slippage,n.coinTypeB,t,!1),n=B.fixAddLiquidityFixTokenParams(n,i.slippage,i.curSqrtPrice),o=await B.buildAddLiquidityFixTokenArgs(u,e,t,n,_,p),o}return o}static async buildAddLiquidityFixToken(e,t,n){if(e.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");let i=new T;const o=B.buildAddLiquidityFixTokenCoinInput(i,!n.fix_amount_a,n.amount_a,n.slippage,n.coinTypeA,t,!1),s=B.buildAddLiquidityFixTokenCoinInput(i,n.fix_amount_a,n.amount_b,n.slippage,n.coinTypeB,t,!1);return i=B.buildAddLiquidityFixTokenArgs(i,e,t,n,o,s),i}static buildAddLiquidityFixTokenCoinInput(e,t,n,i,o,s,r=!0){return t?B.buildCoinForAmountInterval(e,s,{amountSecond:BigInt(lr(n,i)),amountFirst:BigInt(n)},o,r):B.buildCoinForAmount(e,s,BigInt(n),o,r)}static fixAddLiquidityFixTokenParams(e,t,n){const i=e.fix_amount_a?e.amount_a:e.amount_b,o=ae.estLiquidityAndcoinAmountFromOneAmounts(Number(e.tick_lower),Number(e.tick_upper),new g(i),e.fix_amount_a,!0,t,n);return e.amount_a=e.fix_amount_a?e.amount_a:o.tokenMaxA.toNumber(),e.amount_b=e.fix_amount_a?o.tokenMaxB.toNumber():e.amount_b,e}static buildAddLiquidityFixTokenArgs(e,t,n,i,o,s){const r=[i.coinTypeA,i.coinTypeB],a=i.is_open?"open_position_with_liquidity_by_fix_coin":"add_liquidity_by_fix_coin",{clmm_pool:d,integrate:u}=t.sdkOptions;i.is_open||(e=B.createCollectRewarderAndFeeParams(t,e,i,n,o.remainCoins,s.remainCoins));const _=f(d),p=i.is_open?[e.object(_.global_config_id),e.object(i.pool_id),e.pure(He(BigInt(i.tick_lower)).toString()),e.pure(He(BigInt(i.tick_upper)).toString()),o.targetCoin,s.targetCoin,e.pure(i.amount_a),e.pure(i.amount_b),e.pure(i.fix_amount_a),e.object(C)]:[e.object(_.global_config_id),e.object(i.pool_id),e.object(i.pos_id),o.targetCoin,s.targetCoin,e.pure(i.amount_a),e.pure(i.amount_b),e.pure(i.fix_amount_a),e.object(C)];return e.moveCall({target:`${u.published_at}::${Sn}::${a}`,typeArguments:r,arguments:p}),e}static async buildSwapTransactionForGas(e,t,n,i){let o=B.buildSwapTransaction(e,t,n);o.setSender(e.senderAddress);const s=await B.adjustTransactionForGas(e,G.getCoinAssets(t.a2b?t.coinTypeA:t.coinTypeB,n),BigInt(t.by_amount_in?t.amount:t.amount_limit),o),{fixAmount:r,newTx:a}=s;if(a!==void 0){a.setSender(e.senderAddress),t.by_amount_in?t.amount=r.toString():t.amount_limit=r.toString(),t=B.fixSwapParams(e,t,i);const d=B.buildCoinForAmount(o,n,t.a2b?BigInt(t.by_amount_in?t.amount:t.amount_limit):BigInt(0),t.coinTypeA),u=B.buildCoinForAmount(o,n,t.a2b?BigInt(0):BigInt(t.by_amount_in?t.amount:t.amount_limit),t.coinTypeB);o=B.buildSwapTransactionArgs(a,t,e.sdkOptions,d,u)}return o}static buildSwapTransaction(e,t,n){let i=new T;i.setSender(e.senderAddress);const o=B.buildCoinForAmount(i,n,t.a2b?BigInt(t.by_amount_in?t.amount:t.amount_limit):BigInt(0),t.coinTypeA,!1),s=B.buildCoinForAmount(i,n,t.a2b?BigInt(0):BigInt(t.by_amount_in?t.amount:t.amount_limit),t.coinTypeB,!1);return i=B.buildSwapTransactionArgs(i,t,e.sdkOptions,o,s),i}static buildSwapTransactionArgs(e,t,n,i,o){const{clmm_pool:s,integrate:r}=n,a=$e.getDefaultSqrtPriceLimit(t.a2b),d=[t.coinTypeA,t.coinTypeB],{global_config_id:u}=f(s);if(u===void 0)throw Error("clmm.config.global_config_id is undefined");const _=t.swap_partner!==void 0,p=_?t.a2b?"swap_a2b_with_partner":"swap_b2a_with_partner":t.a2b?"swap_a2b":"swap_b2a",m=_?[e.pure(u),e.pure(t.pool_id),e.pure(t.swap_partner),i.targetCoin,o.targetCoin,e.pure(t.by_amount_in),e.pure(t.amount),e.pure(t.amount_limit),e.pure(a.toString()),e.pure(C)]:[e.pure(u),e.pure(t.pool_id),i.targetCoin,o.targetCoin,e.pure(t.by_amount_in),e.pure(t.amount),e.pure(t.amount_limit),e.pure(a.toString()),e.pure(C)];return e.moveCall({target:`${r.published_at}::${Sn}::${p}`,typeArguments:d,arguments:m}),e}static fixSwapParams(e,t,n){const i=e.Swap.calculateRates({decimalsA:n.decimalsA,decimalsB:n.decimalsB,a2b:t.a2b,byAmountIn:t.by_amount_in,amount:new g(t.amount),swapTicks:n.swapTicks,currentPool:n.currentPool}),o=n.byAmountIn?i.estimatedAmountOut:i.estimatedAmountIn,s=Yt(o,n.slippage,!n.byAmountIn);return t.amount_limit=s.toString(),t}static async syncBuildCoinInputForAmount(e,t,n,i,o=!0){if(e.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const s=await e.getOwnerCoinAssets(e.senderAddress,i);return B.buildCoinForAmount(t,s,n,i,o).targetCoin}static buildCoinForAmount(e,t,n,i,o=!0,s=!1){const r=G.getCoinAssets(i,t);if(n===BigInt(0)&&r.length===0)return B.buildZeroValueCoin(t,e,i,o);const a=G.calculateTotalBalance(r);if(a<n)throw new Error(`The amount(${a}) is Insufficient balance for ${i} , expect ${n} `);return B.buildCoin(e,t,r,n,i,o,s)}static buildCoin(e,t,n,i,o,s=!0,r=!1){if(G.isSuiCoin(o)){if(s){const O=e.splitCoins(e.gas,[e.pure(i.toString())]);return{targetCoin:e.makeMoveVec({objects:[O]}),remainCoins:t,tragetCoinAmount:i.toString(),isMintZeroCoin:!1,originalSplitedCoin:e.gas}}if(i===0n&&n.length>1){const O=G.selectCoinObjectIdGreaterThanOrEqual(n,i);return{targetCoin:e.object(O.objectArray[0]),remainCoins:O.remainCoins,tragetCoinAmount:O.amountArray[0],isMintZeroCoin:!1}}const v=G.selectCoinObjectIdGreaterThanOrEqual(n,i);return{targetCoin:e.splitCoins(e.gas,[e.pure(i.toString())]),remainCoins:v.remainCoins,tragetCoinAmount:i.toString(),isMintZeroCoin:!1,originalSplitedCoin:e.gas}}const a=G.selectCoinObjectIdGreaterThanOrEqual(n,i),d=a.amountArray.reduce((v,P)=>Number(v)+Number(P),0).toString(),u=a.objectArray;if(s)return{targetCoin:e.makeMoveVec({objects:u.map(v=>e.object(v))}),remainCoins:a.remainCoins,tragetCoinAmount:a.amountArray.reduce((v,P)=>Number(v)+Number(P),0).toString(),isMintZeroCoin:!1};const[_,...p]=u,m=e.object(_);let b=m,S=a.amountArray.reduce((v,P)=>Number(v)+Number(P),0).toString(),w;return p.length>0&&e.mergeCoins(m,p.map(v=>e.object(v))),r&&Number(d)>Number(i)&&(b=e.splitCoins(m,[e.pure(i.toString())]),S=i.toString(),w=m),{targetCoin:b,remainCoins:a.remainCoins,originalSplitedCoin:w,tragetCoinAmount:S,isMintZeroCoin:!1}}static buildZeroValueCoin(e,t,n,i=!0){const o=B.callMintZeroValueCoin(t,n);let s;return i?s=t.makeMoveVec({objects:[o]}):s=o,{targetCoin:s,remainCoins:e,isMintZeroCoin:!0,tragetCoinAmount:"0"}}static buildCoinForAmountInterval(e,t,n,i,o=!0){const s=G.getCoinAssets(i,t);if(n.amountFirst===BigInt(0))return s.length>0?B.buildCoin(e,[...t],[...s],n.amountFirst,i,o):B.buildZeroValueCoin(t,e,i,o);const r=G.calculateTotalBalance(s);if(r>=n.amountFirst)return B.buildCoin(e,[...t],[...s],n.amountFirst,i,o);if(r<n.amountSecond)throw new Error(`The amount(${r}) is Insufficient balance for ${i} , expect ${n.amountSecond} `);return B.buildCoin(e,[...t],[...s],n.amountSecond,i,o)}static async buildRouterSwapTransaction(e,t,n,i){let o=new T;return t.paths.length>1&&(t.partner=""),o=await this.buildRouterBasePathTx(e,t,n,i,o),o}static async buildRouterBasePathTx(e,t,n,i,o){const{clmm_pool:s,integrate:r}=e.sdkOptions,a=f(s).global_config_id,d=t.paths.filter(E=>E&&E.poolAddress),u=Number(d.reduce((E,J)=>E.add(J.amountIn),Z).toString()),_=Number(d.reduce((E,J)=>E.add(J.amountOut),Z).toString()),p=Math.round(n?Number(_.toString())*(1-t.priceSlippagePoint):Number(u.toString())*(1+t.priceSlippagePoint)),m=t.paths[0].coinType[0],b=t.paths[0].coinType[t.paths[0].coinType.length-1];let S=B.buildCoinForAmount(o,i,BigInt(n?u:p),m,!1,!0),w=S.targetCoin;const v=S.originalSplitedCoin!==void 0,P=B.buildCoinForAmount(o,i,0n,b,!1);let O;P.isMintZeroCoin||P.originalSplitedCoin!==void 0?O=P.targetCoin:O=B.callMintZeroValueCoin(o,b);const U=[],R=t.partner==="",F=R?it:Tn;for(const E of d)if(E.poolAddress.length===1){const J=E.a2b[0],ye={amount:Number(E.amountIn.toString()),amountLimit:p,poolCoinA:E.a2b[0]?m:b,poolCoinB:E.a2b[0]?b:m},ue=R?"swap":"swap_with_partner",ve=J?w:O,et=J?O:w,pt=n?E.amountIn.toString():E.amountOut.toString(),mt=$e.getDefaultSqrtPriceLimit(J).toString(),ht=R?[o.object(a),o.object(E.poolAddress[0]),ve,et,o.pure(J),o.pure(n),o.pure(pt),o.pure(mt),o.pure(!1),o.object(C)]:[o.object(a),o.object(E.poolAddress[0]),o.pure(t.partner),ve,et,o.pure(J),o.pure(n),o.pure(pt),o.pure(mt),o.pure(!1),o.object(C)],wi=[ye.poolCoinA,ye.poolCoinB],gt=o.moveCall({target:`${e.sdkOptions.integrate.published_at}::${F}::${ue}`,typeArguments:wi,arguments:ht});w=J?gt[0]:gt[1],O=J?gt[1]:gt[0]}else{const J=n?E.amountIn:E.rawAmountLimit[0],ye=n?0:E.amountOut;let ue="";R&&(E.a2b[0]?E.a2b[1]?ue="swap_ab_bc":ue="swap_ab_cb":E.a2b[1]?ue="swap_ba_bc":ue="swap_ba_cb"),R||(ue=`${ue}_with_partner`);const ve=$e.getDefaultSqrtPriceLimit(E.a2b[0]),et=$e.getDefaultSqrtPriceLimit(E.a2b[1]),pt=R?[o.object(a),o.object(E.poolAddress[0]),o.object(E.poolAddress[1]),w,O,o.pure(n),o.pure(J.toString()),o.pure(ye.toString()),o.pure(ve.toString()),o.pure(et.toString()),o.object(C)]:[o.object(a),o.object(E.poolAddress[0]),o.object(E.poolAddress[1]),o.pure(t.partner),w,O,o.pure(n),o.pure(J.toString()),o.pure(ye.toString()),o.pure(ve.toString()),o.pure(et.toString()),o.object(C)],mt=[E.coinType[0],E.coinType[1],E.coinType[2]],ht=o.moveCall({target:`${r.published_at}::${F}::${ue}`,typeArguments:mt,arguments:pt});w=ht[0],O=ht[1]}if(this.checkCoinThreshold(e,n,o,O,p,b),P.isMintZeroCoin?U.push(O):P.originalSplitedCoin!==void 0?o.mergeCoins(P.originalSplitedCoin,[O]):o.mergeCoins(P.targetCoin,[O]),v){const E=S==null?void 0:S.originalSplitedCoin;o.mergeCoins(E,[w])}else U.push(w);return U.length>0&&o.transferObjects(U,o.pure(e.senderAddress)),o}static async buildAggregatorSwapTransaction(e,t,n,i,o){let s=new T;t.splitPaths.length>1&&(i="");const r=t.splitPaths.some(a=>a.basePaths.some(d=>d.label==="Deepbook"));if((!t.byAmountIn||t.splitPaths.length===1)&&!r){const a=[];for(const u of t.splitPaths){const _=[],p=[],m=[],b=[];for(let w=0;w<u.basePaths.length;w+=1){const v=u.basePaths[w];_.push(v.direction),p.push(v.poolAddress),m.push(new g(v.inputAmount)),w===0?b.push(v.fromCoin,v.toCoin):b.push(v.toCoin)}const S={amountIn:new g(u.inputAmount),amountOut:new g(u.outputAmount),poolAddress:p,a2b:_,rawAmountLimit:m,isExceed:!1,coinType:b};a.push(S)}const d={paths:a,partner:i,priceSlippagePoint:o};s=await this.buildRouterBasePathTx(e,d,t.byAmountIn,n,s)}else{const a=Math.round(t.outputAmount*(1-o)),d=B.buildCoinForAmount(s,n,t.byAmountIn?BigInt(t.inputAmount):BigInt(a),t.fromCoin,!1,!0);let u=d.targetCoin;const _=d.originalSplitedCoin!==void 0,p=B.buildCoinForAmount(s,n,0n,t.toCoin,!1);let m;p.isMintZeroCoin||p.originalSplitedCoin!==void 0?m=p.targetCoin:m=B.callMintZeroValueCoin(s,t.toCoin);const b=[];let S=!1,w;if(r){const[v,P]=Pn.createAccountCap(e.senderAddress,e.sdkOptions,s);s=P,w=v,S=!0}for(let v=0;v<t.splitPaths.length;v+=1){const P=t.splitPaths[v];let O;for(let U=0;U<P.basePaths.length;U+=1){const R=P.basePaths[U];if(R.label==="Deepbook")if(U===0)if(P.basePaths.length===1){const F=this.buildDeepbookBasePathTx(e,R,s,w,u,m,!1);u=F.from,m=F.to}else{O=B.callMintZeroValueCoin(s,R.toCoin);const F=this.buildDeepbookBasePathTx(e,R,s,w,u,O,!1);u=F.from,O=F.to}else{const F=this.buildDeepbookBasePathTx(e,R,s,w,O,m,!0);O=F.from,m=F.to}if(R.label==="Cetus")if(U===0)if(P.basePaths.length===1){const F=this.buildClmmBasePathTx(e,R,s,t.byAmountIn,u,m,!1,i);u=F.from,m=F.to}else{O=B.callMintZeroValueCoin(s,R.toCoin);const F=this.buildClmmBasePathTx(e,R,s,t.byAmountIn,u,O,!1,i);u=F.from,O=F.to}else{const F=this.buildClmmBasePathTx(e,R,s,t.byAmountIn,O,m,!0,i);O=F.from,m=F.to,s.moveCall({target:`${e.sdkOptions.integrate.published_at}::${Fs}::send_coin`,typeArguments:[R.fromCoin],arguments:[O,s.pure(e.senderAddress)]})}}}if(this.checkCoinThreshold(e,t.byAmountIn,s,m,a,t.toCoin),p.isMintZeroCoin?b.push(m):p.originalSplitedCoin!==void 0?s.mergeCoins(p.originalSplitedCoin,[m]):s.mergeCoins(p.targetCoin,[m]),_){const v=d.originalSplitedCoin;s.mergeCoins(v,[u])}else b.push(u);b.length>0&&s.transferObjects(b,s.pure(e.senderAddress)),S&&(s=Pn.deleteAccountCapByObject(w,e.sdkOptions,s))}return s}static checkCoinThreshold(e,t,n,i,o,s){t&&n.moveCall({target:`${e.sdkOptions.integrate.published_at}::${it}::check_coin_threshold`,typeArguments:[s],arguments:[i,n.pure(o)]})}static buildDeepbookBasePathTx(e,t,n,i,o,s,r){const a=t.direction?o:s,d=t.direction?s:o,u=[n.object(t.poolAddress),i,n.pure(t.inputAmount),n.pure(0),n.pure(t.direction),a,d,n.pure(r),n.object(C)],_=t.direction?[t.fromCoin,t.toCoin]:[t.toCoin,t.fromCoin],p=n.moveCall({target:`${e.sdkOptions.deepbook_endpoint_v2.published_at}::endpoints_v2::swap`,typeArguments:_,arguments:u});return o=t.direction?p[0]:p[1],s=t.direction?p[1]:p[0],{from:o,to:s,tx:n}}static buildClmmBasePathTx(e,t,n,i,o,s,r,a){const{clmm_pool:d,integrate:u}=e.sdkOptions,_=f(d).global_config_id;let p=t.direction?o:s,m=t.direction?s:o;const b=a==="",S=b?it:Tn,w=b?"swap":"swap_with_partner",v=i?t.inputAmount.toString():t.outputAmount.toString(),P=$e.getDefaultSqrtPriceLimit(t.direction),O=b?[n.object(_),n.object(t.poolAddress),p,m,n.pure(t.direction),n.pure(i),n.pure(v),n.pure(P.toString()),n.pure(r),n.object(C)]:[n.object(_),n.object(t.poolAddress),n.pure(a),p,m,n.pure(t.direction),n.pure(i),n.pure(v),n.pure(P.toString()),n.pure(r),n.object(C)],U=t.direction?[t.fromCoin,t.toCoin]:[t.toCoin,t.fromCoin],R=n.moveCall({target:`${u.published_at}::${S}::${w}`,typeArguments:U,arguments:O});return p=R[0],m=R[1],o=t.direction?p:m,s=t.direction?m:p,{from:o,to:s,tx:n}}static buildCoinTypePair(e,t){const n=[];if(e.length===2){const i=[];i.push(e[0],e[1]),n.push(i)}else{const i=[];i.push(e[0],e[e.length-1]),n.push(i);for(let o=1;o<e.length-1;o+=1){if(t[o-1]===0)continue;const s=[];s.push(e[0],e[o],e[e.length-1]),n.push(s)}}return n}},oe=B;Ms(oe,"callMintZeroValueCoin",(e,t)=>e.moveCall({target:"0x2::coin::zero",typeArguments:[t]}));var ze=new g(1e9),Pn=class{static createAccountCap(e,t,n,i=!1){const{deepbook:o}=t,[s]=n.moveCall({target:`${o.published_at}::${Ls}::create_account`,typeArguments:[],arguments:[]});return i&&n.transferObjects([s],n.pure(e)),[s,n]}static deleteAccountCap(e,t,n){const{deepbook:i}=t,o=[n.pure(e)];return n.moveCall({target:`${i.published_at}::${Rt}::delete_account_cap`,typeArguments:[],arguments:o}),n}static deleteAccountCapByObject(e,t,n){const{deepbook:i}=t,o=[e];return n.moveCall({target:`${i.published_at}::${Rt}::delete_account_cap`,typeArguments:[],arguments:o}),n}static async getAccountCap(e){const t=await e.fullClient.getOwnedObjectsByPage(e.senderAddress,{options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0},filter:{MoveModule:{package:e.sdkOptions.deepbook.package_id,module:Rt}}});return t.data.length===0?"":t.data[0].data.objectId}static async getPools(e){const t=e.sdkOptions.deepbook.package_id,n=[];try{(await e.fullClient.queryEventsByPage({MoveEventType:`${t}::clob_v2::PoolCreated`})).data.forEach(o=>{const s=o.parsedJson;s&&n.push({poolID:s.pool_id,tickSize:Number(s.tick_size),lotSize:Number(s.lot_size),takerFeeRate:Number(s.taker_fee_rate),makerRebateRate:Number(s.maker_rebate_rate),baseAsset:s.base_asset.name,quoteAsset:s.quote_asset.name})})}catch(i){console.log("getPoolImmutables",i)}return n}static async getPoolAsks(e,t,n,i){var m;const{simulationAccount:o}=e.sdkOptions,{deepbook_endpoint_v2:s}=e.sdkOptions,r=new T,a=[],d=[n,i],u=[r.pure(t),r.pure("0"),r.pure("999999999999"),r.pure(C)];r.moveCall({target:`${s.published_at}::endpoints_v2::get_level2_book_status_ask_side`,arguments:u,typeArguments:d});const p=(m=(await e.fullClient.devInspectTransactionBlock({transactionBlock:r,sender:o.address})).events)==null?void 0:m.filter(b=>A(b.type).name==="BookStatus");if(p.length===0)return a;for(let b=0;b<p[0].parsedJson.depths.length;b++){const S=p[0].parsedJson.price[b],w=p[0].parsedJson.depths[b],v={price:parseInt(S,10),quantity:parseInt(w,10)};a.push(v)}return a}static async getPoolBids(e,t,n,i){var m;const{simulationAccount:o}=e.sdkOptions,{deepbook_endpoint_v2:s}=e.sdkOptions,r=new T,a=[],d=[n,i],u=[r.pure(t),r.pure("0"),r.pure("999999999999"),r.pure(C)];r.moveCall({target:`${s.published_at}::endpoints_v2::get_level2_book_status_bid_side`,arguments:u,typeArguments:d});const p=(m=(await e.fullClient.devInspectTransactionBlock({transactionBlock:r,sender:o.address})).events)==null?void 0:m.filter(b=>A(b.type).name==="BookStatus");if(p.length===0)return a;for(let b=0;b<p[0].parsedJson.depths.length;b++){const S=p[0].parsedJson.price[b],w=p[0].parsedJson.depths[b],v={price:parseInt(S,10),quantity:parseInt(w,10)};a.push(v)}return a}static async preSwap(e,t,n,i){let o=!1,s=Z,r=new g(i),a=Z;const d=new g(i);if(n){let u=await this.getPoolBids(e,t.poolID,t.baseAsset,t.quoteAsset);u===null&&(o=!0),u=u.sort((_,p)=>p.price-_.price);for(let _=0;_<u.length;_+=1){const p=new g(u[_].quantity),m=new g(u[_].price),b=p.mul(new g(m)).mul(new g(t.takerFeeRate)).div(ze).div(ze);if(r.gt(p))r=r.sub(p),s=s.add(p.mul(m).div(ze).sub(b)),a=a.add(b);else{const S=r.mul(new g(u[_].price)).div(ze),w=S.mul(new g(t.takerFeeRate)).div(ze);s=s.add(S.sub(w)),r=r.sub(r),a=a.add(w)}if(r.eq(Z))break}}else{const u=await this.getPoolAsks(e,t.poolID,t.baseAsset,t.quoteAsset);u===null&&(o=!0);for(let _=0;_<u.length;_+=1){const p=new g(u[_].price).mul(new g(u[_].quantity)).div(new g(1e9)),m=p.mul(new g(t.takerFeeRate)).div(ze),b=p.add(m);if(r.gt(p))s=s.add(new g(u[_].quantity)),r=r.sub(b),a=a.add(m);else{const S=new g(u[_].quantity).div(new g(t.lotSize)),w=b.div(S),v=r.div(w);s=s.add(v.muln(t.lotSize)),r=r.sub(v.mul(w)),a=a.add(v.div(S).mul(m))}if(r.eq(Z))break}}return{poolAddress:t.poolID,estimatedAmountIn:d.sub(r).toNumber(),estimatedAmountOut:s.toNumber(),estimatedFeeAmount:a,isExceed:o,amount:Number(i),aToB:n,byAmountIn:!0}}static async simulateSwap(e,t,n,i,o,s){var F;const{deepbook_endpoint_v2:r}=e.sdkOptions;let a=new T;const d=await this.getAccountCap(e);let u;if(d===""){const E=this.createAccountCap(e.senderAddress,e.sdkOptions,a),J=E[0];a=E[1],u=J}else u=a.pure(d);const _=await e.getOwnerCoinAssets(e.senderAddress),p=oe.buildCoinForAmount(a,_,BigInt(s),n,!1),m=p==null?void 0:p.targetCoin,b=oe.buildCoinForAmount(a,_,BigInt(s),i,!1),S=b==null?void 0:b.targetCoin,w=[n,i],v=[a.pure(t),u,a.pure(s),a.pure(0),a.pure(o),m,S,a.pure(C)];a.moveCall({target:`${r.published_at}::${Ks}::swap`,arguments:v,typeArguments:w});const{simulationAccount:P}=e.sdkOptions,U=(F=(await e.fullClient.devInspectTransactionBlock({transactionBlock:a,sender:P.address})).events)==null?void 0:F.filter(E=>A(E.type).name==="DeepbookSwapEvent");if(U.length===0)return null;const R=U[0].parsedJson;return{poolAddress:R.pool,estimatedAmountIn:R.amount_in,estimatedAmountOut:R.amount_out,aToB:R.atob}}},qt="router",Ye=1e4,Me=class{static buildPoolImmutables(e){const{fields:t}=e.value.fields.value;return{clmm_pool_id:A(t.clmm_pool_id).address,booster_type:A(t.booster_type.fields.name).source_address,pool_id:A(t.pool_id).address,coinTypeA:A(t.coin_type_a.fields.name).source_address,coinTypeB:A(t.coin_type_b.fields.name).source_address}}static buildPoolState(e){const t=$(e),n=[];return t.config.fields.contents.forEach(o=>{n.push({lock_day:Number(o.fields.key),multiplier:Number(l(o.fields.value).div(Ye))})}),{basic_percent:Number(l(t.basic_percent).div(Ye)),balances:{balances_handle:t.balances.fields.id.id,size:t.balances.fields.size},config:n,lock_positions:{lock_positions_handle:t.lock_positions.fields.id.id,size:t.lock_positions.fields.size},is_open:t.is_open,index:Number(t.index),pool_id:ct(e)}}static buildLockNFT(e){const t=A(ct(e)).address;return{lock_clmm_position:pn(e),locked_nft_id:t}}static buildLockPositionInfo(e){const t=$(e),{value:n}=t.value.fields;return{type:n.type,position_id:n.fields.position_id,start_time:Number(n.fields.start_time),lock_period:Number(n.fields.lock_period),end_time:Number(n.fields.end_time),growth_rewarder:n.fields.growth_rewarder,rewarder_owned:n.fields.rewarder_owned,is_settled:n.fields.is_settled}}static isLocked(e){return e.end_time>Date.parse(new Date().toString())/1e3}},_r=class{constructor(e){q(this,"_sdk");q(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e=!1){var s;const{booster:t}=this._sdk.sdkOptions,n=`${t.package_id}_getPoolImmutables`,i=this.getCache(n,e),o=[];if(i!==void 0)o.push(...i);else{const r=[];(s=(await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(f(t).booster_pool_handle)).data)==null||s.forEach(u=>{r.push(u.objectId)});const d=await this._sdk.ClmmSDK.fullClient.batchGetObjects(r,{showContent:!0});for(const u of d){const _=$(u);if(_){const p=Me.buildPoolImmutables(_);this.updateCache(`${p.pool_id}_getPoolImmutable`,p,M),o.push(p)}}}return this.updateCache(n,o,M),o}async getPoolImmutable(e){const{booster:t}=this._sdk.sdkOptions,n=`${e}_getPoolImmutable`,i=this.getCache(n);if(i!==void 0)return i;const o=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:f(t).booster_pool_handle,name:{type:"0x2::object::ID",value:e}}),s=$(o),r=Me.buildPoolImmutables(s);return this.updateCache(n,r,M),r}async getPools(){const e=[],n=(await this.getPoolImmutables()).map(o=>o.pool_id),i=await this._sdk.ClmmSDK.fullClient.batchGetObjects(n,{showType:!0,showContent:!0});for(const o of i){const s=Me.buildPoolState(o);if(s){const r={...await this.getPoolImmutable(s.pool_id),...s};e.push(r);const a=`${r.pool_id}_getPoolObject`;this.updateCache(a,r,M)}}return e}async getPool(e,t=!0){const n=`${e}_getPoolObject`,i=this.getCache(n,t),o=await this.getPoolImmutable(e);if(i!==void 0)return{...o,...i};const s=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),r=Me.buildPoolState(s),a={...o,...r};return this.updateCache(n,a,M),a}async getPoolHandleId(e){const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),n=$(t);return n?n.list.fields.id.id:""}async getBoosterInitConfigs(){var i;const{package_id:e}=this.sdk.sdkOptions.booster,t=(i=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::config::InitEvent`}))==null?void 0:i.data,n={booster_config_id:"",booster_pool_handle:""};return t.length>0&&t.forEach(o=>{const s=o.parsedJson;s&&(n.booster_config_id=s.config_id)}),n.booster_pool_handle=await this.getPoolHandleId(n.booster_config_id),n}async getOwnerBoosterPositions(e,t,n){const{booster:i}=this.sdk.sdkOptions,o=[],s=[],r=`${i.package_id}::lock_nft::LockNFT<${this._sdk.ClmmSDK.Position.buildPositionType()}>`,a=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{StructType:r}});for(const u of a.data)if(A(we(u)).source_address===r&&u.data){const p=Me.buildLockNFT(u);this.updateCache(`${p.locked_nft_id}_getBoosterPositionById`,p,M),p&&(t===void 0||t===p.lock_clmm_position.pool)&&o.push(p)}const d=await this.getLockPositionInfos(n,o.map(u=>u.locked_nft_id));for(const u of o)for(const _ of d)if(u.lock_clmm_position.pos_object_id===_.position_id){s.push({...u,..._});break}return s}async getBoosterPosition(e,t){const n=`${t}_getBoosterPositionById`,i=this.getCache(n);let o;if(i!==void 0)o=i;else{const r=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0,showOwner:!0}});o=Me.buildLockNFT(r),this.updateCache(n,o,M)}const s=await this.getLockPositionInfo(e,t);return{...o,...s}}async getLockPositionInfos(e,t=[]){var s;const n=await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(e),i=[],o=[];return(s=n.data)==null||s.forEach(r=>{t.length>0?t.includes(r.name.value)&&i.push(r.objectId):i.push(r.objectId)}),i.length>0&&(await this._sdk.ClmmSDK.fullClient.batchGetObjects(i,{showContent:!0})).forEach(a=>{const d=Me.buildLockPositionInfo(a);d&&o.push(d)}),o}async getLockPositionInfo(e,t){const n=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}});return Me.buildLockPositionInfo(n)}calculateXCetusRewarder(e,t,n){let i=t.basic_percent,o="0";e.forEach(a=>{a.coin_address===t.booster_type&&(console.log("find ",t.booster_type),o=a.amount_owed.toString())}),n.is_settled||t.config.forEach(a=>{a.lock_day===n.lock_period&&(i=a.multiplier)});const s=l(o).sub(n.growth_rewarder).mul(i);return l(n.rewarder_owned).add(s).toString()}lockPositionPayload(e){const{booster:t}=this.sdk.sdkOptions,{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions,i=new T;return i.moveCall({target:`${t.published_at}::${qt}::lock_position`,typeArguments:[e.booster_type,e.coinTypeA,e.coinTypeB],arguments:[i.pure(f(t).booster_config_id),i.pure(f(n).global_config_id),i.pure(e.booster_pool_id),i.pure(e.clmm_pool_id),i.pure(e.clmm_position_id),i.pure(e.lock_day),i.pure(C)]}),i}canceLockPositionPayload(e){const{booster:t}=this.sdk.sdkOptions,n=new T;return n.moveCall({target:`${t.published_at}::${qt}::cancel_lock`,typeArguments:[e.booster_type],arguments:[n.pure(f(t).booster_config_id),n.pure(e.booster_pool_id),n.pure(e.lock_nft_id),n.pure(C)]}),n}redeemPayload(e){const{booster:t,xcetus:n}=this.sdk.sdkOptions,{clmm_pool:i}=this.sdk.ClmmSDK.sdkOptions,o=new T,s=f(n);return o.moveCall({target:`${t.published_at}::${qt}::redeem`,typeArguments:[e.booster_type,e.coinTypeA,e.coinTypeB],arguments:[o.pure(f(t).booster_config_id),o.pure(f(i).global_config_id),o.pure(e.booster_pool_id),o.pure(e.lock_nft_id),o.pure(e.clmm_pool_id),o.pure(s.lock_manager_id),o.pure(s.xcetus_manager_id),o.pure(e.ve_nft_id),o.pure(C)]}),o}updateCache(e,t,n=De){let i=this._cache[e];i?(i.overdueTime=Q(n),i.value=t):i=new xe(t,Q(n)),this._cache[e]=i}getCache(e,t=!1){const n=this._cache[e];if(!t&&(n!=null&&n.isValid()))return n.value;delete this._cache[e]}},se="router",yi=1e9,ie=class{static priceRealToFix(e,t,n){const i=l(t-n).toNumber();return Number(l(e).div(l(10).pow(l(i))).toString())}static priceFixToReal(e,t,n){const i=l(t-n).toNumber();return Number(l(e).mul(l(10).pow(l(i))).toString())}static raiseTotalAmount(e,t,n){const i=l(t-n).abs().toNumber();return t>n?Number(l(e.total_supply).mul(e.current_price).div(l(10).pow(l(i))).toString()):Number(l(e.total_supply).mul(e.current_price).mul(l(10).pow(l(i))).toString())}static buildLaunchPadPool(e){const t=we(e),n=A(t),i=$(e),o={coin_type_sale:n.type_arguments[0],coin_type_raise:n.type_arguments[1],pool_address:ce(ct(e)),is_settle:i.is_settle,current_price:l(i.initialize_price).div(l(yi)).toString(),price:i.initialize_price,min_price:"0",max_price:"0",sale_coin_amount:i.sale_coin,raise_coin_amount:i.raise_coin,total_purchase_amount:i.reality_raise_total,total_supply:i.sale_total,min_purchase:i.min_purchase,max_purchase:i.max_purchase,complete_raise_limit:i.least_raise_amount,softcap:i.softcap,max_raise_amount:i.hardcap,sale_decimals:0,raise_decimals:0,liquidity_injection_ratio:Number(i.liquidity_rate)/1e4,is_cancel:i.is_cancel,duration_summary:{start_time:Number(i.duration_manager.fields.start_time),end_time:0,settle_end_time:0,purchase_duration:Number(i.duration_manager.fields.activity_duration),settle_duration:Number(i.duration_manager.fields.settle_duration),lock_up_duration:Number(i.duration_manager.fields.locked_duration)},white_summary:{white_handle:i.white_list.fields.users.fields.id.id,protection_hard_cap:i.white_list.fields.hard_cap_total,protection_limit_used:i.white_list.fields.purchase_total,size:Number(i.white_list.fields.users.fields.size)},unused_sale:i.unused_sale,harvest_raise:i.harvest_raise,tick_spacing:Number(i.tick_spacing),owner:i.recipient,purchase_summary:{purchase_handle:i.purchase_list.fields.id.id,size:Number(i.purchase_list.fields.size)},pool_status:"Failed"};return ie.updatePoolStatus(o),o}static updatePoolStatus(e){const t=Number(l(Date.now()/1e3).toFixed(0)),{duration_summary:n}=e,i=n.start_time+n.purchase_duration,o=i+n.settle_duration;if(n.end_time=i,n.settle_end_time=o,e.is_settle)e.pool_status="Ended";else if(e.is_cancel)e.pool_status="Canceled";else if(t<n.start_time)e.pool_status="Upcoming";else if(t>n.start_time&&t<i)e.pool_status="Live";else if(t>i&&t<o){const s=e.raise_coin_amount;Number(s)<Number(e.complete_raise_limit)?e.pool_status="Failed":e.pool_status="Settle"}return e}static async calculatePoolPrice(e,t){const n=await e.ClmmSDK.CetusConfig.getTokenListByCoinTypes([t.coin_type_sale,t.coin_type_raise]),i=n[t.coin_type_sale].decimals,o=n[t.coin_type_raise].decimals;t.min_price=this.priceFixToReal(Number(l(t.softcap).div(l(t.total_supply))),i,o).toString(),t.max_price=this.priceFixToReal(Number(l(t.max_raise_amount).div(l(t.total_supply))),i,o).toString(),t.current_price=this.priceFixToReal(Number(t.current_price),i,o).toString(),t.sale_decimals=i,t.raise_decimals=o}static async getWithdrawRaise(e){return e.pool_status==="Ended"?e.harvest_raise:"0"}static async getWithdrawSale(e){return e.pool_status==="Ended"?e.unused_sale:e.sale_coin_amount}static async getHistoryWithdrawRaise(e,t){if(t.pool_status==="Ended"){if(l(t.harvest_raise).equals(l(0))){const i=await e.Launchpad.getSettleEvent(t.pool_address);i&&(t.harvest_raise=i.unused_raise)}const n=g.min(new g(t.total_purchase_amount),new g(t.max_raise_amount));return l(n.toString()).mul(1-t.liquidity_injection_ratio).toString()}return"0"}static async getHistoryWithdrawSale(e,t){if(t.pool_status==="Ended"){const n=await e.Launchpad.getSettleEvent(t.pool_address);return n&&(t.unused_sale=n.unused_sale),t.unused_sale}return"0"}static async getOverrecruitReverseAmount(e,t){const n=await e.Launchpad.getPurchaseMarks(e.ClmmSDK.senderAddress,[t.pool_address],!1);if(n.length>0){const i=n[0].purchased_raise_amount,o=(await e.Launchpad.getPurchaseAmount(t.white_summary.white_handle,e.ClmmSDK.senderAddress)).safe_purchased_amount,{protection_limit_used:s}=t.white_summary;return l(i).sub(o).div(l(t.total_purchase_amount).sub(s)).mul(l(t.total_purchase_amount).sub(t.max_raise_amount)).toString()}return"0"}static async getCanPurchaseAmount(e,t){const n=await ie.getOverrecruitReverseAmount(e,t),i=await e.Launchpad.getPurchaseMarks(e.ClmmSDK.senderAddress,[t.pool_address],!1);if(i){const o=i[0].purchased_raise_amount;l(o).sub(n).div(t.current_price)}return"0"}},pr=class{constructor(e){q(this,"_sdk");q(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e=[],t=0,n=100,i=!1){var _;const{package_id:o}=this._sdk.sdkOptions.launchpad;if(o===void 0)throw Error("sdk.sdkOptions.launchpad is undefined");const s=`${o}_getPoolImmutables`,r=this.getCache(s,i),a=[],d=[];if(r!==void 0&&a.push(...r),a.length===0)try{((_=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${o}::factory::CreatePoolEvent`}))==null?void 0:_.data).forEach(m=>{const b=m.parsedJson;b&&a.push({pool_address:b.pool_id,coin_type_sale:A(b.sale_coin.name).full_address,coin_type_raise:A(b.raise_coin.name).full_address})}),this.updateCache(s,a,M)}catch(p){console.log("getPoolImmutables",p)}const u=e.length>0;for(let p=0;p<a.length;p+=1){const m=a[p];if(!(u&&!e.includes(m.pool_address))){if(!u){const b=p;if(b<t||b>=t+n)continue}d.push(m)}}return d}async getPoolImmutablesWithPage(e="all",t=!1){const{package_id:n}=this._sdk.sdkOptions.launchpad,i=`${n}_getPoolImmutables`,o=[],s={data:[],hasNextPage:!1},r=e==="all";if(r){const a=this.getCache(i,t);a&&o.push(...a)}if(o.length===0)try{const a=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${n}::factory::CreatePoolEvent`},e);s.hasNextPage=a.hasNextPage,s.nextCursor=a.nextCursor,a.data.forEach(d=>{const u=d.parsedJson;u&&o.push({pool_address:u.pool_id,coin_type_sale:A(u.sale_coin.name).full_address,coin_type_raise:A(u.raise_coin.name).full_address})})}catch(a){console.log("getPoolImmutables",a)}return s.data=o,r&&this.updateCache(i,o,M),s}async getPools(e=[],t=0,n=100){const i=[];let o=[];e.length>0?o=[...e]:(await this.getPoolImmutables([],t,n,!1)).forEach(a=>{o.push(a.pool_address)});const s=await this._sdk.ClmmSDK.fullClient.batchGetObjects(o,{showType:!0,showContent:!0});for(const r of s){const a=ie.buildLaunchPadPool(r);await ie.calculatePoolPrice(this._sdk,a),i.push(a);const d=`${a.pool_address}_getPoolObject`;this.updateCache(d,a,M)}return i}async getPool(e,t=!0){const n=`${e}_getPoolObject`,i=this.getCache(n,t);if(i!==void 0){const r=i;return ie.updatePoolStatus(r),r}const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),s=ie.buildLaunchPadPool(o);return await ie.calculatePoolPrice(this._sdk,s),this.updateCache(n,s),s}async getInitConfig(e=!1){var d;const t=this._sdk.sdkOptions.launchpad.package_id,n=`${t}_getInitEvent`,i=this.getCache(n,e);if(i!==void 0)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showPreviousTransaction:!0}}),s=bi(o),r=(d=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({Transaction:s}))==null?void 0:d.data,a={pools_id:"",admin_cap_id:"",config_cap_id:""};return r.length>0&&(r.forEach(u=>{const _=u.parsedJson;if(_)switch(A(u.type).full_address){case`${t}::config::InitConfigEvent`:a.admin_cap_id=_.admin_cap_id,a.config_cap_id=_.config_cap_id;break;case`${t}::factory::InitFactoryEvent`:a.pools_id=_.pools_id;break}}),this.updateCache(n,a,M)),a}async getLockNFT(e,t=!1){const n=`${e}_getLockNFT`,i=this.getCache(n,t);if(i!==void 0)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}});if(!o.error)return pn(o)}async getLockNFTList(e){var o;const{package_id:t}=this._sdk.ClmmSDK.sdkOptions.clmm_pool,{sdkOptions:n}=this._sdk,i=[];try{const s=(o=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${n.launchpad.package_id}::lock::LockNFTEvent`}))==null?void 0:o.data;for(const r of s){const a=r.parsedJson;if(a){const d={locked_time:Number(a.locked_time),end_lock_time:Number(a.end_lock_time),nft_type:a.nft_type_name.name,lock_nft_id:a.lock_nft_id,recipient:a.recipient};if(e===d.recipient&&`${t}`===A(d.nft_type).address){const u=await this.getLockNFT(d.lock_nft_id);if(u){const _=A(u.coin_type_a).full_address,p=A(u.coin_type_b).full_address;i.push({...u,coin_type_a:_,coin_type_b:p,...d})}}}}return i}catch(s){return console.log("getLockNFTList:",s),[]}}async creatPoolTransactionPayload(e){const{launchpad:t}=this.sdk.sdkOptions,n=f(t);if(this.assertLuanchpadConfig(),this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const i=ie.priceRealToFix(Number(e.initialize_price),e.sale_decimals,e.raise_decimals),o=new T,s=l(e.total_supply).add(l(e.total_supply).mul(l(e.liquidity_rate))).toNumber(),r=await oe.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,o,BigInt(s),e.coin_type_sale),a=[o.pure(n.admin_cap_id),o.pure(n.config_cap_id),o.pure(n.pools_id),o.pure(H(e.recipient)),o.pure((i*yi).toString()),r,o.pure(e.total_supply.toString()),o.pure(e.min_purchase.toString()),o.pure(e.max_purchase.toString()),o.pure(e.least_raise_amount.toString()),o.pure(e.hardcap.toString()),o.pure((e.liquidity_rate*1e3).toString()),o.pure(e.start_time.toString()),o.pure(e.activity_duration.toString()),o.pure(e.settle_duration.toString()),o.pure(e.locked_duration.toString()),o.pure(e.tick_spacing.toString()),o.pure(C)],d=[e.coin_type_sale,e.coin_type_raise];return o.moveCall({target:`${t.published_at}::${se}::create_launch_pool`,typeArguments:d,arguments:a}),o}async creatPurchasePayload(e){const{launchpad:t}=this.sdk.sdkOptions;if(this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const n=new T,i=await oe.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,n,BigInt(e.purchase_amount),e.coin_type_raise),o=(await this.getPurchaseMarks(this._sdk.ClmmSDK.senderAddress,[e.pool_address],!1))[0],s=[e.coin_type_sale,e.coin_type_raise];let r;return o?r=[n.pure(e.pool_address),n.pure(f(t).config_cap_id),n.pure(o.id),i,n.pure(e.purchase_amount.toString()),n.pure(C)]:r=[n.pure(e.pool_address),n.pure(f(t).config_cap_id),i,n.pure(e.purchase_amount.toString()),n.pure(C)],n.moveCall({target:`${t.published_at}::${se}::${o===void 0?"create_and_purchase":"purchase"}`,typeArguments:s,arguments:r}),n}async creatClaimPayload(e){const{launchpad:t}=this.sdk.sdkOptions;if(this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const n=(await this.getPurchaseMarks(this._sdk.ClmmSDK.senderAddress,[e.pool_address],!1))[0],i=new T,o=[e.coin_type_sale,e.coin_type_raise],s=[i.pure(e.pool_address),i.pure(f(t).config_cap_id),i.pure(n==null?void 0:n.id),i.pure(C)];return i.moveCall({target:`${t.published_at}::${se}::claim`,typeArguments:o,arguments:s}),i}async creatSettlePayload(e){const{launchpad:t}=this.sdk.sdkOptions,{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions;if(this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");this.assertLuanchpadConfig();const i=f(n),{clmm_args:o}=e,s=new T;s.setSender(this.sdk.ClmmSDK.senderAddress);const r=[e.coin_type_sale,e.coin_type_raise];if(o){const a=o.opposite?D.priceToSqrtPriceX64(l(1).div(o.current_price),o.raise_decimals,o.sale_decimals).toString():D.priceToSqrtPriceX64(l(o.current_price),o.sale_decimals,o.raise_decimals).toString(),d=BigInt(a)<BigInt(o.clmm_sqrt_price),u=o.opposite?d?e.coin_type_raise:e.coin_type_sale:d?e.coin_type_sale:e.coin_type_raise,_=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,u);let p=G.calculateTotalBalance(_);G.isSuiCoin(u)&&(p-=BigInt(2e8));const b=oe.buildCoinForAmount(s,_,p,u).targetCoin,S=o.opposite?d?"settle_with_reverse_clmm_only_with_a":"settle_with_reverse_clmm_only_with_b":d?"settle_only_with_a":"settle_only_with_b",w=[s.pure(e.pool_address),s.pure(f(t).config_cap_id),s.pure(o.clmm_pool_address),s.pure(i.global_config_id),s.pure(a),b,s.pure(C)];s.moveCall({target:`${t.published_at}::${se}::${S}`,typeArguments:r,arguments:w})}else s.moveCall({target:`${t.published_at}::${se}::settle`,typeArguments:r,arguments:[s.pure(e.pool_address),s.pure(f(t).config_cap_id),s.pure(C)]});return s}creatWithdrawPayload(e){const{launchpad:t}=this.sdk.sdkOptions,n=new T,i=[e.coin_type_sale,e.coin_type_raise],o=[n.object(e.pool_address),n.object(f(t).config_cap_id),n.object(C)];return e.sale_amount>BigInt(0)&&n.moveCall({target:`${t.published_at}::${se}::withdraw_sale`,typeArguments:i,arguments:o}),e.raise_amount>BigInt(0)&&n.moveCall({target:`${t.published_at}::${se}::withdraw_raise`,typeArguments:i,arguments:o}),n}addUserToWhitelisPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const n=new T,i=[e.coin_type_sale,e.coin_type_raise];return e.user_addrs.forEach(o=>{const s=[n.object(f(t).admin_cap_id),n.object(f(t).config_cap_id),n.object(e.pool_address),n.object(o),n.pure(e.safe_limit_amount),n.object(C)];n.moveCall({target:`${t.published_at}::${se}::add_user_to_whitelist`,typeArguments:i,arguments:s})}),n}updateWhitelistCapPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const n=new T,i=[e.coin_type_sale,e.coin_type_raise];return e.safe_limit_amount>0&&n.moveCall({target:`${t.published_at}::${se}::update_whitelist_member_safe_limit_amount`,typeArguments:i,arguments:[n.object(f(t).admin_cap_id),n.object(f(t).config_cap_id),n.object(e.pool_address),n.pure(e.white_list_member),n.pure(e.safe_limit_amount),n.object(C)]}),e.hard_cap_total>0&&n.moveCall({target:`${t.published_at}::${se}::update_whitelist_hard_cap_total`,typeArguments:i,arguments:[n.object(f(t).admin_cap_id),n.object(f(t).config_cap_id),n.object(e.pool_address),n.pure(e.hard_cap_total),n.object(C)]}),n}creatRemoveWhitelistPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const n=new T,i=[e.coin_type_sale,e.coin_type_raise];return e.user_addrs.forEach(o=>{const s=[n.object(f(t).admin_cap_id),n.object(f(t).config_cap_id),n.object(e.pool_address),n.object(o),n.object(C)];n.moveCall({target:`${t.published_at}::${se}::remove_user_from_whitelist`,typeArguments:i,arguments:s})}),n}creatCancelPoolPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const n=new T,i=[e.coin_type_sale,e.coin_type_raise],o=[n.pure(f(t).admin_cap_id),n.pure(f(t).config_cap_id),n.pure(e.pool_address),n.pure(C)];return n.moveCall({target:`${t.published_at}::${se}::cancel`,typeArguments:i,arguments:o}),n}updateRecipientPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const n=new T,i=[e.coin_type_sale,e.coin_type_raise],o=[n.pure(f(t).admin_cap_id),n.pure(f(t).config_cap_id),n.pure(e.pool_address),n.pure(e.new_recipient),n.pure(C)];return n.moveCall({target:`${t.published_at}::${se}::update_recipient_address`,typeArguments:i,arguments:o}),n}updatePoolDuractionPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const n=new T,i=[e.coin_type_sale,e.coin_type_raise],o=[n.pure(f(t).admin_cap_id),n.pure(f(t).config_cap_id),n.pure(e.pool_address),n.pure(e.activity_duration),n.pure(e.settle_duration),n.pure(e.lock_duration),n.pure(C)];return n.moveCall({target:`${t.published_at}::${se}::update_pool_duration`,typeArguments:i,arguments:o}),n}creatUnlockNftPayload(e){const{launchpad:t}=this.sdk.sdkOptions;if(f(t)===void 0)throw Error("getPackagerConfigs(launchpad)  is null");const n=new T,i=[e.nft_type],o=[n.pure(e.lock_nft),n.pure(C)];return n.moveCall({target:`${t.published_at}::lock::unlock_nft`,typeArguments:i,arguments:o}),n}async isAdminCap(e){const{launchpad:t}=this._sdk.sdkOptions;if(f(t)===void 0)throw Error("launchpad config is empty");const n=`${e}_isAdminCap`,i=this.getCache(n);if(i)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:f(t).admin_cap_id,options:{showType:!0,showOwner:!0}});console.log(o);const s=ut(o),r=jt(o);let a=!1;return r&&s&&A(s).source_address===`${t.package_id}::config::AdminCap`&&(a=H(r.AddressOwner)===H(e)),this.updateCache(n,a,M),a}async isWhiteListUser(e,t){const n={type:"address",value:t};try{const i=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:n});return!!(i&&i.data)}catch{return!1}}async getPurchaseAmount(e,t){var i;const n={type:"address",value:t};try{const o=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:n}),s=$(o);if(console.log(s),s)return(i=s==null?void 0:s.value)==null?void 0:i.fields}catch{}return{safe_limit_amount:"0",safe_purchased_amount:"0"}}async getPurchaseMarks(e,t=[],n=!0){const{launchpad:i}=this._sdk.sdkOptions,o=`${t}_getPurchaseMark`,s=this.getCache(o,n);if(!n&&s!==void 0)return s;let r=null;const a=[];for(;;){const d=await this._sdk.ClmmSDK.fullClient.getOwnedObjects({owner:e,options:{showType:!0,showContent:!0,showDisplay:!0},cursor:r});for(const u of d.data){const{fields:_}=u.data.content;if(A(we(u)).source_address===`${i.package_id}::pool::PurchaseMark`){console.log("fields: ",_);const m={id:_.id.id,pool_id:A(_.pool_id).address,purchased_raise_amount:_.purchase_total,obtain_sale_amount:_.obtain_sale_amount,used_raise_amount:_.used_raise_amount};t.length>0?t.includes(m.pool_id)&&a.push(m):a.push(m)}}if(d.hasNextPage)r=d.nextCursor;else break}return this.updateCache(o,a,M),a}async getSettleEvent(e){const{launchpad:t}=this._sdk.sdkOptions,n=`${e}_getPurchaseMark`,i=this.getCache(n);if(i!==void 0)return i;const o=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t.package_id}::pool::SettleEvent`});for(const s of o.data){const r=s.parsedJson;if(e===ce(r.pool_id)){const a={pool_id:r.pool_id,settle_price:r.settle_price,unused_sale:r.unused_sale,unused_raise:r.unused_raise,white_purchase_total:r.white_purchase_total};return this.updateCache(n,a,M),a}}}buildLaunchpadCoinType(e,t){return Ht(this._sdk.sdkOptions.launchpad.package_id,"pool","PoolLiquidityCoin",[e,t])}assertLuanchpadConfig(){const{launchpad:e}=this.sdk.sdkOptions;if(f(e)===void 0)throw Error("sdk getPackagerConfigs(launchpad) is null")}updateCache(e,t,n=De){let i=this._cache[e];i?(i.overdueTime=Q(n),i.value=t):i=new xe(t,Q(n)),this._cache[e]=i}getCache(e,t=!1){const n=this._cache[e];if(!t&&(n!=null&&n.isValid()))return n.value;delete this._cache[e]}},Ne=class{static buildPoolImmutables(e){const{fields:t}=e.value.fields.value;return{clmm_pool_id:A(t.clmm_pool_id).address,bonus_type:A(t.bonus_type.fields.name).source_address,pool_id:A(t.pool_id).address,coinTypeA:A(t.coin_type_a.fields.name).source_address,coinTypeB:A(t.coin_type_b.fields.name).source_address}}static buildPoolState(e){const t=$(e),n=[];return t.config.fields.contents.forEach(o=>{n.push({rate:Number(l(o.fields.key).div(Ye)),multiplier:Number(l(o.fields.value).div(Ye))})}),{balance:t.balance,config:n,is_open:t.is_open,index:Number(t.index),start_time:Number(t.start_time),interval_day:Number(t.interval_day),minimum_percent_to_reward:Number(l(t.minimum_percent_to_reward).div(Ye)),rewarders:{rewarder_handle:t.rewarders.fields.id.id,size:Number(t.rewarders.fields.size)},whale_nfts:{whale_nfts_handle:t.whale_nfts.fields.id.id,size:Number(t.whale_nfts.fields.size)},points:{point_handle:t.points.fields.id.id,size:Number(t.points.fields.size)}}}static buildMarkerPositions(e){const{contents:t}=e.value.fields.value.fields,n=[],i=e.id.id;return t.forEach(o=>{const{key:s,value:r}=o.fields,a={id:s,period_id:i,bonus_num:r.fields.bonus_num,point:r.fields.point,is_burn:r.fields.is_burn,point_after_multiplier:r.fields.point_after_multiplier,percent:Number(l(r.fields.percent).div(Ye)),fee_share_rate:0,is_redeemed:r.fields.is_redeemed};n.push(a)}),n}static buildPoolBonusInfo(e){const{fields:t,type:n}=e.value.fields.value;return{type:n,time:Number(t.time),settle_time:Number(t.settle_time),settled_num:t.settled_num,is_settled:t.is_settled,basis_bonus:t.basis_bonus,total_bonus:t.total_bonus,is_vacant:t.is_vacant,redeemed_num:t.redeemed_num}}static getBonusPercent(e,t){let n=0;for(const i of e)t>=i.rate&&i.rate>n&&(n=i.multiplier);return n}},In="router",mr=class{constructor(e){q(this,"_sdk");q(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e=!1){var s;const{maker_bonus:t}=this._sdk.sdkOptions,n=`${t.package_id}_getPoolImmutables`,i=this.getCache(n,e),o=[];if(i!==void 0)o.push(...i);else{const r=[];(s=(await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(f(t).maker_pool_handle)).data)==null||s.forEach(u=>{r.push(u.objectId)});const d=await this._sdk.ClmmSDK.fullClient.batchGetObjects(r,{showContent:!0});for(const u of d){const _=$(u);_&&o.push(Ne.buildPoolImmutables(_))}}return o}async getPoolImmutable(e){const{maker_bonus:t}=this._sdk.sdkOptions,n=`${t.package_id}_getPoolImmutables`,i=this.getCache(n);if(i!==void 0){const r=i.filter(a=>e===a.pool_id);if(r.length>0)return r[0]}const o=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:f(t).maker_pool_handle,name:{type:"0x2::object::ID",value:e}}),s=$(o);return Ne.buildPoolImmutables(s)}async getPools(){const e=[],t=await this.getPoolImmutables(),n=t.map(s=>s.pool_id),i=await this._sdk.ClmmSDK.fullClient.batchGetObjects(n,{showType:!0,showContent:!0});let o=0;for(const s of i){const r=Ne.buildPoolState(s);if(r){const a={...t[o],...r};e.push(a);const d=`${a.pool_id}_getPoolObject`;this.updateCache(d,a,M)}o+=1}return e}async getPool(e,t=!0){const n=`${e}_getPoolObject`,i=this.getCache(n,t),o=await this.getPoolImmutable(e);if(i!==void 0)return i;const s=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),r=Ne.buildPoolState(s),a={...o,...r};return this.updateCache(n,a,M),a}async getPoolHandleId(e){const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),n=$(t);return n?n.list.fields.id.id:""}async getMakerPoolPeriods(e,t=!1){const n=[],i=`${e.pool_id}_getMakerPoolPeriods`,o=this.getCache(i,t);return o!==void 0?o:((await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(e.whale_nfts.whale_nfts_handle)).data.forEach(r=>{const a={id:r.objectId,start_time:0,end_time:0,period:Number(r.name.value)};a.start_time=Number(l(e.start_time).add(l(e.interval_day).mul(24*3600).mul(a.period)).toFixed(0,W.ROUND_DOWN)),a.end_time=Number(l(a.start_time).add(l(e.interval_day).mul(24*3600)).toFixed(0,W.ROUND_DOWN)),n.push(a)}),this.updateCache(i,n,M),n)}async getMakerBonusInitConfigs(){var i;const{package_id:e}=this.sdk.sdkOptions.maker_bonus,t=(i=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::config::InitEvent`}))==null?void 0:i.data,n={maker_config_id:"",maker_pool_handle:""};return t.length>0&&t.forEach(o=>{const s=o.parsedJson;s&&(n.maker_config_id=s.config_id)}),n.maker_pool_handle=await this.getPoolHandleId(n.maker_config_id),n}async getPoolMarkerPositionList(e,t,n=!1){const i={},o=[];n||t.forEach(s=>{const r=`${e}_${s.period}_getPoolMarkerPositionList`,a=this.getCache(r);a!==void 0?i[s.period]=a:(i[s.period]=[],o.push(s))});try{o.length>0&&(await this._sdk.ClmmSDK.fullClient.batchGetObjects(o.map(a=>a.id),{showContent:!0})).forEach(a=>{const d=$(a),u=Ne.buildMarkerPositions(d);if(u.length>0){const{period_id:_}=u[0],p=t.filter(m=>m.id===_)[0];i[p.period]=u}});const s=[];for(const r in i)i[r].forEach(d=>{s.push(d)});if(s.length>0){const r=await this._sdk.ClmmSDK.Position.getSipmlePositionList(s.map(a=>a.id));for(const a of s)for(const d of r)if(a.id===d.pos_object_id){a.clmm_position=d;break}}}catch(s){console.log(s)}for(const s in i){const r=`${e}_${s}_getPoolMarkerPositionList`;this.updateCache(r,i[s],M)}return i}async updateXCetusRewarderAndFee(e,t,n){const i=await this.calculateTotalPointsAfterMultiper(e,n);for(const o of t)await this.calculateXCetusRewarder(e,o,n.period,i);return t}async calculateXCetusRewarder(e,t,n,i){const o=await this.getPoolBonusInfo(e.rewarders.rewarder_handle,n),{fee_share_rate:s}=this.calculateFeeShareRate(e,t,i),r=l(s).mul(o.total_bonus);return t.is_redeemed?t.bonus_num="0":t.bonus_num=r.toString(),t.bonus_num}calculateFeeShareRate(e,t,n){const i=Ne.getBonusPercent(e.config,t.percent),o=l(t.point).mul(i),s=l(o).div(n);return t.point_after_multiplier=o.toString(),t.fee_share_rate=Number(s),{fee_share_rate:Number(s),points_after_multiper:o.toString()}}async calculateTotalPointsAfterMultiper(e,t){const n=await this.getPoolMarkerPositionList(e.whale_nfts.whale_nfts_handle,[t]);let i=l(0);const o=n[t.period];for(const s of o){const r=Ne.getBonusPercent(e.config,s.percent),a=l(s.point).mul(r);i=i.add(a)}return i.toString()}async calculateAllXCetusRewarder(e){const t=this._sdk.ClmmSDK.senderAddress;let n=l(0);const i=[];for(const o of e){const s=await this._sdk.MakerModule.getMakerPoolPeriods(o),r=await this._sdk.MakerModule.getPoolMarkerPositionList(o.whale_nfts.whale_nfts_handle,s),a=[];for(const d of s){const u=r[d.period].filter(_=>{var p;return t.length===0?!1:((p=_.clmm_position)==null?void 0:p.owner)===t});u.length>0&&(await this._sdk.MakerModule.updateXCetusRewarderAndFee(o,u,d),u.forEach(_=>{var p;((p=_.clmm_position)==null?void 0:p.position_status)===li.Exists&&l(_.bonus_num).greaterThan(0)&&(n=n.add(_.bonus_num),a.includes(_.clmm_position.pos_object_id)||a.push(_.clmm_position.pos_object_id))}))}i.push({bonus_type:o.bonus_type,pool_id:o.pool_id,nft_ids:a})}return{claimtotal:n,claimRecord:i}}async getPoolBonusInfo(e,t,n=!1){const i=`${e}_${t}_getPoolBonusInfo`,o=this.getCache(i,n);if(o!==void 0)return o;const s=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"u64",value:t.toString()}}),r=$(s),a=Ne.buildPoolBonusInfo(r);return this.updateCache(i,a,De),a}claimPayload(e){const{maker_bonus:t,xcetus:n}=this.sdk.sdkOptions,i=new T;return i.moveCall({target:`${t.published_at}::${In}::claim`,typeArguments:[e.bonus_type],arguments:[i.pure(f(t).maker_config_id),i.pure(e.market_pool_id),i.pure(e.position_nft_id),i.pure(e.phase),i.pure(f(n).lock_manager_id),i.pure(f(n).xcetus_manager_id),i.pure(e.ve_nft_id)]}),i}claimAllPayload(e){const{maker_bonus:t,xcetus:n}=this.sdk.sdkOptions,i=new T;return e.whale_nfts.forEach(o=>{o.nft_ids.forEach(s=>{i.moveCall({target:`${t.published_at}::${In}::claim_all`,typeArguments:[o.bonus_type],arguments:[i.object(f(t).maker_config_id),i.object(o.pool_id),i.object(s),i.object(f(n).lock_manager_id),i.object(f(n).xcetus_manager_id),i.object(e.ve_nft_id)]})})}),i}updateCache(e,t,n=De){let i=this._cache[e];i?(i.overdueTime=Q(n),i.value=t):i=new xe(t,Q(n)),this._cache[e]=i}getCache(e,t=!1){const n=this._cache[e];if(!t&&(n!=null&&n.isValid()))return n.value;delete this._cache[e]}},We="router",Ft="router",st=24*3600,Dt=1e3,pe=1e11,qe=class{static buildVeNFTDividendInfo(e){const t={id:e.id.id,ve_nft_id:e.name,rewards:[]};return e.value.fields.value.fields.dividends.fields.contents.forEach(n=>{const i=[];n.fields.value.fields.contents.forEach(o=>{i.push({coin_type:A(o.fields.key.fields.name).source_address,amount:o.fields.value})}),t.rewards.push({period:Number(n.fields.key),rewards:i})}),t}static buildDividendManager(e){const t={id:e.id.id,dividends:{id:e.dividends.fields.id.id,size:e.dividends.fields.size},venft_dividends:{id:e.venft_dividends.fields.id.id,size:e.venft_dividends.fields.size},bonus_types:[],start_time:Number(e.start_time),interval_day:Number(e.interval_day),balances:{id:e.balances.fields.id.id,size:e.balances.fields.size},is_open:e.is_open};return e.bonus_types.forEach(n=>{t.bonus_types.push(A(n.fields.name).source_address)}),t}static buildLockUpManager(e){return{id:e.id.id,balance:e.balance,treasury_manager:e.treasury_manager,extra_treasury:e.extra_treasury,lock_infos:{lock_handle_id:e.lock_infos.fields.id.id,size:Number(e.lock_infos.fields.size)},type_name:Ke(e.type_name.fields.name),min_lock_day:Number(e.min_lock_day),max_lock_day:Number(e.max_lock_day),package_version:Number(e.package_version),max_percent_numerator:Number(e.max_percent_numerator),min_percent_numerator:Number(e.min_percent_numerator)}}static buildLockCetus(e){const t=e.fields,n={id:t.id.id,type:A(e.type).source_address,locked_start_time:Number(t.locked_start_time),locked_until_time:Number(t.locked_until_time),cetus_amount:t.balance,xcetus_amount:"0",lock_day:0};return n.lock_day=(n.locked_until_time-n.locked_start_time)/st,n}static getAvailableXCetus(e,t){let n=l(0);return t.forEach(i=>{n=n.add(i.xcetus_amount)}),l(e.xcetus_balance).sub(n).toString()}static getWaitUnLockCetuss(e){return e.filter(t=>!qe.isLocked(t))}static getLockingCetuss(e){return e.filter(t=>qe.isLocked(t))}static isLocked(e){return e.locked_until_time>Date.parse(new Date().toString())/1e3}static buildDividendRewardTypeList(e){const t=new Set;return e.forEach(n=>{n.rewards.forEach(i=>{t.add(i.coin_type)})}),Array.from(t)}static getNextStartTime(e){const t=Date.now()/1e3,{start_time:n,interval_day:i}=e,o=Math.ceil((t-n)/(i*st));return n+o*i*st}},hr=class{constructor(e){q(this,"_sdk");q(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getOwnerVeNFT(e,t=!0){const{xcetus:n}=this.sdk.sdkOptions,i=`${e}_getLockUpManagerEvent`,o=this.getCache(i,t);if(o!==void 0)return o;let s;const r=`${n.package_id}::xcetus::VeNFT`;return(await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showDisplay:!0},filter:{StructType:r}})).data.forEach(d=>{const u=A(we(d)).source_address;if(u===r&&d.data&&d.data.content){const{fields:_}=d.data.content;s={...Et(d),id:_.id.id,index:_.index,type:u,xcetus_balance:_.xcetus_balance},this.updateCache(i,s,M)}}),s}async getOwnerLockCetuss(e){const{xcetus:t}=this.sdk.sdkOptions,n=[],i=`${t.package_id}::lock_coin::LockedCoin<${this.buileCetusCoinType()}>`,o=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0},filter:{StructType:i}});for(const s of o.data)if(A(we(s)).source_address===i&&s.data){const a=qe.buildLockCetus(s.data.content);a.xcetus_amount=await this.getXCetusAmount(a.id),n.push(a)}return n}async getLockCetus(e){var n;const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0}});if((n=t.data)!=null&&n.content){const i=qe.buildLockCetus(t.data.content);return i.xcetus_amount=await this.getXCetusAmount(i.id),i}}async getOwnerCetusCoins(e){return await this._sdk.ClmmSDK.getOwnerCoinAssets(e,this.buileCetusCoinType())}mintVeNFTPayload(){const{xcetus:e}=this.sdk.sdkOptions,t=new T;return t.moveCall({target:`${e.published_at}::${We}::mint_venft`,typeArguments:[],arguments:[t.pure(f(e).xcetus_manager_id)]}),t}async convertPayload(e){const{xcetus:t}=this.sdk.sdkOptions,n=new T,i=this.buileCetusCoinType(),o=await oe.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,n,BigInt(e.amount),i);return e.venft_id===void 0?n.moveCall({target:`${t.published_at}::${We}::mint_and_convert`,typeArguments:[],arguments:[n.object(f(t).lock_manager_id),n.object(f(t).xcetus_manager_id),o,n.pure(e.amount)]}):n.moveCall({target:`${t.published_at}::${We}::convert`,typeArguments:[],arguments:[n.object(f(t).lock_manager_id),n.object(f(t).xcetus_manager_id),o,n.pure(e.amount),n.pure(e.venft_id)]}),n}redeemLockPayload(e){const{xcetus:t}=this.sdk.sdkOptions,n=new T;return n.moveCall({target:`${t.published_at}::${We}::redeem_lock`,typeArguments:[],arguments:[n.pure(f(t).lock_manager_id),n.pure(f(t).xcetus_manager_id),n.pure(e.venft_id),n.pure(e.amount),n.pure(e.lock_day),n.pure(C)]}),n}redeemPayload(e){const{xcetus:t}=this.sdk.sdkOptions,n=new T;return n.moveCall({target:`${t.published_at}::${We}::redeem`,typeArguments:[],arguments:[n.pure(f(t).lock_manager_id),n.pure(f(t).xcetus_manager_id),n.pure(e.venft_id),n.pure(e.lock_id),n.pure(C)]}),n}redeemDividendPayload(e,t){const{xcetus:n,xcetus_dividends:i}=this.sdk.sdkOptions,o=new T;return t.forEach(s=>{o.moveCall({target:`${n.published_at}::${Ft}::redeem`,typeArguments:[s],arguments:[o.object(f(i).dividend_manager_id),o.object(e)]})}),o}redeemDividendV2Payload(e,t,n){const{xcetus_dividends:i}=this.sdk.sdkOptions;let o=new T;return t.filter(r=>n.includes(r)).length>0&&(o=this.redeemDividendXTokenPayload(e,o)),t.forEach(r=>{n.includes(r)||o.moveCall({target:`${i.published_at}::${Ft}::redeem_v2`,typeArguments:[r],arguments:[o.object(f(i).dividend_manager_id),o.object(e),o.object(C)]})}),o}redeemDividendXTokenPayload(e,t){const{xcetus_dividends:n,xcetus:i}=this.sdk.sdkOptions,{xcetus_manager_id:o,lock_manager_id:s}=f(i),{dividend_manager_id:r}=f(n);return t=t===void 0?new T:t,t.moveCall({target:`${n.published_at}::${Ft}::redeem_xtoken`,typeArguments:[],arguments:[t.object(s),t.object(o),t.object(r),t.object(e),t.object(C)]}),t}buileCetusCoinType(){return`${this.sdk.sdkOptions.cetus_faucet.package_id}::cetus::CETUS`}buileXTokenCoinType(e=this._sdk.sdkOptions.xcetus.package_id,t="xcetus",n="XCETUS"){return`${e}::${t}::${n}`}cancelRedeemPayload(e){const{xcetus:t}=this.sdk.sdkOptions,n=new T;return n.moveCall({target:`${t.published_at}::${We}::cancel_redeem_lock`,typeArguments:[],arguments:[n.pure(f(t).lock_manager_id),n.pure(f(t).xcetus_manager_id),n.pure(e.venft_id),n.pure(e.lock_id),n.pure(C)]}),n}async getInitConfigs(){var r,a;const{package_id:e}=this.sdk.sdkOptions.xcetus,t=`${e}_getInitFactoryEvent`,n=this.getCache(t);if(n!==void 0)return n;const i=(r=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::xcetus::InitEvent`}))==null?void 0:r.data,o={xcetus_manager_id:"",lock_manager_id:"",lock_handle_id:""};i.length>0&&i.forEach(d=>{const u=d.parsedJson;u&&(o.xcetus_manager_id=u.xcetus_manager)});const s=(a=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::locking::InitializeEvent`}))==null?void 0:a.data;return s.length>0&&s.forEach(d=>{const u=d.parsedJson;u&&(o.lock_manager_id=u.lock_manager)}),o.lock_manager_id.length>0&&(o.lock_handle_id=(await this.getLockUpManager(o.lock_manager_id)).lock_infos.lock_handle_id),this.updateCache(t,o,M),o}async getLockUpManager(e=f(this.sdk.sdkOptions.xcetus).lock_manager_id,t=!1){const n=`${e}_getLockUpManager`,i=this.getCache(n,t);if(i!==void 0)return i;const o=await this.sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),s=qe.buildLockUpManager($(o));return this.updateCache(n,s,M),s}async getDividendConfigs(){var s;const{package_id:e}=this.sdk.sdkOptions.xcetus_dividends,t=`${e}_getDividendManagerEvent`,n=this.getCache(t);if(n!==void 0)return n;const i=(s=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::dividend::InitEvent`}))==null?void 0:s.data,o={dividend_manager_id:"",dividend_admin_id:"",dividend_settle_id:""};return i.length>0&&i.forEach(r=>{const a=r.parsedJson;a&&(o.dividend_manager_id=a.manager_id,o.dividend_admin_id=a.admin_id,o.dividend_settle_id=a.settle_id,this.updateCache(t,o,M))}),o}async getDividendManager(e=!1){const{dividend_manager_id:t}=f(this._sdk.sdkOptions.xcetus_dividends),n=`${t}_getDividendManager`,i=this.getCache(n,e);if(i!==void 0)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),s=$(o),r=qe.buildDividendManager(s);return this.updateCache(n,r,M),r}async getXcetusManager(e=!0){const{xcetus_manager_id:t}=f(this._sdk.sdkOptions.xcetus),n=`${t}_getXcetusManager`,i=this.getCache(n,e);if(i)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),s=$(o),r={id:s.id.id,index:Number(s.index),has_venft:{handle:s.has_venft.fields.id.id,size:s.has_venft.fields.size},nfts:{handle:s.nfts.fields.id.id,size:s.nfts.fields.size},total_locked:s.total_locked,treasury:s.treasury.fields.total_supply.fields.value};return this.updateCache(n,r),r}async getVeNFTDividendInfo(e,t){try{const n=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),i=$(n);return qe.buildVeNFTDividendInfo(i)}catch{return}}async redeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const n=await this.getLockUpManager(f(this._sdk.sdkOptions.xcetus).lock_manager_id),i=l(pe).mul(l(n.max_lock_day).sub(l(t))).mul(l(n.max_percent_numerator).sub(l(n.min_percent_numerator))).div(l(n.max_lock_day).sub(l(n.min_lock_day))),o=l(pe).mul(l(n.max_percent_numerator)).sub(i).div(l(Dt)).div(pe);return{amountOut:l(o).mul(l(e)).round().toString(),percent:o.toString()}}async reverseRedeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const n=await this.getLockUpManager(f(this._sdk.sdkOptions.xcetus).lock_manager_id),i=l(pe).mul(l(n.max_lock_day).sub(l(t))).mul(l(n.max_percent_numerator).sub(l(n.min_percent_numerator))).div(l(n.max_lock_day).sub(l(n.min_lock_day))),o=l(pe).mul(l(n.max_percent_numerator)).sub(i).div(l(Dt)).div(pe);return{amountOut:l(e).div(o).toFixed(0,W.ROUND_UP),percent:o.toString()}}async getXCetusAmount(e){const{lock_handle_id:t}=f(this._sdk.sdkOptions.xcetus),n=`${e}_getXCetusAmount`,i=this.getCache(n);if(i!==void 0)return i;try{const o=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:t,name:{type:"0x2::object::ID",value:e}}),s=$(o);if(s){const{xcetus_amount:r}=s.value.fields.value.fields;return this.updateCache(n,r,M),r}}catch{}return"0"}async getVeNftAmount(e,t){try{const n=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),i=$(n);if(i){const{lock_amount:o,xcetus_amount:s}=i.value.fields.value.fields;return{lock_amount:o,xcetus_amount:s}}}catch{}return{lock_amount:"0",xcetus_amount:"0"}}async getPhaseDividendInfo(e,t=!1){const i=(await this.getDividendManager()).dividends.id,o=`${i}_${e}_getPhaseDividendInfo`,s=this._sdk.getCache(o,t);if(s)return s;try{const r=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:i,name:{type:"u64",value:e}}),a=$(r),d=a.value.fields.value.fields,u=d.redeemed_num.fields.contents.map(b=>({name:b.fields.key.fields.name,value:b.fields.value})),_=d.bonus_types.map(b=>b.fields.name),p=d.bonus.fields.contents.map(b=>({name:b.fields.key.fields.name,value:b.fields.value})),m={id:ct(r),phase:a.name,settled_num:d.settled_num,register_time:d.register_time,redeemed_num:u,is_settled:d.is_settled,bonus_types:_,bonus:p,phase_end_time:""};return this.updateCache(o,m),m}catch{}}updateCache(e,t,n=De){let i=this._cache[e];i?(i.overdueTime=Q(n),i.value=t):i=new xe(t,Q(n)),this._cache[e]=i}getCache(e,t=!1){const n=this._cache[e];if(!t&&(n!=null&&n.isValid()))return n.value;delete this._cache[e]}},gr="factory",_e="oversubscribe_pool",ki=1e6,At=1e18,Je="router",Lt="router",Ct="router",On={curve:{strategy:3,both_side:{div_width:10,ratios:[.333333,.266666,.2,.133333,.066666]},one_side:{div_width:5,ratios:[.333333,.266666,.2,.133333,.066666]}},bidAsk:{strategy:4,both_side:{div_width:10,ratios:[.172413793,.137931034,.103448276,.068965517,.034482759,.068965517,.103448276,.137931034,.172413793]},one_side:{div_width:5,ratios:[.066666667,.13333333,.2,.266666667,.333333333]}}};function fr(e){return"master_address"in e}var Kt="router",br="vaults",yr=1e4,Y=class{static buildIdoPoolImmutables(e){return{pool_address:ce(e.pool_id),coin_type_sale:A(e.sale_coin_type.name).full_address,coin_type_raise:A(e.raise_coin_type.name).full_address,tick_spacing:Number(e.tick_spacing),total_supply:e.total_supply,min_purchase:e.min_purchase_amount,max_purchase:e.max_purchase_amount}}static buildIdoPool(e){const t=we(e),n=A(t),i=$(e),o={pool_address:ce(i.id.id),coin_type_sale:n.type_arguments[0],coin_type_raise:n.type_arguments[1],tick_spacing:Number(i.tick_spacing),total_supply:i.total_supply,min_purchase:i.min_purchase_amount,max_purchase:i.max_purchase_amount},s={start_time:Number(i.duration_manager.fields.start_time),lock_up_duration:Number(i.duration_manager.fields.lock_up_duration),purchase_duration:Number(i.duration_manager.fields.purchase_duration),end_time:0};s.end_time=s.start_time+s.purchase_duration;const r={complete_raise_limit:i.complete_raise_limit,liquidity_injection_ratio:l(i.liquidity_injection_ratio).div(ki).toNumber(),current_sqrt_price_min:i.current_sqrt_price_min,current_sqrt_price_max:i.current_sqrt_price_max,owner:i.owner,sale_coin_amount:i.sale_coin,raise_coin_amount:i.raise_coin,price:i.price,current_price:i.price,duration_summary:s,is_cancelled:i.is_cancelled,is_liquidity_injected:i.is_liquidity_injected,liquidity_used_raise_amount:i.liquidity_used_raise_amount,liquidity_used_sale_amount:i.liquidity_used_sale_amount,purchase_summary:{size:Number(i.purchase_manager.fields.purchases.fields.size),purchase_handle:i.purchase_manager.fields.purchases.fields.id.id},total_purchase_amount:i.total_purchase_amount,white_summary:{white_list_id:i.white_list.fields.id.id,protection_limit_used:i.white_list.fields.protection_limit_used,protection_hard_cap:i.white_list.fields.protection_hard_cap,white_handle:i.white_list.fields.addresses.fields.id.id,size:Number(i.white_list.fields.addresses.fields.size)},pool_status:"Upcoming",max_raise_amount:"",sale_decimals:0,raise_decimals:0,is_withdrawn:i.is_withdrawn};return Y.updatePoolStatus(r),{...o,...r}}static is_init_period(e){return Number(l(Date.now()/1e3).toFixed(0))<e.start_time}static is_purchase_period(e){const t=Number(l(Date.now()/1e3).toFixed(0));return t>=e.start_time&&t<=e.start_time+e.purchase_duration}static is_claim_period(e){const t=Number(l(Date.now()/1e3).toFixed(0)),n=e.start_time+e.purchase_duration;return t>n}static is_can_inject_liquidity(e){return!e.is_cancelled&&e.liquidity_injection_ratio!==0&&Y.is_claim_period(e.duration_summary)&&!e.is_liquidity_injected}static is_can_withdraw(e){return e.is_withdrawn?!1:Y.is_sale_failed(e)?!0:(e.liquidity_injection_ratio===0||e.is_liquidity_injected)&&Y.is_claim_period(e.duration_summary)}static is_sale_failed(e){return!!(e.is_cancelled||Y.is_claim_period(e.duration_summary)&&l(e.total_purchase_amount).lessThan(e.complete_raise_limit))}static buildPurchaseInfo(e){return{...e.value.fields.value.fields,owner:e.name}}static calculateRedeemAmount(e,t){let n,i;if(Y.is_sale_failed(e))n="0",i="0";else if(t.is_redeemed)n=t.obtained_sale_amount,i=t.used_raise_amount;else if(l(e.total_purchase_amount).lessThanOrEqualTo(e.max_raise_amount))n=l(t.purchased_raise_amount).mul(At).div(e.price).toString(),i=t.purchased_raise_amount;else{const s=Y.redeemForSaleOversubcribe(e,t);n=s.user_obtained_sale_amount,i=s.user_used_raise_amount_ceil}n=W.floor(n);const o=W.floor(l(t.purchased_raise_amount).sub(i).toString());return{obtained_sale_amount:n,refunded_raise_amount:o}}static calculateWithdrawAmount(e){let t,n;const i=l(e.total_supply).mul(e.liquidity_injection_ratio);if(Y.is_sale_failed(e))t="0",n=l(i).add(e.total_supply);else{const{max_raise_amount:o}=e;l(e.total_purchase_amount).greaterThanOrEqualTo(o)?(t=l(o).sub(e.liquidity_used_raise_amount).toString(),n="0"):(t=l(e.total_purchase_amount).sub(e.liquidity_used_raise_amount),n=l(e.total_supply).add(i).sub(e.liquidity_used_sale_amount).sub(Y.get_sold_amount(e)))}return{obtained_raise_amount:W.floor(t).toString(),refunded_sale_amount:W.ceil(n).toString()}}static get_sold_amount(e){return l(e.total_purchase_amount).greaterThanOrEqualTo(e.max_raise_amount)?e.total_supply:l(e.total_purchase_amount).mul(At).div(e.price)}static redeemForSaleOversubcribe(e,t){const n=t.protection_raise_amount,i=l(t.purchased_raise_amount).sub(n),o=e.max_raise_amount,{protection_limit_used:s}=e.white_summary,r=l(o).sub(s),a=l(e.total_purchase_amount).sub(s),d=W.ceil(i.mul(r).div(a).add(n)),u=W.floor(i.mul(r).div(a).add(n));return{user_obtained_sale_amount:W.floor(l(e.total_supply).mul(u).div(o)),user_used_raise_amount_ceil:d}}static raiseTotalAmount(e){const t=l(e.sale_decimals-e.raise_decimals).abs().toNumber();return e.sale_decimals>e.raise_decimals?l(e.total_supply).mul(e.current_price).div(l(10).pow(l(t))).toString():l(e.total_supply).mul(e.current_price).mul(l(10).pow(l(t))).toString()}static updatePoolStatus(e){const t=Number(l(Date.now()/1e3).toFixed(0)),n=e.duration_summary,i=n.start_time+n.purchase_duration;e.is_cancelled?e.pool_status="Canceled":t<n.start_time?e.pool_status="Upcoming":t>n.start_time&&t<i?e.pool_status="Live":l(e.total_purchase_amount).lessThan(e.complete_raise_limit)?e.pool_status="Failed":e.pool_status="Ended"}static async calculatePoolUiPrice(e,t){const n=await e.ClmmSDK.CetusConfig.getTokenListByCoinTypes([t.coin_type_sale,t.coin_type_raise]),i=n[t.coin_type_sale].decimals,o=n[t.coin_type_raise].decimals;t.current_price=ie.priceFixToReal(Number(l(t.price).div(l(At)).toString()),i,o).toString(),t.sale_decimals=i,t.raise_decimals=o,t.max_raise_amount=this.raiseTotalAmount(t)}},Ir=class{constructor(e){q(this,"_sdk");this._sdk=e}async getPools(e=[],t=!1){const n=[];if(e.length>0){if(e.filter(o=>{const s=`${o}_getPool`,r=this._sdk.getCache(s,t);return r?(n.push(r),!1):!0}).length>0){const o=await this._sdk.ClmmSDK.fullClient.batchGetObjects(e,{showType:!0,showContent:!0});for(const s of o){const r=await this.buildIdoWarpPool(s);r&&n.push(r)}}}else{const i=await this._sdk.Launchpad.getPools(),o=await this._sdk.Ido.getPools();i.forEach(s=>{n.push({...s,version:"1"})}),o.forEach(s=>{n.push({...s,version:"2"})})}return n.forEach(i=>{const o=`${i.pool_address}_getPool`;this._sdk.updateCache(o,i)}),n}async getPool(e,t=!0){const n=`${e}_getPool`,i=this._sdk.getCache(n,t);if(i)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),s=await this.buildIdoWarpPool(o);return this._sdk.updateCache(n,s),s}async getJoinPools(e,t){const n=[],i=t.filter(s=>s.version==="1"),o=t.filter(s=>s.version==="2");if(i.length>0){const s=await this._sdk.Launchpad.getPurchaseMarks(e,i.map(r=>r.pool_address),!1);i.forEach(r=>{for(const a of s)if(a.pool_id===r.pool_address){n.push(r);break}})}for(const s of o)await this._sdk.Ido.getPurchaseInfo(s.purchase_summary.purchase_handle,e,!1)&&n.push(s);return n}async getOwnerPools(e,t){return t.filter(n=>n.owner===H(e))}async creatPurchasePayload(e,t){return e.version==="1"?await this._sdk.Launchpad.creatPurchasePayload({pool_address:e.pool_address,purchase_amount:t,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise}):await this._sdk.Ido.creatPurchasePayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise,purchase_handle:e.purchase_summary.purchase_handle,raise_amount:t.toString()})}async creatRedeemPayload(e){return e.version==="1"?await this._sdk.Launchpad.creatClaimPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise}):await this._sdk.Ido.redeemPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise,purchase_handle:e.purchase_summary.purchase_handle})}async creatWithdrawPayload(e){if(e.version==="1"){const n=await ie.getWithdrawSale(e),i=await ie.getWithdrawRaise(e);return this._sdk.Launchpad.creatWithdrawPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise,sale_amount:BigInt(n),raise_amount:BigInt(i)})}return this._sdk.Ido.withdrawPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise})}unlockNftPayload(e,t){return e.version==="1"?this._sdk.Launchpad.creatUnlockNftPayload(t):this._sdk.Ido.unlockNftPayload({lock_nft_id:t.lock_nft,nft_type:t.nft_type})}async getLockNFTList(e){let t=[];return e.version==="1"&&(t=await this._sdk.Launchpad.getLockNFTList(e.owner)),t=await this._sdk.Ido.getLockNFTList(e.owner),t.filter(i=>i.coin_type_a===e.coin_type_sale&&i.coin_type_b===e.coin_type_raise||i.coin_type_a===e.coin_type_raise&&i.coin_type_b===e.coin_type_sale)}async isWhiteListUser(e,t){return t.version==="1"?await this._sdk.Launchpad.isWhiteListUser(t.white_summary.white_handle,e):!!await this._sdk.Ido.getWhiteProtectionLimit(t.white_summary.white_handle,e)}async getPurchaseInfo(e,t){if(t.version==="1"){const i=await this._sdk.Launchpad.getPurchaseMarks(e,[t.pool_address]);return i.length>0?i[0]:void 0}return await this._sdk.Ido.getPurchaseInfo(t.purchase_summary.purchase_handle,e)}async getwhiteProtectionInfo(e,t,n=!1){if(t.version==="1")return await this._sdk.Launchpad.getPurchaseAmount(t.white_summary.white_handle,e);const i=await this._sdk.Ido.getPurchaseInfo(t.purchase_summary.purchase_handle,e,n);if(i)return{safe_limit_amount:i.protection_raise_limit,safe_purchased_amount:i.protection_raise_amount};const o=await this._sdk.Ido.getWhiteProtectionLimit(t.white_summary.white_handle,e,!1);return o?{safe_limit_amount:o,safe_purchased_amount:"0"}:{safe_limit_amount:"0",safe_purchased_amount:"0"}}async calculateWithdrawAmount(e){if(e.version==="1"){const t=await ie.getHistoryWithdrawRaise(this._sdk,e),n=await ie.getHistoryWithdrawSale(this._sdk,e);return{obtained_raise_amount:t,refunded_sale_amount:n}}return Y.calculateWithdrawAmount(e)}async buildIdoWarpPool(e){const t=ut(e);if(A(t).address===this._sdk.sdkOptions.ido.package_id){const n=Y.buildIdoPool(e);return await Y.calculatePoolUiPrice(this._sdk,n),{...n,version:"2"}}if(A(t).address===this._sdk.sdkOptions.launchpad.package_id){const n=ie.buildLaunchPadPool(e);return await ie.calculatePoolPrice(this._sdk,n),{...n,version:"1"}}}},Fe=class{static buildVeNFTDividendInfo(e){const t={id:e.id.id,ve_nft_id:e.name,rewards:[]};return e.value.fields.value.fields.dividends.fields.contents.forEach(n=>{const i=[];n.fields.value.fields.contents.forEach(o=>{i.push({coin_type:A(o.fields.key.fields.name).source_address,amount:o.fields.value})}),t.rewards.push({period:Number(n.fields.key),rewards:i})}),t}static buildDividendManager(e){const t={id:e.id.id,dividends:{id:e.dividends.fields.id.id,size:e.dividends.fields.size},venft_dividends:{id:e.venft_dividends.fields.id.id,size:e.venft_dividends.fields.size},bonus_types:[],start_time:Number(e.start_time),interval_day:Number(e.interval_day),balances:{id:e.balances.fields.id.id,size:e.balances.fields.size},is_open:e.is_open};return e.bonus_types.forEach(n=>{t.bonus_types.push(A(n.fields.name).source_address)}),t}static buildLockUpManager(e){return{id:e.id.id,balance:e.balance,treasury_manager:e.treasury_manager,extra_treasury:e.extra_treasury,lock_infos:{lock_handle_id:e.lock_infos.fields.id.id,size:Number(e.lock_infos.fields.size)},type_name:Ke(e.type_name.fields.name),min_lock_day:Number(e.min_lock_day),max_lock_day:Number(e.max_lock_day),package_version:Number(e.package_version),max_percent_numerator:Number(e.max_percent_numerator),min_percent_numerator:Number(e.min_percent_numerator)}}static buildLockToken(e){const t=e.fields,n={id:t.id.id,type:A(e.type).source_address,locked_start_time:Number(t.locked_start_time),locked_until_time:Number(t.locked_until_time),token_amount:t.balance,xtoken_amount:"0",lock_day:0};return n.lock_day=(n.locked_until_time-n.locked_start_time)/st,n}static getAvailableXToken(e,t){let n=l(0);return t.forEach(i=>{n=n.add(i.xtoken_amount)}),l(e.xtoken_balance).sub(n).toString()}static getWaitUnLockTokens(e){return e.filter(t=>!Fe.isLocked(t))}static getLockingTokens(e){return e.filter(t=>Fe.isLocked(t))}static buildDividendRewardTypeList(e){const t=new Set;return e.forEach(n=>{n.rewards.forEach(i=>{t.add(i.coin_type)})}),Array.from(t)}static isLocked(e){return e.locked_until_time>Date.parse(new Date().toString())/1e3}static getNextStartTime(e,t=st){const n=Date.now()/1e3,{start_time:i,interval_day:o}=e,s=Math.ceil((n-i)/(o*t));return i+s*o*t}},Se=class{static getDefaultStrategyConfig(e){let t;switch(e){case 4:t=On.bidAsk;break;default:t=On.curve;break}return t}static geTickIndexRange(e,t,n,i){let o,s;switch(e=D.getInitializableTickIndex(e,t),i){case"left":e>0?(s=l(e).sub(t).toNumber(),o=l(e).mul(l(1).add(n)).toDecimalPlaces(0).toNumber()):(s=l(e).sub(t).toNumber(),o=l(e).mul(l(1).sub(n)).toDecimalPlaces(0).toNumber());break;case"right":e>0?(s=l(e).mul(l(1).add(n)).toDecimalPlaces(0).toNumber(),o=l(e).add(t).toNumber()):(s=l(e).mul(l(1).sub(n)).toDecimalPlaces(0).toNumber(),o=l(e).add(t).toNumber());break;default:e>0?(o=l(e).mul(l(1).sub(n)).toDecimalPlaces(0).toNumber(),s=l(e).mul(l(1).add(n)).toDecimalPlaces(0).toNumber()):(o=l(e).mul(l(1).add(n)).toDecimalPlaces(0).toNumber(),s=l(e).mul(l(1).sub(n)).toDecimalPlaces(0).toNumber());break}if(o=D.getInitializableTickIndex(o,t),s=D.getInitializableTickIndex(s,t),o<$s)throw Error("Tick lower value is below the minimum allowed value.");if(s>Rs)throw Error("Tick upper value is above the maximum allowed value.");return{tick_lower:o,tick_upper:s}}static getCreateLiquidityBins(e,t){let n=[];switch(t){case 4:n=Se.getCreateBidAskLiquidityBins(e);break;default:n=Se.getCreateCurveLiquidityBins(e);break}return n}static getCreateBidAskLiquidityBins(e){const t=l(Math.floor(l(e.tick_upper).sub(e.tick_lower).div(e.div_width).toNumber())).abs(),n=[],i=e.ratios;let o,s;for(let r=0;r<i.length;r++){let a,d;e.tick_upper<=e.curr_tick?(d=l(e.tick_upper).sub(t.mul(r)).toNumber(),a=l(d).sub(t).toNumber()):e.tick_lower>=e.curr_tick?(a=l(e.tick_lower).add(t.mul(r)).toNumber(),d=l(e.tick_lower).add(t.mul(r+1)).toNumber()):r===4?(a=l(e.tick_lower).add(t.mul(r)).toNumber(),d=l(a).add(t.mul(2)).toNumber()):r>4?(a=l(e.tick_lower).add(t.mul(r+1)).toNumber(),d=l(a).add(t).toNumber()):(a=l(e.tick_lower).add(t.mul(r)).toNumber(),d=l(a).add(t).toNumber()),o=D.getInitializableTickIndex(a,e.tick_spacing),s=D.getInitializableTickIndex(d,e.tick_spacing),n.push({tick_lower:o,tick_upper:s,ratio:i[r],liquidity:"0"})}return n}static getCreateCurveLiquidityBins(e){const t=l(Math.floor(l(e.tick_upper).sub(e.tick_lower).div(e.div_width).toNumber())).abs(),n=[],i=e.ratios;for(let o=0;o<i.length;o++){let s,r;e.tick_upper<=e.curr_tick?(r=e.tick_upper,s=l(e.tick_upper).sub(t.mul(o+1)).toNumber()):e.tick_lower>=e.curr_tick?(s=e.tick_lower,r=l(s).add(t.mul(o+1)).toNumber()):(s=l(e.curr_tick).sub(t.mul(o+1)).toNumber(),r=l(e.curr_tick).add(t.mul(o+1)).toNumber()),n.push({tick_lower:D.getInitializableTickIndex(s,e.tick_spacing),tick_upper:D.getInitializableTickIndex(r,e.tick_spacing),ratio:i[o],liquidity:"0"})}return n}static calculateAddLiquidityInputs(e){const t=new g(D.tickIndexToSqrtPriceX64(e.curr_tick)),n=Se.calculateCoinRatios(e.curr_tick,e.liquidity_bins),i=e.liquidity_bins.map((o,s)=>{const r=n[s],a=l(e.coin_amount).mul(e.fix_amount_a?r.coinRatioA:r.coinRatioB).toFixed(0).toString();try{return{...ae.estLiquidityAndcoinAmountFromOneAmounts(o.tick_lower,o.tick_upper,new g(a),e.fix_amount_a,!0,e.slippage,t),...o}}catch{return{coinAmountA:new g(0),coinAmountB:new g(0),tokenMaxA:new g(0),tokenMaxB:new g(0),liquidityAmount:new g(0),fix_amount_a:!e.fix_amount_a,...o}}});return Se.fixLiquidityInputs(t,e.slippage,i,!0)}static fixLiquidityInputs(e,t,n,i){const o=n.filter(r=>r.liquidityAmount.gt(Z));if(o.length===0)return[];const s=o[0];return n.map(r=>{if(r.liquidityAmount.eq(Z)){const a=l(s.liquidityAmount.toString()).mul(r.ratio).div(s.ratio).toFixed(0),d=D.tickIndexToSqrtPriceX64(r.tick_lower),u=D.tickIndexToSqrtPriceX64(r.tick_upper),_=ae.getCoinAmountFromLiquidity(new g(a.toString()),e,d,u,!1);return{coinAmountA:_.coinA,coinAmountB:_.coinB,liquidityAmount:new g(a.toString()),fix_amount_a:r.fix_amount_a,...$t(_,ot.fromDecimal(l(t).mul(100)),i)}}return r})}static calculateCoinRatios(e,t){const n=new g(D.tickIndexToSqrtPriceX64(e)),i=[];let o=l(0),s=l(0);const r=t.map(u=>{const _=l(ur(100,6).toString()).mul(u.ratio).toFixed(0).toString(),p=D.tickIndexToSqrtPriceX64(u.tick_lower),m=D.tickIndexToSqrtPriceX64(u.tick_upper),b=ae.getCoinAmountFromLiquidity(new g(_),n,p,m,!0);return o=o.add(b.coinA.toString()),s=s.add(b.coinB.toString()),{...b,liquidity:_}}),a=[],d=[];return r.forEach((u,_)=>{const p={coinRatioA:o.eq(l(0))?0:l(u.coinA.toString()).div(o).toNumber(),coinRatioB:s.eq(l(0))?0:l(u.coinB.toString()).div(s).toNumber(),liquiditys:u.liquidity,tick_lower:t[_].tick_lower,tick_upper:t[_].tick_upper};i.push(p),a.push(o.eq(l(0))?0:l(u.coinA.toString()).div(o).toNumber()),d.push(s.eq(l(0))?0:l(u.coinB.toString()).div(s).toNumber())}),i}static calculateCloseMasterLiquidityInputs(e){const t=new g(D.tickIndexToSqrtPriceX64(e.curr_tick));return e.positions.map(i=>{const o=new g(i.liquidity),s=D.tickIndexToSqrtPriceX64(i.tick_lower_index),r=D.tickIndexToSqrtPriceX64(i.tick_upper_index),a=ae.getCoinAmountFromLiquidity(o,t,s,r,!1),d=ot.fromDecimal(l(e.slippage).mul(100)),{tokenMaxA:u,tokenMaxB:_}=$t(a,d,!1);return{coinAmountA:a.coinA,coinAmountB:a.coinB,tokenMaxA:u,tokenMaxB:_,liquidityAmount:o,fix_amount_a:!1}})}static calculateRemoveMasterLiquidityInputs(e){const t=new g(D.tickIndexToSqrtPriceX64(e.curr_tick)),{fix_token:n}=e;if(n){const o=e.positions.map((a,d)=>({tick_lower:a.tick_lower_index,tick_upper:a.tick_upper_index,ratio:e.ratios[d]})),s=Se.calculateCoinRatios(e.curr_tick,o),r=e.positions.map((a,d)=>{const u=s[d],_=l(n.coin_amount).mul(n.fix_amount_a?u.coinRatioA:u.coinRatioB).toFixed(0).toString();try{const p=ae.estLiquidityAndcoinAmountFromOneAmounts(a.tick_lower_index,a.tick_upper_index,new g(_),n.fix_amount_a,!1,e.slippage,t);return{...p,tick_lower:a.tick_lower_index,tick_upper:a.tick_upper_index,liquidity:p.liquidityAmount.toString(),ratio:e.ratios[d]}}catch{return{coinAmountA:new g(0),coinAmountB:new g(0),tokenMaxA:new g(0),tokenMaxB:new g(0),liquidityAmount:new g(0),fix_amount_a:!n.fix_amount_a,tick_lower:a.tick_lower_index,tick_upper:a.tick_upper_index,liquidity:"0",ratio:e.ratios[d]}}});return Se.fixLiquidityInputs(t,e.slippage,r,!1)}return e.positions.map((o,s)=>{const r=e.ratios[s];let a=l(e.liquidity).mul(r).toFixed(0);l(a).greaterThan(o.liquidity)&&(a=o.liquidity);const d=D.tickIndexToSqrtPriceX64(o.tick_lower_index),u=D.tickIndexToSqrtPriceX64(o.tick_upper_index),_=ae.getCoinAmountFromLiquidity(new g(a),t,d,u,!1),p=ot.fromDecimal(l(e.slippage).mul(100)),{tokenMaxA:m,tokenMaxB:b}=$t(_,p,!1);return{coinAmountA:_.coinA,coinAmountB:_.coinB,tokenMaxA:m,tokenMaxB:b,liquidityAmount:new g(a),fix_amount_a:!1}})}static buildMasterPosition(e){return{coin_type_a:A(e.coin_type_a.fields.name).full_address,coin_type_b:A(e.coin_type_b.fields.name).full_address,description:e.description,id:e.id.id,index:e.index,liquidity:e.liquidity,name:e.name,pool:e.pool,tick_lower_index:ke(BigInt(e.tick_lower_index.fields.bits)),tick_upper_index:ke(BigInt(e.tick_upper_index.fields.bits)),url:e.url}}static buildMasterNFT(e){const t=$(e);if(t){const n={id:t.id.id,pool_id:t.pool_id,index:Number(t.index),strategy:Number(t.strategy),tick_lower_index:ke(BigInt(t.tick_lower_index)),tick_upper_index:ke(BigInt(t.tick_upper_index)),positions:[],...Et(e)};return n.positions=t.positions.map(i=>Se.buildMasterPosition(i.fields)),n}}},Le=class{static generateNextTickRange(e,t,n){const i=e-t/2,o=e+t/2;return{new_tick_lower:Le.getValidTickIndex(i,n),new_tick_upper:Le.getValidTickIndex(o,n)}}static calculateDepositRatio(e,t,n){const i=D.sqrtPriceX64ToTickIndex(n);if(i<e)return{ratioA:new W(1),ratioB:new W(0)};if(i>t)return{ratioA:new W(0),ratioB:new W(1)};const o=new g(1e8),{coinAmountB:s}=ae.estLiquidityAndcoinAmountFromOneAmounts(e,t,o,!0,!0,0,n),r=D.sqrtPriceX64ToPrice(n,0,0),a=l(o.toString()).mul(r),d=a.add(s.toString()),u=a.div(d),_=l(s.toString()).div(d);return{ratioA:u,ratioB:_}}static getValidTickIndex(e,t){if(e%t===0)return e;let n;if(e>0?n=e-e%t+t:e<0?n=e+Math.abs(e)%t-t:n=e,n%t!==0)throw new Error("Assertion failed: res % tickSpacing == 0");if(Math.abs(n)<Math.abs(e))throw new Error("Assertion failed: res.abs() >= tickIndex");return n}static get_lp_amount_by_liquidity(e,t){return e.total_supply==="0"?t:l(e.total_supply).mul(t).div(e.liquidity).toFixed(0,W.ROUND_DOWN).toString()}static get_share_liquidity_by_amount(e,t){return l(t).mul(e.liquidity).div(e.total_supply).toFixed(0,W.ROUND_DOWN).toString()}static get_protocol_fee_amount(e,t){return l(t).mul(e.protocol_fee_rate).div(yr).toFixed(0,W.ROUND_CEIL)}static buildPosition(e){return{coin_type_a:A(e.coin_type_a.fields.name).full_address,coin_type_b:A(e.coin_type_b.fields.name).full_address,description:e.description,id:e.id.id,index:e.index,liquidity:e.liquidity,name:e.name,pool:e.pool,tick_lower_index:ke(BigInt(e.tick_lower_index.fields.bits)),tick_upper_index:ke(BigInt(e.tick_upper_index.fields.bits)),url:e.url}}static buildPool(e){const t=$(e),n=ut(e);if(t){const i={id:t.id.id,pool_id:t.pool,protocol_fee_rate:t.protocol_fee_rate,is_pause:t.is_pause,harvest_assets:{harvest_assets_handle:t.harvest_assets.fields.id.id,size:Number(t.harvest_assets.fields.size)},positins:[],lp_token_type:A(n).type_arguments[0],total_supply:t.lp_token_treasury.fields.total_supply.fields.value,liquidity:t.liquidity,max_quota:t.max_quota,status:t.status===1?"STATUS_RUNNING":"STATUS_REBALANCING",quota_based_type:t.quota_based_type.fields.name};return i.positins=t.positions.map(o=>Le.buildPosition(o.fields)),i}}},kr=class{constructor(e){q(this,"_sdk");q(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e="all",t=!1){const{package_id:n}=this._sdk.sdkOptions.ido,i=`${n}_getPoolImmutables`,o=this.getCache(i,t),s={data:[],hasNextPage:!1},r=[];if(o!==void 0&&r.push(...o),r.length===0)try{const a=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${n}::oversubscribe_pool::CreatePoolEvent`},e);a.data.forEach(d=>{const u=d.parsedJson;if(u){const _=Y.buildIdoPoolImmutables(u);r.push(_)}}),s.hasNextPage=a.hasNextPage,s.nextCursor=a.nextCursor,this.updateCache(i,r,M)}catch(a){console.log("getPoolImmutables",a)}return s.data=r,s}async getPools(e=[],t=!1){const n=[];let i=[];e.length>0?i=[...e]:(await this.getPoolImmutables("all",t)).data.forEach(r=>{i.push(r.pool_address)});const o=await this._sdk.ClmmSDK.fullClient.batchGetObjects(i,{showType:!0,showContent:!0});for(const s of o){const r=Y.buildIdoPool(s);await Y.calculatePoolUiPrice(this._sdk,r),n.push(r);const a=`${r.pool_address}_getPoolObject`;this.updateCache(a,r,M)}return n}async getPool(e,t=!0){const n=`${e}_getPoolObject`,i=this.getCache(n,t);if(i!==void 0)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),s=Y.buildIdoPool(o);return await Y.calculatePoolUiPrice(this._sdk,s),this.updateCache(n,s),s}async getIdoConfigs(e=!1){var d;const{package_id:t}=this._sdk.sdkOptions.ido,n=`${t}_getInitEvent`,i=this.getCache(n,e);if(i!==void 0)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showPreviousTransaction:!0}}),s=bi(o),r=(d=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({Transaction:s}))==null?void 0:d.data,a={pools_id:"",admin_cap_id:"",package_version_id:""};return r.length>0&&(r.forEach(u=>{console.log("item: ",u);const _=u.parsedJson;if(_)switch(A(u.type).full_address){case`${t}::config::InitConfigEvent`:a.admin_cap_id=_.admin_cap_id,a.package_version_id=_.package_version_id;break;case`${t}::factory::InitFactoryEvent`:a.pools_id=_.pools_id;break}}),this.updateCache(n,a,M)),a}async getPurchaseInfo(e,t,n=!0){const i=`${e}_${t}_getPurchaseInfo`,o=this.getCache(i,n);if(o)return o;try{const s=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"address",value:t}}),r=Y.buildPurchaseInfo($(s));return this.updateCache(i,r,De),r}catch{return}}async getLockNFT(e,t=!1){const n=`${e}_getLockNFT`,i=this.getCache(n,t);if(i!==void 0)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}});if(!o.error)return pn(o)}async getLockNFTList(e){var o;const{clmm_pool:t}=this._sdk.ClmmSDK.sdkOptions,{ido:n}=this._sdk.sdkOptions,i=[];try{const s=(o=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{filter:{StructType:`${n.package_id}::lock::LockedNFT<${t.package_id}::position::Position>`},options:{showContent:!0}}))==null?void 0:o.data;for(const r of s){const a=$(r);if(a){const d=a.nft.fields,u={locked_at:Number(a.locked_at),lock_duration:Number(a.lock_duration),lock_nft_id:a.id.id,type:a.nft.type,...d};u.end_lock_time=u.locked_at+u.lock_duration,u.coin_type_a=A(d.coin_type_a.fields.name).full_address,u.coin_type_b=A(d.coin_type_b.fields.name).full_address,u.id=d.id.id,u.tick_lower_index=ke(BigInt(d.tick_lower_index.fields.bits)),u.tick_upper_index=ke(BigInt(d.tick_upper_index.fields.bits)),i.push(u)}}return i}catch(s){return console.log("getLockNFTList:",s),[]}}async creatPool(e){const{ido:t}=this.sdk.sdkOptions;Qs(H(e.coin_type_sale),H(e.coin_type_raise))&&(e.price_min=l(1).div(e.price_max).toNumber(),e.price_max=l(1).div(e.price_min).toNumber());const i=ie.priceRealToFix(Number(e.price),e.sale_decimals,e.raise_decimals),o=D.priceToSqrtPriceX64(l(e.price_min),e.sale_decimals,e.raise_decimals).toString(),s=D.priceToSqrtPriceX64(l(e.price_max),e.sale_decimals,e.raise_decimals).toString(),r=new T,a=l(e.total_supply).add(l(e.total_supply).mul(l(e.liquidity_injection_ratio))).toNumber(),d=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,e.coin_type_sale),u=oe.buildCoinForAmount(r,d,BigInt(a),e.coin_type_sale,!1),_=[r.pure(f(t).admin_cap_id),r.pure(f(t).package_version_id),r.pure(f(t).pools_id),r.pure(H(e.owner)),r.pure(l(i).mul(At).toString()),r.pure(e.total_supply),r.pure(e.complete_raise_limit),r.pure(e.min_purchase_amount),r.pure(e.max_purchase_amount),r.pure(e.start_time),r.pure(e.purchase_duration),r.pure(e.lock_up_duration),r.pure((e.liquidity_injection_ratio*ki).toString()),r.pure(o),r.pure(s),r.pure(e.tick_spacing.toString()),u.targetCoin,r.pure(e.protection_hard_cap.toString()),r.pure(C)],p=[e.coin_type_sale,e.coin_type_raise];return r.moveCall({target:`${t.published_at}::${gr}::create_oversubscribe_pool`,typeArguments:p,arguments:_}),r}async creatPurchasePayload(e){const{ido:t}=this.sdk.sdkOptions,n=new T,i=await this.getPurchaseInfo(e.purchase_handle,this._sdk.ClmmSDK.senderAddress,!1),o=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,e.coin_type_raise),s=oe.buildCoinForAmount(n,o,BigInt(e.raise_amount),e.coin_type_raise,!1),r=[e.coin_type_sale,e.coin_type_raise];let a,d;return i?(d="purchase",a=[n.object(f(t).package_version_id),n.object(e.pool_address),n.object(i.purchase_certificate_id),n.pure(e.raise_amount.toString()),s.targetCoin,n.pure(C)]):(d="create_certificate_and_purchase",a=[n.object(f(t).package_version_id),n.object(e.pool_address),n.pure(e.raise_amount.toString()),s.targetCoin,n.pure(C)]),n.moveCall({target:`${t.published_at}::${_e}::${d}`,typeArguments:r,arguments:a}),n}async redeemPayload(e){const{ido:t}=this.sdk.sdkOptions,n=await this.getPurchaseInfo(e.purchase_handle,this._sdk.ClmmSDK.senderAddress,!1);if(n===void 0)throw Error("get purchase certificate fail");const i=new T,o=[e.coin_type_sale,e.coin_type_raise],s=[i.pure(f(t).package_version_id),i.pure(e.pool_address),i.pure(n.purchase_certificate_id),i.pure(C)];return i.moveCall({target:`${t.published_at}::${_e}::redeem`,typeArguments:o,arguments:s}),i}injectLiquidityPayload(e){const{ido:t}=this.sdk.sdkOptions,{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions,i=new T,o=[e.coin_type_sale,e.coin_type_raise],s=e.is_reverse?"inject_liquidity_with_reverse_clmm_pool":"inject_liquidity_with_forward_clmm_pool",r=[i.pure(f(t).package_version_id),i.pure(e.pool_address),i.pure(f(n).global_config_id),i.pure(e.clmm_pool_address),i.pure(C)];return i.moveCall({target:`${t.published_at}::${_e}::${s}`,typeArguments:o,arguments:r}),i}unPauseInjectLiquidity(e){const{ido:t}=this.sdk.sdkOptions,{integrate:n,clmm_pool:i}=this.sdk.ClmmSDK.sdkOptions,o=new T;o.moveCall({target:`${n.published_at}::${qs}::unpause_pool`,typeArguments:[e.coin_type_a,e.coin_type_b],arguments:[o.object(f(i).global_config_id),o.object(e.clmm_pool_address)]});const s=[e.coin_type_sale,e.coin_type_raise],r=e.is_reverse?"inject_liquidity_with_reverse_clmm_pool":"inject_liquidity_with_forward_clmm_pool",a=[o.object(f(t).package_version_id),o.object(e.pool_address),o.object(f(i).global_config_id),o.object(e.clmm_pool_address),o.object(C)];return o.moveCall({target:`${t.published_at}::${_e}::${r}`,typeArguments:s,arguments:a}),o}async findClmmPoolForLiquidity(e){let t=null,n=!1;const i=await this.sdk.ClmmSDK.Pool.getPoolImmutables();for(const o of i){if(o.coinTypeA===e.coin_type_sale&&o.coinTypeB===e.coin_type_raise&&Number(o.tickSpacing)===e.tick_spacing){t=await this._sdk.ClmmSDK.Pool.getPool(o.poolAddress);break}if(o.coinTypeA===e.coin_type_raise&&o.coinTypeB===e.coin_type_sale&&Number(o.tickSpacing)===e.tick_spacing){t=await this._sdk.ClmmSDK.Pool.getPool(o.poolAddress),n=!0;break}}return t&&(l(t.current_sqrt_price).lessThanOrEqualTo(e.current_sqrt_price_min)||l(t.current_sqrt_price).greaterThanOrEqualTo(e.current_sqrt_price_max))?(console.log("clmmPool: ",t.poolAddress),{is_reverse:n,clmmPool:null}):{is_reverse:n,clmmPool:t}}withdrawPayload(e){const{ido:t}=this.sdk.sdkOptions,n=new T,i=[e.coin_type_sale,e.coin_type_raise],o=[n.object(f(t).package_version_id),n.object(e.pool_address),n.object(C)];return n.moveCall({target:`${t.published_at}::${_e}::withdraw`,typeArguments:i,arguments:o}),n}updateWhitelistCapPayload(e){const{ido:t}=this.sdk.sdkOptions,n=new T,i=[e.coin_type_sale,e.coin_type_raise];return e.add_whites&&e.add_whites.addresses.length>0&&n.moveCall({target:`${t.published_at}::${_e}::add_white_listed_addresses`,typeArguments:i,arguments:[n.object(f(t).admin_cap_id),n.object(f(t).package_version_id),n.object(e.pool_address),n.makeMoveVec({type:"address",objects:e.add_whites.addresses.map(o=>n.pure(ce(o),"address"))}),n.pure(e.add_whites.protection_limit),n.object(C)]}),e.remove_whites&&e.remove_whites.length>0&&n.moveCall({target:`${t.published_at}::${_e}::remove_white_listed_addresses`,typeArguments:i,arguments:[n.object(f(t).admin_cap_id),n.object(f(t).package_version_id),n.object(e.pool_address),n.makeMoveVec({type:"address",objects:e.remove_whites.map(o=>n.pure(ce(o),"address"))}),n.object(C)]}),e.update_whites&&e.update_whites.forEach(o=>{n.moveCall({target:`${t.published_at}::${_e}::update_white_listed_address`,typeArguments:i,arguments:[n.object(f(t).admin_cap_id),n.object(f(t).package_version_id),n.object(e.pool_address),n.object(o.address),n.pure(o.protection_limit),n.object(C)]})}),n}creatCancelPoolPayload(e){const{ido:t}=this.sdk.sdkOptions,n=new T,i=[e.coin_type_sale,e.coin_type_raise],o=[n.pure(f(t).admin_cap_id),n.pure(f(t).package_version_id),n.pure(e.pool_address),n.pure(C)];return n.moveCall({target:`${t.published_at}::${_e}::cancel`,typeArguments:i,arguments:o}),n}updatePoolOwnerPayload(e,t){const{ido:n}=this.sdk.sdkOptions;t=t===void 0?new T:t;const i=[e.coin_type_sale,e.coin_type_raise],o=[t.object(f(n).admin_cap_id),t.object(f(n).package_version_id),t.object(e.pool_address),t.object(e.new_owner),t.object(C)];return t.moveCall({target:`${n.published_at}::${_e}::update_pool_owner`,typeArguments:i,arguments:o}),t}updatePoolDuractionPayload(e,t){const{ido:n}=this.sdk.sdkOptions;t=t===void 0?new T:t;const i=[e.coin_type_sale,e.coin_type_raise],o=[t.object(f(n).admin_cap_id),t.object(f(n).package_version_id),t.object(e.pool_address),t.pure(e.start_time),t.pure(e.purchase_duration),t.pure(e.lock_duration),t.object(C)];return t.moveCall({target:`${n.published_at}::${_e}::update_pool_duration`,typeArguments:i,arguments:o}),t}updateProtectionHardCapPayload(e,t){const{ido:n}=this.sdk.sdkOptions;t=t===void 0?new T:t;const i=[e.coin_type_sale,e.coin_type_raise],o=[t.object(f(n).admin_cap_id),t.object(f(n).package_version_id),t.object(e.pool_address),t.pure(e.protection_hard_cap),t.object(C)];return t.moveCall({target:`${n.published_at}::${_e}::update_protection_hard_cap`,typeArguments:i,arguments:o}),t}unlockNftPayload(e){const{ido:t}=this.sdk.sdkOptions,n=new T,i=[e.nft_type],o=[n.pure(e.lock_nft_id),n.pure(C)];return n.moveCall({target:`${t.published_at}::lock::unlock_nft`,typeArguments:i,arguments:o}),n}async isAdminCap(e){const{ido:t}=this._sdk.sdkOptions,n=`${t.package_id}_${e}_isAdminCap`,i=this.getCache(n);if(i)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:f(t).admin_cap_id,options:{showType:!0,showOwner:!0}});console.log(o);const s=ut(o),r=jt(o);let a=!1;return r&&s&&A(s).source_address===`${t.package_id}::config::AdminCap`&&(a=H(r.AddressOwner)===H(e)),this.updateCache(n,a,M),a}async getWhiteProtectionLimit(e,t,n=!0){const i=`${e}_${t}_getWhiteProtectionLimit`,o=this._sdk.getCache(i,n);if(o)return o;try{const s=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"address",value:t}});if(s&&s.data){const r=$(s);return this._sdk.updateCache(i,r.value),r.value}return}catch{return}}async getWhiteList(e,t){var i;const n={type:"address",value:t};try{const o=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:n}),s=$(o);if(console.log(s),s)return(i=s==null?void 0:s.value)==null?void 0:i.fields}catch{}return{safe_limit_amount:"0",safe_purchased_amount:"0"}}async getAdminAddress(){const{ido:e}=this._sdk.sdkOptions,t=`${f(e).admin_cap_id}_getAdminAddress`,n=this.getCache(t);if(n)return n;const i=await this._sdk.ClmmSDK.fullClient.getObject({id:f(e).admin_cap_id,options:{showType:!0,showOwner:!0}});console.log(i);const o=ut(i),s=jt(i);if(s&&o&&A(o).source_address===`${e.package_id}::config::AdminCap`){const a=H(s.AddressOwner);return this.updateCache(t,a,M),a}return""}updateCache(e,t,n=M){let i=this._cache[e];i?(i.overdueTime=Q(n),i.value=t):i=new xe(t,Q(n)),this._cache[e]=i}getCache(e,t=!1){const n=this._cache[e];if(!t&&(n!=null&&n.isValid()))return n.value;delete this._cache[e]}},wr=class{constructor(e){q(this,"_sdk");q(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getOwnerVeNFT(e,t=!0){const{xtoken:n}=this.sdk.sdkOptions,i=`${e}_getLockUpManagerEvent`,o=this.getCache(i,t);if(o!==void 0)return o;let s;const r=`${n.package_id}::xtoken::VeNFT`;return(await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showDisplay:!0},filter:{StructType:r}})).data.forEach(d=>{const u=A(we(d)).source_address;if(u===r&&d.data&&d.data.content){const{fields:_}=d.data.content;s={...Et(d),id:_.id.id,index:_.index,type:u,xtoken_balance:_.xtoken_balance},this.updateCache(i,s,M)}}),s}async getOwnerLockTokens(e){const{xtoken:t}=this.sdk.sdkOptions,n=[],i=`${t.package_id}::lock_coin::LockedCoin<${this.buileTokenCoinType()}>`,o=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0},filter:{StructType:i}});for(const s of o.data)if(A(we(s)).source_address===i&&s.data){const a=Fe.buildLockToken(s.data.content),d=await this.getLockXToken(a.id);d&&(a.xtoken_amount=d.xtoken_amount),n.push(a)}return n}async getLockToken(e){var n;const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0}});if((n=t.data)!=null&&n.content){const i=Fe.buildLockToken(t.data.content),o=await this.getLockXToken(i.id);return o&&(i.xtoken_amount=o.xtoken_amount),i}}async getOwnerTokenCoins(e){return await this._sdk.ClmmSDK.getOwnerCoinAssets(e,this.buileTokenCoinType())}mintVeNFTPayload(){const{xtoken:e}=this.sdk.sdkOptions,t=new T;return t.moveCall({target:`${e.published_at}::${Je}::mint_venft`,typeArguments:[],arguments:[t.pure(f(e).xtoken_manager_id)]}),t}async convertPayload(e){const{xtoken:t}=this.sdk.sdkOptions,n=new T,i=this.buileTokenCoinType(),o=await oe.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,n,BigInt(e.amount),i);return e.venft_id===void 0?n.moveCall({target:`${t.published_at}::${Je}::mint_and_convert`,typeArguments:[],arguments:[n.object(f(t).lock_manager_id),n.object(f(t).xtoken_manager_id),o,n.pure(e.amount)]}):n.moveCall({target:`${t.published_at}::${Je}::convert`,typeArguments:[],arguments:[n.object(f(t).lock_manager_id),n.object(f(t).xtoken_manager_id),o,n.pure(e.amount),n.pure(e.venft_id)]}),n}redeemLockPayload(e){const{xtoken:t}=this.sdk.sdkOptions,n=new T;return n.moveCall({target:`${t.published_at}::${Je}::redeem_lock`,typeArguments:[],arguments:[n.pure(f(t).lock_manager_id),n.pure(f(t).xtoken_manager_id),n.pure(e.venft_id),n.pure(e.amount),n.pure(e.lock_day),n.pure(C)]}),n}redeemPayload(e){const{xtoken:t}=this.sdk.sdkOptions,n=new T;return n.moveCall({target:`${t.published_at}::${Je}::redeem`,typeArguments:[],arguments:[n.pure(f(t).lock_manager_id),n.pure(f(t).xtoken_manager_id),n.pure(e.venft_id),n.pure(e.lock_id),n.pure(C)]}),n}redeemDividendPayload(e,t){const{xtoken_dividends:n}=this.sdk.sdkOptions,i=new T;return t.forEach(o=>{i.moveCall({target:`${n.published_at}::${Lt}::redeem`,typeArguments:[o],arguments:[i.object(f(n).dividend_manager_id),i.object(e)]})}),i}redeemDividendV2Payload(e,t,n){const{xtoken_dividends:i}=this.sdk.sdkOptions;let o=new T;return t.filter(r=>n.includes(r)).length>0&&(o=this.redeemDividendXTokenPayload(e,o)),t.forEach(r=>{n.includes(r)||o.moveCall({target:`${i.published_at}::${Lt}::redeem_v2`,typeArguments:[r],arguments:[o.object(f(i).dividend_manager_id),o.object(e),o.object(C)]})}),o}redeemDividendXTokenPayload(e,t){const{xtoken_dividends:n,xtoken:i}=this.sdk.sdkOptions,{xtoken_manager_id:o,lock_manager_id:s}=f(i),{dividend_manager_id:r}=f(n);return t=t===void 0?new T:t,t.moveCall({target:`${n.published_at}::${Lt}::redeem_xtoken`,typeArguments:[],arguments:[t.object(s),t.object(o),t.object(r),t.object(e),t.object(C)]}),t}buileTokenCoinType(){return`${this.sdk.sdkOptions.token_faucet.package_id}::token::TOKEN`}buileXTokenCoinType(e=this._sdk.sdkOptions.xtoken.package_id,t="xtoken",n="XTOKEN"){return`${e}::${t}::${n}`}cancelRedeemPayload(e){const{xtoken:t}=this.sdk.sdkOptions,n=new T;return n.moveCall({target:`${t.published_at}::${Je}::cancel_redeem_lock`,typeArguments:[],arguments:[n.pure(f(t).lock_manager_id),n.pure(f(t).xtoken_manager_id),n.pure(e.venft_id),n.pure(e.lock_id),n.pure(C)]}),n}async getInitConfigs(){var r,a;const{package_id:e}=this.sdk.sdkOptions.xtoken,t=`${e}_getInitFactoryEvent`,n=this.getCache(t);if(n!==void 0)return n;const i=(r=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::xtoken::InitEvent`}))==null?void 0:r.data,o={xtoken_manager_id:"",lock_manager_id:"",lock_handle_id:""};i.length>0&&i.forEach(d=>{const u=d.parsedJson;u&&(o.xtoken_manager_id=u.xtoken_manager)});const s=(a=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::locking::InitializeEvent`}))==null?void 0:a.data;return s.length>0&&s.forEach(d=>{const u=d.parsedJson;u&&(o.lock_manager_id=u.lock_manager)}),o.lock_handle_id=(await this.getLockUpManager(o.lock_manager_id)).lock_infos.lock_handle_id,this.updateCache(t,o,M),o}async getLockUpManager(e=f(this.sdk.sdkOptions.xtoken).lock_manager_id,t=!1){const n=`${e}_getLockUpManagerEvent`,i=this.getCache(n,t);if(i!==void 0)return i;const o=await this.sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),s=Fe.buildLockUpManager($(o));return this.updateCache(n,s,M),s}async getLockInfoHandle(e){const t=`${e}_getLockInfoHandle`,n=this.getCache(t);if(n!==void 0)return n;let i="";const o=await this.sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),s=$(o);return s&&(i=s.lock_infos.fields.id.id,this.updateCache(t,i,M)),i}async getDividendConfigs(){var s;const{package_id:e}=this.sdk.sdkOptions.xtoken_dividends,t=`${e}_getDividendManagerEvent`,n=this.getCache(t);if(n!==void 0)return n;const i=(s=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::dividend::InitEvent`}))==null?void 0:s.data,o={dividend_manager_id:"",dividend_admin_id:"",dividend_settle_id:""};return i.length>0&&i.forEach(r=>{const a=r.parsedJson;a&&(o.dividend_manager_id=a.manager_id,o.dividend_admin_id=a.admin_id,o.dividend_settle_id=a.settle_id,this.updateCache(t,o,M))}),o}async getDividendManager(e=!1){const{dividend_manager_id:t}=f(this.sdk.sdkOptions.xtoken_dividends),n=`${t}_getDividendManager`,i=this.getCache(n,e);if(i!==void 0)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),s=$(o),r=Fe.buildDividendManager(s);return this.updateCache(n,r,M),r}async getXcetusManager(e=!0){const{xtoken_manager_id:t}=f(this.sdk.sdkOptions.xtoken),n=`${t}_getXcetusManager`,i=this.getCache(n,e);if(i)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),s=$(o),r={id:s.id.id,index:Number(s.index),has_venft:{handle:s.has_venft.fields.id.id,size:s.has_venft.fields.size},nfts:{handle:s.nfts.fields.id.id,size:s.nfts.fields.size},total_locked:s.total_locked,treasury:s.treasury.fields.total_supply.fields.value};return this.updateCache(n,r),r}async getVeNFTDividendInfo(e,t){try{const n=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),i=$(n);return Fe.buildVeNFTDividendInfo(i)}catch{return}}async redeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const n=await this.getLockUpManager(),i=l(pe).mul(l(n.max_lock_day).sub(l(t))).mul(l(n.max_percent_numerator).sub(l(n.min_percent_numerator))).div(l(n.max_lock_day).sub(l(n.min_lock_day))),o=l(pe).mul(l(n.max_percent_numerator)).sub(i).div(l(Dt)).div(pe);return{amountOut:l(o).mul(l(e)).round().toString(),percent:o.toString()}}async reverseRedeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const n=await this.getLockUpManager(),i=l(pe).mul(l(n.max_lock_day).sub(l(t))).mul(l(n.max_percent_numerator).sub(l(n.min_percent_numerator))).div(l(n.max_lock_day).sub(l(n.min_lock_day))),o=l(pe).mul(l(n.max_percent_numerator)).sub(i).div(l(Dt)).div(pe);return{amountOut:l(e).div(o).toFixed(0,W.ROUND_UP),percent:o.toString()}}async getLockXToken(e){const{lock_handle_id:t}=f(this._sdk.sdkOptions.xtoken),n=`${e}_getXTokenAmount`,i=this.getCache(n);if(i)return i;try{const o=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:t,name:{type:"0x2::object::ID",value:e}}),s=$(o);if(s){const r=s.value.fields.value.fields;return this.updateCache(n,r,M),r}}catch{}}async getVeNftAmount(e,t){try{const n=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),i=$(n);if(i){const{lock_amount:o,xtoken_amount:s}=i.value.fields.value.fields;return{lock_amount:o,xtoken_amount:s}}}catch{}return{lock_amount:"0",xtoken_amount:"0"}}async getPhaseDividendInfo(e,t=!1){const i=(await this.getDividendManager()).dividends.id,o=`${i}_${e}_getPhaseDividendInfo`,s=this._sdk.getCache(o,t);if(s)return s;try{const r=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:i,name:{type:"u64",value:e}}),a=$(r),d=a.value.fields.value.fields,u=d.redeemed_num.fields.contents.map(b=>({name:b.fields.key.fields.name,value:b.fields.value})),_=d.bonus_types.map(b=>b.fields.name),p=d.bonus.fields.contents.map(b=>({name:b.fields.key.fields.name,value:b.fields.value})),m={id:ct(r),phase:a.name,settled_num:d.settled_num,register_time:d.register_time,redeemed_num:u,is_settled:d.is_settled,bonus_types:_,bonus:p,phase_end_time:""};return this.updateCache(o,m),m}catch{}}updateCache(e,t,n=De){let i=this._cache[e];i?(i.overdueTime=Q(n),i.value=t):i=new xe(t,Q(n)),this._cache[e]=i}getCache(e,t=!1){const n=this._cache[e];if(!t&&(n!=null&&n.isValid()))return n.value;delete this._cache[e]}},vr=class{constructor(e){q(this,"_sdk");q(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async addMasterLiquidity(e){var w,v;const{liquidity_stratefy:t}=this._sdk.sdkOptions,{clmm_pool:n}=this._sdk.ClmmSDK.sdkOptions,i=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress);let o=l(0),s=l(0);const r=[],a=[],d=[],u=[],_=[];e.liquidity_bins.forEach((P,O)=>{const U=e.amounts_a[O],R=e.amounts_b[O],F=e.bins_fix_amount_a[O];o=o.add(U),s=s.add(R),r.push(U),a.push(R),d.push(He(BigInt(P.tick_lower)).toString()),u.push(He(BigInt(P.tick_upper)).toString()),_.push(F)});const p=[e.coinTypeA,e.coinTypeB],m=new T,b=(w=oe.buildAddLiquidityFixTokenCoinInput(m,!e.fix_amount_a,o.toString(),e.slippage,e.coinTypeA,i,!1))==null?void 0:w.targetCoin,S=(v=oe.buildAddLiquidityFixTokenCoinInput(m,e.fix_amount_a,s.toString(),e.slippage,e.coinTypeB,i,!1))==null?void 0:v.targetCoin;return fr(e)?m.moveCall({target:`${t.published_at}::router::increase_liquidity`,typeArguments:p,arguments:[m.object(f(t).master_manger_id),m.object(e.master_address),m.object(f(n).global_config_id),m.object(e.pool_address),b,S,m.makeMoveVec({type:"u64",objects:r.map(P=>m.pure(P,"u64"))}),m.makeMoveVec({type:"u64",objects:a.map(P=>m.pure(P,"u64"))}),m.makeMoveVec({type:"bool",objects:_.map(P=>m.pure(P,"bool"))}),m.object(C)]}):m.moveCall({target:`${t.published_at}::router::create_master_liquidity`,typeArguments:p,arguments:[m.object(f(t).master_manger_id),m.object(f(n).global_config_id),m.object(e.pool_address),b,S,m.makeMoveVec({type:"u32",objects:d.map(P=>m.pure(P,"u32"))}),m.makeMoveVec({type:"u32",objects:u.map(P=>m.pure(P,"u32"))}),m.makeMoveVec({type:"u64",objects:r.map(P=>m.pure(P,"u64"))}),m.makeMoveVec({type:"u64",objects:a.map(P=>m.pure(P,"u64"))}),m.makeMoveVec({type:"bool",objects:_.map(P=>m.pure(P,"bool"))}),m.pure(e.strategy),m.pure(He(BigInt(e.tick_lower)).toString()),m.pure(He(BigInt(e.tick_upper)).toString()),m.object(C)]}),m}buildMasterNFTType(){return`${this._sdk.sdkOptions.liquidity_stratefy.package_id}::master_liquidity::MasterLiquidity`}async getMasterNFTList(e,t=[]){const n=[],i=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0},filter:{Package:this._sdk.sdkOptions.liquidity_stratefy.package_id}}),o=t.length>0;for(const s of i.data)if(A(s.data.type).full_address===this.buildMasterNFTType()){const a=Se.buildMasterNFT(s);if(a){const d=`${a.id}_masterNFT`;this.updateCache(d,a,M),o?t.includes(a.pool_id)&&n.push(a):n.push(a)}}return n}async getMasterNFT(e,t=!1){const n="$masterId}_masterNFT",i=this.getCache(n,t);if(i)return i;try{const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}});if(A(o.data.type).full_address===this.buildMasterNFTType()){const r=Se.buildMasterNFT(o);return r&&this.updateCache(n,r,M),r}}catch(o){console.log(o)}}async fetchMasterPositionInfos(e){var a;const t={},{clmm_pool:n,integrate:i,simulationAccount:o}=this.sdk.ClmmSDK.sdkOptions,s=new T;return e.forEach(d=>{d.position_ids.forEach(u=>{const _=[d.coinTypeA,d.coinTypeB],p=[s.object(f(n).global_config_id),s.object(d.pool_id),s.object(u)];s.moveCall({target:`${i.published_at}::${Ze}::fetch_position_fees`,arguments:p,typeArguments:_}),s.moveCall({target:`${i.published_at}::${Ze}::fetch_position_rewards`,arguments:[...p,s.object(C)],typeArguments:_})})}),(a=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:s,sender:o.address})).events)==null||a.forEach(d=>{const{parsedJson:u}=d,{position_id:_}=u;let p=t[_];switch(p===void 0&&(p={position_id:_,feeOwedA:"0",feeOwedB:"0",rewarders:[]},t[_]=p),A(d.type).name){case"FetchPositionFeesEvent":p.feeOwedA=u.fee_owned_a,p.feeOwedB=u.fee_owned_b;break;case"FetchPositionRewardsEvent":p.rewarders=u.data;break}}),t}async getLiquidityStrategyConfigs(e=!1){const{package_id:t}=this._sdk.sdkOptions.liquidity_stratefy,n=`${t}_getLiquidityStrategyConfigst`,i=this.getCache(n,e);if(i!==void 0)return i;const o=(await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t}::master_liquidity::MasterLiquidityManagerCreatedEvent`})).data,s={master_manger_id:"",master_liquidity_handle:""};if(o.length>0){for(const r of o){const a=r.parsedJson;s.master_manger_id=a.id;const d=await this._sdk.ClmmSDK.fullClient.getObject({id:a.id,options:{showContent:!0}}),u=$(d);s.master_liquidity_handle=u.position_maps.fields.id.id;break}this.updateCache(n,s,M)}return s}removeMasterLiquidity(e){const{clmm_pool:t}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:n}=this.sdk.sdkOptions,i=new T,o=[e.coinTypeA,e.coinTypeB];this.collectReward({coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collect_fee:!1,rewarder_coin_types:e.rewarder_coin_types,master_address:e.master_address,pool_address:e.pool_address},i);const s=[i.object(f(n).master_manger_id),i.object(e.pool_address),i.object(e.master_address),i.object(f(t).global_config_id),i.makeMoveVec({type:"u128",objects:e.delta_liquidities.map(r=>i.pure(r,"u128"))}),i.makeMoveVec({type:"u64",objects:e.min_amounts_a.map(r=>i.pure(r,"u64"))}),i.makeMoveVec({type:"u64",objects:e.min_amounts_b.map(r=>i.pure(r,"u64"))}),i.object(C)];return i.moveCall({target:`${n.published_at}::${Ct}::remove_liquidity`,typeArguments:o,arguments:s}),i}closeMasterLiquidity(e){const{clmm_pool:t}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:n}=this.sdk.sdkOptions,i=new T,o=[e.coinTypeA,e.coinTypeB];return this.collectReward({coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collect_fee:!1,rewarder_coin_types:e.rewarder_coin_types,master_address:e.master_address,pool_address:e.pool_address},i),i.moveCall({target:`${n.published_at}::${Ct}::close_master_liquidity`,typeArguments:o,arguments:[i.object(f(n).master_manger_id),i.object(e.master_address),i.object(f(t).global_config_id),i.object(e.pool_address),i.makeMoveVec({type:"u64",objects:e.min_amounts_a.map(s=>i.pure(s,"u64"))}),i.makeMoveVec({type:"u64",objects:e.min_amounts_b.map(s=>i.pure(s,"u64"))}),i.object(C)]}),i}collectFee(e,t){const{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:i}=this.sdk.sdkOptions;t=t===void 0?new T:t;const o=[e.coinTypeA,e.coinTypeB],s=[t.object(f(i).master_manger_id),t.object(e.master_address),t.object(f(n).global_config_id),t.object(e.pool_address)];return t.moveCall({target:`${i.published_at}::${Ct}::collect_fee`,typeArguments:o,arguments:s}),t}collectReward(e,t){const{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:i}=this.sdk.sdkOptions;return t=t===void 0?new T:t,e.collect_fee&&this.collectFee({...e},t),e.rewarder_coin_types.forEach(o=>{const s=[e.coinTypeA,e.coinTypeB,o];if(t){const r=[t.object(f(i).master_manger_id),t.object(e.master_address),t.object(f(n).global_config_id),t.object(e.pool_address),t.object(f(n).global_vault_id),t.object(C)];t.moveCall({target:`${i.published_at}::${Ct}::collect_reward`,typeArguments:s,arguments:r})}}),t}updateCache(e,t,n=De){let i=this._cache[e];i?(i.overdueTime=Q(n),i.value=t):i=new xe(t,Q(n)),this._cache[e]=i}getCache(e,t=!1){const n=this._cache[e],i=n==null?void 0:n.isValid();if(!t&&i)return n.value;i||delete this._cache[e]}},Cr=class{constructor(e){q(this,"_sdk");q(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}buildCoinInput(e,t,n,i,o){const{selectedCoins:s,remainingCoins:r}=G.selectCoinAssetGreaterThanOrEqual(t,BigInt(i)),a=G.calculateTotalBalance(s);if(a<BigInt(i))throw new Error(`The amount(${a}) is Insufficient balance for ${n} , expect ${i} `);const d=a-BigInt(i);let u;if(G.isSuiCoin(n))u=e.splitCoins(e.gas,[e.pure(i)]);else{const[_,...p]=s.map(m=>m.coinObjectId);u=e.object(_),p.length>0?o?e.mergeCoins(u,[...p.map(m=>e.object(m)),o]):e.mergeCoins(u,[...p.map(m=>e.object(m))]):o&&e.mergeCoins(u,[o])}return{selectedUsedAmount:d,coinInput:u,remainingCoins:r}}async deposit(e){var u,_;console.log({params:e});const{vaults:t}=this._sdk.sdkOptions,{clmm_pool:n,integrate:i}=this._sdk.ClmmSDK.sdkOptions,o=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress),s=new T;let r,a;if(e.swapParams){const{swap_amount:p,a2b:m}=e.swapParams,b=m?e.coinTypeA:e.coinTypeB,S=G.getCoinAssets(b,o),{coinInput:w,remainingCoins:v,selectedUsedAmount:P}=this.buildCoinInput(s,S,b,BigInt(p)),O=oe.callMintZeroValueCoin(s,m?e.coinTypeB:e.coinTypeA),U=$e.getDefaultSqrtPriceLimit(m).toString(),R=s.moveCall({target:`${i.published_at}::${it}::swap`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[s.object(f(n).global_config_id),s.object(e.clmm_pool),m?w:O,m?O:w,s.pure(m),s.pure(!0),s.pure(p),s.pure(U),s.pure(!1),s.object(C)]}),F=R[0],E=R[1];if(console.log({selectedUsedAmount:P}),m){const J=BigInt(e.amount_a)-P;G.isSuiCoin(b)?(r=s.splitCoins(s.gas,[s.pure(e.amount_a)]),s.transferObjects([F],s.pure(this._sdk.ClmmSDK.senderAddress))):l(J.toString()).greaterThan(0)?r=this.buildCoinInput(s,v,b,J,F).coinInput:r=F,a=E}else if(r=F,G.isSuiCoin(b))a=s.splitCoins(s.gas,[s.pure(e.amount_b)]),s.transferObjects([E],s.pure(this._sdk.ClmmSDK.senderAddress));else{const J=BigInt(e.amount_b)-P;l(J.toString()).greaterThan(0)?a=this.buildCoinInput(s,v,b,BigInt(e.amount_b)-P,E).coinInput:a=E}}else r=(u=oe.buildAddLiquidityFixTokenCoinInput(s,!e.fix_amount_a,e.amount_a,e.slippage,e.coinTypeA,o,!1))==null?void 0:u.targetCoin,a=(_=oe.buildAddLiquidityFixTokenCoinInput(s,e.fix_amount_a,e.amount_b,e.slippage,e.coinTypeB,o,!1))==null?void 0:_.targetCoin;const d=e.rewarder_coin_types?e.rewarder_coin_types.length:0;if(d>0){const p=["deposit_with_one","deposit_with_two","deposit_with_three"];s.moveCall({target:`${t.published_at}::${Kt}::${p[d-1]}`,typeArguments:[e.coinTypeA,e.coinTypeB,...e.rewarder_coin_types,e.lp_token_type],arguments:[s.object(f(t).vaults_manager_id),s.object(e.vault_id),s.object(f(n).global_config_id),s.object(e.clmm_pool),s.object(f(n).global_vault_id),r,a,s.pure(e.amount_a),s.pure(e.amount_b),s.pure(e.fix_amount_a),s.object(C)]})}else s.moveCall({target:`${t.published_at}::${Kt}::deposit`,typeArguments:[e.coinTypeA,e.coinTypeB,e.lp_token_type],arguments:[s.object(f(t).vaults_manager_id),s.object(e.vault_id),s.object(f(n).global_config_id),s.object(e.clmm_pool),r,a,s.pure(e.amount_a),s.pure(e.amount_b),s.pure(e.fix_amount_a),s.object(C)]});return s}async remove(e){console.log({params:e});const{vaults:t}=this.sdk.sdkOptions,{clmm_pool:n,integrate:i}=this._sdk.ClmmSDK.sdkOptions,o=new T,s=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,e.lp_token_type),r=oe.buildCoinForAmount(o,s,BigInt(e.lp_token_amount),e.lp_token_type,!1).targetCoin,a=[e.coinTypeA,e.coinTypeB,e.lp_token_type],d=e.rewarder_coin_types.length;if(d>0){const u=["remove_with_one","remove_with_two","remove_with_three"];o.moveCall({target:`${t.published_at}::${Kt}::${u[d-1]}`,typeArguments:[e.coinTypeA,e.coinTypeB,...e.rewarder_coin_types,e.lp_token_type],arguments:[o.object(f(t).vaults_manager_id),o.object(e.vault_id),o.object(f(n).global_config_id),o.object(e.clmm_pool),o.object(f(n).global_vault_id),r,o.pure(e.lp_token_amount),o.pure(e.min_amount_a),o.pure(e.min_amount_b),o.object(C)]})}else{const u=o.moveCall({target:`${t.published_at}::${br}::remove`,typeArguments:a,arguments:[o.object(f(t).vaults_manager_id),o.object(e.vault_id),o.object(f(n).global_config_id),o.object(e.clmm_pool),r,o.pure(e.lp_token_amount),o.pure(e.min_amount_a),o.pure(e.min_amount_b),o.object(C)]}),_=u[0],p=u[1];if(e.swapParams){const{a2b:m,swap_amount:b}=e.swapParams,S=$e.getDefaultSqrtPriceLimit(m).toString(),w=o.moveCall({target:`${i.published_at}::${it}::swap`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[o.object(f(n).global_config_id),o.object(e.clmm_pool),_,p,o.pure(m),o.pure(!0),o.pure(b),o.pure(S),o.pure(!0),o.object(C)]});o.transferObjects([w[0],w[1]],o.pure(this._sdk.ClmmSDK.senderAddress))}else o.transferObjects([_,p],o.pure(this._sdk.ClmmSDK.senderAddress))}return o}async getVaultList(e="all"){const{vaults:t}=this._sdk.sdkOptions,n=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t.package_id}::vaults::CreateEvent`},e),i=n.data.map(r=>r.parsedJson.id),o=await this._sdk.ClmmSDK.fullClient.batchGetObjects(i,{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}),s=[];return o.forEach(r=>{const a=Le.buildPool(r);a&&(this.savePoolToCache(a),s.push(a))}),n.data=s,n}savePoolToCache(e){const t=`${e.id}_mirrorPool`;this.updateCache(t,e,M)}readPoolFromCache(e,t=!1){const n=`${e}_mirrorPool`;return this.getCache(n,t)}async calculateMaxAvailable(e){var w;const{integrate:t,simulationAccount:n}=this.sdk.ClmmSDK.sdkOptions,i=new T,o=D.tickIndexToSqrtPriceX64(e.lowerTick),s=D.tickIndexToSqrtPriceX64(e.upperTick),r=new g(e.curSqrtPrice),a=ae.getCoinAmountFromLiquidity(new g(e.input_amount),r,o,s,!1),d=[e.coinTypeA,e.coinTypeB];i.moveCall({target:`${t.published_at}::${Ze}::calculate_swap_result`,arguments:[i.object(e.clmm_pool),i.pure(!0),i.pure(!0),i.pure(a.coinA.toString())],typeArguments:d}),i.moveCall({target:`${t.published_at}::${Ze}::calculate_swap_result`,arguments:[i.object(e.clmm_pool),i.pure(!1),i.pure(!0),i.pure(a.coinB.toString())],typeArguments:d});const _=(w=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:i,sender:n.address})).events)==null?void 0:w.filter(v=>A(v.type).name==="CalculatedSwapResultEvent");if(_.length===0)return null;const p=_[0].parsedJson.data,m=_[1].parsedJson.data,b=l(a.coinB.toString()).add(p.amount_out),S=l(a.coinA.toString()).add(m.amount_out);return{maxAmountB:b,maxAmountA:S}}async calculateRemoveSwapAmount(e){var U;const{ratioA:t,ratioB:n}=Le.calculateDepositRatio(e.lowerTick,e.upperTick,new g(e.curSqrtPrice)),i=l(e.receive_amount).mul(e.fix_amount_a?t:n),o=l(e.receive_amount).sub(i);console.log({receiveAmount:i,otherReceiveAmount:o});const s=ae.estLiquidityAndcoinAmountFromOneAmounts(e.lowerTick,e.upperTick,new g(i.toFixed(0)),e.fix_amount_a,!1,.2,new g(e.curSqrtPrice)),r=e.fix_amount_a?s.coinAmountB.toString():s.coinAmountA.toString();console.log({otherSideAmount:r});const{integrate:a,simulationAccount:d}=this.sdk.ClmmSDK.sdkOptions,u=new T,_=!e.fix_amount_a,p=[u.pure(e.clmm_pool),u.pure(_),u.pure(!0),u.pure(r)],m=[e.coinTypeA,e.coinTypeB];u.moveCall({target:`${a.published_at}::${Ze}::calculate_swap_result`,arguments:p,typeArguments:m});const S=(U=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:u,sender:d.address})).events)==null?void 0:U.filter(R=>A(R.type).name==="CalculatedSwapResultEvent");if(S.length===0)return null;const{data:w}=S[0].parsedJson,v=w.amount_in&&w.fee_amount?new g(w.amount_in).add(new g(w.fee_amount)).toString():"0",P=w.amount_out,{is_exceed:O}=w;return{swapInAmount:v,swapOutAmount:P,liquidity:s.liquidityAmount.toString(),is_exceed:O}}async calculateDepositSwapAmount(e){console.log("calculateDepositSwapAmount params: ",e);const{ratioA:t,ratioB:n}=Le.calculateDepositRatio(e.lowerTick,e.upperTick,new g(e.curSqrtPrice));console.log({ratioA:t,ratioB:n});const i=l(e.input_amount).mul(e.fix_amount_a?t:n),o=l(e.input_amount).sub(i),s=e.fix_amount_a?i:o,r=e.fix_amount_a?o:i,a=e.fix_amount_a,d=e.fix_amount_a?r:s;if(console.log({token_a_amount:s,token_b_amount:r,amount:d}),d.toFixed(0)==="0")return null;const u=await this.clmmPreSwap(e.clmm_pool,a,d,e.coinTypeA,e.coinTypeB,!0),_=u.after_sqrt_price,p=D.sqrtPriceX64ToTickIndex(new g(_));console.log({lowerTick:e.lowerTick,upperTick:e.upperTick,currentTick:p}),p<e.lowerTick||p>e.upperTick;const m=u.amount_in&&u.fee_amount?new g(u.amount_in).add(new g(u.fee_amount)).toString():"0",b=u.amount_out,{is_exceed:S}=u;return{swapInAmount:m,swapOutAmount:b,afterSqrtPrice:_,is_exceed:S,inAmount:u.amount_in}}async calculateRebalance(e){const{clmm_pool:t,a2b:n,curSqrtPrice:i,amount_a:o,amount_b:s,lowerTick:r,upperTick:a,tick_spacing:d,coinTypeA:u,coinTypeB:_}=e,p=D.sqrtPriceX64ToTickIndex(new g(i));console.log({current_index:p,upperTick:a,lowerTick:r,a2b:n});const m=async(w,v,P)=>{const O=w.plus(v).div(2),U=await this.clmmPreSwap(t,n,O,u,_,!1);if(U.is_exceed)return v=O,m(w,v,P+1);const R=n?o.sub(U.amount_in):o.add(U.amount_out),F=n?s.add(U.amount_out):s.sub(U.amount_in),E=D.sqrtPriceX64ToTickIndex(new g(U.after_sqrt_price)),J=ae.estLiquidityAndcoinAmountFromOneAmounts(r,a,new g(R.toString()),!0,!0,1,new g(U.after_sqrt_price));J.liquidityAmount.toString();const ye=new W(J.coinAmountA.toString()),ue=new W(J.coinAmountB.toString());if(console.log({preRes:U,left:w,right:v,mid:O,afterPoolTickIndex:E,afterA:R,afterB:F,usedA:ye,usedB:ue,count:P}),ye.toString()!==R.toString())throw new Error("usedA does not match afterA");if(F.lessThan(ue))n?w=O:v=O;else{n?v=O:w=O;const ve=F.sub(ue);if(console.log({remainingB:ve}),ve.lessThan(new W(10).pow(9)))return console.log("break"),{...U,remainingB:ve}}return w.greaterThan(v)||v.sub(w).lessThan(10)?null:m(w,v,P+1)},b=new W(0);return m(b,n?o:s,0)}async clmmPreSwap(e,t,n,i,o,s){var b;const{integrate:r,simulationAccount:a}=this.sdk.ClmmSDK.sdkOptions,d=new T,u=[i,o],_=[d.pure(e),d.pure(t),d.pure(s),d.pure(n.toFixed(0))];d.moveCall({target:`${r.published_at}::${Ze}::calculate_swap_result`,arguments:_,typeArguments:u});const m=(b=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:d,sender:a.address})).events)==null?void 0:b.filter(S=>A(S.type).name==="CalculatedSwapResultEvent");return m.length===0?null:m[0].parsedJson.data}async getVault(e,t=!1){const n=this.readPoolFromCache(e,t);if(n)return n;try{const i=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}}),o=Le.buildPool(i);if(o)return this.savePoolToCache(o),o}catch(i){console.log(i)}}async getVaultsConfigs(e=!1){const{package_id:t}=this._sdk.sdkOptions.vaults,n=`${t}_getMirrorPoolConfigs`,i=this.getCache(n,e);if(i!==void 0)return i;const o=(await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t}::vaults::InitEvent`})).data,s={admin_cap_id:"",vaults_manager_id:"",vaults_pool_handle:""};if(o.length>0){for(const r of o){const a=r.parsedJson;s.admin_cap_id=a.admin_cap_id,s.vaults_manager_id=a.manager_id;const d=await this._sdk.ClmmSDK.fullClient.getObject({id:s.vaults_manager_id,options:{showContent:!0}}),u=$(d);s.vaults_pool_handle=u.vault_to_pool_maps.fields.id.id;break}this.updateCache(n,s,M)}return s}updateCache(e,t,n=De){let i=this._cache[e];i?(i.overdueTime=Q(n),i.value=t):i=new xe(t,Q(n)),this._cache[e]=i}getCache(e,t=!1){const n=this._cache[e],i=n==null?void 0:n.isValid();if(!t&&i)return n.value;i||delete this._cache[e]}},Or=class{constructor(e,t){q(this,"_cache",{});q(this,"_sdkOptions");q(this,"_launchpad");q(this,"_ido");q(this,"_xcetusModule");q(this,"_xtokenModule");q(this,"_boosterModule");q(this,"_makerModule");q(this,"_clmmSDK");q(this,"_liquidityStrategy");q(this,"_vaults");this._sdkOptions=e,this._clmmSDK=t,this._launchpad=new pr(this),this._ido=new kr(this),this._xcetusModule=new hr(this),this._xtokenModule=new wr(this),this._boosterModule=new _r(this),this._makerModule=new mr(this),this._vaults=new Cr(this),this._liquidityStrategy=new vr(this),pi(this._sdkOptions)}get ClmmSDK(){return this._clmmSDK}get sdkOptions(){return this._sdkOptions}get Launchpad(){return this._launchpad}get Ido(){return this._ido}get XToken(){return this._xtokenModule}get XCetusModule(){return this._xcetusModule}get BoosterModule(){return this._boosterModule}get MakerModule(){return this._makerModule}get LiquidityStrategy(){return this._liquidityStrategy}get Vaults(){return this._vaults}updateCache(e,t,n=M){let i=this._cache[e];i?(i.overdueTime=Q(n),i.value=t):i=new xe(t,Q(n)),this._cache[e]=i}getCache(e,t=!1){const n=this._cache[e];if(!t&&(n!=null&&n.isValid()))return n.value;delete this._cache[e]}};export{Or as C,Y as I,Le as V,qe as X,Ir as a};
