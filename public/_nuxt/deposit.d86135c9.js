import{j as io,n as pt,d as be,e as wt,u as Bt,a as Be,c as ie,s as bt,T as lt,G as no,b as ze,l as Nt,p as qt}from"./pool.acb16d99.js";import{a as ot,r as F,l as A,H as Rt,q as _e,e as it,o as M,f as W,t as Ot,N as ao,h as r,O as ht,v as le,u as me,x as Y,c as We,p as _t,k as Ct,S as Ut,y as jt,m as Pt,K as zt,s as ro,F as kt,E as Mt,i as xe,A as vt,w as ut,j as Tt,P as xt,a2 as lo,b as so,B as uo}from"./entry.59a2cdcc.js";/* empty css              */import{s as ct,m as co,l as mo,b as vo,a as fo}from"./transform.c672907f.js";import{D as a}from"./decimal.0bdeb344.js";import{u as dt,a as go}from"./sha256.fbf47686.js";import{d as Ht,_ as Xt,c as Et,a as Dt,b as po}from"./new-liquidity-title.958fd3ec.js";import{i as yt}from"./import-icon.de3e6c66.js";/* empty css              */import{positionError as et,fromCoin as _,toCoin as k,tickList as Qe,minPrice as I,maxPrice as y,currentPrice as tt,currentPriceReverse as st,direction as oe,currentPriceTab as D,defaultMinPrice as ft,defaultMaxPrice as gt,toggle as Wt,isStableFarmingRange as Ue,isInputTotalAmount as Xe,priceConfigObj as Ye,fromCoinAmount as C,toCoinAmount as S,fixedFromCoin as Le,resetTickList as $t,resetData as bo}from"./data.c28e3264.js";import{u as St}from"./farms.f563d6f2.js";import{_ as ho}from"./coin-lock.b36d7006.js";import{_ as ko}from"./coin-select.bdb54d2e.js";import{_ as yo}from"./viewDetail.c1a76dc3.js";import{a as wo}from"./new-add-or-create.b9f2e053.js";import{u as _o}from"./notifi.e156ed62.js";import{_ as Co,a as Po}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.a28135f4.js";import"./lock.0b3ac653.js";/* empty css              *//* empty css              */import"./token-warning.a0600be1.js";import"./swap-setting.792c9cd4.js";/* empty css              */import"./icon-error_2x.bc5af7b3.js";import"./img-lock_2x.51d46539.js";import"./img-no-Positions_2x.fb84f178.js";import"./img-no-Positions_2x.b6d04572.js";import"./status-block.bce15e4e.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.70f4fa69.js";function Ft(e,d,ve){const ne=new a(10).pow(d-ve);return new a(1.0001).pow(e).mul(ne)}const To=ot({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,d){const ve=F(""),ne=F(""),$=A(()=>{var n,P,m,v,B,ee;return(n=e.poolInfo)!=null&&n.current_sqrt_price&&((P=e.poolInfo)!=null&&P.coinA)&&((m=e.poolInfo)!=null&&m.coinB)?i.sqrtPriceX64ToPrice((v=e.poolInfo)==null?void 0:v.current_sqrt_price,(B=e.poolInfo)==null?void 0:B.coinA.decimals,(ee=e.poolInfo)==null?void 0:ee.coinB.decimals).toString():"0"}),se=A(()=>{let n=0;return e.direction?n=(Number(e.minPrice)/Number($.value)-1)*100:n=(Number(e.minPrice)/Number(1/Number($.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),U=A(()=>{let n=0;return e.direction?n=(Number(e.maxPrice)/Number($.value)-1)*100:n=(Number(e.maxPrice)/Number(1/Number($.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),j=dt(),N=A(()=>j),ae=A(()=>N.value.chainName?wt(N.value.chainName):{}),{TickMath:i,getNearestTickByTick:f}=ae.value,G=(n=[])=>{let P=6;const m=Math.abs(Number(n[0])-Number(n[n.length-1]));return m>=6?P=0:m>=1?P=1:m>=.1?P=2:m>=.01?P=3:m>=.001?P=4:m>=1e-4?P=5:m>=1e-5?P=6:m>=1e-6?P=7:m>=1e-7&&(P=8),P},Ce=(n,P=1)=>{if(n&&n.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const m=Number(e.poolInfo.current_tick_index);console.log("0117###dataProcessing###currentTick###",m),console.log("0117###dataProcessing###props.poolInfo###",e.poolInfo),console.log("0117###dataProcessing###minPrice###",e.minPrice),console.log("0117###dataProcessing###maxPrice###",e.maxPrice),console.log("0117###dataProcessing###poolInfo###",e.poolInfo);let v=m+100*P,B=m-100*P,ee,he;if(e.maxPrice==="∞")he=ae.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?he=i.priceToTickIndex(new a(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):he=i.priceToTickIndex(new a(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{he=443636}if(e.minPrice==="0")ee=ae.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ee=i.priceToTickIndex(new a(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ee=i.priceToTickIndex(new a(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ee=-443636}let Ie=0;if(e.currentPriceTab!=="full range"){if(m>=ee&&m<=he){const L=m-ee,ce=he-m;Ie=Math.max(Math.abs(L),Math.abs(ce))}else m<ee?Ie=Math.abs(he-m):Ie=Math.abs(m-ee);v=m+Ie+100*P,B=m-Ie-100*P}else{const L=(Math.abs(m)>5e3,2e4);v=m+L*P,B=m-L*P}B<-443636&&(B=-443636),v>443636&&(v=443636);const p=new a(n.liquidity).div(Math.pow(10,8)).toString(),q=e.tickList;console.log("0117####drawChart####tick_info_array####",q);const z=[],Pe=[];let w={};for(let L=0;L<q.length;L++){if(w=q[L],w.index<=m&&w.index>=B){if(z.length<1&&L!==0){const ce=q[L-1];z.unshift({...ce,index:B,source:"left"})}z.unshift(w)}else if(w.index>m&&w.index<=v&&(Pe.push(w),z.length<1&&L!==0)){const ce=q[L-1];z.push({...ce,index:B,source:"left"})}if(w.index>v){const ce=q[L];if(Pe.push({...ce,index:v,source:"right"}),z.length<1&&L!==0){const Ke=q[L-1];z.push({...Ke,index:B,source:"left"})}break}}let R="0";for(let L=z.length-1;L>=0;L--)R=new a(R).plus(new a(z[L].liquidityNet.toString()).div(Math.pow(10,8))).toString(),z[L].liquityAmount=R;let K=p;for(let L=0;L<Pe.length;L++)K=new a(K).plus(new a(Pe[L].liquidityNet.toString()).div(Math.pow(10,8))).toString(),Pe[L].liquityAmount=K;let J=[];const O=q&&q.length>0?{index:m,liquityAmount:Number(p)}:{index:m,liquityAmount:0};(z.length>0||Pe.length>0)&&(J=[...z.reverse(),O,...Pe],e.direction||(J=J.reverse()));const je=[];q.forEach(L=>{je.push({...L,liquidityGross:L.liquidityGross.toString(),liquidityNet:L.liquidityNet.toString()})}),console.log("0117####drawChart####testTickInfoArray####",je),console.log("0117####drawChart####currentLiquity####",p),console.log(J,"###chartData"),g(J,B,v,ee,he,m)}};let Ne=F(!1);const ue=F(!1);Rt(()=>{const n=document.body.clientWidth;ue.value=!0,n<750?Ne.value=!1:Ne.value=!0,window.onresize=()=>{document.body.clientWidth<750?Ne.value=!1:Ne.value=!0,console.log("这里执行了吗"),Ce(e.poolInfo,e.zoom)}});const g=(n,P,m,v,B,ee)=>{console.log("0117####drawChart####chartData####",n),console.log("0117####drawChart####tickMin####",P),console.log("0117####drawChart####tickMax####",m),console.log("0117####drawChart####minPriceTick####",v),console.log("0117####drawChart####maxPriceTick####",B),console.log("0117####drawChart####currentTick####",ee),console.log("0117####drawChart####props.direction####",e.direction),console.log("0518###newd3###props.before7dContractPriceLowest###",e.before7dContractPriceLowest),console.log("0518###newd3###props.before7dContractPriceHighest###",e.before7dContractPriceHighest);let he,Ie;e.direction?(he=e.before7dContractPriceLowest?i.priceToTickIndex(new a(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",Ie=e.before7dContractPriceHighest?i.priceToTickIndex(new a(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(he=e.before7dContractPriceLowest?i.priceToTickIndex(new a(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",Ie=e.before7dContractPriceHighest?i.priceToTickIndex(new a(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const p={top:30,right:35,bottom:20,left:80};let q,z;Ne.value?(q=460-p.left-p.right,z=205-p.top-p.bottom):(q=340-p.left-p.right,z=205-p.top-p.bottom);const Pe=m-P,w=parseInt(String(Pe/4));let R=[P+w/4,P+w,P+2*w,m-w,m-w/4];const K=P,J=m,O=q/(J-K);e.currentPriceTab==="full range"&&(R=[P,P+2*w,m]),console.log("0117####drawChart####xArr####",R),console.log("0117####drawChart####utickMin####",K),console.log("0117####drawChart####utickMax####",J),console.log("0117####drawChart####unit####",O);const je=R.map(c=>e.direction?Ft(c,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new a(1).div(Ft(c,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),L=G(je);ct("#chart").selectAll("*").remove();const ce=ct("#chart").attr("width",q+p.left+p.right).attr("height",z+p.top+p.bottom).append("g").attr("transform",`translate(${p.left},${p.right})`),Ke=co(n,function(c){return Number(Math.abs(c.liquityAmount))})||0,$e=mo().range([0,z]).domain([Ke,0]);vo().rangeRound([0,q]).padding(.1);const Ve=ce.append("g").attr("id","barsBox").selectAll("rect").data(n).enter().append("rect");N.value.theme=="default"?Ve.attr("x",function(c,l){return l===0?0:e.direction?Math.abs(c.index-K)*O:Math.abs(J-c.index)*O}).attr("y",function(c,l){return e.direction?l===n.length-1?0:$e(c.liquityAmount):l===n.length-1?0:$e(n[l+1].liquityAmount)}).attr("width",function(c,l){return l===0&&n.length===1&&c.liquityAmount>0?q:(e.direction,l!==n.length-1?Math.abs(n[l+1].index-c.index)*O:0)}).attr("height",function(c,l){return l===0&&n.length===1&&c.liquityAmount>0?z:e.direction?l===n.length-1?0:z-$e(c.liquityAmount):l===n.length-1?0:z-$e(n[l+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):Ve.attr("x",function(c,l){return l===0?0:e.direction?Math.abs(c.index-K)*O:Math.abs(J-c.index)*O}).attr("y",function(c,l){return e.direction?l===n.length-1?0:$e(Math.abs(c.liquityAmount)):l===n.length-1?0:$e(Math.abs(n[l+1].liquityAmount))}).attr("width",function(c,l){return l===0&&n.length===1&&c.liquityAmount>0?q:(e.direction,l!==n.length-1?Math.abs(n[l+1].index-c.index)*O:0)}).attr("height",function(c,l){if(l===0&&n.length===1&&c.liquityAmount>0)return z;if(e.direction)return l===n.length-1?0:Number(c.liquityAmount)?z-$e(Math.abs(c.liquityAmount)):0;{if(l===n.length-1)return 0;const ke=z-$e(Math.abs(n[l+1].liquityAmount));return Number(n[l+1].liquityAmount)?ke:0}}).attr("fill",function(c,l){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(c,l){return"#417494"});const Je=ce.append("g");Je.append("line").attr("x1",0).attr("y1",155).attr("x2",q).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const Ze=Je.append("g");let x=0;if(e.direction){for(let c=0;c<R.length;c++){const l=be(je[c],L)||"0";console.log("0423####price####",l),je.push(l);const ke=Math.abs(R[c]-K)*O;let te=0;for(let ye=0;ye<l.length;ye++)l[ye]==="1"?te+=4.02:l[ye]==="."?te+=2.64:l[ye]==="7"?te+=5.48:te+=6;console.log(ke,"x=>>>"),Ze.append("text").text(l).attr("x",ke-te/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}x=Math.abs(ee-K)*O}else{for(let c=R.length-1;c>=0;c--){const l=be(je[c],L)||0;je.push(l);const ke=Math.abs(R[c]-J)*O;let te=0;for(let ye=0;ye<l.length;ye++)l[ye]==="1"?te+=4.02:l[ye]==="."?te+=2.64:l[ye]==="7"?te+=5.48:te+=6;Ze.append("text").text(l).attr("x",ke-te/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}x=Math.abs(ee-J)*O}console.log(ee,J,O,"######currentPricePositon"),(N.value.theme=="default"?ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+x+", 0)");let t,u,h,T;e.direction?(t=v<K?-100:parseInt(String(Math.abs(v-K)*O)),u=B<K?-100:parseInt(String(Math.abs(B-K)*O)),h=he<K?-100:Math.abs(he-K)*O,T=Ie<K?-100:Math.abs(Ie-K)*O):(u=v<K?-100:Math.abs(J-v)*O,t=B<K?-100:Math.abs(J-B)*O,T=he>J?-100:Math.abs(J-he)*O,h=Ie>J?-100:Math.abs(J-Ie)*O),e.minPrice==="0"&&(t=0),e.maxPrice==="∞"&&(u=q),console.log(t,"==>minPriceTickX"),Ne.value,ve.value=q-t+87+"px",ne.value=u+98+"px",he&&h<q&&ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+h+", 0)"),Ie&&T<q&&ce.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+T+", 0)");const H=ce.append("g").attr("id","left-handle"),X=ce.append("g").attr("id","right-handle");N.value.theme=="default"?(H.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),H.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),H.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),H.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),X.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),X.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),X.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),X.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(H.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),H.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),H.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),H.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),X.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),X.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),X.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),X.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),console.log("0525###d3###select###minPriceTickX###",t),console.log("0525###d3###select###maxPriceTickX###",u),H.attr("transform","translate("+t+", 0)"),X.attr("transform","translate("+u+", 0)");const fe=fo().extent([[0,0],[q,z]]).handleSize(30).on("end",Ee);ce.append("g").attr("class","brush").call(fe).call(fe.move,[t,u]);function Ee(c){if(!c.sourceEvent||!c.selection)return;H.attr("transform","translate("+c.selection[0]+", 0)"),X.attr("transform","translate("+c.selection[1]+", 0)"),Ne.value,ve.value=q-c.selection[0]+87+"px",ne.value=c.selection[1]+74+"px";let l,ke;console.log("0525###d3###select###e.selection[0]###",c.selection[0]),console.log("0525###d3###select###e.selection[0]###",c.selection[1]),console.log("0525###d3###select###props.direction###",e.direction),console.log("0525###d3###select###width###",q),console.log("0525###d3###select###unit###",O),console.log("0525###d3###select###utickMin###",K),console.log("0525###d3###select###utickMax###",J),console.log("0525###d3###select###props.poolInfo###",e.poolInfo);let te=0,ye=0;e.direction?(te=f(parseInt(String(c.selection[0]/O+K)),Number(e.poolInfo.tickSpacing)),l=i.tickIndexToPrice(te,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),ye=f(parseInt(String(c.selection[1]/O+K)),Number(e.poolInfo.tickSpacing)),ke=i.tickIndexToPrice(ye,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),console.log("1114###d3###select###minTick###",te),console.log("1114###d3###select###maxTick###",ye),console.log("1114###d3###select###minPrice###",l),console.log("1114###d3###select###maxPrice###",ke)):(ye=f(J-c.selection[0]/O,Number(e.poolInfo.tickSpacing)),l=1/i.tickIndexToPrice(ye,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),te=f(J-c.selection[1]/O,Number(e.poolInfo.tickSpacing)),ke=1/i.tickIndexToPrice(te,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),d.emit("onChangeMinPrice",String(be(String(l),6))),d.emit("onChangeMaxPrice",String(be(String(ke),6)))}N.value.theme=="default"?ct(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):ct(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632"),console.log("画完了##")};return F(""),_e(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom,e.tickList],([n,P,m,v,B,ee])=>{console.log(n,P,m,m>P,B,"poolInfo && minPrice && maxPrice && (maxPrice > minPrice)"),n&&P&&m&&(n!=null&&n.liquidity)&&(v!=="Custom"||console.log("绘制"),Ce(n,B))},{immediate:!0}),console.log(e,"props===>"),{store:N,loading:ue,rangeSizeLower:se,rangeSizeUpper:U,rangeSizeLowerPosition:ve,rangeSizeUpperPosition:ne,decimalFormat:io,numberformat:pt}}});const So=e=>(_t("data-v-62417b0b"),e=e(),Ct(),e),Io={class:"chart-box"},Ao={class:"chart"},Lo=So(()=>r("svg",{id:"chart"},null,-1));function No(e,d,ve,ne,$,se){const U=Ut;return M(),W("div",Io,[Ot(r("div",Ao,[e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(M(),W("div",{key:0,class:"range-size range-size-lower",style:ht({right:e.rangeSizeLowerPosition})},le(("numberformat"in e?e.numberformat:me(pt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):Y("",!0),e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(M(),W("div",{key:1,class:"range-size range-size-upper",style:ht({left:e.rangeSizeUpperPosition})},le(("numberformat"in e?e.numberformat:me(pt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):Y("",!0),Lo],512),[[ao,!e.chartLoading]]),e.chartLoading?(M(),We(U,{key:0})):Y("",!0)])}const Zt=it(To,[["render",No],["__scopeId","data-v-62417b0b"]]),qo=ot({props:{lever:{type:String,default:""}},setup(){return{}}});const Mo=e=>(_t("data-v-619778e2"),e=e(),Ct(),e),$o={class:"lever"},Fo=Mo(()=>r("div",{class:"lever-title"},"Leverage",-1)),Bo={class:"lever-text"};function Ro(e,d,ve,ne,$,se){return M(),W("div",$o,[Fo,r("div",Bo,le(e.lever),1)])}const Oo=it(qo,[["render",Ro],["__scopeId","data-v-619778e2"]]),Uo=ot({components:{NewLiquidityD3Chart:Zt,NewLiquidityPrice:Ht},setup(){const{t:e,locale:d}=jt(),ve=F("liquidity"),ne=dt(),$=A(()=>ne),se=A(()=>$.value.chainName),U=Bt(),j=A(()=>U),N=A(()=>$.value.chainName?wt($.value.chainName):{});Rt(()=>{et.value=!1});const ae=Pt(),i=A(()=>{let t=null;for(let u=0;u<j.value.poolConfigList.length;u++){const h=j.value.poolConfigList[u];h.address==ae.query.poolAddress&&(t=h)}return console.log(t,"===>basePoolInfo"),t}),f=A(()=>{let t=null;for(const u in j.value.poolsObj){const h=j.value.poolsObj[u];h.address==ae.query.poolAddress&&(console.log(h,"p===>"),t=h)}return t}),G=F(),Ce=F(!0),Ne=async(t,u)=>{if(console.log(Ce.value,"==>chartLoading.value"),Ce.value=!0,u){Qe.value=[],g.value=[],Ue.value=!1;const h=t.token_a.decimals,T=t.token_b.decimals;console.log(t,"pool===>1111"),console.log("poolPrice###pool.current_tick_index####",t.current_tick_index);const H=lt.tickIndexToPrice(t.current_tick_index,h,T);console.log("poolPrice###",H.toString()),tt.value=lt.sqrtPriceX64ToPrice((t==null?void 0:t.current_sqrt_price)||(t==null?void 0:t.object.current_sqrt_price),h,T).toString(),console.log(tt.value,"##currentPrice.value"),st.value=new a(1).div(lt.sqrtPriceX64ToPrice((t==null?void 0:t.current_sqrt_price)||(t==null?void 0:t.object.current_sqrt_price),h,T)).toString(),console.log(st.value,"##currentPriceReverse.value"),_.value=t.needReverse?t.token_b:t.token_a,k.value=t.needReverse?t.token_a:t.token_b,G.value=t.needReverse,t.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===k.value.address.toLowerCase()?oe.value=!0:oe.value=!1,console.log(t,"187===>"),console.log(t,"###pool===>");let X={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const{list:fe,address:Ee}=await N.value.getTicks(X);Qe.value=fe&&Ee==t.address?N.value.getTickDataFromUrlData(fe):[],console.log(Qe.value,"===>chartLoadingtickList.value"),Ce.value=!1,P(t)}},ue=t=>{var T,H;const u=t.token_a.decimals,h=t.token_b.decimals;console.log(t,"pool===>1111"),console.log("poolPrice###pool.current_tick_index####",t.current_tick_index),tt.value=lt.sqrtPriceX64ToPrice((t==null?void 0:t.current_sqrt_price)||((T=t==null?void 0:t.object)==null?void 0:T.current_sqrt_price),u,h).toString(),st.value=new a(1).div(lt.sqrtPriceX64ToPrice((t==null?void 0:t.current_sqrt_price)||((H=t==null?void 0:t.object)==null?void 0:H.current_sqrt_price),u,h)).toString()},g=F([]),n=F(),P=async t=>{const u=t.token_a.decimals,h=t.token_b.decimals;let T=j.value.poolPriceConfigObj&&j.value.poolPriceConfigObj[t.address]&&j.value.poolPriceConfigObj[t.address].recommend_ranges||{};const H=j.value.poolPriceConfigObj&&j.value.poolPriceConfigObj[t.address]&&j.value.poolPriceConfigObj[t.address].type||"";console.log(T,"===>priceConfigList");let X,fe;const Ee=no(t.current_tick_index,t.tickSpacing);n.value=t.current_tick_index,console.log(Ee,t.tickSpacing,"==>pool.tickSpacing"),X=Ee-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),fe=Ee+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const c=N.value.TickMath.tickIndexToPrice(X,u,h).toString(),l=N.value.TickMath.tickIndexToPrice(fe,u,h).toString();T["full range"]={lower:N.value.TickUtil.getMinIndex(Number(f.value.tickSpacing)),upper:N.value.TickUtil.getMaxIndex(Number(f.value.tickSpacing))},T.custom={lower:X,upper:fe,minPrice:c,maxPrice:l};const ke=[];for(let te in T)T[te]&&(console.log(te,"j==>"),ke.push({...T[te],key:te}));console.log(ke,"priceList"),console.log(t,"###pool.type 504"),H&&ke&&ke.length>2?t.isSelfBuilt?D.value="custom":H=="stable"?D.value="suggested":D.value="passive":D.value="custom",g.value=ke||{},Ye.value=T,B({key:D.value,...T[D.value]})},m=F(""),v=F(""),B=t=>{console.log("priceTab====>",t),console.log("priceTab###poolInfo###",f.value),D.value=t.key.toLowerCase();const u=f.value.token_a.decimals,h=f.value.token_b.decimals,{lower:T,upper:H}=t;Xe.value=!1;const X=N.value.TickMath.tickIndexToPrice(T,u,h).toString(),fe=N.value.TickMath.tickIndexToPrice(H,u,h).toString();if(t.key=="full range"){m.value=T,v.value=H,ee();return}console.log(oe.value,"===>direct.value"),oe.value?(ft.value=String(X),I.value=String(X),gt.value=String(fe),y.value=String(fe),m.value=T,v.value=H):(ft.value=new a(1).div(new a(fe)).toString(),I.value=new a(1).div(new a(fe)).toString(),gt.value=new a(1).div(new a(X)).toString(),y.value=new a(1).div(new a(X)).toString(),m.value=N.value.TickMath.priceToTickIndex(new a(1/Number(fe)),u,h),v.value=N.value.TickMath.priceToTickIndex(new a(1/Number(X)),u,h)),console.log(I.value,y.value,"===>111")},ee=t=>{I.value="0",y.value="∞"};_e(()=>f.value,(t,u)=>{console.log(u,"===>oldVal"),console.log(t,"===>newVal"),(!u&&t&&!ie(t)||u&&t&&u.address!==t.address)&&(console.log("池子信息"),Ne(t,!u||t.address!==u.address)),t&&!ie(t)&&ue(t),t||(Qe.value=[])},{immediate:!0}),zt(()=>{_.value=F(),k.value=F(),Qe.value=[]}),_e(()=>[i.value,f.value,j.value.recommendRangesObj],(t,u)=>{var h,T;console.log(t,"===>newValue369"),console.log(u,"===>oldValue369"),(!u||t[0]&&t[1]&&t[2]&&!ie(t[0])&&!ie(t[1]&&!ie(t[2]))||((h=t[0])==null?void 0:h.address)!==((T=u[0])==null?void 0:T.address))&&t[0]&&t[2]&&!ie(t[0])&&!ie(t[2])&&(console.log(t[0],t[2],"======>374"),U.setSinglePool(t[0],t[2],se.value))},{immediate:!0,deep:!0});const he=t=>{if(se.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},Ie=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},p=t=>{var h,T;const u=j.value.poolPriceConfigObj&&j.value.poolPriceConfigObj[(h=f.value)==null?void 0:h.address]&&j.value.poolPriceConfigObj[(T=f.value)==null?void 0:T.address].type||"";if(console.log(u,t,"==>poolType"),g.value.length>2)if(u=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}else if(u=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"full range":return{top:"35%"};case"custom":return{top:"60%"}}},q=F(1),z=()=>{const t=q.value/2;q.value=t},Pe=()=>{const t=q.value*2;q.value=t};console.log(g.value,"==>priceTablList");const w=A(()=>{var t,u,h;return!f.value||ie($.value.addressHistTokens)||!$.value.addressHistTokens[(t=f.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((h=$.value.addressHistTokens[(u=f.value)==null?void 0:u.poolAddress])==null?void 0:h.data.map(T=>[T.key,T.value]))}),R=F(30),K=F("30D"),J=A(()=>oe.value?w.value&&be(R.value==7?w.value.before_7_d_contract_price_lowest:R.value==24?w.value.before_24_h_contract_price_lowest:w.value.before_30_d_contract_price_lowest,6)||0:w.value&&be(new a(1).div(R.value==7?w.value.before_7_d_contract_price_highest:R.value==24?w.value.before_24_h_contract_price_highest:w.value.before_30_d_contract_price_highest).toString(),6)||0),O=A(()=>oe.value?w.value&&be(R.value==7?w.value.before_7_d_contract_price_highest:R.value==24?w.value.before_24_h_contract_price_highest:w.value.before_30_d_contract_price_highest,6)||0:(w.value&&be(1/Number(R.value==7?w.value.before_7_d_contract_price_lowest:R.value==24?w.value.before_24_h_contract_price_lowest:w.value.before_30_d_contract_price_lowest),6))==1/0?0:w.value&&be(1/Number(R.value==7?w.value.before_7_d_contract_price_lowest:R.value==24?w.value.before_24_h_contract_price_lowest:w.value.before_30_d_contract_price_lowest),6)||0),je=A(()=>{const t=Number(I.value),u=Number(y.value);if(I.value=="0"&&y.value=="∞"||D.value=="full range")return"1x";if(I.value==y.value||D.value=="full range")return"--";if(I.value&&y.value&&I.value!=="0"&&y.value!=="∞"){const h=bt(1/(1-Number((t/u)**.25)),2);return Number(h)>0?h+"x":"--"}else return 1}),L=A(()=>{var t,u,h,T,H,X;return((t=_.value)==null?void 0:t.isSelfBuilt)||((u=k.value)==null?void 0:u.isSelfBuilt)||((T=j.value.tokensObj[(h=_.value)==null?void 0:h.address])==null?void 0:T.isSelfBuilt)||((X=j.value.tokensObj[(H=k.value)==null?void 0:H.address])==null?void 0:X.isSelfBuilt)}),ce=(t,u)=>{console.log(t,"####0731 priceRangeChangeMin"),t!==I.value&&D.value=="full range"?(console.log(g.value,"===>priceTablList"),B({key:"custom",...g.value.custom})):D.value!=="full range"&&D.value!=="custom"?(D.value="custom",I.value=t):I.value=t,x.value&&(Ue.value?(oe.value&&I.value!==x.value.minPrice&&(Ue.value=!1),!oe.value&&Number(I.value)!==1/Number(x.value.maxPrice)&&(Ue.value=!1)):(oe.value&&I.value==x.value.minPrice&&y.value==x.value.maxPrice&&(Ue.value=!0),!oe.value&&Number(I.value)==1/Number(x.value.maxPrice)&&Number(y.value)==1/Number(x.value.minPrice)&&(Ue.value=!0)))},Ke=(t,u)=>{console.log(t,"###priceRangeChangeMax maxPirce"),t!==y.value&&D.value=="full range"?B({key:"custom",...g.value.custom}):D.value!=="full range"&&D.value!=="custom"?(D.value="custom",t=="0"?y.value="∞":y.value=t):t=="0"?y.value="∞":y.value=t,x.value&&(Ue.value?(oe.value&&y.value!==x.value.maxPrice&&(Ue.value=!1),!oe.value&&Number(y.value)!==1/Number(x.value.minPrice)&&(Ue.value=!1)):(oe.value&&I.value==x.value.minPrice&&y.value==x.value.maxPrice&&(Ue.value=!0),!oe.value&&Number(I.value)==1/Number(x.value.maxPrice)&&Number(y.value)==1/Number(x.value.minPrice)&&(Ue.value=!0)))};console.log(I.value,y.value,"683==>"),_e(()=>[I.value,y.value],([t,u])=>{console.log(t,u,"minmax new-liquidity-left")},{deep:!0,immediate:!0});const $e=t=>{var u;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((u=j.value.tokensObj[t==null?void 0:t.address])==null?void 0:u.logo_url)||($.value.theme==="default"?yt("/image/coins/unknown.png"):yt("/image/coins/sui-unknown.png"))},nt=t=>{switch(t){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}},Ve=[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}],Je=St(),Ze=A(()=>Je),x=A(()=>{var t;return Ze.value.farmsPoolObj[(t=f==null?void 0:f.value)==null?void 0:t.address]}),at=A(()=>j.value.poolPriceConfigObj);return _e(()=>[Ue.value,f.value,g.value,at.value,x.value,oe.value],(t,u)=>{var h,T;if(console.log(x,oe,"##farmsPoolInfo"),t[0]&&t[4]&&!ie(t[4]))D.value="custom",I.value=t[5]?t[4].minPrice:String(1/t[4].maxPrice),y.value=t[5]?t[4].maxPrice:String(1/t[4].minPrice),console.log(I.value,y.value,"###1195");else if(t[1]&&!ie(t[1])&&t[2]&&!ie(t[2])&&t[3]&&!ie(t[3])&&t[4]&&!ie(t[4])){const H=t[3]&&t[3][(h=t[1])==null?void 0:h.address]&&t[3][(T=t[1])==null?void 0:T.address].type||"",X=t[2].filter(fe=>fe.key===(t[2].length==4?"passive":"suggested"));console.log(H,"##poolType"),X!=null&&X[0]&&(!u||u[0]!==t[0])&&B({...X[0]})}},{immediate:!0}),{positionError:et,getCoinIcon:$e,chainName:se,store:$,currentTab:ve,currentPrice:tt,currentPriceReverse:st,fromCoin:_,toCoin:k,direction:oe,needReverse:G,addCommom:Be,decimalUi:be,priceTablList:g,currentPriceTab:D,sliderStyle:p,poolInfo:f,tickList:Qe,getPriceTabImage:he,getPriceTabText:Ie,defaultMinPrice:ft,defaultMaxPrice:gt,minPrice:I,maxPrice:y,currentTick:n,chartLoading:Ce,zoomOut:z,zoomIn:Pe,zoom:q,priceTab:B,before7dContractPriceLowest:J,before7dContractPriceHighest:O,aprRewardsTime:K,lever:je,aprRewardsParameter:R,isSelfBuilt:L,priceRangeChangeMin:ce,priceRangeChangeMax:Ke,toggle:Wt,getPirceTabTips:nt,timeList:Ve,farmsPoolInfo:x,checkNullObj:ie,isStableFarmingRange:Ue}}}),Gt=""+globalThis.__publicAssetsURL("sui-image/icon_sel@2x.png");const jo={class:"new-liquidity-left"},zo=r("span",{class:"selectRange"},"Select Range",-1),xo={class:"price-info"},Ho={class:"left"},Xo={class:"base-coin"},Eo={class:"base-coin-title"},Do=r("span",null,"Base coin",-1),Wo=r("svg",{class:"icon icon-up","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_up1"})],-1),Zo=r("svg",{class:"icon icon-down","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_down1"})],-1),Go=[Wo,Zo],Ko={class:"base-coin-bottom"},Jo={alt:""},Qo={class:"current-price"},Yo=r("div",{class:"current-price-title"},"Current Price",-1),Vo={key:0,class:"from-pre-to"},ei={class:"right"},ti={class:"price-range"},oi={class:"left"},ii={class:"price-slider"},ni={class:"slider"},ai=r("div",{class:"slider-ratio-content"},null,-1),ri=[ai],li={class:"price-tab-list"},si=["onClick"],ui=["src"],ci={class:"right"},di={class:"price-zoom"},mi={class:"current-price"},vi=r("div",{class:"current-price-title"},"Current Price",-1),fi={key:0,class:"from-pre-to"},gi={class:"price-zoom-right"},pi={class:"leverage"},bi=r("div",{class:"left"},null,-1),hi={class:"right"},ki={class:"right-time"},yi={key:0,class:"day-7-price-range"},wi=r("i",null,null,-1),_i={class:"gray"},Ci={class:"time-list"},Pi=["onClick"],Ti={class:"right-price-h5"},Si={key:0,class:"stable-farming-range"},Ii={key:0,src:Gt,alt:""},Ai={class:"apr-leverage"},Li={key:0,class:"position-tips"},Ni=["src"],qi={class:"error"};function Mi(e,d,ve,ne,$,se){var f,G,Ce,Ne,ue,g,n,P,m;const U=xt,j=Zt,N=Oo,ae=Ht,i=ro("image");return M(),W("div",jo,[zo,r("div",xo,[r("div",Ho,[r("div",Xo,[r("div",Eo,[Do,r("div",{class:"change-price",onClick:d[0]||(d[0]=(...v)=>e.toggle&&e.toggle(...v))},Go)]),r("div",Ko,[Ot(r("img",Jo,null,512),[[i,e.getCoinIcon(e.fromCoin)]]),r("span",null,le((f=e.fromCoin)==null?void 0:f.symbol),1)])]),r("div",Qo,[Yo,r("div",null,[r("span",null,le(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:me(Be))(("decimalUi"in e?e.decimalUi:me(be))(e.currentPrice,6)):("addCommom"in e?e.addCommom:me(Be))(("decimalUi"in e?e.decimalUi:me(be))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(M(),W("span",Vo,le((G=e.toCoin)==null?void 0:G.symbol)+" per "+le((Ce=e.fromCoin)==null?void 0:Ce.symbol),1)):Y("",!0)])])]),r("div",ei,[e.currentTab=="liquidity"?(M(),W("div",{key:0,class:"zoom-out",onClick:d[1]||(d[1]=(...v)=>e.zoomOut&&e.zoomOut(...v))}," + ")):Y("",!0),e.currentTab=="liquidity"?(M(),W("div",{key:1,class:"zoom-in",onClick:d[2]||(d[2]=(...v)=>e.zoomIn&&e.zoomIn(...v))}," - ")):Y("",!0)])]),r("div",ti,[r("div",oi,[r("div",ii,[r("div",ni,[r("div",{class:"slider-ratio",style:ht(e.sliderStyle(e.currentPriceTab))},ri,4)])]),r("div",li,[(M(!0),W(kt,null,Mt(e.priceTablList,v=>(M(),W("div",{key:v.key,class:vt(["price-tab-item",e.currentPriceTab==v.key?"price-tab-item-active":""]),onClick:B=>e.priceTab(v)},[xe(U,{placement:"bottom","arrow-point-at-center":""},{title:ut(()=>[Tt(le(e.getPirceTabTips(v.key)),1)]),default:ut(()=>[r("img",{src:e.getPriceTabImage(v.key),alt:""},null,8,ui),r("span",null,le(e.getPriceTabText(v.key)),1)]),_:2},1024)],10,si))),128))])]),r("div",ci,[r("div",di,[r("div",mi,[vi,r("div",null,[r("span",null,le(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:me(Be))(("decimalUi"in e?e.decimalUi:me(be))(e.currentPrice,6)):("addCommom"in e?e.addCommom:me(Be))(("decimalUi"in e?e.decimalUi:me(be))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(M(),W("span",fi,le(e.direction&&!e.needReverse?`${(Ne=e.fromCoin)==null?void 0:Ne.symbol} per ${(ue=e.toCoin)==null?void 0:ue.symbol}`:`${(g=e.toCoin)==null?void 0:g.symbol} per ${(n=e.fromCoin)==null?void 0:n.symbol}`),1)):Y("",!0)])]),r("div",gi,[e.currentTab=="liquidity"?(M(),W("div",{key:0,class:"zoom-out",onClick:d[3]||(d[3]=(...v)=>e.zoomOut&&e.zoomOut(...v))}," + ")):Y("",!0),e.currentTab=="liquidity"?(M(),W("div",{key:1,class:"zoom-in",onClick:d[4]||(d[4]=(...v)=>e.zoomIn&&e.zoomIn(...v))}," - ")):Y("",!0)])]),e.poolInfo?(M(),We(j,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):Y("",!0)])]),r("div",pi,[bi,r("div",hi,[r("div",ki,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(M(),W("div",yi,[wi,r("span",_i,le(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),r("span",null,le(("addCommom"in e?e.addCommom:me(Be))(("decimalUi"in e?e.decimalUi:me(be))(e.before7dContractPriceLowest,6)))+" - "+le(("addCommom"in e?e.addCommom:me(Be))(("decimalUi"in e?e.decimalUi:me(be))(e.before7dContractPriceHighest,6))),1)])):Y("",!0),r("div",Ci,[(M(!0),W(kt,null,Mt(e.timeList,v=>(M(),W("div",{key:v.value,class:vt(["time-item",v.value==e.aprRewardsParameter?"time-item-active":""]),onClick:B=>e.aprRewardsParameter=v.value},le(v.label),11,Pi))),128))])]),r("div",Ti,[r("span",null,le(("addCommom"in e?e.addCommom:me(Be))(("decimalUi"in e?e.decimalUi:me(be))(e.before7dContractPriceLowest,6)))+" - "+le(("addCommom"in e?e.addCommom:me(Be))(("decimalUi"in e?e.decimalUi:me(be))(e.before7dContractPriceHighest,6))),1)])])]),e.farmsPoolInfo&&!("checkNullObj"in e?e.checkNullObj:me(ie))(e.farmsPoolInfo)&&e.fromCoin&&e.toCoin?(M(),W("div",Si,[r("span",null," Farm rewards range："+le(("decimalUi"in e?e.decimalUi:me(be))(e.direction?e.farmsPoolInfo.minPrice:1/e.farmsPoolInfo.maxPrice,6))+" - "+le(("decimalUi"in e?e.decimalUi:me(be))(e.direction?e.farmsPoolInfo.maxPrice:1/e.farmsPoolInfo.minPrice,6))+" "+le((P=e.toCoin)==null?void 0:P.symbol)+" per "+le((m=e.fromCoin)==null?void 0:m.symbol),1),r("div",{class:"check-box-active",onClick:d[5]||(d[5]=v=>e.isStableFarmingRange=!e.isStableFarmingRange)},[e.isStableFarmingRange?(M(),W("img",Ii)):Y("",!0)])])):Y("",!0),r("div",{class:vt(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[r("div",Ai,[xe(N,{lever:e.lever},null,8,["lever"])]),xe(ae,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(M(),W("div",Li,[r("img",{src:("importIcon"in e?e.importIcon:me(yt))("/image/icon-tips-error@2x.png"),alt:""},null,8,Ni),r("p",qi,le(e.$t("tips.positionError")),1)])):Y("",!0)],2)])}const Kt=it(Uo,[["render",Mi]]),$i=ot({props:{poolInfo:{type:Object,default:()=>({})},isActive:{type:Boolean,default:!0}},setup(e,d){const ve=St(),ne=F(!1),$=F(),se=F(!0),U=A(()=>ve),j=A(()=>U.value.farmsPoolList.filter(i=>i.status=="Live"));_e(()=>e.poolInfo,i=>{i&&!ie(i)&&ve.getFarmsPoolList()},{immediate:!0});const N=i=>{const f=i.filter(G=>{var Ce;return G.status=="Live"&&G.clmm_pool_id==((Ce=e.poolInfo)==null?void 0:Ce.poolAddress)});f&&f.length>0?(ne.value=!0,$.value=f[0],d.emit("sendFarmsPoolInfo",se.value&&e.isActive?$.value:"")):ne.value=!1,console.log(f,"##isFarmingPool")};return _e(()=>j.value,i=>{i&&i.length>0&&N(i)},{immediate:!0}),_e(()=>[e.isActive,se.value,$.value],([i,f,G])=>{console.log(i,f,"##props.isActive"),d.emit("sendFarmsPoolInfo",f&&e.isActive?G:"")},{immediate:!0}),{isShowAutoStake:ne,changeIsOpen:()=>{se.value=!se.value,d.emit("sendFarmsPoolInfo",se.value&&e.isActive?$.value:"")},isOpen:se}}}),Fi=""+globalThis.__publicAssetsURL("sui-image/farming_huo.png");const It=e=>(_t("data-v-fb4559d6"),e=e(),Ct(),e),Bi={key:0,class:"farms-auto-stake"},Ri=It(()=>r("img",{class:"farms-icon",src:Fi,alt:""},null,-1)),Oi=It(()=>r("div",{class:"desc"},"Automatically stake your position into the farm to enjoy higher yield.",-1)),Ui={key:0,src:Gt,alt:""},ji=It(()=>r("div",{class:"check-box"},null,-1));function zi(e,d,ve,ne,$,se){const U=xt;return e.isShowAutoStake?(M(),W("div",Bi,[Ri,Oi,e.isActive?(M(),W("div",{key:0,class:"check-box-active",onClick:d[0]||(d[0]=(...j)=>e.changeIsOpen&&e.changeIsOpen(...j))},[e.isOpen?(M(),W("img",Ui)):Y("",!0)])):(M(),We(U,{key:1,"overlay-style":{"min-width":"200px"}},lo({default:ut(()=>[ji]),_:2},[e.isActive?void 0:{name:"title",fn:ut(()=>[Tt("Farming rewards only available for active positions.")]),key:"0"}]),1024))])):Y("",!0)}const xi=it($i,[["render",zi],["__scopeId","data-v-fb4559d6"]]),Hi=ot({components:{NewLiquidityTitle:Xt,NewLiquidityAssetsCard:Et,NewLiquidityDepositRatio:Dt},setup(){const{t:e,locale:d}=jt(),ve=dt(),ne=A(()=>ve),$=A(()=>ne.value.chainName),se=Bt(),U=A(()=>se),j=go(),N=A(()=>j),ae=Pt(),i=A(()=>{let o=null;for(const s in U.value.poolsObj){const b=U.value.poolsObj[s];b.address==ae.query.poolAddress&&(console.log(b,"p===>"),o=b)}return o}),f=F(!1),G=F(!1),Ce=A(()=>ne.value.theme),Ne=async(o,s)=>{_.value=o.needReverse?o.token_b:o.token_a,k.value=o.needReverse?o.token_a:o.token_b,C.value="",S.value=""},ue=A(()=>N.value.assets&&_.value&&N.value.assets[_.value.address]?qt(N.value.assets[_.value.address].balance,_.value.decimals):"0"),g=A(()=>N.value.assets&&k.value&&N.value.assets[k.value.address]?qt(N.value.assets[k.value.address].balance,k.value.decimals):"0"),n=o=>{o==="fromCoin"?(Le.value=!0,$.value==="Aptos"?C.value=Number(ue.value)>0?_.value.symbol=="APT"?new a(Number(ue.value)).sub(new a(.1)).lt(new a(0))?"0":new a(Number(ue.value)).sub(new a(.1)).toString():String(ue.value):"":C.value=Number(ue.value)>0?_.value.symbol=="SUI"?new a(Number(ue.value)).sub(new a(.05)).lt(new a(0))?"0":new a(Number(ue.value)).sub(new a(.05)).toString():String(ue.value):""):(Le.value=!1,$.value==="Aptos"?S.value=Number(g.value)>0?k.value.symbol=="APT"?new a(Number(g.value)).sub(new a(.1)).lt(new a(0))?"0":new a(Number(g.value)).sub(new a(.1)).toString():String(g.value):"":S.value=Number(g.value)>0?k.value.symbol=="SUI"?new a(Number(g.value)).sub(new a(.05)).lt(new a(0))?"0":new a(Number(g.value)).sub(new a(.05)).toString():String(g.value):"")},P=o=>{o==="fromCoin"?(Le.value=!0,C.value=Number(ue.value)>0?bt(new a(Number(ue.value)).div(2).toString(),_.value.decimals).toString():""):(Le.value=!1,S.value=Number(g.value)>0?bt(new a(Number(g.value)).div(2).toString(),k.value.decimals).toString():"")},m=F(),v=F(),B=F(),ee=F(!1),he=o=>{var s,b,ge,E;m.value=o,o==="fromCoin"?(v.value=((s=k.value)==null?void 0:s.address)||"",B.value=ae.query.actions=="new-position"?(b=_.value)==null?void 0:b.address:i.value.needReverse?i.value.token_b.address:i.value.token_a.address):(v.value=((ge=_.value)==null?void 0:ge.address)||"",B.value=ae.query.actions=="new-position"?(E=k.value)==null?void 0:E.address:i.value.needReverse?i.value.token_a.address:i.value.token_b.address),ee.value=!0,console.log(ee.value,"==>showCoinSelect.value ")},Ie=o=>{var ge,E,de,pe,re,V,Q,Te;const s=i.value.needReverse?i.value.token_b:i.value.token_a,b=i.value.needReverse?i.value.token_a:i.value.token_b;m.value==="fromCoin"?(((ge=_.value)==null?void 0:ge.address)===(s==null?void 0:s.address)||!((E=_.value)!=null&&E.address)?(k.value&&o.address.toLowerCase()===((de=k)==null?void 0:de.value.address.toLowerCase())&&(k.value=null),_.value=o):(_.value&&o.address.toLowerCase()===((pe=_)==null?void 0:pe.value.address.toLowerCase())&&(_.value=null),k.value=o),ae.query.action||(ae.query.fee="")):((re=k.value)==null?void 0:re.address)===(b==null?void 0:b.address)||!((V=k.value)!=null&&V.address)?(_.value&&o.address.toLowerCase()===((Q=_)==null?void 0:Q.value.address.toLowerCase())&&(_.value=null),k.value=o):(k.value&&o.address.toLowerCase()===((Te=k)==null?void 0:Te.value.address.toLowerCase())&&(k.value=null),_.value=o),ee.value=!1},p=A(()=>ne.value.chainName?wt(ne.value.chainName):{}),q=A(()=>ne.value.slippage),z=F(),Pe=async()=>{var Oe,qe,Me,Re;if(Xe.value)return console.log("跳出"),!1;if(!I.value&&!y.value)return!1;if(!C.value&&!S.value&&!I.value&&!y.value)return;const o=i.value||{};if(ie(o))return;const{TickUtil:s,TickMath:b,getNearestTickByTick:ge}=p.value,E=o==null?void 0:o.token_a.decimals,de=o==null?void 0:o.token_b.decimals;let pe,re,V,Q,Te,Fe,He,De,we=o==null?void 0:o.current_tick_index,Z;if(o.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===k.value.address.toLowerCase()?Z=!0:Z=!1,I.value==="0"&&y.value==="∞")V=s.getMinIndex(Number(o.tickSpacing)),Q=s.getMaxIndex(Number(o.tickSpacing)),Te=b.tickIndexToSqrtPriceX64(V),Fe=b.tickIndexToSqrtPriceX64(Q),console.log(V,Q,"#######updateAmounts 513");else if(D.value=="custom"){console.log(Z,"===>directs1866"),Z?(pe=I.value,re=y.value):(pe=y.value!=="∞"?new a(1).div(y.value).toString():1/0,re=new a(1).div(I.value).toString());try{He=new a(pe).equals(new a(0))?-443636:b.priceToTickIndex(new a(pe),E,de)}catch{He=-443636}try{De=b.priceToTickIndex(new a(re),E,de)}catch{De=443636}console.log("1113###updateAmounts###min###",pe),console.log("1113###updateAmounts###max###",re),console.log("1113###updateAmounts###minTick###",He),console.log("1113###updateAmounts###maxTick###",De),V=ge(He,Number(o.tickSpacing),!0),Q=ge(De,Number(o.tickSpacing),!0),console.log("1113###updateAmounts###tick_lower###",V),console.log("1113###updateAmounts###tick_upper###",Q);try{Te=b.priceToSqrtPriceX64(new a(pe),E,de)}catch{(re===1/0||re==="∞")&&(Te=b.tickIndexToSqrtPriceX64(s.getMinIndex(Number(o.tickSpacing))))}try{Fe=b.priceToSqrtPriceX64(new a(re),E,de)}catch{console.log("0523###test###max###",re),(re===1/0||re==="∞")&&(console.log("0523###test###max###11111"),Fe=b.tickIndexToSqrtPriceX64(s.getMaxIndex(Number(o.tickSpacing))))}console.log("0518###pre###tick_lower###",V,Q,we),console.log("0518###pre###tick_upper###",Q)}else V=(Oe=Ye.value[D.value])==null?void 0:Oe.lower,Q=(qe=Ye.value[D.value])==null?void 0:qe.upper,Te=b.tickIndexToSqrtPriceX64(V),Fe=b.tickIndexToSqrtPriceX64(Q);if(console.log("1116###updateAmounts###tick_lower####",V),console.log("1116###updateAmounts###tick_upper####",Q),console.log("1116###updateAmounts###currentTickIndex####",we),y.value!=="∞"&&V>=Q){f.value=!0,C.value="",G.value=!0,S.value="";return}if(console.log(Q,we,V,"1922"),y.value==="∞"||we>=V&&we<Q){f.value=!1,G.value=!1;let Se;if(C.value||S.value){if(Le.value){const mt=new a(C.value).mul(Math.pow(10,_.value.decimals)).toString();Se=new ze(mt)}else{const mt=new a(S.value).mul(Math.pow(10,k.value.decimals)).toString();Se=new ze(mt)}console.log(Z,"======>directs"),b.tickIndexToSqrtPriceX64(i.value.current_tick_index);const{liquidityAmount:Ae,tokenMaxA:Ge,tokenMaxB:rt,tokenMaxAOrigin:to,tokenMaxBOrigin:oo}=p.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:o.token_a,tokenB:o.token_b,lowerTick:V,upperTick:Q,coinAmount:Se,iscoinA:Z?Le.value:!Le.value,roundUp:!0,slippage:Number(q.value)/100,curSqrtPrice:new ze(i.value.current_sqrt_price)});z.value={liquidityAmount:Ae,tokenMaxA:Ge,tokenMaxB:rt,tokenMaxAOrigin:to,tokenMaxBOrigin:oo},console.log(Ge,rt,"preAdd"),Z?Le.value?S.value=Number(rt)>0?rt:"":C.value=Number(Ge)>0?Ge:"":Le.value?S.value=Ge:C.value=rt}}else if(we>=Q){if(Z?C.value="":S.value="",f.value=Z,G.value=!Z,C.value||S.value){let Se;if(Z){const Ae=new a(S.value).mul(Math.pow(10,(Me=k.value)==null?void 0:Me.decimals)).toString();Se=new ze(Ae),z.value={liquidityAmount:p.value.estimateLiquidityForCoinB(Te,Fe,Se),tokenMaxA:0,tokenMaxB:S.value}}else{const Ae=new a(C.value).mul(Math.pow(10,(Re=_.value)==null?void 0:Re.decimals)).toString();Se=new ze(Ae),z.value={liquidityAmount:p.value.estimateLiquidityForCoinB(Te,Fe,Se),tokenMaxA:0,tokenMaxB:C.value}}}}else if(we<V){if(f.value=!Z,G.value=Z,Z?S.value="":C.value="",C.value||S.value){let Se;if(Z){const Ae=new a(C.value).mul(Math.pow(10,_.value.decimals)).toString();Se=new ze(Ae),z.value={liquidityAmount:p.value.estimateLiquidityForCoinA(Te,Fe,Se),tokenMaxA:C.value,tokenMaxB:0}}else{const Ae=new a(S.value).mul(Math.pow(10,k.value.decimals)).toString();Se=new ze(Ae),z.value={liquidityAmount:p.value.estimateLiquidityForCoinA(Te,Fe,Se),tokenMaxA:S.value,tokenMaxB:0}}}}else f.value=!0,C.value="",G.value=!0,S.value=""};_e(()=>i.value,(o,s)=>{console.log(s,"===>oldVal"),console.log(o,"===>newVal"),(!s&&o&&!ie(o)||s&&o&&s.address!==o.address)&&(console.log("池子信息"),Ne(o,!s||o.address!==s.address)),o&&!ie(o)&&Pe()},{immediate:!0}),_e(C,(o,s)=>{console.log(C,"===>fromCoinAmount"),o==""&&Le.value&&(S.value=""),o&&Le.value&&!Xe.value&&Pe()}),_e(S,(o,s)=>{console.log(o,"===>>>>newValsda"),o==""&&!Le.value&&(C.value=""),o&&!Le.value&&!Xe.value&&Pe()}),_e(()=>oe.value,(o,s)=>{Pe()}),_e(()=>[_.value,k.value],([o,s])=>{o&&s&&(f.value=!1,G.value=!1)});const w=F("--"),R=A(()=>U.value.RATES),K=()=>{const o=R.value&&R.value[_.value.address]&&R.value[_.value.address].price,s=R.value&&R.value[k.value.address]&&R.value[k.value.address].price;if(o&&s){const b=new a(C.value>0?C.value:0).mul(o),ge=new a(S.value>0?S.value:0).mul(s),E=b.add(ge).toNumber();w.value=E>0&&E<.01?"<$0.01":"$"+Be(E,2)}else w.value="--"};_e(()=>[C.value,S.value,Xe.value],([o,s,b])=>{(o||s)&&!b?K():(!o||!s)&&!b&&(w.value="--")},{immediate:!0}),_e(()=>w,o=>{console.log(o,"71911111")},{immediate:!0});const J=F(),O=async()=>{var Z,Oe;if(!I.value&&!y.value)return!1;if(!C.value&&!S.value&&!I.value&&!y.value)return;const o=i.value;if(ie(o))return;const{TickUtil:s,TickMath:b,getNearestTickByTick:ge}=p.value,E=o==null?void 0:o.token_a.decimals,de=o==null?void 0:o.token_b.decimals;let pe,re,V,Q,Te,Fe,He;if(o.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&o.token_b.address.toLowerCase()===k.value.address.toLowerCase()?He=!0:He=!1,I.value==="0"&&y.value==="∞")V=s.getMinIndex(Number(o.tickSpacing)),Q=s.getMaxIndex(Number(o.tickSpacing));else if(D.value=="custom"){He?(pe=Number(I.value),re=Number(y.value)):(pe=new a(1).div(y.value).toString(),re=new a(1).div(I.value).toString());try{Te=pe==0?-443636:b.priceToTickIndex(new a(pe),E,de)}catch{Te=-443636}try{Fe=b.priceToTickIndex(new a(re),E,de)}catch{Fe=443636}V=ge(Te,Number(o.tickSpacing),!0),Q=ge(Fe,Number(o.tickSpacing),!0)}else V=(Z=Ye.value[D.value])==null?void 0:Z.lower,Q=(Oe=Ye.value[D.value])==null?void 0:Oe.upper;const De=R.value[o==null?void 0:o.token_a.address].price,we=R.value[o==null?void 0:o.token_b.address].price;oe.value?new ze(o.current_sqrt_price):new ze(1/o.current_sqrt_price),console.log(oe.value,"===>direction.value"),console.log(o,"poolInfos===>"),console.log(V,Q,"####tick_lower tick_upper 889"),console.log(w.value,"liquidityTotalAmount.value");try{const{amountA:qe,amountB:Me,tokenAmountsInfo:Re}=await p.value.estCoinAmountsFromTotalAmount({lowerTick:V,upperTick:Q,decimalsA:E,decimalsB:de,curSqrtPrice:new ze(o.current_sqrt_price),totalAmount:w.value.replace(/[^\d.]/g,""),tokenPriceA:De,tokenPriceB:we});console.log(qe,Me,"###estCoinAmountsFromTotalAmount 844"),console.log(o.needReverse,oe.value,"===>849"),J.value=Re,o.needReverse?oe.value?(C.value=qe,S.value=Me):(C.value=Me,S.value=qe):(C.value=qe,S.value=Me)}catch(qe){console.log(qe,"e===>")}};_e([I,y],([o,s])=>{console.log(o,s,"==>minPrice,maxPrice"),Xe.value?Xe.value&&O():Pe(),s!=="∞"&&Number(o)!==0&&Number(s)!==0&&Number(o)>=Number(s)?et.value=!0:et.value=!1,Number(o)==0&&Number(s)==0&&tt.value&&(et.value=!0,console.log("价格区间错误"))},{deep:!0,immediate:!0});const je=o=>{console.log(o,"e");const s=o.replace(/[^\d.]/g,""),b="$"+Be(s);Xe.value=!0,w.value=b,s>0?O():(C.value="",S.value="")},L=F(!1),{setTransactionTxid:ce,setTransactionDesc:Ke,setIsShowWaiting:$e,setIsShowSuccess:nt,setPositiomNum:Ve,setIsShowRejected:Je}=ve,Ze=_o(),x=A(()=>U.value.currentPositionInfo),at=F(!1),t=F(!0),u=St(),h=A(()=>u),T=A(()=>h.value.farmsPoolObj);_e(()=>[T.value,i.value],([o,s])=>{o&&!ie(o)&&s&&!ie(s)&&(o[s.address]||(t.value=!1))},{immediate:!0});const H=F(),X=o=>{console.log(o,"getFarmsPoolInfo:"),H.value=o,o?t.value=!0:t.value=!1},fe=async o=>{var Te,Fe,He,De;console.log(i.value,"===> poolInfo.value"),console.log(H.value,"##farmPoolInfo"),L.value=!1,U.value.currentPositionInfo={},ce(""),Ke(e("tips.increaseLiquiditySuccess",{from:f.value?"":`${Be(C.value)} ${(Te=_.value)==null?void 0:Te.symbol}`,and:!f.value&&!G.value?"and":"",to:G.value?"":`${Be(S.value)} ${(Fe=k.value)==null?void 0:Fe.symbol}`})),$e(!0);const s=oe.value?Le.value:!Le.value;let b,ge,E,de,pe,re;const V=i.value.token_a.decimals,Q=i.value.token_b.decimals;if(I.value==="0"&&y.value==="∞")E=p.value.TickUtil.getMinIndex(Number(i.value.tickSpacing)),de=p.value.TickUtil.getMaxIndex(Number(i.value.tickSpacing));else if(D.value=="custom"){oe.value?(b=I.value,ge=y.value):(b=new a(1).div(y.value).toString(),ge=new a(1).div(I.value).toString()),console.log("0519###toAdd###min###",b),console.log("0519###toAdd###max###",ge),console.log("0519###toAdd###minPrice.value###",I.value),console.log("0519###toAdd###maxPrice.value###",y.value);try{pe=b==0?p.value.TickUtil.getMinIndex(Number(i.value.tickSpacing)):p.value.TickMath.priceToTickIndex(new a(b),V,Q)}catch{pe=p.value.TickUtil.getMinIndex(Number(i.value.tickSpacing))}try{re=p.value.TickMath.priceToTickIndex(new a(ge),V,Q)}catch{re=p.value.TickUtil.getMaxIndex(Number(i.value.tickSpacing))}E=p.value.getNearestTickByTick(pe,Number(i.value.tickSpacing),!0),de=p.value.getNearestTickByTick(re,Number(i.value.tickSpacing),!0)}else E=Ye.value[D.value].lower,de=Ye.value[D.value].upper;console.log(E,de,"####tick_lower tick_upper 889"),console.log(i.value,"==>poolInfo.value.curSqrtPrice"),console.log("1202###Add###tick_lower####",E),console.log("1202###Add###tick_upper####",de),console.log("1202###Add###poolInfo.value####",i.value);try{let we;Xe.value?we=await p.value.getCreateAddLiquidityPayload({pool:i.value,curSqrtPrice:new ze(i.value.current_sqrt_price),tickLower:E,tickUpper:de,slippage:Number(q.value)/100,tokenAmounts:J.value}):we=await p.value.getAddLiquidityTransactionPayload({pool:{poolAddress:i.value.poolAddress,token_a:i.value.token_a,token_b:i.value.token_b},amount:Le.value?C.value:S.value,fix_amount_a:s,tick_lower:E,tick_upper:de,index:0,slippage:Number(q.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new ze(i.value.current_sqrt_price),farmPoolInfo:H.value}),console.log(we,"payload===?");let Z;if($.value==="Aptos")Z=await N.value.currentWallet.signAndSubmitTransaction(we);else{const Oe=await p.value.signAndExecuteTransactionBlock(N.value.currentWallet,we);Z=p.value.handleTx(Oe)}if(console.log("0410###tx###",Z),Z&&Z.hash){ce(Z.hash),$e(!1),nt(!0);let Oe;i.value.needReverse?i.value.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&i.value.token_b.address.toLowerCase()===k.value.address.toLowerCase()?Oe=!1:Oe=!0:i.value.token_a.address.toLowerCase()===_.value.address.toLowerCase()&&i.value.token_b.address.toLowerCase()===k.value.address.toLowerCase()?Oe=!0:Oe=!1,console.log(Oe,"===>directs");const qe={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:f.value?"":`${Be(C.value)} ${(He=_.value)==null?void 0:He.symbol}`,and:!f.value&&!G.value?"and":"",to:G.value?"":`${Be(S.value)} ${(De=k.value)==null?void 0:De.symbol}`}),hash:Z.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};$.value!=="Aptos"&&(qe.res=Z.res),p.value.showTransitionPending(qe),console.log(qe,"toAdd params###");const Me=await p.value.watchTransaction(qe,!0);if(console.log("new liquidity right add watchInfo: ",Me),console.log("new liquidity right add tx: ",Z),Me.status){if(nt(!1),U.value.setCurrentPositionLoading(!0),at.value=!0,console.log(Me.nftInfo,"===> watchInfo.nftInfo"),$.value==="Aptos"){if(await U.value.setCurrentPositionInfo(Me.nftInfo[0].data.id.creator,Me.nftInfo[0].data.id.collection,Me.nftInfo[0].data.name,$.value),o)try{await Ze.subscribePosition({pool_address:x.value.poolAddress,position_index:x.value.index},x.value.nftHash)}catch(Re){console.log(Re,"e")}}else{const Re=Me.nftInfo,Se=await Nt(2e3);if(t.value){console.log("auto stake farming");let Ae;Me.res.events.forEach(Ge=>{Ge.type.indexOf("::pool::DepositEvent")>-1&&(Ae=Ge.parsedJson.wrapped_position_id)}),console.log(Ae,"###farmPositionId"),await U.value.setCurrentPositionInfo("","","","Sui",Ae,"farming")}else console.log("not auto"),await U.value.setCurrentPositionInfo(Re==null?void 0:Re.pool,"","",$.value,Re==null?void 0:Re.position);if(await Nt(1e3),console.log("0529###nftInfo###",Re),console.log("0529###currentPositionInfo.value.index###",x.value),o&&!t.value)try{await Ze.subscribePosition({pool_address:x.value.poolAddress,position_index:x.value.index},x.value.nftHash)}catch(Ae){console.log(Ae)}else if(o&&t.value)try{await Ze.subscribePosition({pool_address:x.value.clmm_pool_id,position_index:x.value.name.split("-")[1]},x.value.clmm_position_id)}catch(Ae){console.log(Ae)}}setTimeout(()=>{se.updateCurrentPools(i.value.poolAddress,$.value),p.value.getAccount(N.value.address)},3e3),setTimeout(async()=>{$t(p,i)},7e3)}Ve()}else $e(!1),Je(!0);C.value="",S.value=""}catch(we){C.value="",S.value="",console.log("0330###Add liquidity Error###",we),$e(!1),Je(!0)}},Ee=A(()=>!C.value&&!S.value?(console.log("addLiquidityBtnDisabled11111"),!0):Number(C.value)>Number(ue.value)||Number(S.value)>Number(g.value)?(console.log("addLiquidityBtnDisabled22222"),!0):l.value!==e("button.addLiquidity")&&l.value!==e("newAdd.preview")?(console.log("addLiquidityBtnDisabled33333###",l.value),!0):i.value&&i.value&&i.value.is_pause?(console.log("addLiquidityBtnDisabled44444"),!0):Number(C.value)<=0&&Number(S.value)<=0||!f.value&&Number(C.value)==0||!G.value&&Number(S.value)==0),c=A(()=>!_.value||!k.value),l=A(()=>i.value&&i.value.is_pause?"Pool Closed":!_.value||!k.value||c.value?e("modal.selectTokenModalTitle"):Number(C.value)>Number(ue.value)?e("button.insufficientBalance",{name:_.value.symbol}):Number(S.value)>Number(g.value)?e("button.insufficientBalance",{name:k.value.symbol}):!Number(C.value)&&!Number(S.value)?e("button.enterAmount"):y.value!=="∞"&&Number(I.value)>=Number(y.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),ke=F({}),te=F({}),ye=F(!1),At=(o,s)=>{console.log(m.value,"===>currentCoinKey.value"),console.log(o);const b=localStorage.getItem(o.address);console.log(U.value.tokensObj,"===>pools.value.tokensObj"),console.log(b,"===>coinLocak"),U.value.tokensObj&&U.value.tokensObj[o.address]&&U.value.tokensObj[o.address].isSelfBuilt&&!b&&(s=="fromCoin"&&(ke.value=o),s=="toCoin"&&(te.value=o),ye.value=!0)};_e(()=>[_.value,k.value],([o,s])=>{o&&!ie(o)&&At(o,"fromCoin"),s&&!ie(s)&&At(s,"toCoin")},{immediate:!0});const Lt=so(),Qt=()=>{$.value!=="Aptos"?Lt.push("/pool/list"):Lt.push("/pools")},Yt=o=>{Xe.value,fe(o)},Vt=()=>{ae.query.action!=="create-pool"&&ae.query.actions!=="new-position"&&($t(p,i),Pe(),se.updateCurrentPools(i.value.poolAddress,$.value)),se.setPoolConfigList($.value,ne.value.filterCoinsObj)},eo=A(()=>{var b,ge,E,de,pe,re;const o=(E=R.value[(ge=(b=_)==null?void 0:b.value)==null?void 0:ge.address])==null?void 0:E.price,s=(re=R.value[(pe=(de=k)==null?void 0:de.value)==null?void 0:pe.address])==null?void 0:re.price;return!!(o&&s)});return _e(()=>[ae,U.value.tokensObj],([o,s])=>{var b;s&&!ie(s)&&(k.value||(k.value=U.value.tokensObj[(b=o==null?void 0:o.query)==null?void 0:b.toCoin]))},{immediate:!0,deep:!0}),{positionError:et,decimalUi:be,poolInfo:i,fromCoinAmount:C,toCoinAmount:S,fromCoin:_,toCoin:k,theme:Ce,showFromCoinLock:f,showToCoinLock:G,fromCoinBlance:ue,toCoinBlance:g,maxBtnSelect:n,halfBtnSelect:P,fixedFromCoin:Le,openCoinSelect:he,currentCoinKey:m,existingCoins:v,lastSelectCoin:B,showCoinSelect:ee,onCoinSelect:Ie,liquidityTotalAmount:w,toggle:Wt,onInput:je,isInputTotalAmount:Xe,isViewDetail:at,addLiquidityBtnDisabled:Ee,addLiquidityBtnText:l,isShowTokenWarning:ye,chainName:$,closeTokenWarning:Qt,warningFromCoin:ke,warningToCoin:te,isShowLiquidityModal:L,currentPrice:tt,currentPriceReverse:st,currentPriceTab:D,minPrice:I,maxPrice:y,toAdd:fe,direction:oe,wallet:N,getAddLiquidityType:Yt,clickRefresh:Vt,isShowtotalAmount:eo,isAutoStakeFarming:t,farmPoolInfo:H,getFarmsPoolInfo:X}}});const Xi={class:"new-liquidity-right"},Ei={class:"deposit-title"},Di={class:"card-container"},Wi={key:0,class:"lock"},Zi={class:"card-item"},Gi={class:"card-item"},Ki={key:0,class:"total-amount"},Ji=r("span",null,"Total Amount",-1);function Qi(e,d,ve,ne,$,se){const U=Xt,j=po,N=Et,ae=ho,i=Dt,f=uo,G=ko,Ce=yo,Ne=wo,ue=xi;return M(),W("div",Xi,[r("div",Ei,[xe(U,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),r("div",Di,[e.positionError?(M(),W("div",Wi,[xe(j)])):Y("",!0),r("div",Zi,[xe(N,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":d[0]||(d[0]=g=>e.fromCoinAmount=g),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:d[1]||(d[1]=g=>e.maxBtnSelect("fromCoin")),onOnHalf:d[2]||(d[2]=g=>e.halfBtnSelect("fromCoin")),onOnInput:d[3]||(d[3]=g=>{e.fromCoinAmount=g,e.fixedFromCoin=!0,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?(M(),We(ae,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):Y("",!0)]),r("div",Gi,[xe(N,{modelValue:e.toCoinAmount,"onUpdate:modelValue":d[4]||(d[4]=g=>e.toCoinAmount=g),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:d[5]||(d[5]=g=>e.maxBtnSelect("toCoin")),onOnHalf:d[6]||(d[6]=g=>e.halfBtnSelect("toCoin")),onOnInput:d[7]||(d[7]=g=>{e.toCoinAmount=g,e.fixedFromCoin=!1,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?(M(),We(ae,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):Y("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(M(),W("img",{key:1,class:"add",src:Co,alt:"",onClick:d[8]||(d[8]=(...g)=>e.toggle&&e.toggle(...g))})):Y("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(M(),W("img",{key:2,class:"add",src:Po,alt:"",onClick:d[9]||(d[9]=(...g)=>e.toggle&&e.toggle(...g))})):Y("",!0)]),e.isShowtotalAmount?(M(),W("div",Ki,[Ji,r("span",null,le(e.liquidityTotalAmount)+" ",1)])):Y("",!0),xe(i,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),xe(f,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:d[10]||(d[10]=g=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:ut(()=>[Tt(le(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(M(),We(G,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:d[11]||(d[11]=g=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):Y("",!0),e.isViewDetail?(M(),We(Ce,{key:2,"pool-info":e.poolInfo,"farm-pool-info":e.farmPoolInfo,"is-auto-stake-farming":e.isAutoStakeFarming,onOnClose:d[12]||(d[12]=g=>e.isViewDetail=!1)},null,8,["pool-info","farm-pool-info","is-auto-stake-farming"])):Y("",!0),e.isShowLiquidityModal?(M(),We(Ne,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:d[13]||(d[13]=g=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):Y("",!0),e.chainName=="Sui"?(M(),We(ue,{key:4,"pool-info":e.poolInfo,"is-active":!e.showFromCoinLock&&!e.showToCoinLock,"is-auto-stake-farming":e.isAutoStakeFarming,onSendFarmsPoolInfo:e.getFarmsPoolInfo},null,8,["pool-info","is-active","is-auto-stake-farming","onSendFarmsPoolInfo"])):Y("",!0)])}const Jt=it(Hi,[["render",Qi]]),Yi=ot({components:{NewLiquidityLeft:Kt,NewLiquidityRight:Jt},setup(){zt(()=>{bo()});const e=Pt(),d=dt();return A(()=>d),{tickList:Qe,route:e}}});const Vi={key:0,class:"loading-spin-liquidity loading-global"},en={class:"privide-liquidity"};function tn(e,d,ve,ne,$,se){var ae,i;const U=Ut,j=Kt,N=Jt;return M(),W(kt,null,[!e.tickList&&((i=(ae=e.route)==null?void 0:ae.query)!=null&&i.poolAddress)?(M(),W("div",Vi,[xe(U)])):Y("",!0),r("div",en,[xe(j),xe(N)])],64)}const Bn=it(Yi,[["render",tn],["__scopeId","data-v-1b76f12f"]]);export{Bn as default};
