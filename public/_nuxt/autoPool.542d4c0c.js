import{a6 as Y,l as z,T as G,a7 as H}from"./entry.04194906.js";import{c,a as Q}from"./sha256.b33711d3.js";import{I as X,C as F,e as Z,J as D,l as K,u as N,b as J,a as O,s as v,f as W,p as $}from"./pool.3a65d90b.js";import{C as oo,V as C}from"./index.74905ecc.js";import{D as s}from"./decimal.0e8aa3f1.js";function M(e){const p={launchpad:c[e||"Sui"].launchpad,ido:c[e||"Sui"].ido,xcetus:c[e||"Sui"].xcetus,xcetus_dividends:c[e||"Sui"].xcetus_dividends,cetus_faucet:c[e||"Sui"].cetus_faucet,xtoken:c[e||"Sui"].xtoken,xtoken_dividends:c[e||"Sui"].xtoken_dividends,token_faucet:c[e||"Sui"].token_faucet,booster:c[e||"Sui"].booster,maker_bonus:c[e||"Sui"].maker_bonus,liquidity_stratefy:c[e||"Sui"].liquidity_stratefy,vaults:c[e||"Sui"].vaults},S={fullRpcUrl:localStorage.getItem(`${e}-currentRpclocal2`)||c[e||"Sui"].fullRpcUrl,simulationAccount:c[e||"Sui"].simulationAccount,cetus_config:c[e||"Sui"].cetus_config,clmm_pool:c[e||"Sui"].clmm_pool,integrate:c[e||"Sui"].integrate,deepbook:c[e||"Sui"].deepbook,deepbook_endpoint_v2:c[e||"Sui"].deepbook_endpoint_v2,aggregatorUrl:c[e||"Sui"].aggregatorUrl},i=new X(S),n=Y(new oo(p,i)),u=Q(),f=z(()=>u);G(()=>{f.value.address&&(i.senderAddress=f.value.address)});const I=async()=>{console.log(n,"sdk###");const o=await n.Vaults.getVaultList();return o&&o.data||[]},B=async o=>await n.Vaults.getVault(o),A=async o=>{if(console.log(o,"###coinType"),i.senderAddress){const _=await n.ClmmSDK.fullClient.getBalance({owner:i.senderAddress,coinType:o});return _&&_.totalBalance}else return 0},t=o=>({transactionBlock:o,options:{showEffects:!0,showEvents:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0,showBalanceChanges:!0}});return{getAutoPools:I,getLpBalance:A,deposit:async o=>{const{lowerTick:_,upperTick:x,coinAmount:d,fix_amount_a:m,slippage:g,curSqrtPrice:b,rewarder_coin_types:U}=o;console.log(o,"params###");const y=F.estLiquidityAndcoinAmountFromOneAmounts(_,x,d,m,!0,g,b),k=m?d.toString():y.tokenMaxA.toString(),r=m?y.tokenMaxB.toString():d.toString(),a=await n.Vaults.deposit({vault_id:o.id,clmm_pool:o.clmm_pool,lp_token_type:o.lp_token_type,amount_a:k,amount_b:r,fix_amount_a:m,slippage:g,coinTypeA:o.coinTypeA,coinTypeB:o.coinTypeB,rewarder_coin_types:[]});return t(a)},remove:async o=>{const{lowerSqrtPrice:_,upperSqrtPrice:x,lpTokenAmount:d,curSqrtPrice:m,slippage:g,rewarder_coin_types:b,id:U}=o;console.log(o.lpTokenAmount.toString(),"params##");const y=await B(U),k=await i.Pool.getPool(y.pool_id),r=F.getCoinAmountFromLiquidity(d,new Z(k.current_sqrt_price),_,x,!1),a=D(r.coinA.toString()).mul(D(1-g)),P=D(r.coinB.toString()).mul(D(1-g));console.log(r.coinA.toString(),"##.toString()"),console.log(o.lpTokenAmount.toString(),a.toString(),P.toString(),"params##");const j=C.get_protocol_fee_amount(y,r.coinA.toString()),L=C.get_protocol_fee_amount(y,r.coinB.toString());console.log(y,"##vault"),console.log(k,"newPool##"),console.log(a.toString(),P.toString(),L,j,"###protocol_fee_amount_a");const q=await n.Vaults.remove({vault_id:o.id,clmm_pool:o.clmm_pool,lp_token_type:o.lp_token_type,coinTypeA:o.coinTypeA,coinTypeB:o.coinTypeB,lp_token_amount:d.toString(),min_amount_a:K(D(r.coinA.toString()).sub(j).toString(),0)||"",min_amount_b:K(D(r.coinB.toString()).sub(L).toString(),0)||"",rewarder_coin_types:[]});return t(q)},getAutoPool:B}}const lo=H("autoPool",{state:()=>({autoPoolList:[],autoPoolObj:{},positionInfoObj:{},positionInfoList:[],positionUSDObj:{},apyObj:{}}),getters:{getPoolStore(){return N()}},actions:{async getAutoPoolList(){const p=await M("Sui").getAutoPools();console.log(p,"list###");const S=this.getPoolStore,i=p.map(n=>({...S.poolConfigObj[n.pool_id],id:n.id,lp_token_type:n.lp_token_type,autoPoolPositionInfo:n.positins[0],is_pause:n.is_pause,total_supply:n.total_supply,liquidity:n.liquidity,protocol_fee_rate:n.protocol_fee_rate}));this.autoPoolList=i,this.autoPoolObj=Object.fromEntries(i.map((n,u)=>[n.address,n])),this.getMyAutoPoolPosition(),console.log(i,"##autoPoolList")},async getMyAutoPoolPosition(){var u,f,I,B;const e=M("Sui"),p=this.autoPoolList,S=J("Sui"),i=[],{RATES:n}=this.getPoolStore;for(let A=0;A<p.length;A++){const t=p[A];console.log(t,"poolINfo###");const l=await S.getPool(t.address),w=await e.getLpBalance(p[A].lp_token_type);console.log(w,"balance##");const o=(await S.getTokenListByCoinType([p[A].lp_token_type]))[0];console.log(o,"lpInfo##");const _=((u=n[t.coinA.address])==null?void 0:u.price)||"",x=((f=n[t.coinB.address])==null?void 0:f.price)||"",d=t.autoPoolPositionInfo.tick_lower_index,m=t.autoPoolPositionInfo.tick_upper_index;console.log(p[A],"list[i]"),console.log((I=t==null?void 0:t.object)==null?void 0:I.current_sqrt_price,"##poolInfo?.object?.current_sqrt_price");const g={tick_lower_index:d,tick_upper_index:m,current_sqrt_price:l==null?void 0:l.current_sqrt_price,liquidity:Number(w)>0?C.get_share_liquidity_by_amount({liquidity:t==null?void 0:t.liquidity,total_supply:t==null?void 0:t.total_supply},w):0};console.log(t,"##position");const b=S.getCoinAmountFromLiquidity({pool:{...t,current_sqrt_price:l==null?void 0:l.current_sqrt_price},position:g,roundUp:!1}),U=b.coinaAmount,y=b.coinbAmount;console.log(t.protocol_fee_rate,"##newPoolInfo.protocol_fee_rate");const k=U,r=y,a=new s(_).mul(new s(U)).toNumber(),P=new s(x).mul(new s(y)).toNumber(),j=a>0&&a<.01?"<$0.01":`$${O(v(a,2))}`,L=P>0&&P<.01?"<$0.01":`$${O(v(P,2))}`;let q=0;Number(w)>0&&(q=new s(w).div(Math.pow(10,o.decimals)));const R=_&&x?v(new s(a).add(new s(P)).toString(),2):"",V=t.total_supply;let h=0;q>0&&V>0&&(h=new s(q).mul(Math.pow(10,o.decimals)).div(new s(V)).mul(100).toNumber()),console.log(h,"##myShare");const E=new s(1).div(Math.pow(10,t.decimals)).toNumber();let T=0;h>1?T=v(h,2):h>0&&h<E?T=`<${E}`:h==0?T=0:T=W(h,1),console.log(w,q.toString(),"###balance"),this.positionInfoObj[t.id]={tick_lower_index:d,tick_upper_index:m,current_sqrt_price:l.current_sqrt_price,myLiquidity:$(w,o.decimals),amountA:k,amountB:r,...t,lpInfo:o,myAmountAUSD:j,myAmountBUSD:L,myLiquidityUSD:R,myShare:T},i.push({tick_lower_index:d,tick_upper_index:m,current_sqrt_price:(B=t==null?void 0:t.object)==null?void 0:B.current_sqrt_price,myLiquidity:$(w,o.decimals),amountA:k,amountB:r,...t,lpInfo:o,myAmountAUSD:j,myAmountBUSD:L,myLiquidityUSD:R,myShare:T})}this.positionInfoList=i,console.log(this.positionInfoObj,"this.positionInfoObj###"),console.log(this.positionInfoList,"###this.positionInfoList")},async updatePositionItem(e){var L,q;const p=M("Sui"),S=J("Sui"),i=await p.getAutoPool(e),n=await S.getPool(i.pool_id);console.log("newPoolInfo:",i),console.log("this.positionInfoObj[id]:",this.positionInfoObj[e]);const u={...this.positionInfoObj[e],autoPoolPositionInfo:i.positins[0]},f=await p.getLpBalance(u.lp_token_type),I=(await S.getTokenListByCoinType([u.lp_token_type]))[0];console.log(f,"###balance updatePositionItem");const B=u.autoPoolPositionInfo.tick_lower_index,A=u.autoPoolPositionInfo.tick_upper_index,t={tick_lower_index:B,tick_upper_index:A,current_sqrt_price:n.object.current_sqrt_price,liquidity:C.get_share_liquidity_by_amount({liquidity:i==null?void 0:i.liquidity,total_supply:i==null?void 0:i.total_supply},f)},l=S.getCoinAmountFromLiquidity({pool:{current_sqrt_price:n.current_sqrt_price,...u},position:t,roundUp:!1});console.log(l,"amountInfo###"),l.coinaAmount,l.coinbAmount;const w=l.coinaAmount,o=l.coinbAmount,{RATES:_}=this.getPoolStore,x=i.total_supply,d=((L=_[u.coinA.address])==null?void 0:L.price)||0,m=((q=_[u.coinB.address])==null?void 0:q.price)||0,g=new s(d).mul(new s(l==null?void 0:l.coinaAmount)).toNumber(),b=new s(m).mul(new s(l==null?void 0:l.coinbAmount)).toNumber(),U=g>0&&g<.01?"<$0.01":`$${O(v(g,2))}`,y=b>0&&b<.01?"<$0.01":`$${O(v(b,2))}`;let k=new s(0);Number(f)>0&&(k=new s(f).div(Math.pow(10,I.decimals)));const r=new s(k).mul(Math.pow(10,u.lpInfo.decimals)).div(new s(x)).mul(100).toNumber();let a=0;const P=new s(1).div(Math.pow(10,u.decimals)).toNumber(),j=d&&m?v(new s(g).add(new s(b)).toString(),2):"";r>1?a=v(r,2):r>0&&r<P?a=`<${P}`:a=W(r,1),this.positionInfoObj[e]={...u,tick_lower_index:B,tick_upper_index:A,current_sqrt_price:n.current_sqrt_price,myLiquidity:$(f,I.decimals),amountA:w,amountB:o,myShare:a,myAmountAUSD:U,myAmountBUSD:y,myLiquidityUSD:j},console.log(this.positionInfoObj[e],"###this.positionInfoObj[id]")},async getAutoPoolAPY(){}}});export{M as a,lo as u};
