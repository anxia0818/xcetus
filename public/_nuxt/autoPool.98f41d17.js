import{a6 as E,l as F,T as R,a7 as V}from"./entry.22d1dc40.js";import{c as r,a as $}from"./sha256.850281d4.js";import{H as K,C,I as x,l as M,u as H,b as j,p as I,s as L,f as v}from"./pool.d87fe413.js";import{C as W}from"./index.6bd0ebf3.js";import{D as c}from"./decimal.0e8aa3f1.js";function U(o){const u={launchpad:r[o||"Sui"].launchpad,ido:r[o||"Sui"].ido,xcetus:r[o||"Sui"].xcetus,xcetus_dividends:r[o||"Sui"].xcetus_dividends,cetus_faucet:r[o||"Sui"].cetus_faucet,xtoken:r[o||"Sui"].xtoken,xtoken_dividends:r[o||"Sui"].xtoken_dividends,token_faucet:r[o||"Sui"].token_faucet,booster:r[o||"Sui"].booster,maker_bonus:r[o||"Sui"].maker_bonus,liquidity_stratefy:r[o||"Sui"].liquidity_stratefy,vaults:r[o||"Sui"].vaults},i={fullRpcUrl:localStorage.getItem(`${o}-currentRpclocal2`)||r[o||"Sui"].fullRpcUrl,simulationAccount:r[o||"Sui"].simulationAccount,cetus_config:r[o||"Sui"].cetus_config,clmm_pool:r[o||"Sui"].clmm_pool,integrate:r[o||"Sui"].integrate,deepbook:r[o||"Sui"].deepbook,deepbook_endpoint_v2:r[o||"Sui"].deepbook_endpoint_v2,aggregatorUrl:r[o||"Sui"].aggregatorUrl},e=new K(i),s=E(new W(u,e)),m=$(),A=F(()=>m);R(()=>{A.value.address&&(e.senderAddress=A.value.address)});const f=async()=>{console.log(s,"sdk###");const n=await s.Vaults.getVaultList();return n&&n.data||[]},S=async n=>{console.log(n,"###coinType");const a=await s.ClmmSDK.fullClient.getBalance({owner:e.senderAddress,coinType:n});return a&&a.totalBalance},t=n=>({transactionBlock:n,options:{showEffects:!0,showEvents:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0,showBalanceChanges:!0}});return{getAutoPools:f,getLpBalance:S,deposit:async n=>{const{lowerTick:a,upperTick:l,coinAmount:_,fix_amount_a:d,slippage:g,curSqrtPrice:p,rewarder_coin_types:P}=n;console.log(n,"params###");const b=C.estLiquidityAndcoinAmountFromOneAmounts(a,l,_,d,!0,g,p),q=d?_.toString():b.tokenMaxA.toString(),B=d?b.tokenMaxB.toString():_.toString(),k=await s.Vaults.deposit({vault_id:n.id,clmm_pool:n.clmm_pool,lp_token_type:n.lp_token_type,amount_a:q,amount_b:B,fix_amount_a:d,slippage:g,coinTypeA:n.coinTypeA,coinTypeB:n.coinTypeB,rewarder_coin_types:P});return t(k)},remove:async n=>{const{lowerSqrtPrice:a,upperSqrtPrice:l,lpTokenAmount:_,curSqrtPrice:d,slippage:g,rewarder_coin_types:p}=n,P=C.getCoinAmountFromLiquidity(_,d,a,l,!0),b=x(P.coinA.toString()).mul(x(1-g)),q=x(P.coinB.toString()).mul(x(1-g));console.log(n.lpTokenAmount.toString(),b.toString(),q.toString(),"params##");const B=await s.Vaults.remove({vault_id:n.id,clmm_pool:n.clmm_pool,lp_token_type:n.lp_token_type,coinTypeA:n.coinTypeA,coinTypeB:n.coinTypeB,lp_token_amount:_.toString(),min_amount_a:M(b.toString(),0)||"",min_amount_b:M(q.toString(),0)||"",rewarder_coin_types:p});return t(B)}}}const X=V("autoPool",{state:()=>({autoPoolList:[],autoPoolObj:{},positionInfoObj:{},positionInfoList:[],positionUSDObj:{},apyObj:{}}),getters:{getPoolStore(){return H()}},actions:{async getAutoPoolList(){const u=await U("Sui").getAutoPools();console.log(u,"list###");const i=this.getPoolStore,e=u.map(s=>({...i.poolConfigObj[s.pool_id],id:s.id,lp_token_type:s.lp_token_type,autoPoolPositionInfo:s.positins[0],is_pause:s.is_pause}));this.autoPoolList=e,this.autoPoolObj=Object.fromEntries(e.map((s,m)=>[s.address,s])),console.log(e,"##autoPoolList")},async getMyAutoPoolPosition(){var s,m,A,f;const o=U("Sui"),u=this.autoPoolList,i=j("Sui"),e=[];for(let S=0;S<u.length;S++){const t=u[S],y=await o.getLpBalance(u[S].lp_token_type),w=(await i.getTokenListByCoinType([u[S].lp_token_type]))[0];console.log(w,"lpInfo##");let n=new c(0);Number(y)>0&&(n=new c(y).div(Math.pow(10,w.decimals))),console.log(y,n.toString(),"###balance");const a=t.autoPoolPositionInfo.tick_lower_index,l=t.autoPoolPositionInfo.tick_upper_index,_={tick_lower_index:a,tick_upper_index:l,current_sqrt_price:(s=t==null?void 0:t.object)==null?void 0:s.current_sqrt_price,liquidity:y},d=i.getCoinAmountFromLiquidity({pool:{current_sqrt_price:(m=t==null?void 0:t.object)==null?void 0:m.current_sqrt_price,...t},position:_,roundUp:!1}),g=d.coinaAmount,p=d.coinbAmount;this.positionInfoObj[t.address]={tick_lower_index:a,tick_upper_index:l,current_sqrt_price:(A=t==null?void 0:t.object)==null?void 0:A.current_sqrt_price,myLiquidity:I(y,w.decimals),amountA:g,amountB:p,...t,lpInfo:w},e.push({tick_lower_index:a,tick_upper_index:l,current_sqrt_price:(f=t==null?void 0:t.object)==null?void 0:f.current_sqrt_price,myLiquidity:I(y,w.decimals),amountA:g,amountB:p,...t,lpInfo:w})}this.positionInfoList=e,console.log(this.positionInfoObj,"this.positionInfoObj###")},async getUserPositionUSD(){const{RATES:o}=this.getPoolStore,u=j("Sui");console.log(this.positionInfoList,"###this.positionInfoList"),this.positionInfoList.forEach(i=>{var k,h;const e=((k=o[i.coinA.address])==null?void 0:k.price)||0,s=((h=o[i.coinB.address])==null?void 0:h.price)||0,m=new c(e).mul(new c(i==null?void 0:i.amountA)).toString(),A=new c(s).mul(new c(i==null?void 0:i.amountB)).toString(),f=2,S=2,t=L(m,f),y=L(A,S),w=new c(t).add(new c(y)).toString(),n=i.myLiquidity,a=i.autoPoolPositionInfo.liquidity;console.log(n,a,"####totalLiquidity");let l=0;n>0&&a>0&&(l=new c(n).mul(Math.pow(10,i.lpInfo.decimals)).div(new c(a)).mul(100).toNumber()),console.log(l,"##myShare");const _=new c(1).div(Math.pow(10,i.decimals)).toNumber();let d=0;l>1?d=L(l,2):l>0&&l<_?d=`<${_}`:d=v(l,1);const g={tick_lower_index:i.tick_lower_index,tick_upper_index:i.tick_upper_index,current_sqrt_price:i.object.current_sqrt_price,liquidity:a},p=u.getCoinAmountFromLiquidity({pool:{current_sqrt_price:i.object.current_sqrt_price,...i},position:g,roundUp:!1});console.log(p,"poolAmountInfo##");const P=new c(e).mul(new c(p==null?void 0:p.coinaAmount)).toString(),b=new c(s).mul(new c(p==null?void 0:p.coinbAmount)).toString(),q=L(P,f),B=L(b,S);console.log(p,"###poolAmountInfo"),console.log(l,"###myShare"),console.log(m,A,"##myPosition"),this.positionInfoObj[i.address]={...this.positionInfoObj[i.address],myAmountAUSD:t,myAmountBUSD:y,myLiquidityUSD:w,myShare:d,poolAmoutnA:q,poolAmoutnB:B},console.log(this.positionInfoObj,"###this.positionInfoObj")})},async updatePositionItem(o){var D,T;const u=U("Sui"),i=j("Sui"),e=this.positionInfoObj[o],s=await u.getLpBalance(e.lp_token_type),m=(await i.getTokenListByCoinType([e.lp_token_type]))[0];console.log(s,"###balance updatePositionItem");const A=e.autoPoolPositionInfo.tick_lower_index,f=e.autoPoolPositionInfo.tick_upper_index,S={tick_lower_index:A,tick_upper_index:f,current_sqrt_price:e.object.current_sqrt_price,liquidity:s},t=i.getCoinAmountFromLiquidity({pool:{current_sqrt_price:e.object.current_sqrt_price,...e},position:S,roundUp:!1});console.log(t,"amountInfo###");const y=t.coinaAmount,w=t.coinbAmount,{RATES:n}=this.getPoolStore,a=e.autoPoolPositionInfo.liquidity,l=2,_=2,d=((D=n[e.coinA.address])==null?void 0:D.price)||0,g=((T=n[e.coinB.address])==null?void 0:T.price)||0,p=new c(d).mul(new c(t==null?void 0:t.coinaAmount)).toString(),P=new c(g).mul(new c(t==null?void 0:t.coinbAmount)).toString(),b=L(p,l),q=L(P,_);let B=new c(0);Number(s)>0&&(B=new c(s).div(Math.pow(10,m.decimals)));const k=new c(B).mul(Math.pow(10,e.lpInfo.decimals)).div(new c(a)).mul(100).toNumber();let h=0;const O=new c(1).div(Math.pow(10,e.decimals)).toNumber();k>1?h=L(k,2):k>0&&k<O?h=`<${O}`:h=v(k,1),this.positionInfoObj[e.address]={...e,tick_lower_index:A,tick_upper_index:f,current_sqrt_price:e.object.current_sqrt_price,myLiquidity:I(s,m.decimals),amountA:y,amountB:w,myShare:h,myAmountAUSD:b,myAmountBUSD:q}},async getAutoPoolAPY(){const{data:o}=await fetch(`${r.Sui.api}/v2/sui/auto_pools`).then(u=>u.json());o&&o.pools&&o.pools.length>0&&(this.apyObj=Object.fromEntries(o.pools.map((u,i)=>[u.object_id,{...u,apr:v(u.apr.replace("%",""),2)+"%"}])),console.log(this.apyObj,"data##"))}}});export{U as a,X as u};
