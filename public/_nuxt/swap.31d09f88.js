import{_ as cn}from"./refresh-icon.3bba2866.js";import{_ as dn}from"./assets-card.70592340.js";import{u as Fe,b as ao,c as Re,s as ue,a as W,l as Ze,d as re,w as ze,g as $o,p as Io,i as mn,e as He}from"./pool.8ec855c0.js";import{e as Te,a as Ke,D as No,L as Ro,r as f,l as F,q as ee,s as Ue,o as d,f as A,h as o,c as H,x as D,t as K,j as oe,v as u,C as me,u as Q,S as Oo,O as Bo,p as je,k as Me,a4 as vn,i as we,w as de,R as Fo,M as To,z as Uo,F as so,G as _o,B as jo,b as Po,y as pn,J as gn,N as fn,E as Ye}from"./entry.16c47115.js";/* empty css              *//* empty css              */import{u as Ee,c as he,a as hn}from"./sha256.ae0196be.js";import"./decimal.633e31ee.js";import{i as ve}from"./import-icon.de3e6c66.js";import{D as i}from"./decimal.0e8aa3f1.js";import{_ as Cn}from"./network-tips.ebc3d28f.js";import{_ as wn}from"./coin-select.58ff4d2f.js";import{_ as bn}from"./swap-setting.bfb92097.js";/* empty css              */import{_ as An}from"./token-warning-modal.265285cd.js";import{u as Sn}from"./swapRouter.37d5e39c.js";import{_ as yn}from"./img-leverage_2x.1c577303.js";/* empty css              */import"./token-warning.6ca079c7.js";/* empty css              */import"./img-no-Positions_2x.39368e69.js";/* empty css              */import"./icon-selected_3x.09e9a6f0.js";const kn=""+globalThis.__publicAssetsURL("sui-image/route-view.png");const In=Ke({props:{swapLoading:{type:Boolean,default:!1},fromCoinAmount:{type:String,default:""},toCoinAmount:{type:String,default:""},fromCoin:{type:Object,default:()=>({})},toCoin:{type:Object,default:()=>({})},fixedFromCoin:{type:Boolean,default:!0},impact:{type:String,default:""},insufficientLiquidity:{type:Boolean,default:!1},oneToAmount:{type:String,default:""},oneFromAmount:{type:String,default:""},suiPreSwapdata:{type:Object,default:()=>({})},suiSwapFee:{type:String,default:""},swapRouterLoading:{type:Boolean,default:!1}},setup(e){const g=No(Ro,{style:{fontSize:"20px",color:"#75C8FF"},spin:!0}),k=f(!1),S=Ee(),E=F(()=>S),L=F(()=>E.value.slippage),v=F(()=>E.isShowRouterModal);ee(()=>e,O=>{console.log(O,"==>newValue")},{immediate:!0,deep:!0});const I=Fe(),j=F(()=>I),X=ao("Sui"),G=f(0),P=f([]),_=f({});ee(()=>e.suiPreSwapdata,async O=>{var p;if(console.log(O,"===>suiPreSwapdata"),O&&!Re(O)){let Z=[];(p=O==null?void 0:O.splitPaths)==null||p.forEach(a=>{a==null||a.basePaths.forEach(async l=>{Z.push(l.label),console.log(l.toCoin,"==>basePath.toCoin"),console.log(l.fromCoin,"==>basePath.fromCoin")})});const{splitPaths:w}=O,$=w&&w[0]&&w[0].basePaths;if(w&&w.length==1&&$&&$.length==2){const a=$[0].toCoin=="0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI"?"0x2::sui::SUI":$[0].toCoin;_.value=j.value.tokensObj[a]||(await X.getTokenListByCoinType[a])[0],console.log(_.value,"===>coinTypeB.value")}else _.value="";P.value=Array.from(new Set(Z)),G.value=P.value.length,console.log(P.value,"===>sourcesArr.value"),console.log(_.value,"===>coinTypeB")}},{immediate:!0});const z=f(0),t=f(0);return ee(()=>[e.fromCoinAmount,e.toCoinAmount,e.fromCoin,e.toCoin,e.fixedFromCoin,L.value],([O,p,Z,w,$,a])=>{if(O&&p&&Z&&w&&a)if($){const l=new i(p).mul(new i(a/100));t.value=new i(p).sub(l).toString()}else{const l=new i(O).mul(new i(a/100));z.value=new i(O).add(l).toString()}},{immediate:!0}),{sFixD:ue,getCoinIcon:O=>{var p;return(O==null?void 0:O.logoURI)||(O==null?void 0:O.logo_url)||((p=j.value.tokensObj[O==null?void 0:O.address])==null?void 0:p.logo_url)||(E.theme==="default"?ve("/image/coins/unknown.png"):ve("/image/coins/sui-unknown.png"))},indicator:g,rateChange:k,slippage:L,isShowRouterModal:v,indexStore:S,maximumSold:z,minimumReceived:t,addCommom:W,pathLength:G,sourcesArr:P,coinTypeB:_}}}),ke=e=>(je("data-v-daa2842b"),e=e(),Me(),e),_n={key:0,class:"swap-info"},Pn={class:"loading-swap"},$n={key:1,class:"swap-rate"},Nn={key:0},Rn={key:0},On={key:1},Bn={key:0},Fn=ke(()=>o("div",null,[o("svg",{class:"icon icon-up","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_up1"})])],-1)),Tn=ke(()=>o("div",null,[o("svg",{class:"icon icon-down","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_down1"})])],-1)),Un=[Fn,Tn],jn={key:2},Mn={class:"trade-info"},En={class:"trade-block"},Ln=ke(()=>o("div",{class:"lebal"},"Price Impact",-1)),Dn={key:0,class:"icon","aria-hidden":"true"},Wn=ke(()=>o("use",{"xlink:href":"#icon-icon-warning1"},null,-1)),qn=[Wn],Jn={class:"trade-block"},Qn={class:"lebal"},Xn={key:0,class:"text"},zn={class:"trade-block"},Hn=ke(()=>o("div",{class:"lebal"},"Fee",-1)),Yn={key:0,class:"text"},Zn={key:0,class:"trade-block"},Kn=ke(()=>o("div",{class:"lebal"},"Route",-1)),Gn={key:0,class:"text text-box"},Vn=["src"],xn=["src"],et={key:1,class:"text text-box"},ot=["src"],nt=["src"],tt=ke(()=>o("img",{src:kn,alt:""},null,-1));function st(e,g,k,S,E,L){var X,G,P,_;const v=Oo,I=Bo,j=Ue("image");return e.swapLoading||Number(e.fromCoinAmount)&&Number(e.toCoinAmount)&&!e.insufficientLiquidity?(d(),A("div",_n,[o("div",Pn,[e.swapLoading||e.swapRouterLoading?(d(),H(v,{key:0,size:"small",indicator:e.indicator},null,8,["indicator"])):D("",!0),e.swapLoading?e.swapLoading?(d(),A("span",jn,"Best route and price")):D("",!0):(d(),A("div",$n,[e.rateChange?(d(),A("span",On,[e.fromCoinAmount&&e.toCoinAmount?(d(),A("span",Bn,[K(o("img",null,null,512),[[j,e.getCoinIcon(e.toCoin)]]),oe(" 1 "+u(e.toCoin.symbol)+" ≈ ",1),K(o("img",null,null,512),[[j,e.getCoinIcon(e.fromCoin)]]),oe(u(e.oneFromAmount==1/0?0:e.oneFromAmount)+" "+u(e.fromCoin.symbol),1)])):(d(),H(v,{key:1,indicator:e.indicator},null,8,["indicator"]))])):(d(),A("span",Nn,[K(o("img",null,null,512),[[j,e.getCoinIcon(e.fromCoin)]]),oe(" 1 "+u(e.fromCoin.symbol)+" ≈ ",1),e.fromCoinAmount&&e.toCoinAmount?(d(),A("span",Rn,[K(o("img",null,null,512),[[j,e.getCoinIcon(e.toCoin)]]),oe(u(e.oneToAmount==1/0?0:e.oneToAmount)+" "+u(e.toCoin.symbol),1)])):(d(),H(v,{key:1,indicator:e.indicator},null,8,["indicator"]))])),o("div",{class:"right",onClick:g[0]||(g[0]=z=>e.rateChange=!e.rateChange)},Un)]))]),o("div",Mn,[o("div",En,[Ln,e.swapRouterLoading?(d(),H(I,{key:1,paragraph:!1,active:""})):(d(),A("div",{key:0,class:me(["text",e.impact<1?"impact-s":e.impact<10&&e.impact>=1?"impact-w":"impact-e"])},[oe(u(e.impact<.01?"<0.01":e.impact>100?"100":e.impact)+"% ",1),e.impact>=10?(d(),A("svg",Dn,qn)):D("",!0)],2))]),o("div",Jn,[o("div",Qn,u(e.fixedFromCoin?e.$t("common.minimumReceived"):e.$t("common.maximumSold")),1),e.swapRouterLoading?(d(),H(I,{key:1,paragraph:!1,active:""})):(d(),A("div",Xn,u(e.fixedFromCoin?("addCommom"in e?e.addCommom:Q(W))(("sFixD"in e?e.sFixD:Q(ue))(e.minimumReceived,e.toCoin.decimals)):("addCommom"in e?e.addCommom:Q(W))(("sFixD"in e?e.sFixD:Q(ue))(e.maximumSold,e.fromCoin.decimals)))+" "+u(e.fixedFromCoin?e.toCoin.symbol:e.fromCoin.symbol),1))]),o("div",zn,[Hn,e.swapRouterLoading?(d(),H(I,{key:1,paragraph:!1,active:""})):(d(),A("div",Yn,u(e.suiSwapFee)+" "+u(e.fromCoin.symbol),1))]),e.insufficientLiquidity?D("",!0):(d(),A("div",Zn,[Kn,e.swapRouterLoading?(d(),H(I,{key:1,paragraph:!1,active:""})):(d(),A("div",{key:0,class:"text",onClick:g[1]||(g[1]=z=>e.indexStore.setIsShowRouterModal(!e.isShowRouterModal))},[!e.swapRouterLoading&&e.suiPreSwapdata&&e.suiPreSwapdata.splitPaths&&e.suiPreSwapdata.splitPaths.length==1?(d(),A("div",Gn,[o("span",null,u(e.fromCoin.symbol)+" "+u(e.coinTypeB&&((X=e.coinTypeB)!=null&&X.symbol)?`> ${(G=e.coinTypeB)==null?void 0:G.symbol}`:"")+" > "+u(e.toCoin.symbol),1),o("img",{src:e.sourcesArr[0]=="Deepbook"?"/sui-image/logo_deepbook@2x.png":"/sui-image/logo_cetus@2x.png",alt:""},null,8,Vn),e.sourcesArr[1]?(d(),A("img",{key:0,src:e.sourcesArr[1]=="Deepbook"?"/sui-image/logo_deepbook@2x.png":"/sui-image/logo_cetus@2x.png",alt:""},null,8,xn)):D("",!0)])):e.swapRouterLoading?D("",!0):(d(),A("div",et,[oe(u((_=(P=e.suiPreSwapdata)==null?void 0:P.splitPaths)==null?void 0:_.length)+" Streams ",1),e.sourcesArr[0]?(d(),A("img",{key:0,src:e.sourcesArr[0]=="Deepbook"?"/sui-image/logo_deepbook@2x.png":"/sui-image/logo_cetus@2x.png",alt:""},null,8,ot)):D("",!0),e.sourcesArr[1]?(d(),A("img",{key:1,src:e.sourcesArr[1]=="Deepbook"?"/sui-image/logo_deepbook@2x.png":"/sui-image/logo_cetus@2x.png",alt:""},null,8,nt)):D("",!0)])),tt]))]))])])):D("",!0)}const at=Te(In,[["render",st],["__scopeId","data-v-daa2842b"]]);async function it(e,g){var E,L,v;const k=e==="0x2::sui::SUI"?"0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI":e,S=`${he.Sui.api}/v2/sui/coin/kline?coin_address=${k}&interval=day&market=${g}`;try{const I=await $fetch(S);return console.log("0621###getprice###res###",I),{price:((L=(E=I==null?void 0:I.data)==null?void 0:E.list)==null?void 0:L.reverse())||[],daily_rate:(v=I==null?void 0:I.data)==null?void 0:v.daily_rate.replace("%","")}}catch{return{price:[],daily_rate:""}}}async function lt(e){try{const{prices:g}=await $fetch(`https://api.coingecko.com/api/v3/coins/${e}/market_chart?vs_currency=usd&id=${e}&days=7&interval=daily`,{headers:{Connection:"keep-alive",Accept:"*/*"}}),S=(await $fetch(`https://api.coingecko.com/api/v3/coins/markets?ids=${e}&vs_currency=usd&price_change_percentage=24h`,{headers:{Connection:"keep-alive",Accept:"*/*"}}))[0].price_change_percentage_24h,E=[];return g.forEach(L=>{E.push({price:new i(L[1]).toString(),timestamp:L[0]})}),{price:E,daily_rate:S}}catch{return{price:[],daily_rate:""}}}const ut={props:{coin:{type:Object,default:()=>({})},refresh:{type:Boolean,default:!1},id:{type:String,default:""},market:{type:String,default:""}},setup(e,g){const{$echarts:k}=vn();let S=null,E;const L=f(!0),v=Ee(),I=F(()=>v),j=F(()=>I.value.chainName),X=F(()=>he[j.value]),G=Fe(),P=F(()=>G),_=(a,l,U)=>{E={xAxis:{type:"category",boundaryGap:!1,show:!1,data:l},yAxis:{type:"value",show:!1,min:function(y){return y.min-y.min*.1},max:function(y){return y.max+y.max*.1}},grid:{top:1,right:1,bottom:1,left:1},tooltip:{trigger:"axis",borderWidth:0,padding:0,backgroundColor:"transparent",axisPointer:{lineStyle:{color:I.value.chainName=="Aptos"?"#68FFD8":"#76C8FF"}},formatter:function(y){return`<div class="chart-tip">
              <div>${y&&y[0]&&y[0].name}</div>
              <div>$${re(y&&y[0]&&y[0].value,4)}</div>
            </chart-tip>`}},color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:I.value.chainName=="Aptos"?"#0C4535":"#2E546D"},{offset:1,color:I.value.chainName=="Aptos"?"#151817":"#1B1B1B"}]},series:[{data:a,type:"line",showSymbol:!1,areaStyle:{},lineStyle:{color:I.value.chainName=="Aptos"?"#68FFD8":"#76C8FF",width:2,type:"solid"}}]},E&&S.clear(),E&&S.setOption(E,!0),S.resize(),L.value=!1},z=f(""),t=f(""),Y=async a=>{var ne,N;const l=[],U=[],{price:y,daily_rate:se}=j.value==="Aptos"?await lt(a):await it(a,e.market);z.value=se,t.value=y&&y.length>1&&y[y.length-1].price,j.value==="Aptos"?y.forEach(J=>{l.push(J.price);const r=ze(Number(J.timestamp),"MD"),c=ze(Number(J.timestamp),"HM");U.push(r+" "+c)}):y.forEach(J=>{l.push(J.price);const r=ze(new i(J.timestamp).mul(1e3).toNumber(),"MD"),c=ze(new i(J.timestamp).mul(1e3).toNumber(),"HM");U.push(r+" "+c)});let V=document.getElementById(`main${(ne=e.coin)==null?void 0:ne.name}`);S=k.init(V),_(l,U,(N=e.coin)==null?void 0:N.name)};ee(()=>e.id,(a,l)=>{console.log(a,l,"===>oldValue"),console.log(!L.value,"!isFirst.value"),a&&(z.value="",t.value="",setTimeout(()=>{Y(a)},1e3))},{immediate:!0});const O=f(""),p=f(""),Z=f(""),w=f("");ee(()=>[P.value.tokensObj,e.coin],([a,l])=>{var U,y;a&&l&&a[l.address]&&(console.log(a[l.address],"===>newValue[coin.address]"),p.value=((U=a[l.address])==null?void 0:U.labels)&&((y=a[l.address])==null?void 0:y.labels[0]),O.value=a[l.address].name,Z.value=a[l.address].symbol,w.value=a[l.address].address)},{immediate:!0,deep:!0}),ee(()=>e.refresh,a=>{a&&Y(e.id)});const $=F(()=>I.value.theme);return console.log(e.coin.address=="0x2::sui::SUI","0x2::sui::SUI"),{theme:$,store:v,importIcon:ve,fixD:Ze,config:X,price_rate_24h:z,nowPrice:t,coinName:O,coinLabels:p,coinSymbol:Z,address:w,decimalUi:re}}},rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAk1BMVEUAAADn2v/m2//r2//v4//n2v/55P/n2v/o3P//+P/m2v/n2f/n2v/n2v/n2v/n2v/n2v/o2//p2//n3f/o3v/n2f/n2v/n2v/n2v/n2v/n2//o2v/q3f/r4f/u3f/n2v/o2v/n2//p3P/o3P/m2v/n2v/n2f/n2v/o2f/n2//r3f/t3P/n2v/m2v/o2v/r3v/m2f/tUDLHAAAAMHRSTlMAl5oyFNMJqSwFhvvr5d7Yr2FGNSD0zb2lkIltOhkOxoJoT0D48aJzWFYlHeB8Wief0nHAAAABSElEQVQ4y52Q53LCMBCEZWK5g0swBpveQknZ93+6rFxAHkSYyf6x9+67JqHLKxOZRzJJbWHStkCn0Fo8pG0XuvJv0dciBjVZb+dZeoxABb38MlbpXeucr5z2QwdUf8vX1h0ByLT9aAeCGlez4Ozw5zoE4nvFBJB0yymUhqp0B2DT5ec0O+YlWlUMJsCqAwJA8jNV1W4RAnuvqepeYwWsOR/AkfM9ji8YjYBTC3wCZyEq1jvKnoCQP8X90j0wF2IGuM2jArjUE8sWAPAmxACwavtDf623XJsBtoqa2zcm4MI8Ag7iNZkBeAcVc8cUOPhPgJjP4I/UzkYgKtWxpQqaAGfMvvUATIUBaOQHAEb2M2CZcj4OnrhJasDYXYVQ9Vpe2LJ/BeWyf4/oAXlC25e9uI0IqswRJulX/BOwXgG2JPCCIPA3sXmM/QK1PTc8LGCPoAAAAABJRU5ErkJggg==",ct="data:image/png;base64,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";const dt=e=>(je("data-v-1fbf26d3"),e=e(),Me(),e),mt={class:"token-info"},vt={class:"token-info-padding"},pt={class:"token-info-header"},gt={class:"left"},ft=["onerror"],ht={class:"name"},Ct={class:"desc"},wt={key:0},bt={class:"right"},At={class:"price-info"},St={key:0,src:rt,alt:""},yt={key:1,src:ct,alt:""},kt={class:"token-info-footer"},It={class:"left"},_t={class:"address"},Pt={key:0,class:"pc-address"},$t={key:1,class:"pc-address"},Nt={class:"h5-address"},Rt=dt(()=>o("use",{"xlink:href":"#icon-icon-copy1"},null,-1)),Ot=[Rt],Bt={class:"right"},Ft=["id"];function Tt(e,g,k,S,E,L){var j;const v=Fo,I=Ue("image");return d(),A("div",mt,[o("div",vt,[o("div",pt,[o("div",gt,[K(o("img",{onerror:S.theme=="default"?S.importIcon("/image/coins/unknown.png"):S.importIcon("/image/coins/sui-unknown.png")},null,8,ft),[[I,k.coin.logoURI||S.importIcon(`/image/coins/${k.coin.symbol.toLowerCase()}.png`)]]),o("div",null,[o("div",ht,u(S.coinSymbol),1),o("div",Ct,[o("span",null,[oe(u(S.coinName)+" ",1),S.theme!=="sui"?(d(),A("span",wt,u(S.coinLabels?`(${S.coinLabels})`:""),1)):D("",!0)])])])]),o("div",bt,[we(v,{placement:"top","arrow-point-at-center":""},{title:de(()=>[oe(u(k.market==="pyth"?"Data source: Pyth Network":"Data source: CoinGecko"),1)]),default:de(()=>[o("div",At,[k.market==="pyth"?(d(),A("img",St)):(d(),A("img",yt)),o("span",null,"$"+u(S.nowPrice?Number(S.nowPrice)<1?S.decimalUi(S.nowPrice,4):S.fixD(S.nowPrice,2):"--"),1),S.price_rate_24h?(d(),A("i",{key:2,class:me(S.price_rate_24h>0?"up":S.price_rate_24h<0?"down":"up")},u(S.price_rate_24h>0?`+ ${S.fixD(S.price_rate_24h,2)}`:S.price_rate_24h<0?+`${S.fixD(S.price_rate_24h,2)}`:`+${S.fixD(S.price_rate_24h,2)}`)+"%",3)):D("",!0)])]),_:1})])]),o("div",kt,[o("div",It,[o("div",_t,[k.coin&&S.address!=="0x2::sui::SUI"?(d(),A("span",Pt,u(k.coin&&k.coin.address.substr(0,13))+" ... "+u(k.coin&&k.coin.address.substr(k.coin.address.length-13,13)),1)):(d(),A("span",$t,u(k.coin&&k.coin.address),1)),o("span",Nt,u(k.coin&&k.coin.address.substr(0,4))+" ... "+u(k.coin&&k.coin.address.substr(k.coin.address.length-4,4)),1),(d(),A("svg",{class:"icon","aria-hidden":"true",onClick:g[0]||(g[0]=X=>S.store.copy(k.coin&&k.coin.address))},Ot))])]),o("div",Bt,[o("div",{id:`main${(j=k.coin)==null?void 0:j.name}`,class:"main"},null,8,Ft)])])])])}const Ut=Te(ut,[["render",Tt],["__scopeId","data-v-1fbf26d3"]]);const jt=Ke({components:{Modal:To},props:{fromCoin:{type:Object,default:()=>({})},toCoin:{type:Object,default:()=>({})},fromCoinAmount:{type:String,default:""},toCoinAmount:{type:String,default:""},suiPreSwapdata:{type:Object,default:()=>({})}},setup(e){const g=Fe(),k=ao("Sui"),S=F(()=>g);F(()=>{var P,_;return(_=(P=S.value)==null?void 0:P.poolInfo)==null?void 0:_.needReverse});const E=f([]),L=f({});ee(()=>[e.suiPreSwapdata,e.fromCoin,e.toCoin],async([P,_,z])=>{if(P&&!Re(P)){let t=[];P.splitPaths.sort((w,$)=>$.outputAmount-w.outputAmount);for(let w=0;w<P.splitPaths.length;w++){const $=P.splitPaths[w];console.log($,"###splitPath");const a={...$,amountIn:new i($.inputAmount).div(new i(Math.pow(10,_.decimals))).toString(),amountOut:new i($.outputAmount).div(new i(Math.pow(10,z.decimals))).toString()};let l=[];for(let U=0;U<$.basePaths.length;U++){const y=$.basePaths[U];console.log(y,"###basePath");const se=y.fromCoin=="0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI"?"0x2::sui::SUI":y.fromCoin,V=y.toCoin=="0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI"?"0x2::sui::SUI":y.toCoin,ne=S.value.tokensObj[se]||(await k.getTokenListByCoinType([se]))[0],N=S.value.tokensObj[V]||(await k.getTokenListByCoinType([V]))[0];console.log(ne,N,"###coin_a coin_b"),(y==null?void 0:y.label)=="Deepbook"?l.push({...y,...S.value.routerPoolConfigObj[y.poolAddress],feeRate:new i(y.feeRate).div(new i(Math.pow(10,9))),coin_a:ne,coin_b:N}):l.push({...y,...S.value.routerPoolConfigObj[y.poolAddress],feeRate:new i(y.feeRate).div(new i(Math.pow(10,6)))})}t.push({...a,basePaths:l})}E.value=t;const Y=[];let O=new i(0);t.forEach(w=>{const $=new i(w.percent).gt(0)?new i(w.percent).div(100).mul(100).toString():0,a=ue($,2);O=O.plus(a);const l=a.split(".");Y.push({value:a,int:l[0],decimal:l[1],pathIndex:w.pathIndex})});let p=new i(100).minus(O).toNumber();const Z=Y.sort((w,$)=>Number($.decimal)-Number(w.decimal));if(p)for(let w=0;w<Z.length&&p;w++)Z[w].value=new i(Z[w].value).plus(.01).toString(),p=new i(p).minus(.01).toNumber();L.value=Object.fromEntries(Z.map((w,$)=>[w.pathIndex,w])),console.log(Z,"===>sortByDecimalPart"),console.log(t,"===>routerArr")}},{immediate:!0});const v=Ee(),I=F(()=>v),j=P=>{var _;return console.log("获取logo"),console.log(S.value.tokensObj,"==>pools.value.tokensObj217"),(P==null?void 0:P.logoURI)||(P==null?void 0:P.logo_url)||((_=S.value.tokensObj[(P==null?void 0:P.address)=="0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI"?"0x2::sui::SUI":P==null?void 0:P.address])==null?void 0:_.logo_url)||(I.value.theme==="default"?ve("/image/coins/unknown.png"):ve("/image/coins/sui-unknown.png"))},X=async P=>{const _=(await k.getTokenListByCoinType([P]))[0];return console.log(_,"###tokenInfo"),_&&!Re(_)?_==null?void 0:_.logo_url:""},G=F(()=>S.value.tokensObj);return{addCommom:W,routerStep:E,getCoinIcon:j,getDeepBookLogo:X,percentObj:L,tokensObj:G,store:I,getExplorerUrl:$o}}}),be=e=>(je("data-v-c8d6399d"),e=e(),Me(),e),Mt=be(()=>o("svg",{class:"icon modal-icon-close","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-a-icon-Shutdown"})],-1)),Et={class:"route-top"},Lt={class:"token-a"},Dt={alt:""},Wt={class:"token-num"},qt={class:"token-symbol"},Jt={class:"token-b"},Qt={class:"token-num"},Xt={class:"token-symbol"},zt={alt:""},Ht={class:"route-bottom"},Yt=be(()=>o("div",{class:"left-round"},null,-1)),Zt=be(()=>o("div",{class:"right-round"},null,-1)),Kt={class:"percent-text"},Gt={class:"amount"},Vt={class:"symbol"},xt={class:"percent-ratio"},es={class:"percent-text"},os={class:"amount"},ns={class:"symbol"},ts={class:"pool-info-box"},ss={key:0,class:"icon","aria-hidden":"true"},as=be(()=>o("use",{"xlink:href":"#icon-icon_on1"},null,-1)),is=[as],ls={class:"pool-info"},us={class:"pool-info-top"},rs={class:"token-a-img",alt:""},cs={class:"token-b-img",alt:""},ds={class:"source"},ms=["src"],vs={class:"pool-info-detail"},ps={class:"pool-address"},gs=be(()=>o("span",null,"Pool Address",-1)),fs=["href"],hs=["onClick"],Cs=be(()=>o("use",{"xlink:href":"#icon-icon-copy1"},null,-1)),ws=[Cs],bs={key:0,class:"token-info-detail"},As={alt:""},Ss={class:"token-name"},ys={class:"token-address"},ks=["onClick"],Is=be(()=>o("use",{"xlink:href":"#icon-icon-copy1"},null,-1)),_s=[Is],Ps={class:"token-symbol"},$s={class:"token-info-detail"},Ns={alt:""},Rs={class:"token-name"},Os={class:"token-address"},Bs=["onClick"],Fs=be(()=>o("use",{"xlink:href":"#icon-icon-copy1"},null,-1)),Ts=[Fs],Us={class:"token-symbol"};function js(e,g,k,S,E,L){const v=Uo("Modal"),I=Ue("image");return d(),H(v,{title:"Route",width:"600px",visible:!0,footer:null,onCancel:g[0]||(g[0]=j=>e.$emit("onClose"))},{closeIcon:de(()=>[Mt]),default:de(()=>{var j,X,G,P;return[o("div",Et,[o("div",Lt,[K(o("img",Dt,null,512),[[I,(j=e.fromCoin)==null?void 0:j.logo_url]]),o("span",Wt,u(("addCommom"in e?e.addCommom:Q(W))(e.fromCoinAmount)),1),o("span",qt,u((X=e.fromCoin)==null?void 0:X.symbol),1)]),o("div",Jt,[o("span",Qt,u(("addCommom"in e?e.addCommom:Q(W))(e.toCoinAmount)),1),o("span",Xt,u((G=e.toCoin)==null?void 0:G.symbol),1),K(o("img",zt,null,512),[[I,(P=e.toCoin)==null?void 0:P.logo_url]])])]),o("div",Ht,[Yt,Zt,(d(!0),A(so,null,_o(e.routerStep,(_,z)=>(d(),A("div",{key:z,class:me(["route-path",z!==0?"route-path-active":""])},[o("div",{class:me(["percent",z!==0?"percent-active":""])},[o("div",Kt,[o("div",Gt,u(("addCommom"in e?e.addCommom:Q(W))(_.amountIn)),1),o("div",Vt,u(e.fromCoin.symbol),1),o("span",xt,"("+u(e.percentObj&&e.percentObj[_.pathIndex].value)+"%)",1)]),o("div",es,[o("div",os,u(("addCommom"in e?e.addCommom:Q(W))(_.amountOut)),1),o("div",ns,u(e.toCoin.symbol),1)])],2),o("div",ts,[_.basePaths&&_.basePaths.length>1?(d(),A("svg",ss,is)):D("",!0),(d(!0),A(so,null,_o(_.basePaths,(t,Y)=>{var O,p,Z,w,$,a,l,U,y,se,V,ne,N,J,r,c,Ie,Oe,Le,De;return d(),A("div",{key:Y},[o("div",ls,[o("div",us,[K(o("img",rs,null,512),[[I,t.label=="Cetus"?e.getCoinIcon({address:t.fromCoin}):(O=t==null?void 0:t.coin_a)==null?void 0:O.logo_url]]),K(o("img",cs,null,512),[[I,t.label=="Cetus"?e.getCoinIcon({address:t.toCoin}):(p=t==null?void 0:t.coin_b)==null?void 0:p.logo_url]]),o("span",null,u((t==null?void 0:t.feeRate)*100)+"%",1)]),o("div",ds,[o("img",{src:t.label=="Cetus"?"/sui-image/logo_cetus@2x.png":"/sui-image/logo_deepbook@2x.png",alt:""},null,8,ms),o("span",null,u(t.label=="Cetus"?"Cetus":"DeepBook"),1)]),o("div",{class:me(["pool-info-detail-box",_.basePaths.length==1?"pool-info-detail-box-center":Y==0?"pool-info-detail-box-left":"pool-info-detail-box-right"])},[o("div",vs,[o("div",ps,[gs,o("p",null,[o("a",{href:("getExplorerUrl"in e?e.getExplorerUrl:Q($o))("poolAddress",t==null?void 0:t.poolAddress),target:"_blank"},u(t&&((Z=t==null?void 0:t.poolAddress)==null?void 0:Z.substr(0,6)))+" ... "+u(t&&((w=t==null?void 0:t.poolAddress)==null?void 0:w.substr(t.poolAddress.length-6,6))),9,fs),(d(),A("svg",{class:"copy-icon","aria-hidden":"true",onClick:_e=>e.store.copy(t==null?void 0:t.poolAddress)},ws,8,hs))])]),t.coin_a&&t.coin_a?(d(),A("div",bs,[K(o("img",As,null,512),[[I,($=t==null?void 0:t.coin_a)==null?void 0:$.logo_url]]),o("div",null,[o("div",null,[o("span",Ss,u((a=t==null?void 0:t.coin_a)==null?void 0:a.symbol),1),o("p",ys,[o("span",null,u((U=(l=t==null?void 0:t.coin_a)==null?void 0:l.address)==null?void 0:U.substr(0,4))+" ... "+u(t&&((V=(y=t==null?void 0:t.coin_a)==null?void 0:y.address)==null?void 0:V.substr(((se=t==null?void 0:t.coin_a)==null?void 0:se.address.length)-4,4))),1),(d(),A("svg",{class:"copy-icon","aria-hidden":"true",onClick:_e=>{var pe;return e.store.copy((pe=t==null?void 0:t.coin_a)==null?void 0:pe.address)}},_s,8,ks))])]),o("div",Ps,u((ne=t==null?void 0:t.coin_a)==null?void 0:ne.name),1)])])):D("",!0),o("div",$s,[K(o("img",Ns,null,512),[[I,(N=t==null?void 0:t.coin_b)==null?void 0:N.logo_url]]),o("div",null,[o("div",null,[o("span",Rs,u((J=t==null?void 0:t.coin_b)==null?void 0:J.symbol),1),o("p",Os,[o("span",null,u((c=(r=t==null?void 0:t.coin_b)==null?void 0:r.address)==null?void 0:c.substr(0,4))+" ... "+u(t&&((Le=(Ie=t==null?void 0:t.coin_b)==null?void 0:Ie.address)==null?void 0:Le.substr(((Oe=t==null?void 0:t.coin_b)==null?void 0:Oe.address.length)-4,4))),1),(d(),A("svg",{class:"copy-icon","aria-hidden":"true",onClick:_e=>{var pe;return e.store.copy((pe=t==null?void 0:t.coin_b)==null?void 0:pe.address)}},Ts,8,Bs))])]),o("div",Us,u((De=t==null?void 0:t.coin_b)==null?void 0:De.name),1)])])])],2)])])}),128))])],2))),128))])]}),_:1})}const Ms=Te(jt,[["render",js],["__scopeId","data-v-c8d6399d"]]),Es=Ke({components:{Modal:To},props:{fromCoin:{type:Object,default:()=>({})},toCoin:{type:Object,default:()=>({})},fromCoinAmount:{type:String,required:!0},toCoinAmount:{type:String,required:!0},slippage:{type:String,default:""},impact:{type:Number,required:!1},fixedFromCoin:{type:Boolean,default:!1},fee:{type:String,required:!1},formatFee:{type:String,default:""},isShowAccept:{type:Boolean,default:!1},swapLoading:{type:Boolean,required:!1},oneFromAmount:{type:String,default:""},oneToAmount:{type:String,default:""},suiPreSwapdata:{type:Object,default:()=>({})}},setup(e,g){const k=Fe(),S=F(()=>k),E=Ee(),L=F(()=>E),v=t=>{var Y;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((Y=S.value.tokensObj[t==null?void 0:t.address])==null?void 0:Y.logo_url)||(L.value.theme==="default"?ve("/image/coins/unknown.png"):ve("/image/coins/sui-unknown.png"))},I=f(!1),j=F(()=>L.value.chainName),X=async()=>{g.emit("to-swap")};f([]);const G=f(0),P=f(""),_=f(""),z=F(()=>L.value.slippage);return ee(()=>[e.fromCoinAmount,e.toCoinAmount,e.fromCoin,e.toCoin,e.fixedFromCoin,z.value],([t,Y,O,p,Z,w])=>{if(console.log(Y,t,w,"===>"),t&&Y&&O&&p&&w)if(Z){const $=new i(Y).mul(new i(w/100));_.value=new i(Y).sub($).toString()}else{const $=new i(t).mul(new i(w/100));P.value=new i(t).add($).toString()}},{immediate:!0}),console.log(e,"swapLoading===>"),{getCoinIcon:v,addCommom:W,sFixD:ue,rateChange:I,chainName:j,clickNextBtn:X,pathLength:G,maximumSold:P,minimumReceived:_,decimalUi:re}}});const Ae=e=>(je("data-v-ce681136"),e=e(),Me(),e),Ls=Ae(()=>o("svg",{class:"icon modal-icon-close","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-a-icon-Shutdown"})],-1)),Ds={class:"new-swap-contnet"},Ws={class:"coin-info"},qs={class:"from-coin-info"},Js={class:"left"},Qs={class:"coin-amount"},Xs={class:"coin-symbol"},zs={class:"right"},Hs={class:"to-coin-info"},Ys={class:"left"},Zs={class:"coin-amount"},Ks={class:"coin-symbol"},Gs={class:"right"},Vs=Ae(()=>o("div",{class:"to-swap-logo"},null,-1)),xs={class:"coin-rate"},ea={key:0},oa={class:"left"},na=Ae(()=>o("div",null,[o("svg",{class:"icon icon-up","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_up1"})])],-1)),ta=Ae(()=>o("div",null,[o("svg",{class:"icon icon-down","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_down1"})])],-1)),sa=[na,ta],aa={key:1},ia={class:"left"},la=Ae(()=>o("div",null,[o("svg",{class:"icon icon-up","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_up1"})])],-1)),ua=Ae(()=>o("div",null,[o("svg",{class:"icon icon-down","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_down1"})])],-1)),ra=[la,ua],ca={class:"bottom"},da={class:"induction"},ma={class:"item"},va={class:"induction-text"},pa={class:"induction-value"},ga={class:"item"},fa={class:"induction-text"},ha={class:"induction-value"},Ca={class:"item"},wa={class:"induction-text"},ba={key:0,class:"icon","aria-hidden":"true"},Aa=Ae(()=>o("use",{"xlink:href":"#icon-icon-warning1"},null,-1)),Sa=[Aa],ya={class:"item"},ka={class:"induction-text"},Ia={key:0,class:"induction-value"},_a={key:1,class:"induction-value"},Pa={key:0,class:"price-updated"},$a=Ae(()=>o("span",null,"Price updated",-1));function Na(e,g,k,S,E,L){const v=jo,I=Uo("Modal"),j=Ue("image");return d(),H(I,{width:"440px",visible:!0,footer:null,title:e.$t("button.swap"),class:"add-liquidity-modal",onCancel:g[4]||(g[4]=X=>e.$emit("on-close"))},{closeIcon:de(()=>[Ls]),default:de(()=>[o("div",Ds,[o("div",Ws,[o("div",qs,[o("div",Js,[o("div",Qs,u(e.fromCoinAmount&&("addCommom"in e?e.addCommom:Q(W))(e.fromCoinAmount)),1),o("div",Xs,u(e.fromCoin&&e.fromCoin.symbol),1)]),o("div",zs,[K(o("img",null,null,512),[[j,e.fromCoin&&e.fromCoin.logoURI||e.getCoinIcon(e.fromCoin)]])])]),o("div",Hs,[o("div",Ys,[o("div",Zs,u(e.toCoinAmount&&("addCommom"in e?e.addCommom:Q(W))(e.toCoinAmount)),1),o("div",Ks,u(e.toCoin&&e.toCoin.symbol),1)]),o("div",Gs,[K(o("img",null,null,512),[[j,e.toCoin&&e.toCoin.logoURI||e.getCoinIcon(e.toCoin)]])]),Vs]),o("div",xs,[e.rateChange?(d(),A("div",aa,[o("div",ia,[K(o("img",null,null,512),[[j,e.toCoin&&e.toCoin.logoURI||e.getCoinIcon(e.toCoin)]]),o("span",null,"1 "+u(e.toCoin&&e.toCoin.symbol)+" ≈",1),K(o("img",null,null,512),[[j,e.fromCoin&&e.fromCoin.logoURI||e.getCoinIcon(e.fromCoin)]]),o("span",null,u(("decimalUi"in e?e.decimalUi:Q(re))(e.oneFromAmount,e.fromCoin.decimals))+" "+u(e.fromCoin.symbol),1)]),o("div",{class:"right",onClick:g[1]||(g[1]=X=>e.rateChange=!e.rateChange)},ra)])):(d(),A("div",ea,[o("div",oa,[K(o("img",null,null,512),[[j,e.fromCoin&&e.fromCoin.logoURI||e.getCoinIcon(e.fromCoin)]]),o("span",null,"1 "+u(e.fromCoin&&e.fromCoin.symbol)+" ≈",1),K(o("img",null,null,512),[[j,e.toCoin&&e.toCoin.logoURI||e.getCoinIcon(e.toCoin)]]),o("span",null,u(("decimalUi"in e?e.decimalUi:Q(re))(e.oneToAmount,e.toCoin.decimals))+" "+u(e.toCoin.symbol),1)]),o("div",{class:"right",onClick:g[0]||(g[0]=X=>e.rateChange=!e.rateChange)},sa)]))])]),o("div",ca,[o("div",da,[o("div",ma,[o("div",va,u(e.$t("modal.slippageTolerance")),1),o("div",pa,u(e.slippage)+"%",1)]),o("div",ga,[o("div",fa,u(e.fixedFromCoin?e.$t("common.minimumReceived"):e.$t("common.maximumSold")),1),o("div",ha,u(e.fixedFromCoin?("addCommom"in e?e.addCommom:Q(W))(("sFixD"in e?e.sFixD:Q(ue))(e.minimumReceived,e.toCoin.decimals)):("addCommom"in e?e.addCommom:Q(W))(("sFixD"in e?e.sFixD:Q(ue))(e.maximumSold,e.fromCoin.decimals)))+" "+u(e.fixedFromCoin?e.toCoin.symbol:e.fromCoin.symbol),1)]),o("div",Ca,[o("div",wa,u(e.$t("common.priceImpact")),1),o("div",{class:me(["induction-value",e.impact<1?"impact-s":e.impact<10&&e.impact>=1?"impact-w":"impact-e"])},[oe(u(e.impact<.01?"<0.01":e.impact>100?"100":e.impact)+"% ",1),e.impact>=10?(d(),A("svg",ba,Sa)):D("",!0)],2)]),o("div",ya,[o("div",ka,u(e.$t("common.fee")),1),e.chainName=="Aptos"?(d(),A("div",Ia,u(e.formatFee)+" "+u(e.fromCoin.symbol)+" ("+u(e.fee*100)+"%) ",1)):(d(),A("div",_a,u(e.fee)+" "+u(e.fromCoin.symbol),1))])])])]),e.isShowAccept?(d(),A("div",Pa,[$a,we(v,{class:"accept-btn",loading:e.swapLoading,onClick:g[2]||(g[2]=X=>e.$emit("accept"))},{default:de(()=>[oe("Accept")]),_:1},8,["loading"])])):(d(),H(v,{key:1,class:"big-btn swap-confirm-btn",onClick:g[3]||(g[3]=X=>e.clickNextBtn())},{default:de(()=>[oe(u(e.$t("button.confirmSwap")),1)]),_:1}))]),_:1},8,["title"])}const Ra=Te(Es,[["render",Na],["__scopeId","data-v-ce681136"]]),Oa=Ke({setup(){const e=Po(),g=No(Ro,{style:{fontSize:"12px",color:"#fff",paddingBottom:"3px"},spin:!0}),{t:k,locale:S}=pn(),E=Ee(),L=Fe(),v=F(()=>L);let I=f(!1),j=f(!1),X=f(!1),G=f(!1),P=f(!1),_=f(!1);const z=f("fromCoin"),t=f(""),Y=f(""),O=f(!1),p=f(!0),Z=f(!1),w=f(!1),$=f(!1),a=f(""),l=f(""),U=f(20),y=f(0),se=f(null),V=f(!1),ne=F(()=>E.slippage),N=F(()=>E.chainName),J=F(()=>N.value?ao(N.value):{}),r=f(),c=f(),Ie=F(()=>he&&he[N.value]&&he[N.value].hasRouter),Oe=F(()=>L.getPoolInfoSuccess),Le=F(()=>{var n;return R.value&&((n=R.value)!=null&&n.is_pause)?"Pool Closed":!r.value||!c.value?k("modal.selectTokenModalTitle"):!Number(a.value)&&!Number(l.value)?k("button.enterAmount"):!Ie.value&&!R.value&&Oe.value?"Pool Not Found":Ie.value&&$e.value?"No Available Route":(console.log(V.value,"===>insufficientLiquidity.value"),V.value?k("button.insufficientLiquidity"):Number(a.value)>Number(le.value)?k("button.insufficientBalance",{name:r.value.symbol}):k("button.swap"))}),De=n=>{var m,s,h,b;z.value=n,n==="fromCoin"?(t.value=((m=c.value)==null?void 0:m.address)||"",Y.value=((s=r.value)==null?void 0:s.address)||""):(t.value=((h=r.value)==null?void 0:h.address)||"",Y.value=((b=c.value)==null?void 0:b.address)||""),O.value=!0},_e=f({}),pe=f({}),Mo=n=>{z.value==="fromCoin"?(_e.value=n,xe(n)):(pe.value=n,xe(n))},Eo=n=>{n==="fromCoin"?(p.value=!0,N.value==="Aptos"?a.value=le.value>0?r.value.symbol=="APT"?new i(Number(le.value)).sub(new i(.1)).lt(new i(0))?"0":new i(Number(le.value)).sub(new i(.1)).toString():String(le.value):"":a.value=le.value>0?r.value.symbol=="SUI"?new i(Number(le.value)).sub(new i(.05)).lt(new i(0))?"0":new i(Number(le.value)).sub(new i(.05)).toString():String(le.value):""):(p.value=!1,N.value==="Aptos"?l.value=ce.value>0?c.value.symbol=="APT"?new i(Number(ce.value)).sub(new i(.1)).lt(new i(0))?"0":new i(Number(ce.value)).sub(new i(.1)).toString():String(ce.value):"":l.value=ce.value>0?c.value.symbol=="SUI"?new i(Number(ce.value)).sub(new i(.05)).lt(new i(0))?"0":new i(Number(ce.value)).sub(new i(.05)).toString():String(ce.value):"")},Lo=n=>{n==="fromCoin"?(p.value=!0,a.value=le.value>0?ue(new i(Number(le.value)).div(2).toString(),r.value.decimals).toString():""):(p.value=!1,l.value=ce.value>0?ue(new i(Number(ce.value)).div(2).toString(),c.value.decimals).toString():"")};gn(()=>{io()}),fn(()=>{clearInterval(se.value)});const Ge=F(()=>E),Ve=()=>{!R.value&&!Ie.value||(clearInterval(se.value),L.setPoolConfigList(Ge.value.chainName,Ge.value.filterCoinsObj),y.value=0,j.value=!0,R.value&&L.updateCurrentPools(R.value.poolAddress,N.value),Ne(p.value?a.value:l.value),ie.value.address&&J.value.getAccount(ie.value.address),E.getStatsData(N.value,Ge.value.filterCoinsObj),setTimeout(()=>{j.value=!1,io()},1e3))},io=()=>{se.value=setInterval(()=>{j.value=!1,Z.value||y.value<U.value&&(y.value+=1,y.value===U.value&&(N.value=="Aptos"?(R.value&&R.value.poolAddress&&L.updateCurrentPools(R.value.poolAddress,N.value),Ve()):_.value||Ve(),y.value=0,j.value=!0))},1e3)};ee(p,Ye((n,m)=>{p.value=n},500));const Pe=f(!1);ee(a,Ye((n,m)=>{n&&n!==0&&p.value&&(y.value=0,Ne(n)),n==""&&p.value&&(l.value="")},500)),ee(l,Ye((n,m)=>{n&&n!==0&&!p.value&&(y.value=0,Ne(n)),n==""&&!p.value&&(a.value="")},500));const We=f(1e-4),qe=async n=>{let m=n;if(console.log(m,"poolInfo====>"),N.value==="Aptos"&&!m.current_sqrt_price&&a.value&&l.value){const s=await J.value.getPools([m.address]);s&&s[0]&&(m={...n,...s[0],fee:Number(s[0].fee_rate)/1e6})}if(m.current_sqrt_price&&a.value&&l.value){const h=(r.value.address===m.coinA.address&&c.value.address===m.coinB.address?0:1)==0,b=new i(a.value),C=new i(l.value),T=b.sub(b.mul(new i(m.fee)));console.log("getImpact###poolInfo.fee####",m.fee),console.log("getImpact###fAmount####",b.toString()),console.log("getImpact###tAmount####",C.toString()),console.log("getImpact###f####",T.toString());const q=C.div(T);console.log("getImpact####rates####",q.toString());const B=J.value.getPriceImpactPct(m,q.toString(),h);return console.log(B,"t===>"),B}return"--"},lo=f(0),uo=f(0),ro=f(),ae=f({}),Do=async n=>{if(R.value&&(console.log(Number(a.value)==0,"===>Number(fromCoinAmount.value)==0"),!(p.value&&Number(a.value)==0)&&!(!p.value&&Number(l.value)==0)))if(r.value&&c.value&&(a.value||l.value)){w.value=!0,$.value=!0,V.value=!1;const m=r.value.address===R.value.coinA.address&&c.value.address===R.value.coinB.address?0:1;console.log(R.value,"poolInfo=====>451"),console.log(p.value?a.value:l.value,"fixedFromCoin.value ? fromCoinAmount.value : toCoinAmount.value"),console.log(m,"===>direct");try{let s=await J.value.preSwap({pool:R.value,a2b:m==0,byAmountIn:p.value,amount:p.value?a.value:l.value});console.log(s,"preSwapRespreSwapRes"),V.value=s==null?void 0:s.isExceed,ro.value=s==null?void 0:s.estimatedFeeAmount,p.value?(l.value=s.estimatedAmountOut,fe.value=(Number(s.estimatedAmountOut)/n).toString(),ge.value=(n/Number(s.estimatedAmountOut)).toString()):(a.value=s.estimatedAmountIn,fe.value=(n/Number(s.estimatedAmountIn)).toString(),ge.value=(Number(s.estimatedAmountIn)/n).toString()),console.log(ge.value,fe.value,"===>831"),lo.value=new i(l.value).div(a.value).toString(),uo.value=new i(a.value).div(l.value).toString(),console.log("0524###getAmount###toAddLiquidiPoolInfo.value ###",ae.value),console.log("0524###getAmount###poolInfo.value ###",R.value),We.value=N.value=="Aptos"?await qe(R.value):await qe(ae.value||R.value),w.value=!1,$.value=!1}catch(s){console.log("pre swap error",s),w.value=!1,$.value=!1}}else p.value?l.value="":a.value="",w.value=!1,$.value=!1},Wo=hn(),ie=F(()=>Wo),qo=f({}),ge=f(""),fe=f(""),le=F(()=>ie.value.assets&&r.value&&ie.value.assets[r.value.address]?Io(ie.value.assets[r.value.address].balance,r.value.decimals):0),ce=F(()=>ie.value.assets&&c.value&&ie.value.assets[c.value.address]?Io(ie.value.assets[c.value.address].balance,c.value.decimals):0),Jo=Po();ee(()=>v.value.tokensObj,async n=>{if(!Re(n)){console.log(n,"===>newValue626"),console.log(Jo,"===>route625");const m=e?e.currentRoute.value.query.to:"",s=e?e.currentRoute.value.query.from:"";s?r.value=await J.value.getTokenBySymbol(n,s):!s&&!r.value&&(r.value=await J.value.getTokenBySymbol(n,he[N.value].swapDefaultPair.fromCoin),console.log(r.value,"===>fromCoin.value")),m?c.value=await J.value.getTokenBySymbol(n,m):!m&&!c.value&&(c.value=await J.value.getTokenBySymbol(n,he[N.value].swapDefaultPair.toCoin)),!s&&m&&(r.value="",console.log("我清空了fromCoin"))}},{immediate:!0});const R=F(()=>{var n,m,s,h,b;if(r.value&&c.value){let C=null,T={};if(console.log(c.value.address,"===>toCoin.value.address930"),Object.values(v.value.poolConfigList).forEach(B=>{var M,x,te,ye;(B.coinA.address.toUpperCase()===((M=r.value.address)==null?void 0:M.toUpperCase())&&B.coinB.address.toUpperCase()===((x=c.value.address)==null?void 0:x.toUpperCase())||B.coinB.address.toUpperCase()===((te=r.value.address)==null?void 0:te.toUpperCase())&&B.coinA.address.toUpperCase()===((ye=c.value.address)==null?void 0:ye.toUpperCase()))&&(console.log(B,"p===>"),T[B.address]={...B})}),N.value=="Aptos"&&v.value.poolsObj&&!Re(v.value.poolsObj))for(const B in v.value.poolsObj){const M=v.value.poolsObj[B];(M.token_a.address.toUpperCase()===((n=r.value.address)==null?void 0:n.toUpperCase())&&M.token_b.address.toUpperCase()===((m=c.value.address)==null?void 0:m.toUpperCase())||M.token_b.address.toUpperCase()===((s=r.value.address)==null?void 0:s.toUpperCase())&&M.token_a.address.toUpperCase()===((h=c.value.address)==null?void 0:h.toUpperCase()))&&(T[M.address]={...M})}console.log(T,"===>currentPoolsObj");const q=Object.values(T).sort((B,M)=>B.fee-M.fee);console.log("0507####swap###poolInfo###poolSortList###",q);for(let B=0;B<q.length;B++)if(!((b=q[B])!=null&&b.is_pause)){C=q[B];break}return C=Object.values(T).sort((B,M)=>B.fee-M.fee)[0],console.log(T,"currentPoolsObj===>"),console.log("0507####swap###poolInfo###info###",C),C&&!Re(C)?C:null}return null}),co=f(!0),mo=f(!1),Qo=async n=>{n&&N.value=="Aptos"&&(Ne(p.value?a.value:l.value),mo.value=!0,n.coinA.symbol.toLowerCase()===r.value.symbol.toLowerCase()&&n.coinB.symbol.toLowerCase()===c.value.symbol.toLowerCase()?co.value=!0:co.value=!1,V.value=!1)};ee(()=>R.value,(n,m)=>{n&&(!m||n.address!==m.address||n.current_sqrt_price!==m.current_sqrt_price)&&Qo(n)},{immediate:!0,deep:!0});const Xo=F(()=>v.value.tokensObj&&r.value&&r.value.address&&v.value.tokensObj[r.value.address]&&v.value.tokensObj[r.value.address].logoURI),zo=F(()=>(console.log(v.value.tokensObj,"===>pools.value.tokensObj"),v.value.tokensObj&&c.value&&c.value.address&&v.value.tokensObj[c.value.address]&&v.value.tokensObj[c.value.address].logoURI)),Ho=F(()=>N.value==="Aptos"?v.value.tokensObj&&r.value&&r.value.address&&v.value.tokensObj[r.value.address]&&v.value.tokensObj[r.value.address].coingecko_id||null:v.value.tokensObj&&r.value&&r.value.address||null),Yo=F(()=>N.value==="Aptos"?v.value.tokensObj&&c.value&&c.value.address&&v.value.tokensObj[c.value.address]&&v.value.tokensObj[c.value.address].coingecko_id||null:v.value.tokensObj&&c.value&&c.value.address||null),Zo=F(()=>{var n,m,s,h,b,C,T,q,B;return(s=(m=v==null?void 0:v.value)==null?void 0:m.tokensObj[(n=r==null?void 0:r.value)==null?void 0:n.address])!=null&&s.pyth_id&&((C=(b=v==null?void 0:v.value)==null?void 0:b.tokensObj[(h=r==null?void 0:r.value)==null?void 0:h.address])==null?void 0:C.pyth_id)!=="0x0000000000000000000000000000000000000000000000000000000000000000"?"pyth":(B=(q=v==null?void 0:v.value)==null?void 0:q.tokensObj[(T=r==null?void 0:r.value)==null?void 0:T.address])!=null&&B.coingecko_id?"coingecko":null}),Ko=F(()=>{var n,m,s,h,b,C,T,q,B;return(s=(m=v==null?void 0:v.value)==null?void 0:m.tokensObj[(n=c==null?void 0:c.value)==null?void 0:n.address])!=null&&s.pyth_id&&((C=(b=v==null?void 0:v.value)==null?void 0:b.tokensObj[(h=c==null?void 0:c.value)==null?void 0:h.address])==null?void 0:C.pyth_id)!=="0x0000000000000000000000000000000000000000000000000000000000000000"?"pyth":(B=(q=v==null?void 0:v.value)==null?void 0:q.tokensObj[(T=c==null?void 0:c.value)==null?void 0:T.address])!=null&&B.coingecko_id?"coingecko":null}),Go=F(()=>{var h,b,C;const n=new i(a.value);console.log(ae.value,"===>toAddLiquidiPoolInfo"),console.log((h=ae==null?void 0:ae.value)==null?void 0:h.fee,"toAddLiquidiPoolInfo?.value?.fee");const m=new i(N.value=="Aptos"?(b=R==null?void 0:R.value)==null?void 0:b.fee:(C=ae==null?void 0:ae.value)==null?void 0:C.fee),s=n.mul(m).toString();return console.log(s,"===>fee"),Number(s)<1/Math.pow(10,r.value.decimals)?`<${new i(1).div(new i(Math.pow(10,r.value.decimals))).toString()}`:ue(s,r.value.decimals)}),{setIsShowSuccess:Vo,setIsShowRejected:vo,setIsShowWaiting:Je,setTransactionDesc:xo,setTransactionTxid:po}=E,en=async()=>{var m,s,h,b,C,T,q,B;_.value=!1,w.value=!0,clearInterval(Be),window.clearInterval(Be),po(""),xo(k("tips.swapping",{from:`${W(a.value)} ${(m=r.value)==null?void 0:m.symbol}`,to:`${W(l.value)} ${(s=c.value)==null?void 0:s.symbol}`})),Je(!0);let n;N.value=="Aptos"&&(n=r.value.address===R.value.token_a.address&&c.value.address===R.value.token_b.address?0:1);try{console.log("0221####swap start####",N.value,"###",J),console.log("0412###toSwap###poolInfo.value###",R.value);let M;N.value=="Aptos"?M=await J.value.getSwapTransactionPayload({pool:R.value,a2b:n==0,byAmountIn:p.value,amount:p.value?a.value:l.value,slippage:Number(ne.value)/100}):(console.log(ae.value,"===>toAddLiquidiPoolInfo.value"),M=await Qe.value.swapRouterContract.getSwapRouterPayload(Xe.value,Number(ne.value)/100)),console.log("0221####swap###swapPayload###",M);let x;if(N.value==="Aptos")x=await ie.value.currentWallet.signAndSubmitTransaction(M);else{console.log("0221###swap###sui##signAndExecuteTransaction前###",N.value,"###swapPayload###",M);const te=await ie.value.currentWallet.signAndExecuteTransactionBlock(M);console.log("0221###sui swap res###",te),x=J.value.handleTx(te),console.log("0221###swap###sui##tx###",x)}if(x&&x.hash){po(x.hash),Je(!1),Vo(!0);const te={title:k("tips.swap"),desc:k("tips.swapSuccessText",{from:`${W(a.value)} ${(h=r.value)==null?void 0:h.symbol}`,to:`${W(l.value)} ${(b=c.value)==null?void 0:b.symbol}`}),hash:x.hash,tit:"Swap",type:"liquidity",action:"swap",isHaveSui:r.value.address==he[N.value].currentChainTokenAddress||c.value.address==he[N.value].currentChainTokenAddress,icon:"icon-icon-swap1",tokenInfo:{tokena:`${(C=r.value)==null?void 0:C.address}`,numa:`- ${a.value}`,logoa:v.value.tokensObj&&r.value&&r.value.address&&v.value.tokensObj[r.value.address]&&v.value.tokensObj[r.value.address].logoURI,tokenb:`${(T=c.value)==null?void 0:T.address}`,numb:`+ ${l.value}`,logob:v.value.tokensObj&&c.value&&c.value.address&&v.value.tokensObj[c.value.address]&&v.value.tokensObj[c.value.address].logoURI},text:`Pay ${a.value} ${(q=r.value)==null?void 0:q.symbol} to receive ${l.value} ${(B=c.value)==null?void 0:B.symbol}`};N.value!=="Aptos"&&(te.res=x.res),J.value.showTransitionPending(te);const ye=await J.value.watchTransaction(te);console.log("0221###swap###transitionStatus####",ye),ye&&setTimeout(()=>{N.value=="Aptos"&&L.updateCurrentPools(R.value.poolAddress,N.value),J.value.getAccount(ie.value.address)},1e3)}else Je(!1),vo(!0);a.value="",l.value="",w.value=!1}catch(M){a.value="",l.value="",console.log("Swap Error###",M),w.value=!1,Je(!1),vo(!0)}},on=n=>{var m;return(n==null?void 0:n.logoURI)||(n==null?void 0:n.logo_url)||((m=v.value.tokensObj[n==null?void 0:n.address])==null?void 0:m.logo_url)||(E.theme==="default"?ve("/image/coins/unknown.png"):ve("/image/coins/sui-unknown.png"))},go=f([]);ee(()=>[r.value,c.value,v.value.poolConfigList],([n,m,s])=>{if(s&&s.length>0&&n&&m){const h=[];s.forEach(b=>{var C,T,q,B;(b.coinA.address.toUpperCase()===((C=n.address)==null?void 0:C.toUpperCase())&&b.coinB.address.toUpperCase()===((T=m.address)==null?void 0:T.toUpperCase())||b.coinB.address.toUpperCase()===((q=n.address)==null?void 0:q.toUpperCase())&&b.coinA.address.toUpperCase()===((B=m.address)==null?void 0:B.toUpperCase()))&&(b!=null&&b.is_pause||h.push(b.address))}),console.log(h,"result===>"),go.value=h}},{immediate:!0});const xe=n=>{console.log(z.value,"===>currentCoinKey.value"),console.log(n);const m=localStorage.getItem(n.address);console.log(v.value.tokensObj,"===>pools.value.tokensObj"),console.log(m,"===>coinLocak"),v.value.tokensObj&&v.value.tokensObj[n.address]&&v.value.tokensObj[n.address].isSelfBuilt&&!m?eo.value=!0:(z.value==="fromCoin"?(a.value="",c.value&&n.address.toLowerCase()===(c==null?void 0:c.value.address.toLowerCase())&&(c.value=null),r.value=n):(r.value&&(l.value="",n.address.toLowerCase()===(r==null?void 0:r.value.address.toLowerCase())&&(r.value=null)),c.value=n),fo())},eo=f(!1),fo=()=>{pe.value={},_e.value={},eo.value=!1},nn=F(()=>E.isShowRouterModal),oo=f([]),ho=f(""),tn=f(!1),Co=Sn(),Qe=F(()=>Co),$e=f(!1),Xe=f({}),wo=f(""),bo=n=>{console.log("0711###getSuiSwapFee###swapRouter###",n);const{splitPaths:m}=n;let s=new i(0);m.forEach((b,C)=>{const T=b.basePaths[0],q=T.label==="Cetus"?new i(T.feeRate).div(Math.pow(10,6)):new i(T.feeRate).div(Math.pow(10,9)),B=new i(T.inputAmount).div(Math.pow(10,r.value.decimals)).mul(q);if(s=s.add(B),console.log(s.toString(),"1431"),console.log(C,"@0711getSuiSwapFee#####","ele.basePaths[0]###",b.basePaths[0].currentPrice.toString()),b.basePaths[1]){const M=b.basePaths[1];console.log(C,"@0711getSuiSwapFee#####","ele.basePaths[1]###",b.basePaths[1].currentPrice.toString());const x=T.direction?T.currentPrice:new i(1).div(T.currentPrice),te=M.direction?M.currentPrice:new i(1).div(b.basePaths[1].currentPrice),ye=M.label==="Cetus"?new i(M.feeRate).div(Math.pow(10,6)):new i(M.feeRate).div(Math.pow(10,9)),to=new i(M.outputAmount).div(Math.pow(10,c.value.decimals)).mul(ye).div(x.mul(te));console.log(C,"@0711getSuiSwapFee#####","price1###",x.toString()),console.log(C,"@0711getSuiSwapFee#####","price2###",te.toString()),console.log(C,"@0711getSuiSwapFee#####","price1.mul(price2)###",x.mul(te).toString()),console.log(C,"@0711getSuiSwapFee#####","new Decimal(1).div(price1.mul(price2))###",new i(1).div(x.mul(te)).toString()),console.log(C,"@0711getSuiSwapFee#####","fee2###",to.toString()),console.log(to.toString(),144611),s=s.add(to)}});const h=s.toNumber();console.log(h,"===>feeText"),wo.value=h>0&&h<1e-6?"<0.000001":W(ue(h,r.value.decimals))},no=(n,m)=>m.minus(n).div(m).mul(100),Ao=async n=>{console.log("0711###getSuiPriceImpact####swapRouter###",n);const{splitPaths:m}=n;let s=new i(0);m.forEach((h,b)=>{if(h.basePaths.length===1){const C=h.basePaths[0],T=new i(C.outputAmount).div(Math.pow(10,C.toDecimal)),q=new i(C.inputAmount).div(Math.pow(10,C.fromDecimal)),B=T.div(q),M=C.direction?new i(C.currentPrice):new i(1).div(C.currentPrice);console.log("getSuiPriceImpact###",b,"####outputAmount###",T.toString()),console.log("getSuiPriceImpact###",b,"####inputAmount###",q.toString()),console.log("getSuiPriceImpact###",b,"####rate###",B.toString()),console.log("getSuiPriceImpact###",b,"####cprice###",M.toString()),console.log("getSuiPriceImpact###",b,"####path.currentPrice###",C.currentPrice.toString()),console.log("getSuiPriceImpact###",b,"####calculateSingleImpact(rate, cprice)###",no(B,M)),s=s.add(no(B,M)),console.log("getSuiPriceImpact###",b,"####impactValue###",s.toString())}else{console.log("####getSuiPriceImpact 多路径计算");const C=h.basePaths[0].direction?new i(h.basePaths[0].currentPrice):new i(1).div(h.basePaths[0].currentPrice),T=h.basePaths[1].direction?new i(h.basePaths[1].currentPrice):new i(1).div(h.basePaths[1].currentPrice),q=C.mul(T),B=new i(h.basePaths[1].outputAmount).div(Math.pow(10,h.basePaths[1].toDecimal)),M=new i(h.basePaths[0].inputAmount).div(Math.pow(10,h.basePaths[0].fromDecimal)),x=B.div(M);s=s.add(no(x,q)),console.log("getSuiPriceImpact###",b,"####cprice1###",C.toString()),console.log("getSuiPriceImpact###",b,"####ele.basePaths[0].currentPrice###",h.basePaths[0].currentPrice.toString()),console.log("getSuiPriceImpact###",b,"####cprice2###",T.toString()),console.log("getSuiPriceImpact###",b,"####ele.basePaths[1].currentPrice###",h.basePaths[1].currentPrice.toString()),console.log("getSuiPriceImpact###",b,"####cprice###",q.toString()),console.log("getSuiPriceImpact###",b,"####rate###",x.toString()),console.log("getSuiPriceImpact###",b,"####impactValue###",s.toString())}}),console.log("0711###getSuiPriceImpact###impactValue.toNumber()####",s.toNumber()),We.value=Number(ue(s.toNumber(),2))},So=async n=>{if(r.value&&c.value&&(Number(a.value)>0||Number(l.value)>0)){console.log(new Date().getTime(),"开始计算时间戳"),console.log("执行吧"),(!a.value&&l.value||a.value&&!l.value)&&(w.value=!0),Pe.value=!0,$e.value=!1,console.log(R.value,"==>poolInfo.value.");let m;R.value&&(m=r.value.address===R.value.coinA.address&&c.value.address===R.value.coinB.address?0:1);try{let s;if(p.value){const T=new i(a.value).mul(Math.pow(10,r.value.decimals)).toString();s=new He(T)}else{const T=new i(l.value).mul(Math.pow(10,c.value.decimals)).toString();s=new He(T)}console.log(s.toString(),"====>1498");const h=Number(ne.value)/100;console.log(Qe.value,"===>swapRouterContract.value");const b=R.value?{poolAddresses:go.value,coinTypeA:R.value.coin_a_address,coinTypeB:R.value.coin_b_address,decimalsA:R.value.coinA.decimals,decimalsB:R.value.coinB.decimals,a2b:m==0,byAmountIn:p.value,amount:s.toString()}:"",C=await Qe.value.swapRouterContract.getSwapRouter(r,c,s,p.value,h,"",R.value?b:"");if(console.log(new Date().getTime(),"计算完成时间戳"),console.log(C,"===> swapRouter1454"),C&&!C.isExceed&&C.splitPaths&&C.splitPaths.length==0){$e.value=!0;return}if(C){if(Xe.value=C,oo.value=C.paths,console.log("build"),V.value=C.isExceed,console.log(C.isExceed,V.value,"===>swapRouter.isExceed"),C.isExceed){p.value?l.value="":a.value="";return}bo(C),p.value?a.value&&(l.value=new i(C.outputAmount).div(new i(Math.pow(10,c.value.decimals))).toString()):l.value&&(a.value=new i(C.inputAmount).div(new i(Math.pow(10,r.value.decimals))).toString()),console.log(l.value,"###toCoinAmount.value"),ge.value=W(re(new i(a.value).div(new i(l.value).toString()),r.value.decimals)),fe.value=W(re(new i(l.value).div(a.value).toString(),c.value.decimals)),Ao(C),w.value=!1,$e.value=!1,Pe.value=!1}else w.value=!1,$e.value=!0,Pe.value=!1}catch(s){console.log("pre swap error",s),w.value=!1,Pe.value=!1}}else p.value?l.value="":a.value="",w.value=!1,Pe.value=!1;console.log(w.value,"====>routerSwaping")},Ce=f(!1),yo=async n=>{console.log("3s执行一次");try{let m;if(p.value){const b=new i(a.value).mul(Math.pow(10,r.value.decimals)).toString();m=new He(b)}else{const b=new i(l.value).mul(Math.pow(10,c.value.decimals)).toString();m=new He(b)}const s=Number(ne.value)/100,h=await Qe.value.swapRouterContract.getSwapRouter(r,c,m,p.value,s,"");h&&(Xe.value=h,oo.value=h.paths,V.value=h.isExceed,console.log(h.isExceed,V.value,"===>swapRouter.isExceed"),ho.value=h.amountIn,bo(h),ge.value=W(re(new i(a.value).div(new i(l.value).toString()),r.value.decimals)),fe.value=W(re(new i(l.value).div(a.value).toString(),c.value.decimals)),Ao(h),p.value?l.value!==h.amountOut&&(Ce.value=!0,l.value=h.amountOut):a.value!==h.amountIn&&(Ce.value=!0,a.value=h.amountIn))}catch(m){console.log("pre swap error",m)}},sn=async n=>{if(r.value&&c.value&&(a.value||l.value)){const m=r.value.address===R.value.coinA.address&&c.value.address===R.value.coinB.address?0:1;try{let s=await J.value.preSwap({pool:R.value,a2b:m==0,byAmountIn:p.value,amount:p.value?a.value:l.value});console.log(s,"preSwapRespreSwapRes"),V.value=s==null?void 0:s.isExceed,ro.value=s==null?void 0:s.estimatedFeeAmount,p.value?(fe.value=(Number(s.estimatedAmountOut)/s.estimatedAmountIn).toString(),ge.value=(s.estimatedAmountIn/Number(s.estimatedAmountOut)).toString()):(fe.value=(Number(s.estimatedAmountOut)/Number(s.estimatedAmountIn)).toString(),ge.value=(Number(s.estimatedAmountIn)/Number(s.estimatedAmountOut)).toString()),p.value?l.value!==s.estimatedAmountOut&&(Ce.value=!0,l.value=s.estimatedAmountOut):a.value!==s.estimatedAmountIn&&(Ce.value=!0,a.value=s.estimatedAmountIn),console.log(ge.value,fe.value,"===>831"),console.log(Ce.value,"==>isShowAccept.value"),We.value=N.value=="Aptos"?await qe(R.value):await qe(ae.value||R.value),w.value=!1,$.value=!1}catch(s){console.log("pre swap error",s),w.value=!1,$.value=!1}}else w.value=!1,$.value=!1};let Be=f(null);ee(()=>_.value,n=>{n?(console.log("我开启了"),Be.value=setInterval(()=>{N.value=="Aptos"?sn(p.value):yo(p.value)},3e3)):(console.log("我关闭了"),clearInterval(Be.value),window.clearInterval(Be.value))},{immediate:!0});const Ne=async n=>{N.value=="Aptos"?Do(n):(console.log("调用sui"),So())},an=F(()=>Co),ln=F(()=>an.value.isInitRouter);ee(()=>ln.value,n=>{n||(y.value=0,Ne(p.value?a.value:l.value))},{immediate:!0}),ee(()=>[r.value,c.value],([n,m])=>{if(n&&m&&(y.value=0,Ne(p.value?a.value:l.value)),n||m){const s=`/swap?from=${n==null?void 0:n.address}&to=${m==null?void 0:m.address}`;e.push(s)}},{immediate:!0});function un(n,m=500){let s=null;return function(...h){clearTimeout(s),s=setTimeout(()=>{n.call(this,...h)},m)}}const rn=un(ko);function ko(){console.log("====>调用了几次");const n=r.value;r.value=c.value,c.value=n,I.value=!0,p.value=!p.value,p.value?(a.value=l.value,l.value=""):(l.value=a.value,a.value=""),setTimeout(()=>{I.value=!1},300)}return{closeSwapConfirmModal:()=>{_.value=!1,Ce.value=!1},updateAccept:()=>{Ce.value=!1},clickExchange:ko,debounceClickExchange:rn,closeTokenWarning:fo,isShowTokenWarning:eo,getTokenSource:xe,hasPool:mo,getPoolInfoSuccess:Oe,halfBtnSelect:Lo,formCoinId:Ho,toCoinId:Yo,formCoinMarket:Zo,toCoinMarket:Ko,fromCoinUrl:Xo,toCoinUrl:zo,t:k,indicator:g,wallet:ie,currentLpInfo:qo,fixD:Ze,decimalFormat:mn,impact:We,oneFromAmount:ge,oneToAmount:fe,importIcon:ve,clickRefresh:Ve,refresh:j,change:I,isShowAddress:X,isShowSwapSetting:G,fromCoin:r,toCoin:c,slippage:ne,openCoinSelect:De,onCoinSelect:Mo,existingCoins:t,lastSelectCoin:Y,currentCoinKey:z,showCoinSelect:O,fromCoinAmount:a,toCoinAmount:l,maxBtnSelect:Eo,fixedFromCoin:p,swapBtnText:Le,toSwap:en,loading:Z,swaping:w,autoRefreshTime:U,countdown:y,marketTimer:se,rateChange:P,isSwapConfirmMpdal:_,fromCoinBlance:le,toCoinBlance:ce,poolInfo:R,chainName:N,swapRouterLoading:Pe,formatFee:Go,calculating:$,currentRate:lo,currentRateReverse:uo,getCoinIcon:on,toAddLiquidiPoolInfo:ae,decimalUi:re,warningToCoin:pe,warningFromCoin:_e,isShowRouterModal:nn,toSwapLoading:tn,insufficientLiquidity:V,routerPool:oo,routerTotalAmounts:ho,store:E,suiPreSwapdata:Xe,suiSwapFee:wo,addCommom:W,debounce:Ye,notFoundRouter:$e,getSuiAmountAccept:yo,isShowAccept:Ce,getSuiAmount:So}}});const Se=e=>(je("data-v-4d4b8501"),e=e(),Me(),e),Ba={class:"swap-container"},Fa={class:"title"},Ta={class:"left"},Ua={class:"right title-right"},ja=Se(()=>o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-a-icon-setslippage"})],-1)),Ma={class:"swap-card"},Ea={class:"card-container"},La={class:"card-item"},Da={class:"card-item"},Wa=Se(()=>o("use",{"xlink:href":"#icon-icon-swap1"},null,-1)),qa=[Wa],Ja={key:1,class:"induction"},Qa={key:0,class:"exchange-rate-btn"},Xa={key:0},za={key:0},Ha={key:0},Ya={key:1},Za={key:0},Ka=Se(()=>o("div",null,[o("svg",{class:"icon icon-up","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_up1"})])],-1)),Ga=Se(()=>o("div",null,[o("svg",{class:"icon icon-down","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_down1"})])],-1)),Va=[Ka,Ga],xa={class:"item"},ei={class:"induction-text"},oi={key:0,class:"icon","aria-hidden":"true"},ni=Se(()=>o("use",{"xlink:href":"#icon-icon-warning1"},null,-1)),ti=[ni],si={class:"item"},ai={class:"induction-text"},ii={key:0,class:"induction-value"},li={class:"item"},ui={class:"induction-text"},ri={key:0,class:"induction-value"},ci={key:0,class:"icon","aria-hidden":"true"},di=Se(()=>o("use",{"xlink:href":"#icon-icon-swap"},null,-1)),mi=[di],vi={key:2,class:"token-info-container"},pi={class:"token-info-title"},gi=Se(()=>o("span",{class:"coingecko"},"Price Reference",-1)),fi=Se(()=>o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-icon-information"})],-1));function hi(e,g,k,S,E,L){var a,l;const v=cn,I=dn,j=at,X=Oo,G=Bo,P=jo,_=Cn,z=wn,t=bn,Y=Fo,O=Ut,p=An,Z=Ms,w=Ra,$=Ue("image");return d(),A("div",Ba,[o("div",Fa,[o("div",Ta,u(e.$t("menu.swap")),1),o("div",Ua,[o("div",{class:"slippage-icon",onClick:g[0]||(g[0]=U=>e.isShowSwapSetting=!0)},[ja,o("span",null,u(e.slippage)+"%",1)]),we(v,{loading:e.refresh,"auto-refresh-time":e.autoRefreshTime,countdown:e.countdown,onClickRefresh:e.clickRefresh},null,8,["loading","auto-refresh-time","countdown","onClickRefresh"])])]),o("div",Ma,[o("div",Ea,[o("div",La,[we(I,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":g[1]||(g[1]=U=>e.fromCoinAmount=U),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logo_url:"",address:e.fromCoin?e.fromCoin.address:"","swap-direction":"From",onOnMax:g[2]||(g[2]=U=>e.maxBtnSelect("fromCoin")),onOnHalf:g[3]||(g[3]=U=>e.halfBtnSelect("fromCoin")),onOnInput:g[4]||(g[4]=U=>{e.fromCoinAmount=U,e.fixedFromCoin=!0}),onOnSelect:g[5]||(g[5]=U=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"])]),o("div",Da,[we(I,{modelValue:e.toCoinAmount,"onUpdate:modelValue":g[6]||(g[6]=U=>e.toCoinAmount=U),"input-value":e.toCoinAmount,havemax:!1,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direction":"To","coin-icon":e.toCoin?e.toCoin.logo_url:"",address:e.toCoin?e.toCoin.address:"",havehalf:!1,onOnInput:g[7]||(g[7]=U=>{e.toCoinAmount=U,e.fixedFromCoin=!1}),onOnSelect:g[8]||(g[8]=U=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"])]),o("img",{class:me(e.change?"gang animationex":"gang"),src:yn,alt:""},null,2),o("div",{class:me(["exchange",e.chainName=="Sui"?"sui-exchange":""]),onClick:g[9]||(g[9]=(...U)=>e.debounceClickExchange&&e.debounceClickExchange(...U))},[(d(),A("svg",{class:me(e.change?"icon animationex":"icon"),"aria-hidden":"true"},qa,2))],2)]),e.chainName=="Sui"&&!e.notFoundRouter?(d(),H(j,{key:0,"swap-loading":e.swaping,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"router-pool":e.routerPool,impact:e.impact,"insufficient-liquidity":e.insufficientLiquidity,"one-to-amount":e.oneToAmount,"one-from-amount":e.oneFromAmount,"sui-pre-swapdata":e.suiPreSwapdata,"sui-swap-fee":e.suiSwapFee,"swap-router-loading":e.swapRouterLoading},null,8,["swap-loading","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","router-pool","impact","insufficient-liquidity","one-to-amount","one-from-amount","sui-pre-swapdata","sui-swap-fee","swap-router-loading"])):e.poolInfo&&e.fromCoinAmount&&e.toCoinAmount&&e.fromCoinAmount!=="0"&&e.toCoinAmount!=="0"&&e.swapBtnText!==e.$t("button.poolNotFound")?(d(),A("div",Ja,[Number(e.fromCoinAmount)>0&&Number(e.toCoinAmount)>0?(d(),A("div",Qa,[e.rateChange?Number(e.fromCoinAmount)&&Number(e.toCoinAmount)&&e.rateChange?(d(),A("span",Ya,[Number(e.fromCoinAmount)&&Number(e.toCoinAmount)?(d(),A("span",Za,[K(o("img",null,null,512),[[$,e.toCoinUrl||e.getCoinIcon(e.toCoin)]]),oe(" 1 "+u(e.toCoin.symbol)+" ≈ ",1),K(o("img",null,null,512),[[$,e.fromCoinUrl||e.getCoinIcon(e.fromCoin)]]),o("span",null,u(("addCommom"in e?e.addCommom:Q(W))(("decimalUi"in e?e.decimalUi:Q(re))(e.currentRateReverse,e.fromCoin.decimals),e.fromCoin.decimals)),1),oe("  "+u(e.fromCoin.symbol),1)])):(d(),H(X,{key:1,indicator:e.indicator},null,8,["indicator"]))])):D("",!0):(d(),A("span",Xa,[K(o("img",null,null,512),[[$,e.fromCoinUrl||e.getCoinIcon(e.fromCoin)]]),oe(" 1 "+u(e.fromCoin.symbol)+" ≈ ",1),Number(e.fromCoinAmount)&&Number(e.toCoinAmount)?(d(),A("span",za,[K(o("img",null,null,512),[[$,e.toCoinUrl||e.getCoinIcon(e.toCoin)]]),e.calculating?D("",!0):(d(),A("span",Ha,u(("addCommom"in e?e.addCommom:Q(W))(("decimalUi"in e?e.decimalUi:Q(re))(e.currentRate,e.toCoin.decimals))),1)),e.calculating?(d(),H(X,{key:1,indicator:e.indicator},null,8,["indicator"])):D("",!0),oe("  "+u(e.toCoin.symbol),1)])):(d(),H(X,{key:1,indicator:e.indicator},null,8,["indicator"]))])),o("div",{class:"icon-change",onClick:g[10]||(g[10]=U=>e.rateChange=!e.rateChange)},Va)])):D("",!0),Number(e.fromCoinAmount)>0&&Number(e.toCoinAmount)>0?(d(),A(so,{key:1},[o("div",xa,[o("div",ei,u(e.$t("common.priceImpact")),1),e.swaping?(d(),H(G,{key:1,paragraph:!1,active:""})):(d(),A("div",{key:0,class:me(["induction-value",Number(e.impact)<1?"impact-s":Number(e.impact)<10&&Number(e.impact)>1?"impact-w":"impact-e"])},[oe(u(Number(e.impact)<.01?"<0.01":Number(e.impact)>100?"100":e.impact)+"% ",1),e.impact>=10?(d(),A("svg",oi,ti)):D("",!0)],2))]),o("div",si,[o("div",ai,u(e.fixedFromCoin?e.$t("common.minimumReceived"):e.$t("common.maximumSold")),1),e.swaping?(d(),H(G,{key:1,paragraph:!1,active:""})):(d(),A("div",ii,u(e.fixedFromCoin?("addCommom"in e?e.addCommom:Q(W))(("fixD"in e?e.fixD:Q(Ze))(Number(e.toCoinAmount)-Number(e.toCoinAmount)*Number(e.slippage)/100,e.toCoin.decimals),e.toCoin.decimals):("addCommom"in e?e.addCommom:Q(W))(("fixD"in e?e.fixD:Q(Ze))(Number(e.fromCoinAmount)*Number(e.slippage)/100+Number(e.fromCoinAmount),e.fromCoin.decimals),e.fromCoin.decimals))+" "+u(e.fixedFromCoin?e.toCoin.symbol:e.fromCoin.symbol),1))]),o("div",li,[o("div",ui,u(e.$t("common.fee")),1),e.swaping?(d(),H(G,{key:1,paragraph:!1,active:""})):(d(),A("div",ri,u(("addCommom"in e?e.addCommom:Q(W))(e.formatFee,e.fromCoin.decimals))+" "+u(e.fromCoin.symbol)+" ("+u(e.chainName=="Aptos"?e.poolInfo.fee*100:((a=e.toAddLiquidiPoolInfo)==null?void 0:a.fee)*100)+"%) ",1))])],64)):D("",!0)])):D("",!0)]),we(P,{disabled:e.wallet.connected?e.swaping||!e.fromCoin||!e.toCoin||!Number(e.fromCoinAmount)||!Number(e.toCoinAmount)||Number(e.fromCoinAmount)>Number(e.fromCoinBlance)||e.swapBtnText==e.$t("button.poolNotFound")||e.swapBtnText!==e.$t("button.swap")||((l=e.poolInfo)==null?void 0:l.is_pause)||e.swapRouterLoading:!1,class:"big-btn",loading:e.chainName=="Aptos"?e.swaping:!1,onClick:g[11]||(g[11]=U=>e.wallet.connected?e.isSwapConfirmMpdal=!0:e.wallet.setIsShowWalletModal(!0))},{default:de(()=>[e.wallet.connected?(d(),A("svg",ci,mi)):D("",!0),o("span",null,u(e.wallet.connected?e.swapBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled","loading"]),we(_),e.showCoinSelect?(d(),H(z,{key:0,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:g[12]||(g[12]=U=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):D("",!0),e.isShowSwapSetting?(d(),H(t,{key:1,onOnClose:g[13]||(g[13]=U=>e.isShowSwapSetting=!1)})):D("",!0),e.chainName&&(e.formCoinMarket||e.toCoinMarket)?(d(),A("div",vi,[o("div",pi,[gi,we(Y,{placement:"top","arrow-point-at-center":""},{title:de(()=>[oe(" The following price is only an external reference from 3rd party data providers, which does not reflect actual data on Cetus. ")]),default:de(()=>[fi]),_:1})]),e.fromCoin&&e.formCoinMarket?(d(),H(O,{key:0,id:e.formCoinId,coin:e.fromCoin,market:e.formCoinMarket,refresh:e.refresh},null,8,["id","coin","market","refresh"])):D("",!0),e.toCoin&&e.toCoinMarket?(d(),H(O,{key:1,id:e.toCoinId,coin:e.toCoin,market:e.toCoinMarket,refresh:e.refresh},null,8,["id","coin","market","refresh"])):D("",!0)])):D("",!0),e.chainName=="Sui"&&e.isShowTokenWarning?(d(),H(p,{key:3,"from-coin":e.warningFromCoin,"to-coin":e.warningToCoin,onClose:e.closeTokenWarning,onClickContinue:e.getTokenSource},null,8,["from-coin","to-coin","onClose","onClickContinue"])):D("",!0),e.isShowRouterModal?(d(),H(Z,{key:4,"sui-pre-swapdata":e.suiPreSwapdata,"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,onOnClose:g[14]||(g[14]=U=>e.store.setIsShowRouterModal(!1))},null,8,["sui-pre-swapdata","from-coin","to-coin","from-coin-amount","to-coin-amount"])):D("",!0),e.isSwapConfirmMpdal?(d(),H(w,{key:5,"sui-pre-swapdata":e.suiPreSwapdata,"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,slippage:e.slippage,impact:e.impact,"fixed-from-coin":e.fixedFromCoin,fee:e.chainName=="Sui"?e.suiSwapFee:e.poolInfo.fee,"format-fee":e.chainName=="Sui"?e.suiSwapFee:e.formatFee,"is-show-accept":e.isShowAccept,"swap-loading":e.swapRouterLoading,"one-from-amount":e.oneFromAmount,"one-to-amount":e.oneToAmount,onOnClose:e.closeSwapConfirmModal,onToSwap:e.toSwap,onAccept:e.updateAccept},null,8,["sui-pre-swapdata","from-coin","to-coin","from-coin-amount","to-coin-amount","slippage","impact","fixed-from-coin","fee","format-fee","is-show-accept","swap-loading","one-from-amount","one-to-amount","onOnClose","onToSwap","onAccept"])):D("",!0)])}const Qi=Te(Oa,[["render",hi],["__scopeId","data-v-4d4b8501"]]);export{Qi as default};
