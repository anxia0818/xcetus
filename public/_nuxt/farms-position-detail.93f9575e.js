import{u as x,m as ss,e as es,s as R,a as H,c as T}from"./pool.24492b2f.js";import{a as os,l as f,b as as,r as A,q as ts,e as ns,s as rs,o as u,f as S,h as e,j as _,v as M,u as D,F as is,E as ls,c as F,w,x as L,i as q,z as ds,B as cs,P as us,t as z,p as ms,k as ps}from"./entry.818b5f76.js";/* empty css              */import{u as fs}from"./farms.cb51ef8b.js";import{i as vs}from"./import-icon.de3e6c66.js";import{D as G}from"./decimal.0bdeb344.js";import{a as hs,u as _s}from"./sha256.e99e00a8.js";const ws=os({setup(){const s=x(),m=f(()=>s),$=fs(),j=f(()=>$),I=as(),a=f(()=>m.value.currentPositionInfo),d=A(),y=o=>{var t;return((t=m.value.tokensObj[o])==null?void 0:t.logo_url)||vs("/image/coins/sui-unknown.png")},v=ss("Sui"),i=A(),N=async o=>{i.value=0;const t=await v.calculateFarmingRewards([{pool_id:o.pool_id,position_nft_id:o.id}]),l=[];let r=new G(0);t[o.id].forEach(n=>{var U;const g=(U=m.value.tokensObj[n.rewarder_type])==null?void 0:U.decimals;let k=new G(n.rewarder_amount).div(Math.pow(10,g)).toString();Number(k)>0&&(r=r.add(k),l.push({...n,rewarderAmount:k,rewarderAmountPer:k}))}),i.value=r,d.value=l,console.log("getRewarder",o,l)},B=f(()=>j.value.farmsPoolObj);ts(()=>[a.value,B.value],([o,t])=>{!T(o)&&o.positionSource=="farming"?N(o):!T(t)&&!T(o)&&(console.log(t,"##farmsPoolObj"),d.value=t[o.poolAddress].rewarders)},{immediate:!0});const J=hs(),E=f(()=>J),O=_s(),h=es("Sui"),{setIsShowSuccess:V,setIsShowRejected:b,setIsShowWaiting:c,setTransactionDesc:W,setTransactionTxid:C}=O,p=A(!1),K=async()=>{p.value=!0,C(""),W("Claim rewards"),c(!0);const o={pool_id:a.value.pool_id,position_nft_id:a.value.id};try{const t=await v.harvestFarms(o),l=await E.value.currentWallet.signAndExecuteTransactionBlock(t);console.log("0221###sui swap res###",l);let r=h.handleTx(l);if(r&&r.hash){C(r.hash),c(!1),V(!0);let n={title:"Claim",res:r.res,hash:r.hash};h.showTransitionPending(n),await h.watchTransaction(n)&&setTimeout(()=>{N(a.value)},2e3)}else c(!1),b(!0);p.value=!1}catch(t){console.log("farmsDeposit error",t),c(!1),b(!0),p.value=!1}},Q=async()=>{p.value=!0,C(""),W(`Unstake ${a.value.name}`),c(!0);const o=a.value.pool_id,t=a.value.id;try{const l=await v.farmsWithdraw(o,t),r=await E.value.currentWallet.signAndExecuteTransactionBlock(l);console.log("0221###sui swap res###",r);let n=h.handleTx(r);if(console.log(n,"unStaketx##"),n&&n.hash){C(n.hash),c(!1),V(!0);let g={res:n.res,title:"Unstake",hash:n.hash};h.showTransitionPending(g),await h.watchTransaction(g)&&setTimeout(()=>{console.log("unstake success"),I.replace(`/new-position-detail?name=${a.value.tokenName}address=${a.value.clmm_pool_id}&pos=${a.value.clmm_position_id}`),m.value.setCurrentPositionInfo(a.value.clmm_pool_id,"",a.value.tokenName,"Sui",a.value.clmm_position_id)},2e3)}else c(!1),b(!0);p.value=!1}catch(l){console.log("farmsDeposit error",l),c(!1),b(!0),p.value=!1}},X=async()=>{I.push("/farms")},Y=f(()=>O),Z=f(()=>Y.value.addressLpTokens);return{getCoinIcon:y,rewardList:d,sFixD:R,addCommom:H,claim:K,unStake:Q,loading:p,totalRewardAmount:i,currentPositionInfo:a,stake:X,farmsPoolObj:B,addressLpTokens:Z}}});const P=s=>(ms("data-v-6ae9b50a"),s=s(),ps(),s),gs={key:0,class:"farms-position-detail"},ks={class:"farms-top"},Ss=P(()=>e("div",{class:"left"},[e("div",{class:"title"},"Farming"),e("div",{class:"desc"},"Stake Position to Earn")],-1)),Ps={class:"right"},bs={class:"apr"},Cs=P(()=>e("span",null,"View",-1)),Is=P(()=>e("svg",{class:"arrow-icon","aria-hidden":"true"},[e("use",{"xlink:href":"#icon-icon_arrow"})],-1)),ys=[Cs,Is],Ts={class:"farms-bottom"},As=P(()=>e("div",{class:"title"},"Earnings",-1)),Ds={class:"reward-list"},Fs={key:0,class:"rewards-item-bg"},Ls={class:"rewards-item-box"},Rs={alt:""},$s={key:1},js={class:"rewards-item-bg"},Ns={class:"rewards-item-box"},Bs={alt:""},Es=P(()=>e("span",null,"0",-1)),Os={class:"actions-box"};function Vs(s,m,$,j,I,a){const d=cs,y=us,v=rs("image");return s.farmsPoolObj&&s.farmsPoolObj[s.currentPositionInfo.poolAddress]&&(s.farmsPoolObj[s.currentPositionInfo.poolAddress].status=="Live"||s.totalRewardAmount>0)?(u(),S("div",gs,[e("div",ks,[Ss,e("div",Ps,[e("div",bs,[_(" APR "),e("span",null,M(("sFixD"in s?s.sFixD:D(R))(s.addressLpTokens&&s.addressLpTokens[s.currentPositionInfo.poolAddress]&&s.addressLpTokens[s.currentPositionInfo.poolAddress].stable_farming&&s.addressLpTokens[s.currentPositionInfo.poolAddress].stable_farming.apr*100,2))+"%",1)]),e("div",{class:"view",onClick:m[0]||(m[0]=i=>s.$router.push("/farms"))},ys)])]),e("div",Ts,[As,e("div",Ds,[(u(!0),S(is,null,ls(s.rewardList,i=>(u(),S("div",{key:i,class:"rewards-item"},[s.currentPositionInfo.positionSource=="farming"?(u(),S("div",Fs,[e("div",Ls,[z(e("img",Rs,null,512),[[v,s.getCoinIcon(i.rewarder_type)]]),e("span",null,M(i.rewarderAmountPer>0&&i.rewarderAmountPer<.01?"<0.01":("addCommom"in s?s.addCommom:D(H))(("sFixD"in s?s.sFixD:D(R))(i.rewarderAmount,4))),1)])])):(u(),S("div",$s,[e("div",js,[e("div",Ns,[z(e("img",Bs,null,512),[[v,s.getCoinIcon(i.reward_coin)]]),Es])])]))]))),128))]),e("div",Os,[s.currentPositionInfo&&s.currentPositionInfo.positionSource=="farming"?(u(),F(d,{key:0,class:"unstake-btn",loading:s.loading,onClick:s.unStake},{default:w(()=>[_("Unstake")]),_:1},8,["loading","onClick"])):L("",!0),s.currentPositionInfo&&s.currentPositionInfo.positionSource=="clmm"&&s.currentPositionInfo.currentStatus!=="Active"?(u(),F(y,{key:1},{title:w(()=>[_("Farming rewards are only available for active positions.")]),default:w(()=>[q(d,{class:"unstake-btn",loading:s.loading,disabled:!0,onClick:s.stake},{default:w(()=>[_("Stake")]),_:1},8,["loading","onClick"])]),_:1})):s.currentPositionInfo&&s.currentPositionInfo.positionSource=="clmm"?(u(),F(d,{key:2,class:"unstake-btn",loading:s.loading,onClick:s.stake},{default:w(()=>[_("Stake")]),_:1},8,["loading","onClick"])):L("",!0),q(d,{class:"unstake-btn btn-margin",loading:s.loading,disabled:s.totalRewardAmount==0||s.currentPositionInfo&&s.currentPositionInfo.positionSource!=="farming",onClick:ds(s.claim,["stop"])},{default:w(()=>[_("â†‘ Claim")]),_:1},8,["loading","disabled","onClick"])])])])):L("",!0)}const Js=ns(ws,[["render",Vs],["__scopeId","data-v-6ae9b50a"]]);export{Js as _};
